<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V4 Vertical Header Sections - Annotated Template</title>
    <style>
        /* V4 Focused Sections with Vertical Headers - Annotated with UI Terminology */

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            width: 100vw;
            background: #f8f9fa;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* CSS Variables for V3 Compatibility */
        :root {
            --note-fill: #008080;
            --note-text: #FFFFFF;
            --triangle-fill: #008080;
            --bent-note-color: #E67E22;
        }

        .v4-container {
            width: 100%;
            max-width: none;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        /* INTERACTIVE TABLATURE AREA - Full-width top section */
        .tablature-overlay-container {
            width: 100%;
            position: relative;
            background: white;
            border-bottom: 3px solid #3498db;
            padding: 20px;
            box-sizing: border-box;
        }

        /* SECTION CONTAINER - Main content area holding all analysis sections */
        .sections-container {
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 15px; /* SECTION GAP - Space between analysis sections */
        }

        /* ANALYSIS SECTION - Individual collapsible analysis container */
        .analysis-section {
            width: 100%;
            background: white;
            border: 2px solid #e0e0e0; /* SECTION BORDER */
            border-radius: 12px; /* SECTION BORDER RADIUS */
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); /* SECTION SHADOW */
            overflow: hidden;
            order: 0;
            box-sizing: border-box;
            transition: all 0.3s ease;
            display: flex; /* LAYOUT: Horizontal flex for vertical header */
        }

        .analysis-section.highlighted {
            border-color: #3498db; /* HIGHLIGHT BORDER COLOR */
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3); /* HIGHLIGHT SHADOW */
            transform: translateY(-2px); /* HIGHLIGHT LIFT EFFECT */
        }

        /* VERTICAL HEADER - Left side vertical panel (replaces horizontal header) */
        .vertical-header {
            /* POSITION: x=0, y=0 (left edge of section) */
            /* DIMENSIONS: width=80px, height=100% of section */
            width: 80px;
            background: linear-gradient(180deg, #3498db, #2980b9); /* VERTICAL GRADIENT */
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 15px 5px; /* VERTICAL HEADER PADDING */
            cursor: pointer;
            user-select: none;
            transition: background 0.3s ease;
            position: relative; /* POSITIONING CONTEXT */
            flex-shrink: 0; /* PREVENT SHRINKING */
        }

        .vertical-header:hover {
            background: linear-gradient(180deg, #2980b9, #1f639a); /* HOVER GRADIENT */
        }

        .vertical-header.active-focus {
            background: linear-gradient(180deg, #27ae60, #229954); /* ACTIVE GRADIENT */
        }

        /* SECTION ICON - Top element in vertical header */
        .section-icon {
            /* POSITION: x=40px (center), y=20px (top area) */
            font-size: 24px; /* ICON SIZE */
            margin-bottom: 8px; /* ICON BOTTOM MARGIN */
            display: block;
        }

        /* SECTION TITLE - Center element in vertical header */
        .section-title {
            /* POSITION: x=40px (center), y=middle (varies by content) */
            font-size: 11px; /* TITLE FONT SIZE */
            font-weight: 600; /* TITLE FONT WEIGHT */
            text-align: center;
            line-height: 1.2; /* TITLE LINE HEIGHT */
            margin: 0;
            writing-mode: horizontal-tb; /* TITLE WRITING MODE */
            max-width: 70px;
            word-wrap: break-word;
        }

        /* VERTICAL CONTROLS - Control elements in vertical header */
        .vertical-controls {
            /* POSITION: x=40px (center), y=bottom area */
            display: flex;
            flex-direction: column;
            gap: 3px; /* CONTROL GAP */
            margin-top: 8px; /* CONTROLS TOP MARGIN */
            align-items: center;
        }

        /* MOVE ARROWS - Up/down movement controls */
        .vertical-move-arrow {
            /* POSITION: x=40px (center), y=varies in controls area */
            /* DIMENSIONS: width=20px, height=16px */
            background: #2c3e50; /* ARROW BACKGROUND */
            border: 1px solid #34495e; /* ARROW BORDER */
            border-radius: 3px; /* ARROW BORDER RADIUS */
            color: white;
            cursor: pointer;
            padding: 2px 4px; /* ARROW PADDING */
            font-size: 10px; /* ARROW FONT SIZE */
            font-weight: bold;
            min-width: 20px; /* ARROW MIN WIDTH */
            text-align: center;
            transition: all 0.2s ease;
        }

        .vertical-move-arrow:hover {
            background: #1a252f; /* ARROW HOVER BACKGROUND */
            transform: scale(1.1); /* ARROW HOVER SCALE */
        }

        /* COLLAPSE TOGGLE - Expand/collapse indicator */
        .vertical-collapse-toggle {
            /* POSITION: x=40px (center), y=bottom of controls */
            font-size: 14px; /* TOGGLE ICON SIZE */
            margin-top: 5px; /* TOGGLE TOP MARGIN */
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .collapsed .vertical-collapse-toggle {
            transform: rotate(-90deg); /* COLLAPSED ROTATION */
        }

        /* SECTION CONTENT - Main content area (right side) */
        .section-content {
            /* POSITION: x=80px (after vertical header), y=0 */
            /* DIMENSIONS: width=calc(100% - 80px), height=auto */
            flex: 1; /* CONTENT FLEX GROW */
            padding: 20px; /* CONTENT PADDING */
            display: block;
            max-height: 1000px; /* CONTENT MAX HEIGHT */
            overflow-y: auto; /* CONTENT OVERFLOW */
            transition: max-height 0.4s ease;
        }

        .section-content.collapsed {
            max-height: 0; /* COLLAPSED HEIGHT */
            padding: 0 20px; /* COLLAPSED PADDING */
        }

        /* METRIC GRID - Container for metric cards */
        .metric-grid {
            /* POSITION: x=0 (relative to content), y=0 (top of content) */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* GRID COLUMNS */
            gap: 15px; /* METRIC CARD GAP */
            margin: 15px 0; /* GRID MARGIN */
        }

        /* METRIC CARD - Individual metric display container */
        .metric-card {
            /* POSITION: x=varies (grid), y=varies (grid) */
            /* DIMENSIONS: min-width=150px, height=auto */
            background: #f8f9fa; /* CARD BACKGROUND */
            border: 1px solid #e9ecef; /* CARD BORDER */
            border-radius: 8px; /* CARD BORDER RADIUS */
            padding: 15px; /* CARD PADDING */
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* CARD SHADOW */
        }

        .metric-card:hover {
            background: #e9ecef; /* CARD HOVER BACKGROUND */
            transform: translateY(-2px); /* CARD HOVER LIFT */
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); /* CARD HOVER SHADOW */
        }

        .metric-card.highlighted {
            background: #d4edda; /* CARD HIGHLIGHT BACKGROUND */
            border-color: #27ae60; /* CARD HIGHLIGHT BORDER */
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3); /* CARD HIGHLIGHT SHADOW */
        }

        /* METRIC VALUE - Main numeric/text value display */
        .metric-value {
            /* POSITION: x=center of card, y=top area of card */
            font-size: 24px; /* VALUE FONT SIZE */
            font-weight: bold; /* VALUE FONT WEIGHT */
            color: #2c3e50; /* VALUE COLOR */
            margin-bottom: 5px; /* VALUE BOTTOM MARGIN */
            line-height: 1; /* VALUE LINE HEIGHT */
        }

        /* METRIC LABEL - Descriptive text below value */
        .metric-label {
            /* POSITION: x=center of card, y=bottom area of card */
            font-size: 12px; /* LABEL FONT SIZE */
            color: #7f8c8d; /* LABEL COLOR */
            font-weight: 500; /* LABEL FONT WEIGHT */
            line-height: 1.2; /* LABEL LINE HEIGHT */
            margin: 0; /* LABEL MARGIN */
        }

        /* CROSS REFERENCE BOX - Shows relationships to other sections */
        .cross-reference {
            /* POSITION: x=0 (relative to content), y=below metric grid */
            /* DIMENSIONS: width=100% of content area, height=auto */
            background: #fff3cd; /* CROSS REF BACKGROUND */
            border: 1px solid #ffeaa7; /* CROSS REF BORDER */
            border-radius: 6px; /* CROSS REF BORDER RADIUS */
            padding: 10px; /* CROSS REF PADDING */
            margin: 10px 0; /* CROSS REF MARGIN */
            font-size: 13px; /* CROSS REF FONT SIZE */
            color: #856404; /* CROSS REF TEXT COLOR */
        }

        .cross-reference.active {
            background: #d1ecf1; /* ACTIVE CROSS REF BACKGROUND */
            border-color: #bee5eb; /* ACTIVE CROSS REF BORDER */
            color: #0c5460; /* ACTIVE CROSS REF TEXT */
        }

        /* TABLATURE REFERENCE - Mini tablature clone in section */
        .tablature-reference {
            /* POSITION: x=0 (relative to content), y=bottom of content */
            /* DIMENSIONS: width=100% of content area, height=auto */
            margin: 15px 0; /* TABLATURE REF MARGIN */
            border: 1px solid #ddd; /* TABLATURE REF BORDER */
            border-radius: 6px; /* TABLATURE REF BORDER RADIUS */
            background: #fafafa; /* TABLATURE REF BACKGROUND */
            padding: 10px; /* TABLATURE REF PADDING */
            overflow-x: auto; /* TABLATURE REF OVERFLOW */
        }

        /* HIGHLIGHT OVERLAYS - Dynamic highlighting system */
        .highlight-overlay {
            position: absolute;
            pointer-events: none;
            border-radius: 50%; /* OVERLAY BORDER RADIUS */
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10; /* OVERLAY Z-INDEX */
            /* DIMENSIONS: width=20px, height=20px (set via JavaScript) */
            /* POSITION: x,y set dynamically based on tablature note positions */
        }

        .highlight-overlay.active {
            opacity: 0.8; /* ACTIVE OVERLAY OPACITY */
            animation: pulse 1.5s infinite; /* ACTIVE OVERLAY ANIMATION */
        }

        /* HIGHLIGHT COLOR CLASSES - Different highlight types */
        .highlight-tone-nga { background: rgba(156, 89, 182, 0.6); } /* PURPLE for ngÃ£ tone */
        .highlight-pitch-e { background: rgba(52, 152, 219, 0.6); } /* BLUE for E notes */
        .highlight-rank-17 { background: rgba(231, 76, 60, 0.6); } /* RED for rank #17 */
        .highlight-melisma { background: rgba(241, 196, 15, 0.6); } /* GOLD for melisma */
        .highlight-string-usage { background: rgba(39, 174, 96, 0.6); } /* GREEN for string usage */

        @keyframes pulse {
            0% { transform: scale(1); } /* PULSE START SCALE */
            50% { transform: scale(1.2); } /* PULSE MAX SCALE */
            100% { transform: scale(1); } /* PULSE END SCALE */
        }

        /* RESPONSIVE ADJUSTMENTS */
        @media (max-width: 768px) {
            .vertical-header {
                width: 60px; /* MOBILE HEADER WIDTH */
            }
            .section-title {
                font-size: 10px; /* MOBILE TITLE SIZE */
            }
            .section-icon {
                font-size: 20px; /* MOBILE ICON SIZE */
            }
        }

    </style>
</head>
<body>

    <div class="v4-container">

        <!-- SONG HEADER -->
        <!-- POSITION: x=0, y=0 (top of page) -->
        <!-- DIMENSIONS: width=100vw, height=auto -->
        <div class="song-header" style="width: 100%; background: white; border-bottom: 3px solid #3498db; padding: 20px; box-sizing: border-box; text-align: center;">
            <h1 style="margin: 0 0 10px 0; color: #2c3e50;">{{SONG_NAME}}</h1>
            <p style="margin: 0; color: #7f8c8d;">V4 Tuning Analysis with Bent Note Detection</p>
        </div>

        <!-- SECTIONS CONTAINER -->
        <!-- POSITION: x=0, y=after tablature -->
        <!-- DIMENSIONS: width=100%, height=auto (content-based) -->
        <div class="sections-container" id="sectionsContainer">

            <!-- OPTIMAL TUNING SECTION (Fixed - Always on top) -->
            <!-- POSITION: x=0, y=0 (first section) -->
            <!-- DIMENSIONS: width=100%, height=auto -->
            <div class="analysis-section" id="optimalTuningSection" data-order="0" data-focus="optimal-tuning">

                <!-- VERTICAL HEADER -->
                <!-- POSITION: x=0, y=0 (left edge of section) -->
                <!-- DIMENSIONS: width=80px, height=100% of section content -->
                <div class="vertical-header" onclick="toggleSection('optimalTuningSection')">

                    <!-- SECTION ICON -->
                    <!-- POSITION: x=40px (center of header), y=20px (top area) -->
                    <span class="section-icon">ðŸŽ¸</span>

                    <!-- SECTION TITLE -->
                    <!-- POSITION: x=40px (center of header), y=middle area -->
                    <h3 class="section-title">Optimal Tuning</h3>

                    <!-- VERTICAL CONTROLS -->
                    <!-- POSITION: x=40px (center of header), y=bottom area -->
                    <div class="vertical-controls">
                        <!-- Note: No move arrows for first section (fixed position) -->

                        <!-- COLLAPSE TOGGLE -->
                        <!-- POSITION: x=40px (center), y=bottom of controls -->
                        <span class="vertical-collapse-toggle">â–¼</span>
                    </div>
                </div>

                <!-- SECTION CONTENT -->
                <!-- POSITION: x=80px (after vertical header), y=0 -->
                <!-- DIMENSIONS: width=calc(100% - 80px), height=auto -->
                <div class="section-content">

                    <!-- SECTION LABEL -->
                    <h4 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 18px; font-weight: 600;">Optimal Tuning Analysis</h4>

                    <!-- TUNING CONTROLS -->
                    <div class="tuning-controls" style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                        <div class="tuning-info" style="display: flex; align-items: center; gap: 10px;">
                            <label style="font-weight: 600; color: #2c3e50;">Tuning System:</label>
                            <span class="tuning-display" id="optimalTuning" style="font-family: monospace; font-size: 14px; color: #008080; font-weight: bold;">C-D-E-G-A (Standard Pentatonic)</span>
                            <span class="bent-notes-indicator" style="display: flex; align-items: center; gap: 8px; margin-left: 15px;">
                                <span class="bent-notes-count" id="optimalBentCount" style="color: #E67E22; font-weight: 600;">0 bent notes</span>
                                <button class="bent-toggle-btn" onclick="toggleBentNotes('optimal')" title="Toggle bent notes visibility"
                                        style="background: #E67E22; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;">
                                    Show/Hide
                                </button>
                            </span>
                        </div>
                    </div>

                    <!-- OPTIMAL TUNING TABLATURE -->
                    <!-- POSITION: x=0 (relative to content), y=after controls -->
                    <!-- DIMENSIONS: width=100% of content area, height=auto -->
                    <div class="tablature-reference" style="overflow-x: auto; border: 2px solid #008080; border-radius: 6px; padding: 15px; background: white;">
                        <svg width="{{SVG_WIDTH}}" height="{{SVG_HEIGHT}}" xmlns="http://www.w3.org/2000/svg" id="optimalSvg">
                            {{OPTIMAL_SVG_CONTENT}}
                        </svg>
                    </div>

                </div>
            </div>

            <!-- ALTERNATIVE TUNING SECTION 1 (Moveable) -->
            <!-- POSITION: x=0, y=after previous section + gap -->
            <div class="analysis-section" id="altTuning1Section" data-order="1" data-focus="alt-tuning-1">

                <!-- VERTICAL HEADER -->
                <div class="vertical-header" onclick="toggleSection('altTuning1Section')">

                    <!-- SECTION ICON -->
                    <span class="section-icon">ðŸŽ¼</span>

                    <!-- SECTION TITLE -->
                    <h3 class="section-title">Alt Tuning 1</h3>

                    <!-- VERTICAL CONTROLS -->
                    <div class="vertical-controls">
                        <!-- MOVE ARROWS (for moveable sections) -->
                        <!-- UP ARROW -->
                        <!-- POSITION: x=40px (center), y=controls top -->
                        <button class="vertical-move-arrow" onclick="moveSection('altTuning1Section', 'up'); event.stopPropagation();">â–²</button>

                        <!-- DOWN ARROW -->
                        <!-- POSITION: x=40px (center), y=after up arrow + gap -->
                        <button class="vertical-move-arrow" onclick="moveSection('altTuning1Section', 'down'); event.stopPropagation();">â–¼</button>

                        <!-- COLLAPSE TOGGLE -->
                        <span class="vertical-collapse-toggle">â–¼</span>
                    </div>
                </div>

                <!-- SECTION CONTENT -->
                <div class="section-content collapsed">

                    <!-- SECTION LABEL -->
                    <h4 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 18px; font-weight: 600;">Alternative Tuning Comparison 1</h4>

                    <!-- TUNING CONTROLS -->
                    <div class="tuning-controls" style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                        <div class="tuning-info" style="display: flex; align-items: center; gap: 10px;">
                            <label style="font-weight: 600; color: #2c3e50;">Tuning System:</label>
                            <select class="tuning-selector" id="altTuning1Select" onchange="updateAlternativeTuning(1, this.value)"
                                    style="padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                <option value="C-D-F-G-A">C-D-F-G-A (Northern)</option>
                                <option value="C-D-E-G-Bb">C-D-E-G-Bâ™­ (Southern)</option>
                                <option value="C-Eb-F-G-Bb">C-Eâ™­-F-G-Bâ™­ (Central)</option>
                                <option value="D-E-G-A-B">D-E-G-A-B (Modern)</option>
                            </select>
                            <span class="bent-notes-indicator" style="display: flex; align-items: center; gap: 8px; margin-left: 15px;">
                                <span class="bent-notes-count" id="alt1BentCount" style="color: #E67E22; font-weight: 600;">2 bent notes</span>
                                <button class="bent-toggle-btn" onclick="toggleBentNotes('alt1')" title="Toggle bent notes visibility"
                                        style="background: #E67E22; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;">
                                    Show/Hide
                                </button>
                            </span>
                        </div>
                    </div>

                    <!-- ALTERNATIVE TUNING TABLATURE -->
                    <div class="tablature-reference" style="overflow-x: auto; border: 2px solid #3498db; border-radius: 6px; padding: 15px; background: white;">
                        <svg width="{{SVG_WIDTH}}" height="{{SVG_HEIGHT}}" xmlns="http://www.w3.org/2000/svg" id="alt1Svg">
                            {{COMPARISON_SVG_CONTENT}}
                        </svg>
                    </div>

                </div>
            </div>

            <!-- ALTERNATIVE TUNING SECTION 2 (Moveable) -->
            <!-- POSITION: x=0, y=after previous section + gap -->
            <div class="analysis-section" id="altTuning2Section" data-order="2" data-focus="alt-tuning-2">

                <!-- VERTICAL HEADER -->
                <div class="vertical-header" onclick="toggleSection('altTuning2Section')">
                    <span class="section-icon">ðŸŽµ</span>
                    <h3 class="section-title">Alt Tuning 2</h3>
                    <div class="vertical-controls">
                        <button class="vertical-move-arrow" onclick="moveSection('altTuning2Section', 'up'); event.stopPropagation();">â–²</button>
                        <button class="vertical-move-arrow" onclick="moveSection('altTuning2Section', 'down'); event.stopPropagation();">â–¼</button>
                        <span class="vertical-collapse-toggle">â–¼</span>
                    </div>
                </div>

                <!-- SECTION CONTENT -->
                <div class="section-content collapsed">

                    <!-- SECTION LABEL -->
                    <h4 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 18px; font-weight: 600;">Alternative Tuning Comparison 2</h4>

                    <!-- TUNING CONTROLS -->
                    <div class="tuning-controls" style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                        <div class="tuning-info" style="display: flex; align-items: center; gap: 10px;">
                            <label style="font-weight: 600; color: #2c3e50;">Tuning System:</label>
                            <select class="tuning-selector" id="altTuning2Select" onchange="updateAlternativeTuning(2, this.value)"
                                    style="padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                <option value="C-D-E-G-Bb">C-D-E-G-Bâ™­ (Southern)</option>
                                <option value="C-D-F-G-A">C-D-F-G-A (Northern)</option>
                                <option value="C-Eb-F-G-Bb">C-Eâ™­-F-G-Bâ™­ (Central)</option>
                                <option value="D-E-G-A-B">D-E-G-A-B (Modern)</option>
                            </select>
                            <span class="bent-notes-indicator" style="display: flex; align-items: center; gap: 8px; margin-left: 15px;">
                                <span class="bent-notes-count" id="alt2BentCount" style="color: #E67E22; font-weight: 600;">3 bent notes</span>
                                <button class="bent-toggle-btn" onclick="toggleBentNotes('alt2')" title="Toggle bent notes visibility"
                                        style="background: #E67E22; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;">
                                    Show/Hide
                                </button>
                            </span>
                        </div>
                    </div>

                    <!-- ALTERNATIVE TUNING TABLATURE -->
                    <div class="tablature-reference" style="overflow-x: auto; border: 2px solid #9b59b6; border-radius: 6px; padding: 15px; background: white;">
                        <svg width="{{SVG_WIDTH}}" height="{{SVG_HEIGHT}}" xmlns="http://www.w3.org/2000/svg" id="alt2Svg">
                            <!-- Alternative tuning 2 tablature will be rendered here -->
                        </svg>
                    </div>

                </div>
            </div>

            <!-- ALTERNATIVE TUNING SECTION 3 (Moveable) -->
            <!-- POSITION: x=0, y=after previous section + gap -->
            <div class="analysis-section" id="altTuning3Section" data-order="3" data-focus="alt-tuning-3">

                <!-- VERTICAL HEADER -->
                <div class="vertical-header" onclick="toggleSection('altTuning3Section')">
                    <span class="section-icon">ðŸŽ»</span>
                    <h3 class="section-title">Alt Tuning 3</h3>
                    <div class="vertical-controls">
                        <button class="vertical-move-arrow" onclick="moveSection('altTuning3Section', 'up'); event.stopPropagation();">â–²</button>
                        <button class="vertical-move-arrow" onclick="moveSection('altTuning3Section', 'down'); event.stopPropagation();">â–¼</button>
                        <span class="vertical-collapse-toggle">â–¼</span>
                    </div>
                </div>

                <!-- SECTION CONTENT -->
                <div class="section-content collapsed">

                    <!-- SECTION LABEL -->
                    <h4 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 18px; font-weight: 600;">Alternative Tuning Comparison 3</h4>

                    <!-- TUNING CONTROLS -->
                    <div class="tuning-controls" style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                        <div class="tuning-info" style="display: flex; align-items: center; gap: 10px;">
                            <label style="font-weight: 600; color: #2c3e50;">Tuning System:</label>
                            <select class="tuning-selector" id="altTuning3Select" onchange="updateAlternativeTuning(3, this.value)"
                                    style="padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                <option value="C-Eb-F-G-Bb">C-Eâ™­-F-G-Bâ™­ (Central)</option>
                                <option value="C-D-F-G-A">C-D-F-G-A (Northern)</option>
                                <option value="C-D-E-G-Bb">C-D-E-G-Bâ™­ (Southern)</option>
                                <option value="D-E-G-A-B">D-E-G-A-B (Modern)</option>
                            </select>
                            <span class="bent-notes-indicator" style="display: flex; align-items: center; gap: 8px; margin-left: 15px;">
                                <span class="bent-notes-count" id="alt3BentCount" style="color: #E67E22; font-weight: 600;">4 bent notes</span>
                                <button class="bent-toggle-btn" onclick="toggleBentNotes('alt3')" title="Toggle bent notes visibility"
                                        style="background: #E67E22; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;">
                                    Show/Hide
                                </button>
                            </span>
                        </div>
                    </div>

                    <!-- ALTERNATIVE TUNING TABLATURE -->
                    <div class="tablature-reference" style="overflow-x: auto; border: 2px solid #e74c3c; border-radius: 6px; padding: 15px; background: white;">
                        <svg width="{{SVG_WIDTH}}" height="{{SVG_HEIGHT}}" xmlns="http://www.w3.org/2000/svg" id="alt3Svg">
                            <!-- Alternative tuning 3 tablature will be rendered here -->
                        </svg>
                    </div>

                </div>
            </div>

            <!-- Additional sections would follow the same pattern... -->

        </div>
    </div>

    <script>
        // V4 Vertical Header System with Cross-Highlighting

        const verticalHeaderSystem = {
            // Cross-reference relationships between sections
            relationships: {
                'tone-nga': ['melisma-groups', 'rank-17-notes', 'phrase-peaks'],
                'pitch-e': ['string-usage', 'melodic-emphasis', 'traditional-elements'],
                'melisma-count': ['tone-nga', 'grace-notes', 'phrase-endings'],
                'unique-pitches': ['string-usage', 'tuning-system', 'cultural-context']
            },

            // Active highlights tracking
            activeHighlights: new Set(),

            // Correlation examples with positioning data
            correlationExamples: {
                'tone-nga': {
                    description: "NgÃ£ tone appears in 80% of melismas on rank #17 notes",
                    relatedSections: ['melismaSection', 'patternsSection'],
                    tablatureHighlights: ['tone-nga', 'melisma-groups', 'rank-17'],
                    highlightPositions: [
                        { x: 120, y: 80, type: 'tone-nga' },
                        { x: 280, y: 110, type: 'melisma-groups' }
                    ]
                }
            }
        };

        // SECTION TOGGLE FUNCTION
        function toggleSection(sectionId) {
            // UI ELEMENTS ACCESSED:
            const content = document.querySelector(`#${sectionId} .section-content`); // CONTENT AREA
            const toggle = document.querySelector(`#${sectionId} .vertical-collapse-toggle`); // TOGGLE ICON
            const section = document.getElementById(sectionId); // ENTIRE SECTION
            const header = document.querySelector(`#${sectionId} .vertical-header`); // VERTICAL HEADER

            if (content.classList.contains('collapsed')) {
                // EXPAND SECTION
                content.classList.remove('collapsed');
                toggle.textContent = 'â–¼'; // EXPANDED ICON
                section.classList.remove('collapsed');
                header.classList.add('active-focus'); // ACTIVE HEADER STYLING

                // ACTIVATE CROSS-HIGHLIGHTING
                activateCrossHighlighting(sectionId);
            } else {
                // COLLAPSE SECTION
                content.classList.add('collapsed');
                toggle.textContent = 'â–¶'; // COLLAPSED ICON
                section.classList.add('collapsed');
                header.classList.remove('active-focus');

                // DEACTIVATE CROSS-HIGHLIGHTING
                deactivateCrossHighlighting(sectionId);
            }
        }

        // METRIC HIGHLIGHTING FUNCTION
        function highlightMetric(metricId) {
            console.log(`Highlighting metric: ${metricId}`);

            // CLEAR PREVIOUS HIGHLIGHTS
            clearAllHighlights();

            // HIGHLIGHT RELATED ELEMENTS ON TABLATURE
            const relatedElements = verticalHeaderSystem.relationships[metricId] || [];
            relatedElements.forEach(elementType => {
                highlightTablatureElements(elementType);
            });

            // HIGHLIGHT RELATED SECTIONS
            highlightRelatedSections(metricId);

            // SHOW CROSS-REFERENCE INFORMATION
            showCrossReferences(metricId);

            // UPDATE METRIC CARD APPEARANCE
            document.querySelectorAll('.metric-card').forEach(card => {
                card.classList.remove('highlighted');
            });
            document.querySelector(`[data-metric="${metricId}"]`).classList.add('highlighted');
        }

        // TABLATURE ELEMENT HIGHLIGHTING FUNCTION
        function highlightTablatureElements(elementType) {
            console.log(`Highlighting tablature elements: ${elementType}`);

            // EXAMPLE HIGHLIGHT POSITIONS (would be calculated from real data)
            const highlightPositions = {
                'pitch-e': [{ x: 220, y: 140 }, { x: 340, y: 170 }],
                'melisma-groups': [{ x: 180, y: 110 }, { x: 280, y: 110 }],
                'tone-nga': [{ x: 120, y: 80 }],
                'rank-17': [{ x: 220, y: 140 }]
            };

            const positions = highlightPositions[elementType] || [];
            const className = `highlight-${elementType.replace('_', '-')}`;

            addHighlightOverlays(className, positions);
        }

        // ADD HIGHLIGHT OVERLAYS FUNCTION
        function addHighlightOverlays(className, positions) {
            const container = document.getElementById('highlightOverlayContainer');

            positions.forEach(pos => {
                const overlay = document.createElement('div');
                overlay.className = `highlight-overlay ${className} active`;
                // OVERLAY POSITIONING
                overlay.style.left = pos.x + 'px'; // X COORDINATE
                overlay.style.top = pos.y + 'px';  // Y COORDINATE
                overlay.style.width = '20px';     // OVERLAY WIDTH
                overlay.style.height = '20px';    // OVERLAY HEIGHT
                container.appendChild(overlay);
            });
        }

        // MOVE SECTION FUNCTION (Fixed for Vertical Headers)
        window.moveSection = function(sectionId, direction) {
            console.log(`V4 Move: ${sectionId} ${direction}`);

            const section = document.getElementById(sectionId);
            if (!section) {
                console.log('Section not found:', sectionId);
                return false;
            }

            const container = document.getElementById('sectionsContainer');
            const movableSections = Array.from(container.querySelectorAll('.analysis-section:not(#optimalTuningSection)'));

            console.log('Found movable sections:', movableSections.map(s => s.id));

            // ENSURE FLEXBOX LAYOUT
            container.style.display = 'flex';
            container.style.flexDirection = 'column';

            // INITIALIZE ORDER VALUES
            movableSections.forEach((s, i) => {
                if (!s.style.order) {
                    s.style.order = s.dataset.order || (i + 1);
                }
                console.log(`Section ${s.id} order: ${s.style.order}`);
            });

            // GET SORTED SECTIONS
            const sortedSections = movableSections.map(s => ({
                section: s,
                order: parseInt(s.style.order),
                id: s.id
            })).sort((a, b) => a.order - b.order);

            const currentIndex = sortedSections.findIndex(s => s.section === section);
            console.log(`Current index: ${currentIndex}, direction: ${direction}`);

            if (direction === 'up' && currentIndex > 0) {
                // MOVE UP
                const prevSection = sortedSections[currentIndex - 1];
                const tempOrder = section.style.order;
                section.style.order = prevSection.section.style.order;
                prevSection.section.style.order = tempOrder;

                console.log(`Moved ${sectionId} UP - swapped orders`);

                // FORCE BROWSER REFLOW
                container.style.display = 'none';
                container.offsetHeight; // TRIGGER REFLOW
                container.style.display = 'flex';

                return true;

            } else if (direction === 'down' && currentIndex < sortedSections.length - 1) {
                // MOVE DOWN
                const nextSection = sortedSections[currentIndex + 1];
                const tempOrder = section.style.order;
                section.style.order = nextSection.section.style.order;
                nextSection.section.style.order = tempOrder;

                console.log(`Moved ${sectionId} DOWN - swapped orders`);

                // FORCE BROWSER REFLOW
                container.style.display = 'none';
                container.offsetHeight;
                container.style.display = 'flex';

                return true;
            }

            console.log('Move not possible - at boundary or invalid direction');
            return false;
        };

        // OLD BENT NOTES TOGGLE FUNCTION - REMOVED (conflicts with new modular system)

        // UPDATE ALTERNATIVE TUNING FUNCTION
        function updateAlternativeTuning(tuningNumber, selectedTuning) {
            console.log(`Updating alternative tuning ${tuningNumber} to: ${selectedTuning}`);

            // Update bent notes count based on tuning
            const bentCountElement = document.getElementById(`alt${tuningNumber}BentCount`);
            if (bentCountElement) {
                // Simulate different bent note counts for different tunings
                const bentCounts = {
                    'C-D-F-G-A': 2,
                    'C-D-E-G-Bb': 3,
                    'C-Eb-F-G-Bb': 4,
                    'D-E-G-A-B': 1
                };
                const count = bentCounts[selectedTuning.split(' ')[0]] || 0;
                bentCountElement.textContent = `${count} bent note${count !== 1 ? 's' : ''}`;
            }

            // Here you would normally regenerate the SVG based on the new tuning
            // For now, we'll just log the change
        }

        // PLACEHOLDER FUNCTIONS
        function clearAllHighlights() { /* Clear all visual highlights */ }
        function highlightRelatedSections(metricId) { /* Highlight related sections */ }
        function showCrossReferences(metricId) { /* Show cross-reference information */ }
        function activateCrossHighlighting(sectionId) { /* Activate cross-highlighting for section */ }
        function deactivateCrossHighlighting(sectionId) { /* Deactivate cross-highlighting */ }

        // INITIALIZATION
        document.addEventListener('DOMContentLoaded', function() {
            console.log('V4 Vertical Header Sections System Initialized');
            console.log('UI Elements: Vertical headers, metric cards, cross-reference boxes, tablature references');
        });

    </script>

    <!-- Include Client Tablature Generator -->
    <script src="/static/client-tablature-generator.js"></script>

    <!-- Dynamic Update Functions -->
    <script>
        // Store bent note visibility state for each section
        window.bentNotesVisible = {
            optimal: true,
            alt1: true,
            alt2: true,
            alt3: true
        };

        // Override the updateAlternativeTuning function to actually update the tablature
        window.updateAlternativeTuning = function(tuningNumber, selectedValue) {
            console.log(`Updating Alternative Tuning ${tuningNumber} to: ${selectedValue}`);

            // Parse the tuning key from the dropdown value
            const tuningKey = tablatureGenerator.parseTuningKey(selectedValue);
            if (!tuningKey) {
                console.error('Invalid tuning value:', selectedValue);
                return;
            }

            // Update the SVG with current bent note visibility state
            const svgId = `alt${tuningNumber}Svg`;
            const sectionKey = `alt${tuningNumber}`;
            const showBent = bentNotesVisible[sectionKey];
            const bentCount = tablatureGenerator.updateSVG(svgId, tuningKey, null, showBent);

            // Update the bent notes count display
            const bentCountElement = document.getElementById(`alt${tuningNumber}BentCount`);
            if (bentCountElement) {
                bentCountElement.textContent = `${bentCount} bent note${bentCount !== 1 ? 's' : ''}`;
            }

            console.log(`Tablature updated with ${bentCount} bent notes`);
        };

        // Toggle bent notes visibility
        window.toggleBentNotes = function(sectionKey) {
            // Toggle the visibility state
            bentNotesVisible[sectionKey] = !bentNotesVisible[sectionKey];
            const isVisible = bentNotesVisible[sectionKey];

            // Update the corresponding SVG
            let svgId;
            if (sectionKey === 'optimal') {
                svgId = 'optimalSvg';
            } else {
                svgId = `${sectionKey}Svg`;
            }

            tablatureGenerator.toggleBentNotes(svgId, isVisible);

            console.log(`${sectionKey} bent notes ${isVisible ? 'shown' : 'hidden'}`);
        };

        // Initialize tablatures on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize optimal tuning tablature
            tablatureGenerator.updateSVG('optimalSvg', 'C-D-E-G-A');

            // Initialize alternative tuning tablatures with their default values
            tablatureGenerator.updateSVG('alt1Svg', 'C-D-F-G-A');
            tablatureGenerator.updateSVG('alt2Svg', 'C-D-E-G-Bb');
            tablatureGenerator.updateSVG('alt3Svg', 'C-Eb-F-G-Bb');

            console.log('V4 Tablatures initialized with dynamic update capability');
        });
    </script>

    <!-- UI TERMINOLOGY REFERENCE -->
    <!--
    LAYOUT STRUCTURE:
    - TABLATURE OVERLAY CONTAINER: Top full-width area containing interactive tablature
    - SECTIONS CONTAINER: Main content area containing all analysis sections
    - ANALYSIS SECTION: Individual collapsible container for each analysis type

    VERTICAL HEADER COMPONENTS:
    - VERTICAL HEADER: Left-side vertical panel (replaces horizontal header/banner)
    - SECTION ICON: Visual identifier (ðŸŽµ, ðŸ—£ï¸, ðŸŽ¶, etc.)
    - SECTION TITLE: Text description of analysis type
    - VERTICAL CONTROLS: Container for move arrows and collapse toggle
    - VERTICAL MOVE ARROW: Up/down movement buttons
    - VERTICAL COLLAPSE TOGGLE: Expand/collapse indicator

    SECTION CONTENT COMPONENTS:
    - SECTION CONTENT: Main content area (right side of section)
    - METRIC GRID: Grid container for metric cards
    - METRIC CARD: Individual metric display (rounded rectangle you mentioned)
    - METRIC VALUE: Main numeric/text value
    - METRIC LABEL: Descriptive text below value
    - CROSS REFERENCE BOX: Shows relationships to other sections
    - TABLATURE REFERENCE: Mini tablature clone for context

    POSITIONING SYSTEM:
    - X COORDINATES: 0 = left edge, increases rightward
    - Y COORDINATES: 0 = top edge, increases downward
    - VERTICAL HEADER: x=0, width=80px
    - SECTION CONTENT: x=80px, width=calc(100% - 80px)
    - METRIC CARDS: Grid positioning within content area
    -->

</body>
</html>