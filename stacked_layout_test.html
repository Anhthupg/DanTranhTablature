<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stacked Layout Test - Vietnamese Lyrics</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .lyrics-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #3498db;
        }

        .line-group {
            margin-bottom: 25px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }

        .vietnamese-line {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            line-height: 1.4;
            padding: 10px;
            background: #e8f4fd;
            border-radius: 5px;
            border: 1px solid #3498db;
        }

        .english-line {
            font-size: 14px;
            color: #666;
            font-style: italic;
            margin-bottom: 12px;
            line-height: 1.3;
            padding: 8px;
            background: #f0f0f0;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .line-controls {
            display: flex;
            gap: 5px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            color: white;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .play-btn { background: #4CAF50; }
        .loop-btn { background: #2196F3; }
        .stop-btn { background: #f44336; }
        .phonetic-btn { background: #9C27B0; }
        .google-btn { background: #4285F4; }
        .voice-btn { background: #FF7043; }

        .line-number {
            display: inline-block;
            background: #95a5a6;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            margin-right: 8px;
            min-width: 20px;
            text-align: center;
        }

        .syllable {
            display: inline-block;
            padding: 2px 4px;
            margin: 1px;
            border-radius: 3px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .syllable:hover {
            background-color: #e3f2fd;
        }

        .line-break {
            color: #bdc3c7;
            cursor: pointer;
            margin: 0 1px;
            font-weight: bold;
            opacity: 0.3;
            transition: opacity 0.2s;
            font-size: 10px;
            padding: 0 1px;
        }

        .line-break:hover {
            opacity: 0.8;
            color: #3498db;
        }

        .line-break.active {
            color: #3498db;
            opacity: 0.7;
        }

        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }

            .vietnamese-line {
                font-size: 16px;
            }

            .english-line {
                font-size: 13px;
            }

            .line-controls {
                justify-content: center;
            }

            .control-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .vietnamese-line {
                font-size: 15px;
            }

            .english-line {
                font-size: 12px;
            }

            .control-btn {
                padding: 6px 8px;
                font-size: 10px;
                margin: 2px;
            }
        }
    </style>
</head>
<body>
    <a href="analytical_tablature.html" class="back-btn">‚Üê Back to Tablature</a>

    <div class="container">
        <h1>üì± Stacked Layout Test</h1>

        <div class="instructions">
            <strong>üìù Testing Stacked Layout:</strong> This shows Vietnamese on top, English below, with all controls attached to the Vietnamese line.
            <strong>üì± Mobile-Friendly:</strong> Works great on tablets and phones. Try resizing your browser window to see responsive behavior.
        </div>

        <div class="lyrics-container">
            <div id="stacked-lyrics">
                <!-- Lines will be generated here -->
            </div>
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <button onclick="generateLines()" style="background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">üîÑ Regenerate Lines</button>
            <button onclick="toggleLineBreaks()" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px;">üìù Toggle Line Breaks</button>
        </div>
    </div>

    <script>
        // Sample lyrics data (same as your main app)
        const lyricsData = [
            {
                vietnamese: "B√† R·∫±ng b√† R√≠, ·ªõi r·∫±ng b√† ƒëi",
                english: "Lady Rang lady Ri, oh telling lady where-to-go"
            },
            {
                vietnamese: "·ªõi ƒëi l√† ƒë√¢u b√† ƒëi kh·∫Øp ch·ªën n·ªëi d√¢y t∆° h·ªìng",
                english: "oh going is where lady goes everywhere places connecting threads silk red"
            },
            {
                vietnamese: "c√°i duy√™n √¥ng ch·ªìng l√†m kh·ªï c√°i ƒë·ªùi t√¥i ∆°i b√† R√≠ ∆°i",
                english: "the destiny of husband making miserable the life of-mine oh lady Ri oh"
            },
            {
                vietnamese: "b√† R·∫±ng b√† R√≠ ∆°i. Ch·ªìng g√¨ m√† ch·ªìng b√©,",
                english: "lady Rang lady Ri oh. What-husband what-kind that husband so-small,"
            },
            {
                vietnamese: "b√© t·∫πo t√®o teo, ch√¢n ƒëi c√† kheo",
                english: "small tiny skinny lean, legs walking crooked limping"
            },
            {
                vietnamese: "l√∫c ƒëi ph·∫£i c√µng l√∫c kh√≥c ph·∫£i b·ªìng",
                english: "when going must carry when crying must hold"
            }
        ];

        function generateLines() {
            const container = document.getElementById('stacked-lyrics');
            container.innerHTML = '';

            lyricsData.forEach((line, index) => {
                const lineGroup = document.createElement('div');
                lineGroup.className = 'line-group';

                lineGroup.innerHTML = `
                    <div class="vietnamese-line">
                        <span class="line-number">${index + 1}</span>
                        ${createEditableSyllables(line.vietnamese, index)}
                    </div>
                    <div class="english-line">
                        ${line.english}
                    </div>
                    <div class="line-controls">
                        <button class="control-btn play-btn" onclick="playLine(${index})" title="Play music for line ${index + 1}">‚ñ∂Ô∏è Play</button>
                        <button class="control-btn loop-btn" onclick="loopLine(${index})" title="Loop music for line ${index + 1}">üîÑ Loop</button>
                        <button class="control-btn stop-btn" onclick="stopLine(${index})" title="Stop music for line ${index + 1}">‚èπÔ∏è Stop</button>
                        <button class="control-btn phonetic-btn" onclick="showPhonetic('${line.vietnamese}', ${index})" title='"${line.vietnamese}"\nüìù Vietnamese pronunciation guide'>üìù Guide</button>
                        <button class="control-btn google-btn" onclick="openGoogle('${line.vietnamese}')" title='"${line.vietnamese}"\nüåê Google Translate - High quality pronunciation'>üåê Google</button>
                        <button class="control-btn voice-btn" onclick="playVoice('${line.vietnamese}', ${index})" title='"${line.vietnamese}"\nüîä System voice - Natural pronunciation'>üîä Voice</button>
                    </div>
                `;

                container.appendChild(lineGroup);
            });
        }

        function createEditableSyllables(text, lineIndex) {
            // Convert text to syllables with line break markers
            const words = text.split(' ');
            let result = '';

            words.forEach((word, index) => {
                result += `<span class="syllable" data-word="${word}" data-line="${lineIndex}">${word}</span>`;
                if (index < words.length - 1) {
                    result += ` <span class="line-break" data-break-after="${index}" onclick="toggleBreak(${lineIndex}, ${index})">|</span> `;
                }
            });

            return result;
        }

        function toggleBreaks() {
            // Demo function to show line break toggling
            document.querySelectorAll('.line-break').forEach((breakEl, index) => {
                if (Math.random() > 0.7) {
                    breakEl.classList.toggle('active');
                }
            });
        }

        function toggleBreak(lineIndex, breakIndex) {
            const breakEl = document.querySelector(`[data-line="${lineIndex}"][data-break-after="${breakIndex}"]`);
            if (breakEl) {
                breakEl.classList.toggle('active');
            }
        }

        // Placeholder functions for controls
        function playLine(index) {
            alert(`Playing line ${index + 1} music`);
        }

        function loopLine(index) {
            alert(`Looping line ${index + 1} music`);
        }

        function stopLine(index) {
            alert(`Stopping line ${index + 1} music`);
        }

        function showPhonetic(text, index) {
            // Simple phonetic conversion
            const phonetic = text
                .replace(/√†|√°|·∫£|√£|·∫°/g, 'ah')
                .replace(/ƒÉ|·∫±|·∫Ø|·∫≥|·∫µ|·∫∑/g, 'a')
                .replace(/√¢|·∫ß|·∫•|·∫©|·∫´|·∫≠/g, 'aw')
                .replace(/√®|√©|·∫ª|·∫Ω|·∫π/g, 'eh')
                .replace(/√™|·ªÅ|·∫ø|·ªÉ|·ªÖ|·ªá/g, 'ay')
                .replace(/√¨|√≠|·ªâ|ƒ©|·ªã/g, 'ee')
                .replace(/√≤|√≥|·ªè|√µ|·ªç/g, 'oh')
                .replace(/√¥|·ªì|·ªë|·ªï|·ªó|·ªô/g, 'aw')
                .replace(/∆°|·ªù|·ªõ|·ªü|·ª°|·ª£/g, 'uh')
                .replace(/√π|√∫|·ªß|≈©|·ª•/g, 'oo')
                .replace(/∆∞|·ª´|·ª©|·ª≠|·ªØ|·ª±/g, 'oo')
                .replace(/·ª≥|√Ω|·ª∑|·ªπ|·ªµ/g, 'ee')
                .replace(/ƒë/g, 'd')
                .replace(/r·∫±ng/g, 'zahng')
                .replace(/r√≠/g, 'zee');

            alert(`Vietnamese: ${text}\nPhonetic: ${phonetic}`);
        }

        function openGoogle(text) {
            const encodedText = encodeURIComponent(text);
            const url = `https://translate.google.com/?sl=vi&tl=en&text=${encodedText}&op=translate`;
            window.open(url, 'GoogleTranslate', 'width=600,height=500,scrollbars=yes,resizable=yes');
        }

        function playVoice(text, index) {
            if ('speechSynthesis' in window) {
                // Stop any existing speech
                speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);

                // Find best Vietnamese voice
                const voices = speechSynthesis.getVoices();
                const vietnameseVoice = voices.find(voice =>
                    voice.lang.includes('vi') || voice.name.toLowerCase().includes('viet')
                ) || voices.find(voice =>
                    voice.lang.includes('zh') || voice.lang.includes('ja') || voice.lang.includes('ko')
                ) || voices[0];

                if (vietnameseVoice) {
                    utterance.voice = vietnameseVoice;
                }

                utterance.lang = 'vi-VN';
                utterance.rate = 0.8;
                utterance.pitch = 1.0; // Natural pitch
                utterance.volume = 1.0;

                // Visual feedback
                const btn = document.querySelector(`[onclick="playVoice('${text}', ${index})"]`);
                if (btn) {
                    btn.innerHTML = 'üîä Playing...';
                    btn.style.background = '#E91E63';
                }

                utterance.onend = function() {
                    if (btn) {
                        btn.innerHTML = 'üîä Voice';
                        btn.style.background = '#FF7043';
                    }
                };

                speechSynthesis.speak(utterance);
            } else {
                alert('Text-to-speech not supported');
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            generateLines();
        });

        // Test responsive behavior
        function testMobile() {
            const container = document.querySelector('.container');
            container.style.maxWidth = '400px';
            container.style.fontSize = '14px';
            alert('Simulating mobile view - check how the layout adapts!');
        }

        // Test desktop view
        function testDesktop() {
            const container = document.querySelector('.container');
            container.style.maxWidth = '800px';
            container.style.fontSize = 'inherit';
            alert('Back to desktop view');
        }
    </script>

    <div style="position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-size: 12px;">
        <strong>üì± Test Responsive:</strong><br>
        <button onclick="testMobile()" style="background: #3498db; color: white; border: none; padding: 5px 8px; border-radius: 3px; margin: 2px; cursor: pointer;">üì± Mobile</button>
        <button onclick="testDesktop()" style="background: #2c3e50; color: white; border: none; padding: 5px 8px; border-radius: 3px; margin: 2px; cursor: pointer;">üñ•Ô∏è Desktop</button>
    </div>
</body>
</html>