<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytical ƒê√†n Tranh Tablature</title>
    <style>
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        header h2 {
            color: #7f8c8d;
            font-weight: normal;
            font-size: 1.1em;
        }
        
        .controls {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        
        .controls-grid {
            display: flex;
            gap: 20px;
        }

        .left-column {
            width: 300px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .right-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        @media (max-width: 1200px) {
            .controls-grid {
                flex-direction: column;
            }
            .left-column {
                width: 100%;
            }
        }
        
        .control-section.compact {
            margin-bottom: 0;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .section-title {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title.collapsible:hover {
            color: #3498db;
        }
        
        .toggle-icon {
            font-size: 12px;
            transition: transform 0.3s;
        }
        
        .toggle-icon.collapsed {
            transform: rotate(-90deg);
        }
        
        .section-content {
            transition: max-height 0.3s ease-out;
            overflow: hidden;
        }
        
        .section-content.collapsed {
            max-height: 0;
            margin: 0;
            padding: 0;
        }
        
        .inline-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        
        .inline-controls .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 0;
            min-width: auto;
        }
        
        .control-group-header {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .inline-controls label {
            font-size: 12px;
            margin-bottom: 0;
            white-space: nowrap;
        }
        
        .inline-controls select {
            padding: 4px;
            font-size: 12px;
            min-width: 80px;
        }
        
        .inline-controls input[type="range"] {
            width: 80px;
        }
        
        .inline-controls button {
            padding: 4px 8px;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .pattern-selector {
            margin-top: 8px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px;
        }
        
        .pattern-selector select {
            border: none;
            font-size: 11px;
            width: 100%;
            min-height: 60px;
        }
        
        .patterns-row {
            display: flex;
            gap: 15px;
        }
        
        .pattern-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .control-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .control-row:last-child {
            margin-bottom: 0;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }
        
        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .custom-zoom {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }
        
        .slider-container input[type="range"] {
            flex: 1;
        }
        
        .custom-zoom input {
            padding: 4px 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
        }
        
        .control-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #34495e;
        }
        
        select, input[type="range"] {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .tablature-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .lyrics-section {
            background: white;
            padding: 10px;
            margin-top: 10px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .lyrics-section h3 {
            color: #2c3e50;
            margin: 0 0 8px 0;
            font-size: 16px;
            border-bottom: 1px solid #3498db;
            padding-bottom: 4px;
        }
        
        .lyrics-content {
            font-size: 14px;
            line-height: 1.0;
            color: #2c3e50;
            font-family: serif;
        }
        
        .lyrics-line {
            margin-bottom: 0px;
            padding: 0;
            line-height: 1.1;
        }
        
        .syllable {
            margin-right: 4px;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }
        
        .syllable:hover {
            background-color: #ecf0f1;
            cursor: pointer;
        }
        
        .syllable.highlighted {
            background-color: #3498db;
            color: white;
        }
        
        .lyrics-edit-container {
            margin-top: 10px;
        }
        
        .edit-instructions {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 8px;
            padding: 5px;
            background: #ecf0f1;
            border-radius: 3px;
        }
        
        .editable-lyrics {
            line-height: 1.2;
        }
        
        .coverage-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 8px;
            color: orange;
            font-weight: bold;
            z-index: 10;
        }
        
        .editable-syllable {
            position: relative;
            display: inline-block;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        .editable-syllable:hover {
            background-color: rgba(33, 150, 243, 0.1);
        }

        .syllable-edit-controls {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            border-radius: 4px;
            padding: 3px;
            display: none;
            z-index: 1000;
            white-space: nowrap;
        }

        .syllable-edit-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 10px;
            padding: 3px 6px;
            cursor: pointer;
            border-radius: 2px;
            margin: 0 2px;
        }

        .syllable-edit-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .merge-left-btn { color: #4CAF50; }
        .merge-right-btn { color: #4CAF50; }
        .split-btn { color: #FF9800; }

        .learning-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2196F3;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            display: none;
            z-index: 1001;
            animation: fadeInOut 2s ease-in-out;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        @keyframes sankeyPulse {
            0% {
                filter: drop-shadow(0 0 15px #ff0000) drop-shadow(0 0 30px #ff0000) drop-shadow(0 0 45px #ff0000);
                opacity: 1.0;
            }
            50% {
                filter: drop-shadow(0 0 25px #ff0000) drop-shadow(0 0 50px #ff0000) drop-shadow(0 0 75px #ff0000);
                opacity: 0.8;
            }
            100% {
                filter: drop-shadow(0 0 15px #ff0000) drop-shadow(0 0 30px #ff0000) drop-shadow(0 0 45px #ff0000);
                opacity: 1.0;
            }
        }

        .dramatic-kpic-glow {
            filter: drop-shadow(0 0 12px #ff0000) drop-shadow(0 0 24px #ff0000) drop-shadow(0 0 36px #ff0000) !important;
        }

        .dramatic-kric-glow {
            filter: drop-shadow(0 0 12px #2196f3) drop-shadow(0 0 24px #2196f3) drop-shadow(0 0 36px #2196f3) !important;
        }

        .line-break {
            color: #bdc3c7;
            cursor: pointer;
            margin: 0 1px;
            font-weight: bold;
            opacity: 0.3;
            transition: opacity 0.2s;
            font-size: 10px;
            padding: 0 1px;
        }
        
        .line-break:hover {
            opacity: 0.8;
            color: #3498db;
        }
        
        .line-break.active {
            color: #3498db;
            opacity: 0.7;
        }
        
        .line-break.active::after {
            content: '\A';
            white-space: pre;
            line-height: 0.1;
        }

        
        .legend {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .legend h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .color-sample {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
            border: 1px solid #ccc;
        }
        
        .color-sample.kpic-highlight {
            background: linear-gradient(45deg, #ffeb3b 25%, #ff9800 25%, #ff9800 50%, #ffeb3b 50%, #ffeb3b 75%, #ff9800 75%);
            background-size: 4px 4px;
        }
        
        .color-sample.kric-highlight {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        
        .color-sample.syllable-repetition {
            background: white;
            border: 3px solid #f44336;
        }
        
        .color-sample.syllable-focus {
            background: #e91e63;
        }
        
        
        .color-sample.syllable-melismatic {
            background: #9c27b0;
            border-color: #6a1b9a;
        }
        
        .color-sample.grace-note {
            background: #FFD700;
            border-color: #0066FF;
        }

        /* Audio visual effects - Force entire circle area clickable */
        .note-circle {
            cursor: pointer !important;
            pointer-events: all !important;
            fill-opacity: 1 !important;
            fill: inherit !important;
        }

        .note-circle:hover {
            filter: brightness(0.9);
        }

        /* Ensure SVG allows all pointer events */
        svg {
            pointer-events: all;
        }

        .note-circle:hover {
            filter: brightness(0.9);
        }

        .active-note-glow {
            filter: drop-shadow(0 0 30px #ff6b35) drop-shadow(0 0 60px #ff6b35) drop-shadow(0 0 90px #ff6b35) drop-shadow(0 0 120px #ff6b35) !important;
            stroke: #ff6b35 !important;
            stroke-width: 6 !important;
            fill: #ffaa00 !important;
        }

        .fade-note-glow {
            filter: drop-shadow(0 0 20px #ff6b35) drop-shadow(0 0 40px #ff6b35) !important;
            stroke: #ff6b35 !important;
            stroke-width: 6 !important;
            transition: filter 3s ease-out, stroke-width 3s ease-out !important;
        }

        .fade-note-glow.fading {
            filter: drop-shadow(0 0 5px #ff6b35) !important;
            stroke-width: 2 !important;
        }
        
        
        #minCountValue {
            font-weight: bold;
            margin-left: 10px;
        }
        
        @media (max-width: 768px) {
            .control-row {
                flex-direction: column;
            }
            
            .control-group {
                min-width: auto;
            }
        }

        /* Styles for KPIC-3/KRIC-3 clickable bands */
        .clickable-band-3col {
            transition: opacity 0.2s, filter 0.2s;
        }

        .clickable-band-3col:hover {
            opacity: 0.9 !important;
            filter: brightness(1.2) drop-shadow(0 0 5px rgba(255, 107, 107, 0.6));
        }

        .clickable-band-3col.selected-band-3col {
            stroke: #ff6b6b !important;
            stroke-width: 3px !important;
            filter: drop-shadow(0 0 8px #ff6b6b) !important;
        }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                <a href="../../../index.html" style="text-decoration: none; color: #008080; font-weight: 600; font-size: 14px; padding: 8px 16px; border: 2px solid #008080; border-radius: 8px; transition: all 0.2s;">‚Üê Back to Library</a>
                <h1 style="margin: 0; flex: 1; text-align: center;">üéº Analytical ƒê√†n Tranh Tablature <span style="background: #667eea; color: white; padding: 3px 8px; border-radius: 10px; font-size: 12px; font-weight: bold; margin-left: 10px;">V3</span></h1>
                <div style="width: 140px;"></div>
            </div>
            <h2>MusicXML/ThieÃÇn ƒëaÃÄng ƒëiÃ£a nguÃ£c.musicxml</h2>
        </header>
        
        <div class="controls">
            <!-- Compact control grid -->
            <div class="controls-grid">
                <!-- Left Column: Mode, View, Audio -->
                <div class="left-column">
                    <!-- Mode -->
                    <div class="control-section compact">
                        <h4 class="section-title collapsible" onclick="toggleSection('settings')">
                            üéõÔ∏è Mode <span class="toggle-icon" id="settings-icon">‚ñº</span>
                        </h4>
                        <div class="section-content" id="settings-content">
                            <div class="inline-controls">
                                <div class="control-group">
                                    <div class="control-group-header">
                                        <div style="display: flex; gap: 15px; align-items: center;">
                                            <label style="display: flex; align-items: center; font-size: 12px;">
                                                <input type="radio" name="analysisMode" value="full" onchange="resetPatternsAndUpdate()" checked style="margin-right: 4px;">
                                                All Notes
                                            </label>
                                            <label style="display: flex; align-items: center; font-size: 12px;">
                                                <input type="radio" name="analysisMode" value="main_melody" onchange="resetPatternsAndUpdate()" style="margin-right: 4px;">
                                                Main Notes
                                            </label>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- View Controls -->
                    <div class="control-section compact">
                        <h4 class="section-title collapsible" onclick="toggleSection('view')">
                            üîç View <span class="toggle-icon" id="view-icon">‚ñº</span>
                        </h4>
                        <div class="section-content" id="view-content">
                            <div class="inline-controls">
                                <div class="control-group">
                                    <div class="control-group-header">
                                        <label>X-Zoom:</label>
                                        <select id="zoomLevel" onchange="updateZoomFromSelect()">
                                            <option value="fit-width" selected>Fit</option>
                                            <option value="1.0">100%</option>
                                            <option value="0.6">60%</option>
                                            <option value="0.4">40%</option>
                                            <option value="0.2">20%</option>
                                            <option value="0.1">10%</option>
                                            <option value="custom">Custom</option>
                                        </select>
                                        <div style="position: relative; width: 100px;">
                                            <input type="range" id="xZoomSlider" min="5" max="200" value="100"
                                                   oninput="updateZoomFromSlider('x')" style="width: 100%;">
                                            <span id="xZoomValue" style="position: absolute; top: -5px; left: 0px; font-size: 11px; font-weight: 600; color: #495057; background: white; padding: 2px 4px; border-radius: 3px; border: 1px solid #ddd; pointer-events: none;">100%</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="control-group">
                                    <div class="control-group-header">
                                        <label>Y-Zoom:</label>
                                        <select id="yZoomLevel" onchange="updateYZoomFromSelect()">
                                            <option value="fit-height">Fit Height</option>
                                            <option value="0.05">5%</option>
                                            <option value="0.10">10%</option>
                                            <option value="0.15">15%</option>
                                            <option value="0.20">20%</option>
                                            <option value="0.30" selected>30%</option>
                                            <option value="0.40">40%</option>
                                            <option value="0.50">50%</option>
                                            <option value="0.67">67%</option>
                                            <option value="0.80">80%</option>
                                            <option value="1.0">100%</option>
                                            <option value="1.5">150%</option>
                                            <option value="2.0">200%</option>
                                            <option value="custom">Custom</option>
                                        </select>
                                        <div style="position: relative; width: 100px;">
                                            <input type="range" id="yZoomSlider" min="5" max="300" value="67"
                                                   oninput="updateZoomFromSlider('y')" style="width: 100%;">
                                            <span id="yZoomValue" style="position: absolute; top: -5px; left: 0px; font-size: 11px; font-weight: 600; color: #495057; background: white; padding: 2px 4px; border-radius: 3px; border: 1px solid #ddd; pointer-events: none;">67%</span>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Right Column: Syllables, KPIC/KRIC -->
                <div class="right-column">
                    <!-- Syllable Analysis -->
                    <div class="control-section compact">
                        <h4 class="section-title collapsible" onclick="toggleSection('syllables')">
                            üìù Patterns <span class="toggle-icon" id="syllables-icon">‚ñº</span>
                        </h4>
                        <div class="section-content" id="syllables-content">
                            <div class="inline-controls">
                                <div class="control-group">
                                    <div class="control-group-header">
                                        <!-- Multi-Selection Checkboxes -->
                                        <div style="font-size: 11px; display: flex; gap: 8px; align-items: center;">

                                            <!-- Vietnamese Tones in compact line -->
                                            <label><input type="checkbox" id="multi_sac" onchange="handleMultiCheckbox()" style="margin-right: 2px; transform: scale(0.8);"><span style="color: #e53e3e; font-weight: 600;">S·∫Øc</span></label>
                                            <label><input type="checkbox" id="multi_huyen" onchange="handleMultiCheckbox()" style="margin-right: 2px; transform: scale(0.8);"><span style="color: #3182ce; font-weight: 600;">Huy·ªÅn</span></label>
                                            <label><input type="checkbox" id="multi_hoi" onchange="handleMultiCheckbox()" style="margin-right: 2px; transform: scale(0.8);"><span style="color: #38a169; font-weight: 600;">H·ªèi</span></label>
                                            <label><input type="checkbox" id="multi_nga" onchange="handleMultiCheckbox()" style="margin-right: 2px; transform: scale(0.8);"><span style="color: #d69e2e; font-weight: 600;">Ng√£</span></label>
                                            <label><input type="checkbox" id="multi_nang" onchange="handleMultiCheckbox()" style="margin-right: 2px; transform: scale(0.8);"><span style="color: #805ad5; font-weight: 600;">N·∫∑ng</span></label>
                                            <label><input type="checkbox" id="multi_ngang" onchange="handleMultiCheckbox()" style="margin-right: 2px; transform: scale(0.8);"><span style="color: #718096; font-weight: 600;">Ngang</span></label>

                                            <!-- Separator -->
                                            <span style="color: #ccc; margin: 0 5px;">|</span>

                                            <!-- Ornamentation -->
                                            <label><input type="checkbox" id="multi_grace" onchange="handleMultiCheckbox()" style="margin-right: 2px; transform: scale(0.8);"><span style="color: #38a169; font-weight: 600;">Grace</span></label>
                                            <label><input type="checkbox" id="multi_melisma" onchange="handleMultiCheckbox()" style="margin-right: 2px; transform: scale(0.8);"><span style="color: #d69e2e; font-weight: 600;">Melisma</span></label>

                                            <!-- Separator -->
                                            <span style="color: #ccc; margin: 0 5px;">|</span>

                                            <!-- Repeated Syllables -->
                                            <label><input type="checkbox" id="multi_repeated" onchange="handleMultiCheckbox()" style="margin-right: 2px; transform: scale(0.8);"><span style="color: #e53e3e; font-weight: 600;">Repeated:</span></label>
                                            <select id="multiRepeatedSelect" onchange="handleMultiCheckbox()" style="font-size: 10px; padding: 1px 2px;" disabled>
                                                <option value="">Choose...</option>
                                                <option value="b√†">"b√†" (13√ó)</option>
                                                <option value="∆°i">"∆°i" (7√ó)</option>
                                                <option value="c√°i">"c√°i" (6√ó)</option>
                                                <option value="R√≠">"R√≠" (6√ó)</option>
                                                <option value="R·∫±ng">"R·∫±ng" (5√ó)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="pattern-selector" id="specificSyllableGroup" style="display: none;">
                                        <select id="specificSyllable" onchange="updateHighlighting()" multiple size="3">
                                        </select>
                                        <small>Hold Ctrl/Cmd for multiple</small>
                                    </div>

                                    <div class="pattern-selector" id="repeatedSyllableGroup" style="display: none;">
                                        <label>Syllable:</label>
                                        <select id="repeatedSyllableSelect" onchange="updateHighlighting()">
                                            <option value="">Choose syllable...</option>
                                            <option value="b√†">"b√†" (13√ó)</option>
                                            <option value="∆°i">"∆°i" (7√ó)</option>
                                            <option value="c√°i">"c√°i" (6√ó)</option>
                                            <option value="R√≠">"R√≠" (6√ó)</option>
                                            <option value="R·∫±ng">"R·∫±ng" (5√ó)</option>
                                            <option value="ch·ªìng">"ch·ªìng" (5√ó)</option>
                                            <option value="ƒëi">"ƒëi" (4√ó)</option>
                                            <option value="l√†m">"l√†m" (4√ó)</option>
                                            <option value="duy√™n">"duy√™n" (3√ó)</option>
                                            <option value="√¥ng">"√¥ng" (3√ó)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- KPIC/KRIC Pattern Sliders -->
                    <div style="padding: 5px; position: relative;">
                        <div style="display: block;">
                            <div class="pattern-sliders">
                            <div style="display: flex; gap: 20px; justify-content: center;">
                                <!-- KPIC Slider + Pattern Box -->
                                <div style="display: flex; flex-direction: column; width: 580px; position: relative;">
                                    <!-- KPIC Label on top -->
                                    <label style="font-size: 13px; font-weight: 700; color: #495057; position: absolute; top: -15px; left: 0px; background: white; padding: 2px 8px; border-radius: 3px; z-index: 10;">KPIC</label>
                                    <!-- KPIC Slider -->
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 3px; margin-top: -13px;">
                                        <div style="position: relative; width: 100%;">
                                            <input type="range" id="kpicSlider" min="0" max="136" value="0"
                                                   style="width: 100%;"
                                                   oninput="handleKpicSlider()" onchange="handleKpicSlider()">
                                            <span id="kpicSliderValue" style="position: absolute; top: 0px; left: 0px; font-size: 11px; font-weight: 600; color: #495057; background: white; padding: 2px 4px; border-radius: 3px; border: 1px solid #ddd; pointer-events: none; z-index: 10000;">0</span>
                                        </div>
                                    </div>
                                    <!-- KPIC Pattern Selection -->
                                    <div class="pattern-selector" id="kpicPatternGroup" style="margin-top: -20px;">
                                        <select id="specificKpicPattern" onchange="updateHighlighting('dropdown')" multiple size="4" style="width: 100%; font-size: 11px; min-height: 80px;">
                                            <option disabled style="text-align: center; color: #6c757d;">Move KPIC slider to see patterns...</option>
                                        </select>
                                        <small style="color: #6c757d; font-size: 9px; display: block; margin-top: 2px;">Hold Ctrl/Cmd for multiple</small>
                                    </div>
                                </div>

                                <!-- KRIC Slider + Pattern Box -->
                                <div style="display: flex; flex-direction: column; width: 580px; position: relative;">
                                    <!-- KRIC Label on top -->
                                    <label style="font-size: 13px; font-weight: 700; color: #495057; position: absolute; top: -15px; left: 0px; background: white; padding: 2px 8px; border-radius: 3px; z-index: 10;">KRIC</label>
                                    <!-- KRIC Slider -->
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 3px; margin-top: -13px;">
                                        <div style="position: relative; width: 100%;">
                                            <input type="range" id="kricSlider" min="0" max="136" value="0"
                                                   style="width: 100%;"
                                                   oninput="handleKricSlider()" onchange="handleKricSlider()">
                                            <span id="kricSliderValue" style="position: absolute; top: 0px; left: 0px; font-size: 11px; font-weight: 600; color: #495057; background: white; padding: 2px 4px; border-radius: 3px; border: 1px solid #ddd; pointer-events: none; z-index: 10000;">0</span>
                                        </div>
                                    </div>
                                    <!-- KRIC Pattern Selection -->
                                    <div class="pattern-selector" id="kricPatternGroup" style="margin-top: -20px;">
                                        <select id="specificKricPattern" onchange="updateHighlighting('dropdown')" multiple size="4" style="width: 100%; font-size: 11px; min-height: 80px;">
                                            <option disabled style="text-align: center; color: #6c757d;">Move KRIC slider to see patterns...</option>
                                        </select>
                                        <small style="color: #6c757d; font-size: 9px; display: block; margin-top: 2px;">Hold Ctrl/Cmd for multiple</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                    </div>
                </div>

            </div>

            <div class="lyrics-edit-container">
            <div class="edit-instructions">
                <strong>üìù Interactive Lyrics:</strong> Click the "|" symbols to add/remove line breaks.
        
        <div id="legend" class="legend" style="display: none;">
            <h3>Color Legend</h3>
            <div class="legend-item"><span class="color-sample kpic-highlight"></span>KPIC Patterns</div>
            <div class="legend-item"><span class="color-sample kric-highlight"></span>KRIC Patterns</div>
            <div class="legend-item"><span class="color-sample syllable-repetition"></span>Repeated Syllables</div>
            <div class="legend-item"><span class="color-sample syllable-focus"></span>Focused Syllable</div>
            <div class="legend-item"><span class="color-sample syllable-melismatic"></span>Melismatic Syllables</div>
            <div class="legend-item"><span class="color-sample grace-note"></span>Grace Notes (prefix: g)</div>
        </div>

        <!-- Learning System Indicator -->
        <div id="learningIndicator" class="learning-indicator">
            Learning from your correction...
        </div>
        
        <div class="tablature-container">
            <svg width="11475" height="770.0" xmlns="http://www.w3.org/2000/svg" id="tablatureSvg"
                      data-base-width="11475">
<defs>
    <linearGradient id="resonanceBand" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#666666;stop-opacity:0.8"/>
        <stop offset="25%" style="stop-color:#666666;stop-opacity:0.6"/>
        <stop offset="50%" style="stop-color:#666666;stop-opacity:0.4"/>
        <stop offset="75%" style="stop-color:#666666;stop-opacity:0.2"/>
        <stop offset="100%" style="stop-color:#666666;stop-opacity:0"/>
    </linearGradient>

    <linearGradient id="graceResonanceBand" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#FFD700;stop-opacity:0.6"/>
        <stop offset="50%" style="stop-color:#FFD700;stop-opacity:0.3"/>
        <stop offset="100%" style="stop-color:#FFD700;stop-opacity:0"/>
    </linearGradient>

    <!-- Highlighted resonance band gradients -->
    <linearGradient id="kpicResonanceBand" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#ff9800;stop-opacity:0.8"/>
        <stop offset="50%" style="stop-color:#ff9800;stop-opacity:0.4"/>
        <stop offset="100%" style="stop-color:#ff9800;stop-opacity:0.05"/>
    </linearGradient>

    <linearGradient id="kricResonanceBand" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#2196f3;stop-opacity:0.8"/>
        <stop offset="50%" style="stop-color:#2196f3;stop-opacity:0.4"/>
        <stop offset="100%" style="stop-color:#2196f3;stop-opacity:0.05"/>
    </linearGradient>

    <linearGradient id="focusResonanceBand" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#e91e63;stop-opacity:0.8"/>
        <stop offset="50%" style="stop-color:#e91e63;stop-opacity:0.4"/>
        <stop offset="100%" style="stop-color:#e91e63;stop-opacity:0.05"/>
    </linearGradient>

    <linearGradient id="melismaResonanceBand" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#9c27b0;stop-opacity:0.8"/>
        <stop offset="50%" style="stop-color:#9c27b0;stop-opacity:0.4"/>
        <stop offset="100%" style="stop-color:#9c27b0;stop-opacity:0.05"/>
    </linearGradient>
    
    <!-- Analysis highlight patterns -->
    <pattern id="kpicPattern" patternUnits="userSpaceOnUse" width="4" height="4">
        <rect width="4" height="4" fill="#ffeb3b" opacity="0.6"/>
        <path d="M 0,4 l 4,-4 M -1,1 l 2,-2 M 3,5 l 2,-2" stroke="#ff9800" stroke-width="1"/>
    </pattern>
    
    <pattern id="kricPattern" patternUnits="userSpaceOnUse" width="4" height="4">
        <rect width="4" height="4" fill="#e3f2fd" opacity="0.6"/>
        <circle cx="2" cy="2" r="1" fill="#2196f3"/>
    </pattern>
    
    <style>
        .string-line { stroke: #008ECC; stroke-width: 2; }
        .string-label { font-family: Arial; font-size: 12px; fill: #008ECC; }
        .title { font-family: Arial; font-size: 20px; font-weight: bold; fill: purple; }
        .string-number { font-family: Arial; font-size: 16px; fill: white; font-weight: 1200; stroke: #000; stroke-width: 0.3; }
        .note-circle { cursor: pointer; }
        .note-circle:hover { stroke-width: 4; }

        /* Sankey band tooltip styles */
        .sankey-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            line-height: 1.4;
            z-index: 1000;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
            max-width: 300px;
        }

        .sankey-tooltip .tooltip-title {
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 8px;
            border-bottom: 1px solid #555;
            padding-bottom: 4px;
        }

        .sankey-tooltip .tooltip-section {
            margin-bottom: 6px;
        }

        .sankey-tooltip .tooltip-label {
            color: #AAA;
            font-size: 11px;
        }

        .sankey-tooltip .tooltip-value {
            color: #FFF;
            font-weight: bold;
        }

        .sankey-tooltip .tooltip-rhythm {
            color: #87CEEB;
        }
        
        /* Analysis highlighting classes */
        .kpic-highlight {
            fill: #ffff00 !important;
            stroke: #ff0000 !important;
            stroke-width: 8 !important;
            filter: drop-shadow(0 0 15px #ff0000) drop-shadow(0 0 30px #ff0000) drop-shadow(0 0 45px #ff0000) !important;
            opacity: 1.0 !important;
        }
        .kric-highlight { fill: url(#kricPattern) !important; stroke: #2196f3 !important; stroke-width: 3 !important; }
        .syllable-repetition { stroke: #f44336 !important; stroke-width: 4 !important; }
        .syllable-focus { fill: #e91e63 !important; stroke: #ad1457 !important; stroke-width: 4 !important; }
        .syllable-melismatic { fill: #9c27b0 !important; stroke: #6a1b9a !important; stroke-width: 4 !important; }
                .note-dimmed { opacity: 0.5 !important; }
        .syllable-tone { stroke-width: 4 !important; }
        .tone-sac { stroke: #ff5722 !important; /* Rising tone - orange */ }
        .tone-huyen { stroke: #3f51b5 !important; /* Falling tone - blue */ }
        .tone-hoi { stroke: #009688 !important; /* Dipping tone - teal */ }
        .tone-nga { stroke: #ff9800 !important; /* Broken rising - amber */ }
        .tone-nang { stroke: #795548 !important; /* Heavy tone - brown */ }
        .tone-ngang { stroke: #607d8b !important; /* Flat tone - blue-grey */ }
        .pattern-member { opacity: 0.8; }
        
        /* Different colors for multiple patterns */
        .pattern-color-0 { stroke: #ff9800 !important; }
        .pattern-color-1 { stroke: #4caf50 !important; }
        .pattern-color-2 { stroke: #2196f3 !important; }
        .pattern-color-3 { stroke: #9c27b0 !important; }
        .pattern-color-4 { stroke: #f44336 !important; }
    </style>
</defs>

<rect width="11475" height="770.0" fill="floralwhite"/>
<text x="20" y="30" class="title">Analytical ƒê√†n Tranh Tablature</text>
<text x="20" y="50" style="font-family: Arial; font-size: 14px; fill: #666;">KPIC/KRIC Analysis with Interactive Highlighting</text>
<line x1="120" y1="110" x2="11455" y2="110" class="string-line" data-base-x2="11455" data-base-y1="110" data-base-y2="110"/>
<text x="20" y="115" class="string-label" data-base-y="115">String 5: D4</text>
<line x1="120" y1="260.0" x2="11455" y2="260.0" class="string-line" data-base-x2="11455" data-base-y1="260.0" data-base-y2="260.0"/>
<text x="20" y="265.0" class="string-label" data-base-y="265.0">String 7: G4</text>
<line x1="120" y1="320.0" x2="11455" y2="320.0" class="string-line" data-base-x2="11455" data-base-y1="320.0" data-base-y2="320.0"/>
<text x="20" y="325.0" class="string-label" data-base-y="325.0">String 8: A4</text>
<line x1="120" y1="410.0" x2="11455" y2="410.0" class="string-line" data-base-x2="11455" data-base-y1="410.0" data-base-y2="410.0"/>
<text x="20" y="415.0" class="string-label" data-base-y="415.0">String 9: C5</text>
<line x1="120" y1="470.0" x2="11455" y2="470.0" class="string-line" data-base-x2="11455" data-base-y1="470.0" data-base-y2="470.0"/>
<text x="20" y="475.0" class="string-label" data-base-y="475.0">String 10: D5</text>
<line x1="120" y1="530.0" x2="11455" y2="530.0" class="string-line" data-base-x2="11455" data-base-y1="530.0" data-base-y2="530.0"/>
<text x="20" y="535.0" class="string-label" data-base-y="535.0">String 11: E5</text>
<line x1="120" y1="620.0" x2="11455" y2="620.0" class="string-line" data-base-x2="11455" data-base-y1="620.0" data-base-y2="620.0"/>
<text x="20" y="625.0" class="string-label" data-base-y="625.0">String 12: G5</text>
<rect x="120" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="120" data-base-y="405.0"/>
<circle cx="120" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="0" data-is-grace="false" data-base-x="120" data-base-y="410.0" onclick="showNoteDetails(0)" id="note-0"/>
<text x="120" y="419" text-anchor="middle" class="string-number" data-base-x="120" data-base-y="415.0">9</text>
<text x="120" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="120" data-base-y="375.0">#0</text>
<text x="120" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="120" data-base-y="390.0">2</text>
<text x="124" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 124, 450.0)" data-base-x="124" data-base-y="450.0" class="lyric-text">B√†</text>
<rect x="205" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="205" data-base-y="405.0"/>
<circle cx="205" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="1" data-is-grace="false" data-base-x="205" data-base-y="410.0" onclick="showNoteDetails(1)" id="note-1"/>
<text x="205" y="419" text-anchor="middle" class="string-number" data-base-x="205" data-base-y="415.0">9</text>
<text x="205" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="205" data-base-y="375.0">#1</text>
<text x="205" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="205" data-base-y="390.0">2</text>
<text x="209" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 209, 450.0)" data-base-x="209" data-base-y="450.0" class="lyric-text">R·∫±ng</text>
<rect x="290" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="290" data-base-y="405.0"/>
<circle cx="290" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="2" data-is-grace="false" data-base-x="290" data-base-y="410.0" onclick="showNoteDetails(2)" id="note-2"/>
<text x="290" y="419" text-anchor="middle" class="string-number" data-base-x="290" data-base-y="415.0">9</text>
<text x="290" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="290" data-base-y="375.0">#2</text>
<text x="290" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="290" data-base-y="390.0">2</text>
<text x="294" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 294, 450.0)" data-base-x="294" data-base-y="450.0" class="lyric-text">b√†</text>
<rect x="375" y="467.0" width="80" height="6" fill="url(#graceResonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="375" data-base-y="467.0"/>
<circle cx="375" cy="470.0" r="6" class="note-circle" fill="#FFD700" stroke="#0066FF" stroke-width="2" data-note-index="3" data-is-grace="true" data-base-x="375" data-base-y="470.0" onclick="showNoteDetails(3)" id="note-3"/>
<text x="375" y="479" text-anchor="middle" class="string-number" data-base-x="375" data-base-y="475.0">10</text>
<text x="375" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="375" data-base-y="435.0">#3</text>
<text x="375" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="375" data-base-y="450.0">0.5</text>
<rect x="400" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="400" data-base-y="525.0"/>
<circle cx="400" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="4" data-is-grace="false" data-base-x="400" data-base-y="530.0" onclick="showNoteDetails(4)" id="note-4"/>
<text x="400" y="539" text-anchor="middle" class="string-number" data-base-x="400" data-base-y="535.0">11</text>
<text x="400" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="400" data-base-y="495.0">#4</text>
<text x="400" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="400" data-base-y="510.0">8</text>
<text x="404" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 404, 570.0)" data-base-x="404" data-base-y="570.0" class="lyric-text">R√≠,</text>
<rect x="725" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="725" data-base-y="525.0"/>
<circle cx="725" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="5" data-is-grace="false" data-base-x="725" data-base-y="530.0" onclick="showNoteDetails(5)" id="note-5"/>
<text x="725" y="539" text-anchor="middle" class="string-number" data-base-x="725" data-base-y="535.0">11</text>
<text x="725" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="725" data-base-y="495.0">#5</text>
<text x="725" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="725" data-base-y="510.0">1</text>
<text x="729" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 729, 570.0)" data-base-x="729" data-base-y="570.0" class="lyric-text">·ªöi</text>
<rect x="770" y="615.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="770" data-base-y="615.0"/>
<circle cx="770" cy="620.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="6" data-is-grace="false" data-base-x="770" data-base-y="620.0" onclick="showNoteDetails(6)" id="note-6"/>
<text x="770" y="629" text-anchor="middle" class="string-number" data-base-x="770" data-base-y="625.0">12</text>
<text x="770" y="585.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="770" data-base-y="585.0">#6</text>
<text x="770" y="600.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="770" data-base-y="600.0">1</text>
<rect x="815" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="815" data-base-y="315.0"/>
<circle cx="815" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="7" data-is-grace="false" data-base-x="815" data-base-y="320.0" onclick="showNoteDetails(7)" id="note-7"/>
<text x="815" y="329" text-anchor="middle" class="string-number" data-base-x="815" data-base-y="325.0">8</text>
<text x="815" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="815" data-base-y="285.0">#7</text>
<text x="815" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="815" data-base-y="300.0">2</text>
<text x="819" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 819, 360.0)" data-base-x="819" data-base-y="360.0" class="lyric-text">r·∫±ng</text>
<rect x="900" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="900" data-base-y="405.0"/>
<circle cx="900" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="8" data-is-grace="false" data-base-x="900" data-base-y="410.0" onclick="showNoteDetails(8)" id="note-8"/>
<text x="900" y="419" text-anchor="middle" class="string-number" data-base-x="900" data-base-y="415.0">9</text>
<text x="900" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="900" data-base-y="375.0">#8</text>
<text x="900" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="900" data-base-y="390.0">2</text>
<text x="904" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 904, 450.0)" data-base-x="904" data-base-y="450.0" class="lyric-text">b√†</text>
<rect x="985" y="465.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="985" data-base-y="465.0"/>
<circle cx="985" cy="470.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="9" data-is-grace="false" data-base-x="985" data-base-y="470.0" onclick="showNoteDetails(9)" id="note-9"/>
<text x="985" y="479" text-anchor="middle" class="string-number" data-base-x="985" data-base-y="475.0">10</text>
<text x="985" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="985" data-base-y="435.0">#9</text>
<text x="985" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="985" data-base-y="450.0">8</text>
<text x="989" y="510.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 989, 510.0)" data-base-x="989" data-base-y="510.0" class="lyric-text">ƒëi,</text>
<rect x="1310" y="467.0" width="80" height="6" fill="url(#graceResonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="1310" data-base-y="467.0"/>
<circle cx="1310" cy="470.0" r="6" class="note-circle" fill="#FFD700" stroke="#0066FF" stroke-width="2" data-note-index="10" data-is-grace="true" data-base-x="1310" data-base-y="470.0" onclick="showNoteDetails(10)" id="note-10"/>
<text x="1310" y="479" text-anchor="middle" class="string-number" data-base-x="1310" data-base-y="475.0">10</text>
<text x="1310" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="1310" data-base-y="435.0">#10</text>
<text x="1310" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="1310" data-base-y="450.0">0.5</text>
<rect x="1335" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="1335" data-base-y="525.0"/>
<circle cx="1335" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="11" data-is-grace="false" data-base-x="1335" data-base-y="530.0" onclick="showNoteDetails(11)" id="note-11"/>
<text x="1335" y="539" text-anchor="middle" class="string-number" data-base-x="1335" data-base-y="535.0">11</text>
<text x="1335" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="1335" data-base-y="495.0">#11</text>
<text x="1335" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="1335" data-base-y="510.0">2</text>
<text x="1339" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 1339, 570.0)" data-base-x="1339" data-base-y="570.0" class="lyric-text">·ªõi</text>
<rect x="1420" y="465.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="1420" data-base-y="465.0"/>
<circle cx="1420" cy="470.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="12" data-is-grace="false" data-base-x="1420" data-base-y="470.0" onclick="showNoteDetails(12)" id="note-12"/>
<text x="1420" y="479" text-anchor="middle" class="string-number" data-base-x="1420" data-base-y="475.0">10</text>
<text x="1420" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="1420" data-base-y="435.0">#12</text>
<text x="1420" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="1420" data-base-y="450.0">1</text>
<text x="1424" y="510.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 1424, 510.0)" data-base-x="1424" data-base-y="510.0" class="lyric-text">ƒëi</text>
<rect x="1465" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="1465" data-base-y="405.0"/>
<circle cx="1465" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="13" data-is-grace="false" data-base-x="1465" data-base-y="410.0" onclick="showNoteDetails(13)" id="note-13"/>
<text x="1465" y="419" text-anchor="middle" class="string-number" data-base-x="1465" data-base-y="415.0">9</text>
<text x="1465" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="1465" data-base-y="375.0">#13</text>
<text x="1465" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="1465" data-base-y="390.0">1</text>
<rect x="1510" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="1510" data-base-y="315.0"/>
<circle cx="1510" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="14" data-is-grace="false" data-base-x="1510" data-base-y="320.0" onclick="showNoteDetails(14)" id="note-14"/>
<text x="1510" y="329" text-anchor="middle" class="string-number" data-base-x="1510" data-base-y="325.0">8</text>
<text x="1510" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="1510" data-base-y="285.0">#14</text>
<text x="1510" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="1510" data-base-y="300.0">2</text>
<text x="1514" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 1514, 360.0)" data-base-x="1514" data-base-y="360.0" class="lyric-text">l√†</text>
<rect x="1595" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="1595" data-base-y="405.0"/>
<circle cx="1595" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="15" data-is-grace="false" data-base-x="1595" data-base-y="410.0" onclick="showNoteDetails(15)" id="note-15"/>
<text x="1595" y="419" text-anchor="middle" class="string-number" data-base-x="1595" data-base-y="415.0">9</text>
<text x="1595" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="1595" data-base-y="375.0">#15</text>
<text x="1595" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="1595" data-base-y="390.0">2</text>
<text x="1599" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 1599, 450.0)" data-base-x="1599" data-base-y="450.0" class="lyric-text">ƒë√¢u</text>
<rect x="1680" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="1680" data-base-y="405.0"/>
<circle cx="1680" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="16" data-is-grace="false" data-base-x="1680" data-base-y="410.0" onclick="showNoteDetails(16)" id="note-16"/>
<text x="1680" y="419" text-anchor="middle" class="string-number" data-base-x="1680" data-base-y="415.0">9</text>
<text x="1680" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="1680" data-base-y="375.0">#16</text>
<text x="1680" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="1680" data-base-y="390.0">3</text>
<text x="1684" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 1684, 450.0)" data-base-x="1684" data-base-y="450.0" class="lyric-text">b√†</text>
<rect x="1805" y="465.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="1805" data-base-y="465.0"/>
<circle cx="1805" cy="470.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="17" data-is-grace="false" data-base-x="1805" data-base-y="470.0" onclick="showNoteDetails(17)" id="note-17"/>
<text x="1805" y="479" text-anchor="middle" class="string-number" data-base-x="1805" data-base-y="475.0">10</text>
<text x="1805" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="1805" data-base-y="435.0">#17</text>
<text x="1805" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="1805" data-base-y="450.0">2</text>
<text x="1809" y="510.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 1809, 510.0)" data-base-x="1809" data-base-y="510.0" class="lyric-text">ƒëi</text>
<rect x="1890" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="1890" data-base-y="525.0"/>
<circle cx="1890" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="18" data-is-grace="false" data-base-x="1890" data-base-y="530.0" onclick="showNoteDetails(18)" id="note-18"/>
<text x="1890" y="539" text-anchor="middle" class="string-number" data-base-x="1890" data-base-y="535.0">11</text>
<text x="1890" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="1890" data-base-y="495.0">#18</text>
<text x="1890" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="1890" data-base-y="510.0">1</text>
<text x="1894" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 1894, 570.0)" data-base-x="1894" data-base-y="570.0" class="lyric-text">kh·∫Øp</text>
<rect x="1935" y="467.0" width="80" height="6" fill="url(#graceResonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="1935" data-base-y="467.0"/>
<circle cx="1935" cy="470.0" r="6" class="note-circle" fill="#FFD700" stroke="#0066FF" stroke-width="2" data-note-index="19" data-is-grace="true" data-base-x="1935" data-base-y="470.0" onclick="showNoteDetails(19)" id="note-19"/>
<text x="1935" y="479" text-anchor="middle" class="string-number" data-base-x="1935" data-base-y="475.0">10</text>
<text x="1935" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="1935" data-base-y="435.0">#19</text>
<text x="1935" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="1935" data-base-y="450.0">0.5</text>
<rect x="1960" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="1960" data-base-y="525.0"/>
<circle cx="1960" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="20" data-is-grace="false" data-base-x="1960" data-base-y="530.0" onclick="showNoteDetails(20)" id="note-20"/>
<text x="1960" y="539" text-anchor="middle" class="string-number" data-base-x="1960" data-base-y="535.0">11</text>
<text x="1960" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="1960" data-base-y="495.0">#20</text>
<text x="1960" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="1960" data-base-y="510.0">2</text>
<text x="1964" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 1964, 570.0)" data-base-x="1964" data-base-y="570.0" class="lyric-text">ch·ªën</text>
<rect x="2045" y="467.0" width="80" height="6" fill="url(#graceResonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2045" data-base-y="467.0"/>
<circle cx="2045" cy="470.0" r="6" class="note-circle" fill="#FFD700" stroke="#0066FF" stroke-width="2" data-note-index="21" data-is-grace="true" data-base-x="2045" data-base-y="470.0" onclick="showNoteDetails(21)" id="note-21"/>
<text x="2045" y="479" text-anchor="middle" class="string-number" data-base-x="2045" data-base-y="475.0">10</text>
<text x="2045" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2045" data-base-y="435.0">#21</text>
<text x="2045" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2045" data-base-y="450.0">0.5</text>
<rect x="2070" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2070" data-base-y="525.0"/>
<circle cx="2070" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="22" data-is-grace="false" data-base-x="2070" data-base-y="530.0" onclick="showNoteDetails(22)" id="note-22"/>
<text x="2070" y="539" text-anchor="middle" class="string-number" data-base-x="2070" data-base-y="535.0">11</text>
<text x="2070" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2070" data-base-y="495.0">#22</text>
<text x="2070" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2070" data-base-y="510.0">3</text>
<text x="2074" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 2074, 570.0)" data-base-x="2074" data-base-y="570.0" class="lyric-text">n·ªëi</text>
<rect x="2195" y="465.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2195" data-base-y="465.0"/>
<circle cx="2195" cy="470.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="23" data-is-grace="false" data-base-x="2195" data-base-y="470.0" onclick="showNoteDetails(23)" id="note-23"/>
<text x="2195" y="479" text-anchor="middle" class="string-number" data-base-x="2195" data-base-y="475.0">10</text>
<text x="2195" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2195" data-base-y="435.0">#23</text>
<text x="2195" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2195" data-base-y="450.0">2</text>
<text x="2199" y="510.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 2199, 510.0)" data-base-x="2199" data-base-y="510.0" class="lyric-text">d√¢y</text>
<rect x="2280" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2280" data-base-y="405.0"/>
<circle cx="2280" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="24" data-is-grace="false" data-base-x="2280" data-base-y="410.0" onclick="showNoteDetails(24)" id="note-24"/>
<text x="2280" y="419" text-anchor="middle" class="string-number" data-base-x="2280" data-base-y="415.0">9</text>
<text x="2280" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2280" data-base-y="375.0">#24</text>
<text x="2280" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2280" data-base-y="390.0">1</text>
<text x="2284" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 2284, 450.0)" data-base-x="2284" data-base-y="450.0" class="lyric-text">t∆°</text>
<rect x="2325" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2325" data-base-y="315.0"/>
<circle cx="2325" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="25" data-is-grace="false" data-base-x="2325" data-base-y="320.0" onclick="showNoteDetails(25)" id="note-25"/>
<text x="2325" y="329" text-anchor="middle" class="string-number" data-base-x="2325" data-base-y="325.0">8</text>
<text x="2325" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2325" data-base-y="285.0">#25</text>
<text x="2325" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2325" data-base-y="300.0">3</text>
<text x="2329" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 2329, 360.0)" data-base-x="2329" data-base-y="360.0" class="lyric-text">h·ªìng</text>
<rect x="2450" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2450" data-base-y="405.0"/>
<circle cx="2450" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="26" data-is-grace="false" data-base-x="2450" data-base-y="410.0" onclick="showNoteDetails(26)" id="note-26"/>
<text x="2450" y="419" text-anchor="middle" class="string-number" data-base-x="2450" data-base-y="415.0">9</text>
<text x="2450" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2450" data-base-y="375.0">#26</text>
<text x="2450" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2450" data-base-y="390.0">1</text>
<text x="2454" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 2454, 450.0)" data-base-x="2454" data-base-y="450.0" class="lyric-text">c√°i</text>
<rect x="2495" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2495" data-base-y="315.0"/>
<circle cx="2495" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="27" data-is-grace="false" data-base-x="2495" data-base-y="320.0" onclick="showNoteDetails(27)" id="note-27"/>
<text x="2495" y="329" text-anchor="middle" class="string-number" data-base-x="2495" data-base-y="325.0">8</text>
<text x="2495" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2495" data-base-y="285.0">#27</text>
<text x="2495" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2495" data-base-y="300.0">2</text>
<text x="2499" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 2499, 360.0)" data-base-x="2499" data-base-y="360.0" class="lyric-text">duy√™n</text>
<rect x="2580" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2580" data-base-y="255.0"/>
<circle cx="2580" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="28" data-is-grace="false" data-base-x="2580" data-base-y="260.0" onclick="showNoteDetails(28)" id="note-28"/>
<text x="2580" y="269" text-anchor="middle" class="string-number" data-base-x="2580" data-base-y="265.0">7</text>
<text x="2580" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2580" data-base-y="225.0">#28</text>
<text x="2580" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2580" data-base-y="240.0">2</text>
<text x="2584" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 2584, 300.0)" data-base-x="2584" data-base-y="300.0" class="lyric-text">√¥ng</text>
<rect x="2665" y="105.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2665" data-base-y="105.0"/>
<circle cx="2665" cy="110" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="29" data-is-grace="false" data-base-x="2665" data-base-y="110" onclick="showNoteDetails(29)" id="note-29"/>
<text x="2665" y="119" text-anchor="middle" class="string-number" data-base-x="2665" data-base-y="115.0">5</text>
<text x="2665" y="75" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2665" data-base-y="75">#29</text>
<text x="2665" y="90" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2665" data-base-y="90">2</text>
<text x="2669" y="150" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 2669, 150)" data-base-x="2669" data-base-y="150" class="lyric-text">ch·ªìng</text>
<rect x="2750" y="105.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2750" data-base-y="105.0"/>
<circle cx="2750" cy="110" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="30" data-is-grace="false" data-base-x="2750" data-base-y="110" onclick="showNoteDetails(30)" id="note-30"/>
<text x="2750" y="119" text-anchor="middle" class="string-number" data-base-x="2750" data-base-y="115.0">5</text>
<text x="2750" y="75" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2750" data-base-y="75">#30</text>
<text x="2750" y="90" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2750" data-base-y="90">1</text>
<text x="2754" y="150" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 2754, 150)" data-base-x="2754" data-base-y="150" class="lyric-text">l√†m</text>
<rect x="2795" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2795" data-base-y="255.0"/>
<circle cx="2795" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="31" data-is-grace="false" data-base-x="2795" data-base-y="260.0" onclick="showNoteDetails(31)" id="note-31"/>
<text x="2795" y="269" text-anchor="middle" class="string-number" data-base-x="2795" data-base-y="265.0">7</text>
<text x="2795" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2795" data-base-y="225.0">#31</text>
<text x="2795" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2795" data-base-y="240.0">1</text>
<text x="2799" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 2799, 300.0)" data-base-x="2799" data-base-y="300.0" class="lyric-text">kh·ªï</text>
<rect x="2840" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2840" data-base-y="405.0"/>
<circle cx="2840" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="32" data-is-grace="false" data-base-x="2840" data-base-y="410.0" onclick="showNoteDetails(32)" id="note-32"/>
<text x="2840" y="419" text-anchor="middle" class="string-number" data-base-x="2840" data-base-y="415.0">9</text>
<text x="2840" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2840" data-base-y="375.0">#32</text>
<text x="2840" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2840" data-base-y="390.0">1</text>
<rect x="2885" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2885" data-base-y="405.0"/>
<circle cx="2885" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="33" data-is-grace="false" data-base-x="2885" data-base-y="410.0" onclick="showNoteDetails(33)" id="note-33"/>
<text x="2885" y="419" text-anchor="middle" class="string-number" data-base-x="2885" data-base-y="415.0">9</text>
<text x="2885" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2885" data-base-y="375.0">#33</text>
<text x="2885" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2885" data-base-y="390.0">1</text>
<text x="2889" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 2889, 450.0)" data-base-x="2889" data-base-y="450.0" class="lyric-text">c√°i</text>
<rect x="2930" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="2930" data-base-y="255.0"/>
<circle cx="2930" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="34" data-is-grace="false" data-base-x="2930" data-base-y="260.0" onclick="showNoteDetails(34)" id="note-34"/>
<text x="2930" y="269" text-anchor="middle" class="string-number" data-base-x="2930" data-base-y="265.0">7</text>
<text x="2930" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="2930" data-base-y="225.0">#34</text>
<text x="2930" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="2930" data-base-y="240.0">2</text>
<text x="2934" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 2934, 300.0)" data-base-x="2934" data-base-y="300.0" class="lyric-text">ƒë·ªùi</text>
<rect x="3015" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3015" data-base-y="315.0"/>
<circle cx="3015" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="35" data-is-grace="false" data-base-x="3015" data-base-y="320.0" onclick="showNoteDetails(35)" id="note-35"/>
<text x="3015" y="329" text-anchor="middle" class="string-number" data-base-x="3015" data-base-y="325.0">8</text>
<text x="3015" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3015" data-base-y="285.0">#35</text>
<text x="3015" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3015" data-base-y="300.0">3</text>
<text x="3019" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3019, 360.0)" data-base-x="3019" data-base-y="360.0" class="lyric-text">t√¥i</text>
<rect x="3140" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3140" data-base-y="405.0"/>
<circle cx="3140" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="36" data-is-grace="false" data-base-x="3140" data-base-y="410.0" onclick="showNoteDetails(36)" id="note-36"/>
<text x="3140" y="419" text-anchor="middle" class="string-number" data-base-x="3140" data-base-y="415.0">9</text>
<text x="3140" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3140" data-base-y="375.0">#36</text>
<text x="3140" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3140" data-base-y="390.0">2</text>
<text x="3144" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3144, 450.0)" data-base-x="3144" data-base-y="450.0" class="lyric-text">∆°i</text>
<rect x="3225" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3225" data-base-y="255.0"/>
<circle cx="3225" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="37" data-is-grace="false" data-base-x="3225" data-base-y="260.0" onclick="showNoteDetails(37)" id="note-37"/>
<text x="3225" y="269" text-anchor="middle" class="string-number" data-base-x="3225" data-base-y="265.0">7</text>
<text x="3225" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3225" data-base-y="225.0">#37</text>
<text x="3225" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3225" data-base-y="240.0">2</text>
<text x="3229" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3229, 300.0)" data-base-x="3229" data-base-y="300.0" class="lyric-text">b√†</text>
<rect x="3310" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3310" data-base-y="405.0"/>
<circle cx="3310" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="38" data-is-grace="false" data-base-x="3310" data-base-y="410.0" onclick="showNoteDetails(38)" id="note-38"/>
<text x="3310" y="419" text-anchor="middle" class="string-number" data-base-x="3310" data-base-y="415.0">9</text>
<text x="3310" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3310" data-base-y="375.0">#38</text>
<text x="3310" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3310" data-base-y="390.0">1</text>
<text x="3314" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3314, 450.0)" data-base-x="3314" data-base-y="450.0" class="lyric-text">R√≠</text>
<rect x="3355" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3355" data-base-y="315.0"/>
<circle cx="3355" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="39" data-is-grace="false" data-base-x="3355" data-base-y="320.0" onclick="showNoteDetails(39)" id="note-39"/>
<text x="3355" y="329" text-anchor="middle" class="string-number" data-base-x="3355" data-base-y="325.0">8</text>
<text x="3355" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3355" data-base-y="285.0">#39</text>
<text x="3355" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3355" data-base-y="300.0">3</text>
<text x="3359" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3359, 360.0)" data-base-x="3359" data-base-y="360.0" class="lyric-text">∆°i</text>
<rect x="3480" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3480" data-base-y="255.0"/>
<circle cx="3480" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="40" data-is-grace="false" data-base-x="3480" data-base-y="260.0" onclick="showNoteDetails(40)" id="note-40"/>
<text x="3480" y="269" text-anchor="middle" class="string-number" data-base-x="3480" data-base-y="265.0">7</text>
<text x="3480" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3480" data-base-y="225.0">#40</text>
<text x="3480" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3480" data-base-y="240.0">1</text>
<text x="3484" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3484, 300.0)" data-base-x="3484" data-base-y="300.0" class="lyric-text">b√†</text>
<rect x="3525" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3525" data-base-y="255.0"/>
<circle cx="3525" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="41" data-is-grace="false" data-base-x="3525" data-base-y="260.0" onclick="showNoteDetails(41)" id="note-41"/>
<text x="3525" y="269" text-anchor="middle" class="string-number" data-base-x="3525" data-base-y="265.0">7</text>
<text x="3525" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3525" data-base-y="225.0">#41</text>
<text x="3525" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3525" data-base-y="240.0">1</text>
<text x="3529" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3529, 300.0)" data-base-x="3529" data-base-y="300.0" class="lyric-text">R·∫±ng</text>
<rect x="3570" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3570" data-base-y="255.0"/>
<circle cx="3570" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="42" data-is-grace="false" data-base-x="3570" data-base-y="260.0" onclick="showNoteDetails(42)" id="note-42"/>
<text x="3570" y="269" text-anchor="middle" class="string-number" data-base-x="3570" data-base-y="265.0">7</text>
<text x="3570" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3570" data-base-y="225.0">#42</text>
<text x="3570" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3570" data-base-y="240.0">1</text>
<text x="3574" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3574, 300.0)" data-base-x="3574" data-base-y="300.0" class="lyric-text">b√†</text>
<rect x="3615" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3615" data-base-y="405.0"/>
<circle cx="3615" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="43" data-is-grace="false" data-base-x="3615" data-base-y="410.0" onclick="showNoteDetails(43)" id="note-43"/>
<text x="3615" y="419" text-anchor="middle" class="string-number" data-base-x="3615" data-base-y="415.0">9</text>
<text x="3615" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3615" data-base-y="375.0">#43</text>
<text x="3615" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3615" data-base-y="390.0">2</text>
<text x="3619" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3619, 450.0)" data-base-x="3619" data-base-y="450.0" class="lyric-text">R√≠</text>
<rect x="3700" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3700" data-base-y="315.0"/>
<circle cx="3700" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="44" data-is-grace="false" data-base-x="3700" data-base-y="320.0" onclick="showNoteDetails(44)" id="note-44"/>
<text x="3700" y="329" text-anchor="middle" class="string-number" data-base-x="3700" data-base-y="325.0">8</text>
<text x="3700" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3700" data-base-y="285.0">#44</text>
<text x="3700" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3700" data-base-y="300.0">1</text>
<text x="3704" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3704, 360.0)" data-base-x="3704" data-base-y="360.0" class="lyric-text">∆°i.</text>
<rect x="3745" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3745" data-base-y="405.0"/>
<circle cx="3745" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="45" data-is-grace="false" data-base-x="3745" data-base-y="410.0" onclick="showNoteDetails(45)" id="note-45"/>
<text x="3745" y="419" text-anchor="middle" class="string-number" data-base-x="3745" data-base-y="415.0">9</text>
<text x="3745" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3745" data-base-y="375.0">#45</text>
<text x="3745" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3745" data-base-y="390.0">2</text>
<text x="3749" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3749, 450.0)" data-base-x="3749" data-base-y="450.0" class="lyric-text">Ch·ªìng</text>
<rect x="3830" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3830" data-base-y="405.0"/>
<circle cx="3830" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="46" data-is-grace="false" data-base-x="3830" data-base-y="410.0" onclick="showNoteDetails(46)" id="note-46"/>
<text x="3830" y="419" text-anchor="middle" class="string-number" data-base-x="3830" data-base-y="415.0">9</text>
<text x="3830" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3830" data-base-y="375.0">#46</text>
<text x="3830" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3830" data-base-y="390.0">1</text>
<text x="3834" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3834, 450.0)" data-base-x="3834" data-base-y="450.0" class="lyric-text">g√¨</text>
<rect x="3875" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3875" data-base-y="405.0"/>
<circle cx="3875" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="47" data-is-grace="false" data-base-x="3875" data-base-y="410.0" onclick="showNoteDetails(47)" id="note-47"/>
<text x="3875" y="419" text-anchor="middle" class="string-number" data-base-x="3875" data-base-y="415.0">9</text>
<text x="3875" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3875" data-base-y="375.0">#47</text>
<text x="3875" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3875" data-base-y="390.0">1</text>
<text x="3879" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3879, 450.0)" data-base-x="3879" data-base-y="450.0" class="lyric-text">m√†</text>
<rect x="3920" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="3920" data-base-y="405.0"/>
<circle cx="3920" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="48" data-is-grace="false" data-base-x="3920" data-base-y="410.0" onclick="showNoteDetails(48)" id="note-48"/>
<text x="3920" y="419" text-anchor="middle" class="string-number" data-base-x="3920" data-base-y="415.0">9</text>
<text x="3920" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="3920" data-base-y="375.0">#48</text>
<text x="3920" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="3920" data-base-y="390.0">2</text>
<text x="3924" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 3924, 450.0)" data-base-x="3924" data-base-y="450.0" class="lyric-text">ch·ªìng</text>
<rect x="4005" y="467.0" width="80" height="6" fill="url(#graceResonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="4005" data-base-y="467.0"/>
<circle cx="4005" cy="470.0" r="6" class="note-circle" fill="#FFD700" stroke="#0066FF" stroke-width="2" data-note-index="49" data-is-grace="true" data-base-x="4005" data-base-y="470.0" onclick="showNoteDetails(49)" id="note-49"/>
<text x="4005" y="479" text-anchor="middle" class="string-number" data-base-x="4005" data-base-y="475.0">10</text>
<text x="4005" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="4005" data-base-y="435.0">#49</text>
<text x="4005" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="4005" data-base-y="450.0">0.5</text>
<rect x="4030" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="4030" data-base-y="525.0"/>
<circle cx="4030" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="50" data-is-grace="false" data-base-x="4030" data-base-y="530.0" onclick="showNoteDetails(50)" id="note-50"/>
<text x="4030" y="539" text-anchor="middle" class="string-number" data-base-x="4030" data-base-y="535.0">11</text>
<text x="4030" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="4030" data-base-y="495.0">#50</text>
<text x="4030" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="4030" data-base-y="510.0">8</text>
<text x="4034" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 4034, 570.0)" data-base-x="4034" data-base-y="570.0" class="lyric-text">b√©,</text>
<rect x="4355" y="527.0" width="80" height="6" fill="url(#graceResonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="4355" data-base-y="527.0"/>
<circle cx="4355" cy="530.0" r="6" class="note-circle" fill="#FFD700" stroke="#0066FF" stroke-width="2" data-note-index="51" data-is-grace="true" data-base-x="4355" data-base-y="530.0" onclick="showNoteDetails(51)" id="note-51"/>
<text x="4355" y="539" text-anchor="middle" class="string-number" data-base-x="4355" data-base-y="535.0">11</text>
<text x="4355" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="4355" data-base-y="495.0">#51</text>
<text x="4355" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="4355" data-base-y="510.0">0.5</text>
<rect x="4380" y="615.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="4380" data-base-y="615.0"/>
<circle cx="4380" cy="620.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="52" data-is-grace="false" data-base-x="4380" data-base-y="620.0" onclick="showNoteDetails(52)" id="note-52"/>
<text x="4380" y="629" text-anchor="middle" class="string-number" data-base-x="4380" data-base-y="625.0">12</text>
<text x="4380" y="585.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="4380" data-base-y="585.0">#52</text>
<text x="4380" y="600.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="4380" data-base-y="600.0">2</text>
<text x="4384" y="660.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 4384, 660.0)" data-base-x="4384" data-base-y="660.0" class="lyric-text">b√©</text>
<rect x="4465" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="4465" data-base-y="315.0"/>
<circle cx="4465" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="53" data-is-grace="false" data-base-x="4465" data-base-y="320.0" onclick="showNoteDetails(53)" id="note-53"/>
<text x="4465" y="329" text-anchor="middle" class="string-number" data-base-x="4465" data-base-y="325.0">8</text>
<text x="4465" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="4465" data-base-y="285.0">#53</text>
<text x="4465" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="4465" data-base-y="300.0">2</text>
<text x="4469" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 4469, 360.0)" data-base-x="4469" data-base-y="360.0" class="lyric-text">t·∫πo</text>
<rect x="4550" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="4550" data-base-y="405.0"/>
<circle cx="4550" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="54" data-is-grace="false" data-base-x="4550" data-base-y="410.0" onclick="showNoteDetails(54)" id="note-54"/>
<text x="4550" y="419" text-anchor="middle" class="string-number" data-base-x="4550" data-base-y="415.0">9</text>
<text x="4550" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="4550" data-base-y="375.0">#54</text>
<text x="4550" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="4550" data-base-y="390.0">2</text>
<text x="4554" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 4554, 450.0)" data-base-x="4554" data-base-y="450.0" class="lyric-text">t√®o</text>
<rect x="4635" y="465.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="4635" data-base-y="465.0"/>
<circle cx="4635" cy="470.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="55" data-is-grace="false" data-base-x="4635" data-base-y="470.0" onclick="showNoteDetails(55)" id="note-55"/>
<text x="4635" y="479" text-anchor="middle" class="string-number" data-base-x="4635" data-base-y="475.0">10</text>
<text x="4635" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="4635" data-base-y="435.0">#55</text>
<text x="4635" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="4635" data-base-y="450.0">8</text>
<text x="4639" y="510.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 4639, 510.0)" data-base-x="4639" data-base-y="510.0" class="lyric-text">teo,</text>
<rect x="4960" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="4960" data-base-y="405.0"/>
<circle cx="4960" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="56" data-is-grace="false" data-base-x="4960" data-base-y="410.0" onclick="showNoteDetails(56)" id="note-56"/>
<text x="4960" y="419" text-anchor="middle" class="string-number" data-base-x="4960" data-base-y="415.0">9</text>
<text x="4960" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="4960" data-base-y="375.0">#56</text>
<text x="4960" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="4960" data-base-y="390.0">3</text>
<text x="4964" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 4964, 450.0)" data-base-x="4964" data-base-y="450.0" class="lyric-text">ch√¢n</text>
<rect x="5085" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="5085" data-base-y="405.0"/>
<circle cx="5085" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="57" data-is-grace="false" data-base-x="5085" data-base-y="410.0" onclick="showNoteDetails(57)" id="note-57"/>
<text x="5085" y="419" text-anchor="middle" class="string-number" data-base-x="5085" data-base-y="415.0">9</text>
<text x="5085" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="5085" data-base-y="375.0">#57</text>
<text x="5085" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="5085" data-base-y="390.0">2</text>
<text x="5089" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 5089, 450.0)" data-base-x="5089" data-base-y="450.0" class="lyric-text">ƒëi</text>
<rect x="5170" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="5170" data-base-y="315.0"/>
<circle cx="5170" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="58" data-is-grace="false" data-base-x="5170" data-base-y="320.0" onclick="showNoteDetails(58)" id="note-58"/>
<text x="5170" y="329" text-anchor="middle" class="string-number" data-base-x="5170" data-base-y="325.0">8</text>
<text x="5170" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="5170" data-base-y="285.0">#58</text>
<text x="5170" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="5170" data-base-y="300.0">1</text>
<text x="5174" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 5174, 360.0)" data-base-x="5174" data-base-y="360.0" class="lyric-text">c√†</text>
<rect x="5215" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="5215" data-base-y="405.0"/>
<circle cx="5215" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="59" data-is-grace="false" data-base-x="5215" data-base-y="410.0" onclick="showNoteDetails(59)" id="note-59"/>
<text x="5215" y="419" text-anchor="middle" class="string-number" data-base-x="5215" data-base-y="415.0">9</text>
<text x="5215" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="5215" data-base-y="375.0">#59</text>
<text x="5215" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="5215" data-base-y="390.0">2</text>
<text x="5219" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 5219, 450.0)" data-base-x="5219" data-base-y="450.0" class="lyric-text">kheo</text>
<rect x="5300" y="467.0" width="80" height="6" fill="url(#graceResonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="5300" data-base-y="467.0"/>
<circle cx="5300" cy="470.0" r="6" class="note-circle" fill="#FFD700" stroke="#0066FF" stroke-width="2" data-note-index="60" data-is-grace="true" data-base-x="5300" data-base-y="470.0" onclick="showNoteDetails(60)" id="note-60"/>
<text x="5300" y="479" text-anchor="middle" class="string-number" data-base-x="5300" data-base-y="475.0">10</text>
<text x="5300" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="5300" data-base-y="435.0">#60</text>
<text x="5300" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="5300" data-base-y="450.0">0.5</text>
<rect x="5325" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="5325" data-base-y="525.0"/>
<circle cx="5325" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="61" data-is-grace="false" data-base-x="5325" data-base-y="530.0" onclick="showNoteDetails(61)" id="note-61"/>
<text x="5325" y="539" text-anchor="middle" class="string-number" data-base-x="5325" data-base-y="535.0">11</text>
<text x="5325" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="5325" data-base-y="495.0">#61</text>
<text x="5325" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="5325" data-base-y="510.0">3</text>
<text x="5329" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 5329, 570.0)" data-base-x="5329" data-base-y="570.0" class="lyric-text">l√∫c</text>
<rect x="5450" y="465.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="5450" data-base-y="465.0"/>
<circle cx="5450" cy="470.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="62" data-is-grace="false" data-base-x="5450" data-base-y="470.0" onclick="showNoteDetails(62)" id="note-62"/>
<text x="5450" y="479" text-anchor="middle" class="string-number" data-base-x="5450" data-base-y="475.0">10</text>
<text x="5450" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="5450" data-base-y="435.0">#62</text>
<text x="5450" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="5450" data-base-y="450.0">2</text>
<text x="5454" y="510.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 5454, 510.0)" data-base-x="5454" data-base-y="510.0" class="lyric-text">ƒëi</text>
<rect x="5535" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="5535" data-base-y="405.0"/>
<circle cx="5535" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="63" data-is-grace="false" data-base-x="5535" data-base-y="410.0" onclick="showNoteDetails(63)" id="note-63"/>
<text x="5535" y="419" text-anchor="middle" class="string-number" data-base-x="5535" data-base-y="415.0">9</text>
<text x="5535" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="5535" data-base-y="375.0">#63</text>
<text x="5535" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="5535" data-base-y="390.0">1</text>
<text x="5539" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 5539, 450.0)" data-base-x="5539" data-base-y="450.0" class="lyric-text">ph·∫£i</text>
<rect x="5580" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="5580" data-base-y="525.0"/>
<circle cx="5580" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="64" data-is-grace="false" data-base-x="5580" data-base-y="530.0" onclick="showNoteDetails(64)" id="note-64"/>
<text x="5580" y="539" text-anchor="middle" class="string-number" data-base-x="5580" data-base-y="535.0">11</text>
<text x="5580" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="5580" data-base-y="495.0">#64</text>
<text x="5580" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="5580" data-base-y="510.0">2</text>
<text x="5584" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 5584, 570.0)" data-base-x="5584" data-base-y="570.0" class="lyric-text">c√µng</text>
<rect x="5665" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="5665" data-base-y="525.0"/>
<circle cx="5665" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="65" data-is-grace="false" data-base-x="5665" data-base-y="530.0" onclick="showNoteDetails(65)" id="note-65"/>
<text x="5665" y="539" text-anchor="middle" class="string-number" data-base-x="5665" data-base-y="535.0">11</text>
<text x="5665" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="5665" data-base-y="495.0">#65</text>
<text x="5665" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="5665" data-base-y="510.0">3</text>
<text x="5669" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 5669, 570.0)" data-base-x="5669" data-base-y="570.0" class="lyric-text">l√∫c</text>
<rect x="5790" y="465.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="5790" data-base-y="465.0"/>
<circle cx="5790" cy="470.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="66" data-is-grace="false" data-base-x="5790" data-base-y="470.0" onclick="showNoteDetails(66)" id="note-66"/>
<text x="5790" y="479" text-anchor="middle" class="string-number" data-base-x="5790" data-base-y="475.0">10</text>
<text x="5790" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="5790" data-base-y="435.0">#66</text>
<text x="5790" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="5790" data-base-y="450.0">2</text>
<text x="5794" y="510.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 5794, 510.0)" data-base-x="5794" data-base-y="510.0" class="lyric-text">kh√≥c</text>
<rect x="5875" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="5875" data-base-y="405.0"/>
<circle cx="5875" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="67" data-is-grace="false" data-base-x="5875" data-base-y="410.0" onclick="showNoteDetails(67)" id="note-67"/>
<text x="5875" y="419" text-anchor="middle" class="string-number" data-base-x="5875" data-base-y="415.0">9</text>
<text x="5875" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="5875" data-base-y="375.0">#67</text>
<text x="5875" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="5875" data-base-y="390.0">1</text>
<text x="5879" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 5879, 450.0)" data-base-x="5879" data-base-y="450.0" class="lyric-text">ph·∫£i</text>
<rect x="5920" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="5920" data-base-y="315.0"/>
<circle cx="5920" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="68" data-is-grace="false" data-base-x="5920" data-base-y="320.0" onclick="showNoteDetails(68)" id="note-68"/>
<text x="5920" y="329" text-anchor="middle" class="string-number" data-base-x="5920" data-base-y="325.0">8</text>
<text x="5920" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="5920" data-base-y="285.0">#68</text>
<text x="5920" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="5920" data-base-y="300.0">3</text>
<text x="5924" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 5924, 360.0)" data-base-x="5924" data-base-y="360.0" class="lyric-text">b·ªìng</text>
<rect x="6045" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6045" data-base-y="405.0"/>
<circle cx="6045" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="69" data-is-grace="false" data-base-x="6045" data-base-y="410.0" onclick="showNoteDetails(69)" id="note-69"/>
<text x="6045" y="419" text-anchor="middle" class="string-number" data-base-x="6045" data-base-y="415.0">9</text>
<text x="6045" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6045" data-base-y="375.0">#69</text>
<text x="6045" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6045" data-base-y="390.0">1</text>
<text x="6049" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6049, 450.0)" data-base-x="6049" data-base-y="450.0" class="lyric-text">c√°i</text>
<rect x="6090" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6090" data-base-y="315.0"/>
<circle cx="6090" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="70" data-is-grace="false" data-base-x="6090" data-base-y="320.0" onclick="showNoteDetails(70)" id="note-70"/>
<text x="6090" y="329" text-anchor="middle" class="string-number" data-base-x="6090" data-base-y="325.0">8</text>
<text x="6090" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6090" data-base-y="285.0">#70</text>
<text x="6090" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6090" data-base-y="300.0">2</text>
<text x="6094" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6094, 360.0)" data-base-x="6094" data-base-y="360.0" class="lyric-text">duy√™n</text>
<rect x="6175" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6175" data-base-y="255.0"/>
<circle cx="6175" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="71" data-is-grace="false" data-base-x="6175" data-base-y="260.0" onclick="showNoteDetails(71)" id="note-71"/>
<text x="6175" y="269" text-anchor="middle" class="string-number" data-base-x="6175" data-base-y="265.0">7</text>
<text x="6175" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6175" data-base-y="225.0">#71</text>
<text x="6175" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6175" data-base-y="240.0">2</text>
<text x="6179" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6179, 300.0)" data-base-x="6179" data-base-y="300.0" class="lyric-text">√¥ng</text>
<rect x="6260" y="105.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6260" data-base-y="105.0"/>
<circle cx="6260" cy="110" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="72" data-is-grace="false" data-base-x="6260" data-base-y="110" onclick="showNoteDetails(72)" id="note-72"/>
<text x="6260" y="119" text-anchor="middle" class="string-number" data-base-x="6260" data-base-y="115.0">5</text>
<text x="6260" y="75" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6260" data-base-y="75">#72</text>
<text x="6260" y="90" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6260" data-base-y="90">2</text>
<text x="6264" y="150" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6264, 150)" data-base-x="6264" data-base-y="150" class="lyric-text">ch·ªìng</text>
<rect x="6345" y="105.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6345" data-base-y="105.0"/>
<circle cx="6345" cy="110" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="73" data-is-grace="false" data-base-x="6345" data-base-y="110" onclick="showNoteDetails(73)" id="note-73"/>
<text x="6345" y="119" text-anchor="middle" class="string-number" data-base-x="6345" data-base-y="115.0">5</text>
<text x="6345" y="75" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6345" data-base-y="75">#73</text>
<text x="6345" y="90" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6345" data-base-y="90">1</text>
<text x="6349" y="150" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6349, 150)" data-base-x="6349" data-base-y="150" class="lyric-text">l√†m</text>
<rect x="6390" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6390" data-base-y="255.0"/>
<circle cx="6390" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="74" data-is-grace="false" data-base-x="6390" data-base-y="260.0" onclick="showNoteDetails(74)" id="note-74"/>
<text x="6390" y="269" text-anchor="middle" class="string-number" data-base-x="6390" data-base-y="265.0">7</text>
<text x="6390" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6390" data-base-y="225.0">#74</text>
<text x="6390" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6390" data-base-y="240.0">1</text>
<text x="6394" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6394, 300.0)" data-base-x="6394" data-base-y="300.0" class="lyric-text">kh·ªï</text>
<rect x="6435" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6435" data-base-y="405.0"/>
<circle cx="6435" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="75" data-is-grace="false" data-base-x="6435" data-base-y="410.0" onclick="showNoteDetails(75)" id="note-75"/>
<text x="6435" y="419" text-anchor="middle" class="string-number" data-base-x="6435" data-base-y="415.0">9</text>
<text x="6435" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6435" data-base-y="375.0">#75</text>
<text x="6435" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6435" data-base-y="390.0">1</text>
<rect x="6480" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6480" data-base-y="405.0"/>
<circle cx="6480" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="76" data-is-grace="false" data-base-x="6480" data-base-y="410.0" onclick="showNoteDetails(76)" id="note-76"/>
<text x="6480" y="419" text-anchor="middle" class="string-number" data-base-x="6480" data-base-y="415.0">9</text>
<text x="6480" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6480" data-base-y="375.0">#76</text>
<text x="6480" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6480" data-base-y="390.0">1</text>
<text x="6484" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6484, 450.0)" data-base-x="6484" data-base-y="450.0" class="lyric-text">c√°i</text>
<rect x="6525" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6525" data-base-y="255.0"/>
<circle cx="6525" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="77" data-is-grace="false" data-base-x="6525" data-base-y="260.0" onclick="showNoteDetails(77)" id="note-77"/>
<text x="6525" y="269" text-anchor="middle" class="string-number" data-base-x="6525" data-base-y="265.0">7</text>
<text x="6525" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6525" data-base-y="225.0">#77</text>
<text x="6525" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6525" data-base-y="240.0">2</text>
<text x="6529" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6529, 300.0)" data-base-x="6529" data-base-y="300.0" class="lyric-text">ƒë·ªùi</text>
<rect x="6610" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6610" data-base-y="315.0"/>
<circle cx="6610" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="78" data-is-grace="false" data-base-x="6610" data-base-y="320.0" onclick="showNoteDetails(78)" id="note-78"/>
<text x="6610" y="329" text-anchor="middle" class="string-number" data-base-x="6610" data-base-y="325.0">8</text>
<text x="6610" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6610" data-base-y="285.0">#78</text>
<text x="6610" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6610" data-base-y="300.0">3</text>
<text x="6614" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6614, 360.0)" data-base-x="6614" data-base-y="360.0" class="lyric-text">t√¥i</text>
<rect x="6735" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6735" data-base-y="405.0"/>
<circle cx="6735" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="79" data-is-grace="false" data-base-x="6735" data-base-y="410.0" onclick="showNoteDetails(79)" id="note-79"/>
<text x="6735" y="419" text-anchor="middle" class="string-number" data-base-x="6735" data-base-y="415.0">9</text>
<text x="6735" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6735" data-base-y="375.0">#79</text>
<text x="6735" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6735" data-base-y="390.0">2</text>
<text x="6739" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6739, 450.0)" data-base-x="6739" data-base-y="450.0" class="lyric-text">∆°i</text>
<rect x="6820" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6820" data-base-y="255.0"/>
<circle cx="6820" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="80" data-is-grace="false" data-base-x="6820" data-base-y="260.0" onclick="showNoteDetails(80)" id="note-80"/>
<text x="6820" y="269" text-anchor="middle" class="string-number" data-base-x="6820" data-base-y="265.0">7</text>
<text x="6820" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6820" data-base-y="225.0">#80</text>
<text x="6820" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6820" data-base-y="240.0">1</text>
<text x="6824" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6824, 300.0)" data-base-x="6824" data-base-y="300.0" class="lyric-text">b√†</text>
<rect x="6865" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6865" data-base-y="405.0"/>
<circle cx="6865" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="81" data-is-grace="false" data-base-x="6865" data-base-y="410.0" onclick="showNoteDetails(81)" id="note-81"/>
<text x="6865" y="419" text-anchor="middle" class="string-number" data-base-x="6865" data-base-y="415.0">9</text>
<text x="6865" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6865" data-base-y="375.0">#81</text>
<text x="6865" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6865" data-base-y="390.0">2</text>
<text x="6869" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6869, 450.0)" data-base-x="6869" data-base-y="450.0" class="lyric-text">R√≠</text>
<rect x="6950" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="6950" data-base-y="315.0"/>
<circle cx="6950" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="82" data-is-grace="false" data-base-x="6950" data-base-y="320.0" onclick="showNoteDetails(82)" id="note-82"/>
<text x="6950" y="329" text-anchor="middle" class="string-number" data-base-x="6950" data-base-y="325.0">8</text>
<text x="6950" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="6950" data-base-y="285.0">#82</text>
<text x="6950" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="6950" data-base-y="300.0">3</text>
<text x="6954" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 6954, 360.0)" data-base-x="6954" data-base-y="360.0" class="lyric-text">∆°i</text>
<rect x="7075" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7075" data-base-y="255.0"/>
<circle cx="7075" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="83" data-is-grace="false" data-base-x="7075" data-base-y="260.0" onclick="showNoteDetails(83)" id="note-83"/>
<text x="7075" y="269" text-anchor="middle" class="string-number" data-base-x="7075" data-base-y="265.0">7</text>
<text x="7075" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7075" data-base-y="225.0">#83</text>
<text x="7075" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7075" data-base-y="240.0">1</text>
<text x="7079" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 7079, 300.0)" data-base-x="7079" data-base-y="300.0" class="lyric-text">b√†</text>
<rect x="7120" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7120" data-base-y="255.0"/>
<circle cx="7120" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="84" data-is-grace="false" data-base-x="7120" data-base-y="260.0" onclick="showNoteDetails(84)" id="note-84"/>
<text x="7120" y="269" text-anchor="middle" class="string-number" data-base-x="7120" data-base-y="265.0">7</text>
<text x="7120" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7120" data-base-y="225.0">#84</text>
<text x="7120" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7120" data-base-y="240.0">1</text>
<text x="7124" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 7124, 300.0)" data-base-x="7124" data-base-y="300.0" class="lyric-text">R·∫±ng</text>
<rect x="7165" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7165" data-base-y="255.0"/>
<circle cx="7165" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="85" data-is-grace="false" data-base-x="7165" data-base-y="260.0" onclick="showNoteDetails(85)" id="note-85"/>
<text x="7165" y="269" text-anchor="middle" class="string-number" data-base-x="7165" data-base-y="265.0">7</text>
<text x="7165" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7165" data-base-y="225.0">#85</text>
<text x="7165" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7165" data-base-y="240.0">1</text>
<text x="7169" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 7169, 300.0)" data-base-x="7169" data-base-y="300.0" class="lyric-text">b√†</text>
<rect x="7210" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7210" data-base-y="405.0"/>
<circle cx="7210" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="86" data-is-grace="false" data-base-x="7210" data-base-y="410.0" onclick="showNoteDetails(86)" id="note-86"/>
<text x="7210" y="419" text-anchor="middle" class="string-number" data-base-x="7210" data-base-y="415.0">9</text>
<text x="7210" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7210" data-base-y="375.0">#86</text>
<text x="7210" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7210" data-base-y="390.0">2</text>
<text x="7214" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 7214, 450.0)" data-base-x="7214" data-base-y="450.0" class="lyric-text">R√≠</text>
<rect x="7295" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7295" data-base-y="315.0"/>
<circle cx="7295" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="87" data-is-grace="false" data-base-x="7295" data-base-y="320.0" onclick="showNoteDetails(87)" id="note-87"/>
<text x="7295" y="329" text-anchor="middle" class="string-number" data-base-x="7295" data-base-y="325.0">8</text>
<text x="7295" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7295" data-base-y="285.0">#87</text>
<text x="7295" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7295" data-base-y="300.0">1</text>
<text x="7299" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 7299, 360.0)" data-base-x="7299" data-base-y="360.0" class="lyric-text">∆°i.</text>
<rect x="7340" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7340" data-base-y="405.0"/>
<circle cx="7340" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="88" data-is-grace="false" data-base-x="7340" data-base-y="410.0" onclick="showNoteDetails(88)" id="note-88"/>
<text x="7340" y="419" text-anchor="middle" class="string-number" data-base-x="7340" data-base-y="415.0">9</text>
<text x="7340" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7340" data-base-y="375.0">#88</text>
<text x="7340" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7340" data-base-y="390.0">2</text>
<text x="7344" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 7344, 450.0)" data-base-x="7344" data-base-y="450.0" class="lyric-text">Ch·ªìng</text>
<rect x="7425" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7425" data-base-y="405.0"/>
<circle cx="7425" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="89" data-is-grace="false" data-base-x="7425" data-base-y="410.0" onclick="showNoteDetails(89)" id="note-89"/>
<text x="7425" y="419" text-anchor="middle" class="string-number" data-base-x="7425" data-base-y="415.0">9</text>
<text x="7425" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7425" data-base-y="375.0">#89</text>
<text x="7425" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7425" data-base-y="390.0">1</text>
<text x="7429" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 7429, 450.0)" data-base-x="7429" data-base-y="450.0" class="lyric-text">g√¨</text>
<rect x="7470" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7470" data-base-y="405.0"/>
<circle cx="7470" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="90" data-is-grace="false" data-base-x="7470" data-base-y="410.0" onclick="showNoteDetails(90)" id="note-90"/>
<text x="7470" y="419" text-anchor="middle" class="string-number" data-base-x="7470" data-base-y="415.0">9</text>
<text x="7470" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7470" data-base-y="375.0">#90</text>
<text x="7470" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7470" data-base-y="390.0">1</text>
<text x="7474" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 7474, 450.0)" data-base-x="7474" data-base-y="450.0" class="lyric-text">m√†</text>
<rect x="7515" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7515" data-base-y="405.0"/>
<circle cx="7515" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="91" data-is-grace="false" data-base-x="7515" data-base-y="410.0" onclick="showNoteDetails(91)" id="note-91"/>
<text x="7515" y="419" text-anchor="middle" class="string-number" data-base-x="7515" data-base-y="415.0">9</text>
<text x="7515" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7515" data-base-y="375.0">#91</text>
<text x="7515" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7515" data-base-y="390.0">2</text>
<text x="7519" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 7519, 450.0)" data-base-x="7519" data-base-y="450.0" class="lyric-text">ch·ªìng</text>
<rect x="7600" y="467.0" width="80" height="6" fill="url(#graceResonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7600" data-base-y="467.0"/>
<circle cx="7600" cy="470.0" r="6" class="note-circle" fill="#FFD700" stroke="#0066FF" stroke-width="2" data-note-index="92" data-is-grace="true" data-base-x="7600" data-base-y="470.0" onclick="showNoteDetails(92)" id="note-92"/>
<text x="7600" y="479" text-anchor="middle" class="string-number" data-base-x="7600" data-base-y="475.0">10</text>
<text x="7600" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7600" data-base-y="435.0">#92</text>
<text x="7600" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7600" data-base-y="450.0">0.5</text>
<rect x="7625" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7625" data-base-y="525.0"/>
<circle cx="7625" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="93" data-is-grace="false" data-base-x="7625" data-base-y="530.0" onclick="showNoteDetails(93)" id="note-93"/>
<text x="7625" y="539" text-anchor="middle" class="string-number" data-base-x="7625" data-base-y="535.0">11</text>
<text x="7625" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7625" data-base-y="495.0">#93</text>
<text x="7625" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7625" data-base-y="510.0">8</text>
<text x="7629" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 7629, 570.0)" data-base-x="7629" data-base-y="570.0" class="lyric-text">ng√°y,</text>
<rect x="7950" y="527.0" width="80" height="6" fill="url(#graceResonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7950" data-base-y="527.0"/>
<circle cx="7950" cy="530.0" r="6" class="note-circle" fill="#FFD700" stroke="#0066FF" stroke-width="2" data-note-index="94" data-is-grace="true" data-base-x="7950" data-base-y="530.0" onclick="showNoteDetails(94)" id="note-94"/>
<text x="7950" y="539" text-anchor="middle" class="string-number" data-base-x="7950" data-base-y="535.0">11</text>
<text x="7950" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7950" data-base-y="495.0">#94</text>
<text x="7950" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7950" data-base-y="510.0">0.5</text>
<rect x="7975" y="615.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="7975" data-base-y="615.0"/>
<circle cx="7975" cy="620.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="95" data-is-grace="false" data-base-x="7975" data-base-y="620.0" onclick="showNoteDetails(95)" id="note-95"/>
<text x="7975" y="629" text-anchor="middle" class="string-number" data-base-x="7975" data-base-y="625.0">12</text>
<text x="7975" y="585.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="7975" data-base-y="585.0">#95</text>
<text x="7975" y="600.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="7975" data-base-y="600.0">2</text>
<text x="7979" y="660.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 7979, 660.0)" data-base-x="7979" data-base-y="660.0" class="lyric-text">ng√°y</text>
<rect x="8060" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="8060" data-base-y="525.0"/>
<circle cx="8060" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="96" data-is-grace="false" data-base-x="8060" data-base-y="530.0" onclick="showNoteDetails(96)" id="note-96"/>
<text x="8060" y="539" text-anchor="middle" class="string-number" data-base-x="8060" data-base-y="535.0">11</text>
<text x="8060" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="8060" data-base-y="495.0">#96</text>
<text x="8060" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="8060" data-base-y="510.0">1</text>
<text x="8064" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 8064, 570.0)" data-base-x="8064" data-base-y="570.0" class="lyric-text">o</text>
<rect x="8105" y="465.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="8105" data-base-y="465.0"/>
<circle cx="8105" cy="470.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="97" data-is-grace="false" data-base-x="8105" data-base-y="470.0" onclick="showNoteDetails(97)" id="note-97"/>
<text x="8105" y="479" text-anchor="middle" class="string-number" data-base-x="8105" data-base-y="475.0">10</text>
<text x="8105" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="8105" data-base-y="435.0">#97</text>
<text x="8105" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="8105" data-base-y="450.0">1</text>
<rect x="8150" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="8150" data-base-y="405.0"/>
<circle cx="8150" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="98" data-is-grace="false" data-base-x="8150" data-base-y="410.0" onclick="showNoteDetails(98)" id="note-98"/>
<text x="8150" y="419" text-anchor="middle" class="string-number" data-base-x="8150" data-base-y="415.0">9</text>
<text x="8150" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="8150" data-base-y="375.0">#98</text>
<text x="8150" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="8150" data-base-y="390.0">2</text>
<text x="8154" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 8154, 450.0)" data-base-x="8154" data-base-y="450.0" class="lyric-text">o</text>
<rect x="8235" y="465.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="8235" data-base-y="465.0"/>
<circle cx="8235" cy="470.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="99" data-is-grace="false" data-base-x="8235" data-base-y="470.0" onclick="showNoteDetails(99)" id="note-99"/>
<text x="8235" y="479" text-anchor="middle" class="string-number" data-base-x="8235" data-base-y="475.0">10</text>
<text x="8235" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="8235" data-base-y="435.0">#99</text>
<text x="8235" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="8235" data-base-y="450.0">8</text>
<text x="8239" y="510.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 8239, 510.0)" data-base-x="8239" data-base-y="510.0" class="lyric-text">o</text>
<rect x="8560" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="8560" data-base-y="405.0"/>
<circle cx="8560" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="100" data-is-grace="false" data-base-x="8560" data-base-y="410.0" onclick="showNoteDetails(100)" id="note-100"/>
<text x="8560" y="419" text-anchor="middle" class="string-number" data-base-x="8560" data-base-y="415.0">9</text>
<text x="8560" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="8560" data-base-y="375.0">#100</text>
<text x="8560" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="8560" data-base-y="390.0">3</text>
<text x="8564" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 8564, 450.0)" data-base-x="8564" data-base-y="450.0" class="lyric-text">ƒê√™m</text>
<rect x="8685" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="8685" data-base-y="315.0"/>
<circle cx="8685" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="101" data-is-grace="false" data-base-x="8685" data-base-y="320.0" onclick="showNoteDetails(101)" id="note-101"/>
<text x="8685" y="329" text-anchor="middle" class="string-number" data-base-x="8685" data-base-y="325.0">8</text>
<text x="8685" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="8685" data-base-y="285.0">#101</text>
<text x="8685" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="8685" data-base-y="300.0">2</text>
<text x="8689" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 8689, 360.0)" data-base-x="8689" data-base-y="360.0" class="lyric-text">th·ªùi</text>
<rect x="8770" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="8770" data-base-y="315.0"/>
<circle cx="8770" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="102" data-is-grace="false" data-base-x="8770" data-base-y="320.0" onclick="showNoteDetails(102)" id="note-102"/>
<text x="8770" y="329" text-anchor="middle" class="string-number" data-base-x="8770" data-base-y="325.0">8</text>
<text x="8770" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="8770" data-base-y="285.0">#102</text>
<text x="8770" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="8770" data-base-y="300.0">1</text>
<text x="8774" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 8774, 360.0)" data-base-x="8774" data-base-y="360.0" class="lyric-text">n·∫±m</text>
<rect x="8815" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="8815" data-base-y="405.0"/>
<circle cx="8815" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="103" data-is-grace="false" data-base-x="8815" data-base-y="410.0" onclick="showNoteDetails(103)" id="note-103"/>
<text x="8815" y="419" text-anchor="middle" class="string-number" data-base-x="8815" data-base-y="415.0">9</text>
<text x="8815" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="8815" data-base-y="375.0">#103</text>
<text x="8815" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="8815" data-base-y="390.0">2</text>
<text x="8819" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 8819, 450.0)" data-base-x="8819" data-base-y="450.0" class="lyric-text">co</text>
<rect x="8900" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="8900" data-base-y="405.0"/>
<circle cx="8900" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="104" data-is-grace="false" data-base-x="8900" data-base-y="410.0" onclick="showNoteDetails(104)" id="note-104"/>
<text x="8900" y="419" text-anchor="middle" class="string-number" data-base-x="8900" data-base-y="415.0">9</text>
<text x="8900" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="8900" data-base-y="375.0">#104</text>
<text x="8900" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="8900" data-base-y="390.0">3</text>
<text x="8904" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 8904, 450.0)" data-base-x="8904" data-base-y="450.0" class="lyric-text">l√†m</text>
<rect x="9025" y="465.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9025" data-base-y="465.0"/>
<circle cx="9025" cy="470.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="105" data-is-grace="false" data-base-x="9025" data-base-y="470.0" onclick="showNoteDetails(105)" id="note-105"/>
<text x="9025" y="479" text-anchor="middle" class="string-number" data-base-x="9025" data-base-y="475.0">10</text>
<text x="9025" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9025" data-base-y="435.0">#105</text>
<text x="9025" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9025" data-base-y="450.0">2</text>
<text x="9029" y="510.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 9029, 510.0)" data-base-x="9029" data-base-y="510.0" class="lyric-text">ƒÉn</text>
<rect x="9110" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9110" data-base-y="405.0"/>
<circle cx="9110" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="106" data-is-grace="false" data-base-x="9110" data-base-y="410.0" onclick="showNoteDetails(106)" id="note-106"/>
<text x="9110" y="419" text-anchor="middle" class="string-number" data-base-x="9110" data-base-y="415.0">9</text>
<text x="9110" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9110" data-base-y="375.0">#106</text>
<text x="9110" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9110" data-base-y="390.0">1</text>
<text x="9114" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 9114, 450.0)" data-base-x="9114" data-base-y="450.0" class="lyric-text">l∆∞·ªùi</text>
<rect x="9155" y="467.0" width="80" height="6" fill="url(#graceResonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9155" data-base-y="467.0"/>
<circle cx="9155" cy="470.0" r="6" class="note-circle" fill="#FFD700" stroke="#0066FF" stroke-width="2" data-note-index="107" data-is-grace="true" data-base-x="9155" data-base-y="470.0" onclick="showNoteDetails(107)" id="note-107"/>
<text x="9155" y="479" text-anchor="middle" class="string-number" data-base-x="9155" data-base-y="475.0">10</text>
<text x="9155" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9155" data-base-y="435.0">#107</text>
<text x="9155" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9155" data-base-y="450.0">0.5</text>
<rect x="9180" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9180" data-base-y="525.0"/>
<circle cx="9180" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="108" data-is-grace="false" data-base-x="9180" data-base-y="530.0" onclick="showNoteDetails(108)" id="note-108"/>
<text x="9180" y="539" text-anchor="middle" class="string-number" data-base-x="9180" data-base-y="535.0">11</text>
<text x="9180" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9180" data-base-y="495.0">#108</text>
<text x="9180" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9180" data-base-y="510.0">2</text>
<text x="9184" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 9184, 570.0)" data-base-x="9184" data-base-y="570.0" class="lyric-text">bi·∫øng</text>
<rect x="9265" y="467.0" width="80" height="6" fill="url(#graceResonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9265" data-base-y="467.0"/>
<circle cx="9265" cy="470.0" r="6" class="note-circle" fill="#FFD700" stroke="#0066FF" stroke-width="2" data-note-index="109" data-is-grace="true" data-base-x="9265" data-base-y="470.0" onclick="showNoteDetails(109)" id="note-109"/>
<text x="9265" y="479" text-anchor="middle" class="string-number" data-base-x="9265" data-base-y="475.0">10</text>
<text x="9265" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9265" data-base-y="435.0">#109</text>
<text x="9265" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9265" data-base-y="450.0">0.5</text>
<rect x="9290" y="525.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9290" data-base-y="525.0"/>
<circle cx="9290" cy="530.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="110" data-is-grace="false" data-base-x="9290" data-base-y="530.0" onclick="showNoteDetails(110)" id="note-110"/>
<text x="9290" y="539" text-anchor="middle" class="string-number" data-base-x="9290" data-base-y="535.0">11</text>
<text x="9290" y="495.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9290" data-base-y="495.0">#110</text>
<text x="9290" y="510.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9290" data-base-y="510.0">3</text>
<text x="9294" y="570.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 9294, 570.0)" data-base-x="9294" data-base-y="570.0" class="lyric-text">ch·∫≥ng</text>
<rect x="9415" y="465.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9415" data-base-y="465.0"/>
<circle cx="9415" cy="470.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="111" data-is-grace="false" data-base-x="9415" data-base-y="470.0" onclick="showNoteDetails(111)" id="note-111"/>
<text x="9415" y="479" text-anchor="middle" class="string-number" data-base-x="9415" data-base-y="475.0">10</text>
<text x="9415" y="435.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9415" data-base-y="435.0">#111</text>
<text x="9415" y="450.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9415" data-base-y="450.0">2</text>
<text x="9419" y="510.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 9419, 510.0)" data-base-x="9419" data-base-y="510.0" class="lyric-text">lo</text>
<rect x="9500" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9500" data-base-y="405.0"/>
<circle cx="9500" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="112" data-is-grace="false" data-base-x="9500" data-base-y="410.0" onclick="showNoteDetails(112)" id="note-112"/>
<text x="9500" y="419" text-anchor="middle" class="string-number" data-base-x="9500" data-base-y="415.0">9</text>
<text x="9500" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9500" data-base-y="375.0">#112</text>
<text x="9500" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9500" data-base-y="390.0">1</text>
<text x="9504" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 9504, 450.0)" data-base-x="9504" data-base-y="450.0" class="lyric-text">h·ªçc</text>
<rect x="9545" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9545" data-base-y="315.0"/>
<circle cx="9545" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="113" data-is-grace="false" data-base-x="9545" data-base-y="320.0" onclick="showNoteDetails(113)" id="note-113"/>
<text x="9545" y="329" text-anchor="middle" class="string-number" data-base-x="9545" data-base-y="325.0">8</text>
<text x="9545" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9545" data-base-y="285.0">#113</text>
<text x="9545" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9545" data-base-y="300.0">3</text>
<text x="9549" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 9549, 360.0)" data-base-x="9549" data-base-y="360.0" class="lyric-text">h√†nh</text>
<rect x="9670" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9670" data-base-y="405.0"/>
<circle cx="9670" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="114" data-is-grace="false" data-base-x="9670" data-base-y="410.0" onclick="showNoteDetails(114)" id="note-114"/>
<text x="9670" y="419" text-anchor="middle" class="string-number" data-base-x="9670" data-base-y="415.0">9</text>
<text x="9670" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9670" data-base-y="375.0">#114</text>
<text x="9670" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9670" data-base-y="390.0">1</text>
<text x="9674" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 9674, 450.0)" data-base-x="9674" data-base-y="450.0" class="lyric-text">c√°i</text>
<rect x="9715" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9715" data-base-y="315.0"/>
<circle cx="9715" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="115" data-is-grace="false" data-base-x="9715" data-base-y="320.0" onclick="showNoteDetails(115)" id="note-115"/>
<text x="9715" y="329" text-anchor="middle" class="string-number" data-base-x="9715" data-base-y="325.0">8</text>
<text x="9715" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9715" data-base-y="285.0">#115</text>
<text x="9715" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9715" data-base-y="300.0">2</text>
<text x="9719" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 9719, 360.0)" data-base-x="9719" data-base-y="360.0" class="lyric-text">duy√™n</text>
<rect x="9800" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9800" data-base-y="255.0"/>
<circle cx="9800" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="116" data-is-grace="false" data-base-x="9800" data-base-y="260.0" onclick="showNoteDetails(116)" id="note-116"/>
<text x="9800" y="269" text-anchor="middle" class="string-number" data-base-x="9800" data-base-y="265.0">7</text>
<text x="9800" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9800" data-base-y="225.0">#116</text>
<text x="9800" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9800" data-base-y="240.0">2</text>
<text x="9804" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 9804, 300.0)" data-base-x="9804" data-base-y="300.0" class="lyric-text">√¥ng</text>
<rect x="9885" y="105.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9885" data-base-y="105.0"/>
<circle cx="9885" cy="110" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="117" data-is-grace="false" data-base-x="9885" data-base-y="110" onclick="showNoteDetails(117)" id="note-117"/>
<text x="9885" y="119" text-anchor="middle" class="string-number" data-base-x="9885" data-base-y="115.0">5</text>
<text x="9885" y="75" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9885" data-base-y="75">#117</text>
<text x="9885" y="90" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9885" data-base-y="90">2</text>
<text x="9889" y="150" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 9889, 150)" data-base-x="9889" data-base-y="150" class="lyric-text">ch·ªìng</text>
<rect x="9970" y="105.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="9970" data-base-y="105.0"/>
<circle cx="9970" cy="110" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="118" data-is-grace="false" data-base-x="9970" data-base-y="110" onclick="showNoteDetails(118)" id="note-118"/>
<text x="9970" y="119" text-anchor="middle" class="string-number" data-base-x="9970" data-base-y="115.0">5</text>
<text x="9970" y="75" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="9970" data-base-y="75">#118</text>
<text x="9970" y="90" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="9970" data-base-y="90">1</text>
<text x="9974" y="150" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 9974, 150)" data-base-x="9974" data-base-y="150" class="lyric-text">l√†m</text>
<rect x="10015" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10015" data-base-y="255.0"/>
<circle cx="10015" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="119" data-is-grace="false" data-base-x="10015" data-base-y="260.0" onclick="showNoteDetails(119)" id="note-119"/>
<text x="10015" y="269" text-anchor="middle" class="string-number" data-base-x="10015" data-base-y="265.0">7</text>
<text x="10015" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10015" data-base-y="225.0">#119</text>
<text x="10015" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10015" data-base-y="240.0">1</text>
<text x="10019" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10019, 300.0)" data-base-x="10019" data-base-y="300.0" class="lyric-text">kh·ªï</text>
<rect x="10060" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10060" data-base-y="405.0"/>
<circle cx="10060" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="120" data-is-grace="false" data-base-x="10060" data-base-y="410.0" onclick="showNoteDetails(120)" id="note-120"/>
<text x="10060" y="419" text-anchor="middle" class="string-number" data-base-x="10060" data-base-y="415.0">9</text>
<text x="10060" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10060" data-base-y="375.0">#120</text>
<text x="10060" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10060" data-base-y="390.0">1</text>
<rect x="10105" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10105" data-base-y="405.0"/>
<circle cx="10105" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="121" data-is-grace="false" data-base-x="10105" data-base-y="410.0" onclick="showNoteDetails(121)" id="note-121"/>
<text x="10105" y="419" text-anchor="middle" class="string-number" data-base-x="10105" data-base-y="415.0">9</text>
<text x="10105" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10105" data-base-y="375.0">#121</text>
<text x="10105" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10105" data-base-y="390.0">1</text>
<text x="10109" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10109, 450.0)" data-base-x="10109" data-base-y="450.0" class="lyric-text">c√°i</text>
<rect x="10150" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10150" data-base-y="255.0"/>
<circle cx="10150" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="122" data-is-grace="false" data-base-x="10150" data-base-y="260.0" onclick="showNoteDetails(122)" id="note-122"/>
<text x="10150" y="269" text-anchor="middle" class="string-number" data-base-x="10150" data-base-y="265.0">7</text>
<text x="10150" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10150" data-base-y="225.0">#122</text>
<text x="10150" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10150" data-base-y="240.0">2</text>
<text x="10154" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10154, 300.0)" data-base-x="10154" data-base-y="300.0" class="lyric-text">ƒë·ªùi</text>
<rect x="10235" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10235" data-base-y="315.0"/>
<circle cx="10235" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="123" data-is-grace="false" data-base-x="10235" data-base-y="320.0" onclick="showNoteDetails(123)" id="note-123"/>
<text x="10235" y="329" text-anchor="middle" class="string-number" data-base-x="10235" data-base-y="325.0">8</text>
<text x="10235" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10235" data-base-y="285.0">#123</text>
<text x="10235" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10235" data-base-y="300.0">3</text>
<text x="10239" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10239, 360.0)" data-base-x="10239" data-base-y="360.0" class="lyric-text">t√¥i,</text>
<rect x="10360" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10360" data-base-y="405.0"/>
<circle cx="10360" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="124" data-is-grace="false" data-base-x="10360" data-base-y="410.0" onclick="showNoteDetails(124)" id="note-124"/>
<text x="10360" y="419" text-anchor="middle" class="string-number" data-base-x="10360" data-base-y="415.0">9</text>
<text x="10360" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10360" data-base-y="375.0">#124</text>
<text x="10360" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10360" data-base-y="390.0">2</text>
<text x="10364" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10364, 450.0)" data-base-x="10364" data-base-y="450.0" class="lyric-text">∆°i</text>
<rect x="10445" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10445" data-base-y="255.0"/>
<circle cx="10445" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="125" data-is-grace="false" data-base-x="10445" data-base-y="260.0" onclick="showNoteDetails(125)" id="note-125"/>
<text x="10445" y="269" text-anchor="middle" class="string-number" data-base-x="10445" data-base-y="265.0">7</text>
<text x="10445" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10445" data-base-y="225.0">#125</text>
<text x="10445" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10445" data-base-y="240.0">1</text>
<text x="10449" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10449, 300.0)" data-base-x="10449" data-base-y="300.0" class="lyric-text">b√†</text>
<rect x="10490" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10490" data-base-y="315.0"/>
<circle cx="10490" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="126" data-is-grace="false" data-base-x="10490" data-base-y="320.0" onclick="showNoteDetails(126)" id="note-126"/>
<text x="10490" y="329" text-anchor="middle" class="string-number" data-base-x="10490" data-base-y="325.0">8</text>
<text x="10490" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10490" data-base-y="285.0">#126</text>
<text x="10490" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10490" data-base-y="300.0">2</text>
<text x="10494" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10494, 360.0)" data-base-x="10494" data-base-y="360.0" class="lyric-text">R√≠</text>
<rect x="10575" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10575" data-base-y="315.0"/>
<circle cx="10575" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="127" data-is-grace="false" data-base-x="10575" data-base-y="320.0" onclick="showNoteDetails(127)" id="note-127"/>
<text x="10575" y="329" text-anchor="middle" class="string-number" data-base-x="10575" data-base-y="325.0">8</text>
<text x="10575" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10575" data-base-y="285.0">#127</text>
<text x="10575" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10575" data-base-y="300.0">3</text>
<text x="10579" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10579, 360.0)" data-base-x="10579" data-base-y="360.0" class="lyric-text">∆°i</text>
<rect x="10700" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10700" data-base-y="255.0"/>
<circle cx="10700" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="128" data-is-grace="false" data-base-x="10700" data-base-y="260.0" onclick="showNoteDetails(128)" id="note-128"/>
<text x="10700" y="269" text-anchor="middle" class="string-number" data-base-x="10700" data-base-y="265.0">7</text>
<text x="10700" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10700" data-base-y="225.0">#128</text>
<text x="10700" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10700" data-base-y="240.0">1</text>
<text x="10704" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10704, 300.0)" data-base-x="10704" data-base-y="300.0" class="lyric-text">b√†</text>
<rect x="10745" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10745" data-base-y="255.0"/>
<circle cx="10745" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="129" data-is-grace="false" data-base-x="10745" data-base-y="260.0" onclick="showNoteDetails(129)" id="note-129"/>
<text x="10745" y="269" text-anchor="middle" class="string-number" data-base-x="10745" data-base-y="265.0">7</text>
<text x="10745" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10745" data-base-y="225.0">#129</text>
<text x="10745" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10745" data-base-y="240.0">1</text>
<text x="10749" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10749, 300.0)" data-base-x="10749" data-base-y="300.0" class="lyric-text">R·∫±ng</text>
<rect x="10790" y="255.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10790" data-base-y="255.0"/>
<circle cx="10790" cy="260.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="130" data-is-grace="false" data-base-x="10790" data-base-y="260.0" onclick="showNoteDetails(130)" id="note-130"/>
<text x="10790" y="269" text-anchor="middle" class="string-number" data-base-x="10790" data-base-y="265.0">7</text>
<text x="10790" y="225.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10790" data-base-y="225.0">#130</text>
<text x="10790" y="240.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10790" data-base-y="240.0">1</text>
<text x="10794" y="300.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10794, 300.0)" data-base-x="10794" data-base-y="300.0" class="lyric-text">b√†</text>
<rect x="10835" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10835" data-base-y="405.0"/>
<circle cx="10835" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="131" data-is-grace="false" data-base-x="10835" data-base-y="410.0" onclick="showNoteDetails(131)" id="note-131"/>
<text x="10835" y="419" text-anchor="middle" class="string-number" data-base-x="10835" data-base-y="415.0">9</text>
<text x="10835" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10835" data-base-y="375.0">#131</text>
<text x="10835" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10835" data-base-y="390.0">2</text>
<text x="10839" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10839, 450.0)" data-base-x="10839" data-base-y="450.0" class="lyric-text">R√≠</text>
<rect x="10920" y="315.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10920" data-base-y="315.0"/>
<circle cx="10920" cy="320.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="132" data-is-grace="false" data-base-x="10920" data-base-y="320.0" onclick="showNoteDetails(132)" id="note-132"/>
<text x="10920" y="329" text-anchor="middle" class="string-number" data-base-x="10920" data-base-y="325.0">8</text>
<text x="10920" y="285.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10920" data-base-y="285.0">#132</text>
<text x="10920" y="300.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10920" data-base-y="300.0">1</text>
<text x="10924" y="360.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10924, 360.0)" data-base-x="10924" data-base-y="360.0" class="lyric-text">∆°i</text>
<rect x="10965" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="10965" data-base-y="405.0"/>
<circle cx="10965" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="133" data-is-grace="false" data-base-x="10965" data-base-y="410.0" onclick="showNoteDetails(133)" id="note-133"/>
<text x="10965" y="419" text-anchor="middle" class="string-number" data-base-x="10965" data-base-y="415.0">9</text>
<text x="10965" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="10965" data-base-y="375.0">#133</text>
<text x="10965" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="10965" data-base-y="390.0">2</text>
<text x="10969" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 10969, 450.0)" data-base-x="10969" data-base-y="450.0" class="lyric-text">B√†</text>
<rect x="11050" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="11050" data-base-y="405.0"/>
<circle cx="11050" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="134" data-is-grace="false" data-base-x="11050" data-base-y="410.0" onclick="showNoteDetails(134)" id="note-134"/>
<text x="11050" y="419" text-anchor="middle" class="string-number" data-base-x="11050" data-base-y="415.0">9</text>
<text x="11050" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="11050" data-base-y="375.0">#134</text>
<text x="11050" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="11050" data-base-y="390.0">2</text>
<text x="11054" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 11054, 450.0)" data-base-x="11054" data-base-y="450.0" class="lyric-text">R·∫±ng</text>
<rect x="11135" y="405.0" width="320" height="10" fill="url(#resonanceBand)" stroke="none" rx="2" opacity="0.9" data-base-x="11135" data-base-y="405.0"/>
<circle cx="11135" cy="410.0" r="12" class="note-circle" fill="#008080" stroke="crimson" stroke-width="2" data-note-index="135" data-is-grace="false" data-base-x="11135" data-base-y="410.0" onclick="showNoteDetails(135)" id="note-135"/>
<text x="11135" y="419" text-anchor="middle" class="string-number" data-base-x="11135" data-base-y="415.0">9</text>
<text x="11135" y="375.0" text-anchor="middle" style="font-size: 9px; fill: #666; font-weight: bold; opacity: 0.3;" data-base-x="11135" data-base-y="375.0">#135</text>
<text x="11135" y="390.0" text-anchor="middle" style="font-size: 10px; fill: #000; font-weight: bold; opacity: 0.0;" data-base-x="11135" data-base-y="390.0">2</text>
<text x="11139" y="450.0" text-anchor="start" style="font-family: Arial; font-size: 11px; fill: #333; font-weight: bold;" transform="rotate(-90, 11139, 450.0)" data-base-x="11139" data-base-y="450.0" class="lyric-text">b√†</text>
</svg>
        </div>

        <!-- Right-Aligned Bar Chart Container -->
        <div id="rightBarChartContainer" style="
            position: fixed;
            right: 270px;
            top: 200px;
            width: 250px;
            height: 500px;
            background: transparent;
            z-index: 1000;
            overflow: visible;
            pointer-events: all;
            display: block;
        ">
            <div id="rightBarChartContent" style="position: relative; width: 100%; height: 100%;"></div>
        </div>
        </div>

        <!-- Popup Button Panel -->
        <div class="popup-button-panel" style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
            <!-- Audio Controls Inline -->
            <button id="initAudioBtn" onclick="initializeAudio()" style="background: #e74c3c; color: white; padding: 8px 12px; font-size: 12px; border: none; border-radius: 3px; cursor: pointer; margin: 0 2px;">üîä</button>
            <button id="playPauseBtn" onclick="togglePlayback()" disabled style="opacity: 0.3; cursor: not-allowed; padding: 8px 12px; font-size: 12px; border: none; border-radius: 3px; background: #bdc3c7; color: #7f8c8d; margin: 0 2px;">‚ñ∂</button>
            <button id="stopBtn" onclick="stopPlayback()" disabled style="opacity: 0.3; cursor: not-allowed; padding: 8px 12px; font-size: 12px; border: none; border-radius: 3px; background: #bdc3c7; color: #7f8c8d; margin: 0 2px;">‚èπ</button>
            <span style="font-size: 12px; margin: 0 5px;">Tempo:</span>
            <input type="range" id="tempoSlider" min="60" max="200" value="120" onchange="updateTempo()" style="width: 80px; margin: 0 2px;">
            <span id="tempoValue" style="font-size: 12px; min-width: 35px; margin: 0 5px;">120 BPM</span>
            <label style="display: inline-flex; align-items: center; gap: 3px; font-size: 12px; cursor: pointer; margin: 0 5px;">
                <input type="checkbox" id="autoScrollToggle" checked onchange="saveAutoScrollPreference()">
                Auto-scroll
            </label>
            <span style="margin: 0 10px;">|</span>
            <button onclick="showContent('lyrics')" style="padding: 8px 15px; margin: 0 5px; background: #e74c3c; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">üìù Lyrics</button>
            <button id="toggleRightBarChart" onclick="toggleRightBarChart()" style="padding: 8px 15px; margin: 0 5px; background: #008080; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">üìä KP/RIC-1</button>
            <button onclick="showContent('kpic-kric-sankey')" style="padding: 8px 15px; margin: 0 5px; background: #9b59b6; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">üìà KPIC-2 & KRIC-2</button>
            <button onclick="showContent('kpic3-kric3-sankey')" style="padding: 8px 15px; margin: 0 5px; background: #8e44ad; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">üìà KPIC-3 & KRIC-3</button>
            <button onclick="showLegend()" style="padding: 8px 15px; margin: 0 5px; background: #34495e; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">üè∑Ô∏è Legend</button>
            <button onclick="showContent('analysis')" style="padding: 8px 15px; margin: 0 5px; background: #f39c12; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">üîç Analysis</button>
        </div>

        <!-- Unified Content Area -->
        <div id="content-area" style="margin: 20px 0; background: white; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: none; padding: 20px;">
            <!-- Content will be shown here based on button selection -->
        </div>

        <!-- Analysis Modal -->
        <div id="analysisModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
            <div class="modal-content" style="background-color: white; margin: 2% auto; padding: 0; border-radius: 10px; width: 90%; max-width: 1200px; height: 90%; max-height: 800px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); display: flex; flex-direction: column;">
                <!-- Modal Header -->
                <div class="modal-header" style="padding: 20px 30px; border-bottom: 2px solid #ecf0f1; background: linear-gradient(135deg, #f39c12, #e67e22); color: white; border-radius: 10px 10px 0 0;">
                    <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                        üîç Song Analysis: <span id="songTitle">B√† R·∫±ng B√† R√≠</span>
                    </h2>
                    <span class="close" onclick="closeAnalysisModal()" style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 28px; font-weight: bold; cursor: pointer; color: white; opacity: 0.8; transition: opacity 0.3s;">&times;</span>
                </div>

                <!-- Modal Body -->
                <div class="modal-body" style="flex: 1; display: flex; overflow: hidden;">
                    <!-- Left Sidebar - Key Takeaways -->
                    <div class="analysis-sidebar" style="width: 30%; padding: 20px; background: #f8f9fa; border-right: 2px solid #ecf0f1; overflow-y: auto;">
                        <h3 style="color: #2c3e50; margin: 0 0 15px 0; font-size: 18px;">üìå Key Takeaways</h3>

                        <!-- Quick Overview Metrics -->
                        <div class="overview-metrics" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 20px;">
                            <div style="background: white; padding: 10px; border-radius: 5px; text-align: center; border-left: 3px solid #e74c3c;">
                                <div style="font-size: 16px; font-weight: bold; color: #e74c3c;">137</div>
                                <div style="font-size: 11px; color: #7f8c8d;">Total Notes</div>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px; text-align: center; border-left: 3px solid #3498db;">
                                <div style="font-size: 16px; font-weight: bold; color: #3498db;">7</div>
                                <div style="font-size: 11px; color: #7f8c8d;">Open Strings</div>
                            </div>
                            <div id="bentStringsMetric" style="background: white; padding: 10px; border-radius: 5px; text-align: center; border-left: 3px solid #27ae60; cursor: pointer; transition: all 0.2s;"
                                 onclick="toggleBentNotesHighlight()"
                                 title="Click to highlight bent notes in tablature">
                                <div style="font-size: 16px; font-weight: bold; color: #27ae60;">
                                    <span id="bentStringsCount">0</span> str / <span id="bentNotesCount">0</span> notes
                                </div>
                                <div style="font-size: 11px; color: #7f8c8d;">Bent Strings/Notes</div>
                            </div>
                        </div>

                        <!-- Tuning Information -->
                        <div class="tuning-info" style="background: #e8f5e9; padding: 12px; border-radius: 5px; margin-bottom: 20px; border-left: 3px solid #27ae60;">
                            <h4 style="color: #27ae60; margin: 0 0 8px 0; font-size: 14px;">üéµ Tuning System</h4>
                            <div style="font-size: 13px; color: #2e7d32; font-weight: 600; margin-bottom: 5px;">
                                Pentatonic (5-note scale)
                            </div>
                            <div id="tuningDisplay" style="font-size: 12px; color: #558b57; font-family: monospace;">
                                C - D - E - G - A
                            </div>
                            <div style="font-size: 11px; color: #7f8c8d; margin-top: 5px;">
                                Song-specific optimal tuning
                            </div>
                        </div>

                        <div class="takeaway-section" style="margin-bottom: 20px;">
                            <h4 style="color: #e74c3c; margin: 0 0 8px 0; font-size: 14px;">Cultural Message</h4>
                            <p style="font-size: 13px; line-height: 1.5; margin: 0; color: #34495e;">A humorous Vietnamese folk song depicting marital hardships, using wit and satire to comment on social relationships and domestic life challenges.</p>
                        </div>

                        <div class="takeaway-section" style="margin-bottom: 20px;">
                            <h4 style="color: #3498db; margin: 0 0 8px 0; font-size: 14px;">Musical Key Points</h4>
                            <ul style="font-size: 13px; line-height: 1.4; margin: 0; padding-left: 15px; color: #34495e;">
                                <li>Uses 7 of 16 ƒê√†n Tranh strings (D4-G5 range)</li>
                                <li>Dominated by descending melodic patterns</li>
                                <li>C5-A4-C5 oscillation is most characteristic</li>
                                <li>Intermediate-advanced difficulty level</li>
                            </ul>
                        </div>

                        <div class="takeaway-section">
                            <h4 style="color: #9b59b6; margin: 0 0 8px 0; font-size: 14px;">Learning Focus</h4>
                            <ul style="font-size: 13px; line-height: 1.4; margin: 0; padding-left: 15px; color: #34495e;">
                                <li>Master the E5-D5-C5-A4-C5 descending phrase</li>
                                <li>Practice the long melodic sequences (16+ notes)</li>
                                <li>Work on smooth transitions between registers</li>
                                <li>Focus on expressive melodic storytelling</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Right Main Content -->
                    <div class="analysis-main" style="width: 70%; padding: 20px; overflow-y: auto;">
                        <!-- Tab Navigation -->
                        <div class="analysis-tabs" style="margin-bottom: 20px; border-bottom: 2px solid #ecf0f1;">
                            <button class="tab-button active" onclick="showAnalysisTab('cultural')" style="padding: 10px 20px; margin-right: 5px; background: #3498db; color: white; border: none; border-radius: 5px 5px 0 0; cursor: pointer; font-size: 14px;">üèõÔ∏è Cultural</button>
                            <button class="tab-button" onclick="showAnalysisTab('technical')" style="padding: 10px 20px; margin-right: 5px; background: #bdc3c7; color: #34495e; border: none; border-radius: 5px 5px 0 0; cursor: pointer; font-size: 14px;">‚öôÔ∏è Technical</button>
                            <button class="tab-button" onclick="showAnalysisTab('patterns')" style="padding: 10px 20px; margin-right: 5px; background: #bdc3c7; color: #34495e; border: none; border-radius: 5px 5px 0 0; cursor: pointer; font-size: 14px;">üìä Patterns</button>
                            <button class="tab-button" onclick="showAnalysisTab('melodic')" style="padding: 10px 20px; margin-right: 5px; background: #bdc3c7; color: #34495e; border: none; border-radius: 5px 5px 0 0; cursor: pointer; font-size: 14px;">üéµ Melodic</button>
                            <button class="tab-button" onclick="showAnalysisTab('structure')" style="padding: 10px 20px; background: #bdc3c7; color: #34495e; border: none; border-radius: 5px 5px 0 0; cursor: pointer; font-size: 14px;">üèóÔ∏è Structure</button>
                        </div>

                        <!-- Tab Content Areas -->
                        <div id="cultural-tab" class="tab-content" style="display: block;">
                            <h3 style="color: #2c3e50; margin: 0 0 15px 0;">üèõÔ∏è Cultural Significance</h3>

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #e74c3c; margin: 0 0 10px 0;">Lyrics in Vietnamese Society</h4>
                                <p style="line-height: 1.6; margin: 0;">"B√† R·∫±ng B√† R√≠" uses humor and wordplay to address serious social issues about marriage and domestic relationships. The song's satirical tone allows for social commentary while entertaining, reflecting Vietnamese culture's tradition of using folk songs to discuss difficult topics through wit and metaphor. The repetitive "b√† R·∫±ng b√† R√≠" phrase creates a rhythmic storytelling device typical of Vietnamese oral tradition.</p>
                            </div>

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #3498db; margin: 0 0 10px 0;">Historical Context</h4>
                                <p style="line-height: 1.6; margin: 0;">This folk song represents the tradition of Vietnamese satirical music, where social criticism is delivered through humor and memorable melodies. Such songs were important outlets for expressing frustrations about social conditions, particularly regarding family and marital relationships. The melodic complexity reflects the sophisticated storytelling tradition of Vietnamese folk music.</p>
                            </div>
                        </div>

                        <div id="technical-tab" class="tab-content" style="display: none;">
                            <h3 style="color: #2c3e50; margin: 0 0 15px 0;">‚öôÔ∏è Technical Analysis</h3>

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #e74c3c; margin: 0 0 10px 0;">String Usage Analysis</h4>
                                <p style="margin: 0 0 10px 0;"><strong>Strings Used:</strong> 7 out of 16 total strings</p>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                                    <div style="background: white; padding: 10px; border-radius: 5px; text-align: center;">
                                        <strong>String 5 (D4)</strong><br>
                                        <span style="color: #e74c3c;">Lower register foundation</span>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 5px; text-align: center;">
                                        <strong>String 7 (G4)</strong><br>
                                        <span style="color: #e74c3c;">Transitional phrases</span>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 5px; text-align: center;">
                                        <strong>String 8 (A4)</strong><br>
                                        <span style="color: #e74c3c;">Key melodic pivot</span>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 5px; text-align: center;">
                                        <strong>String 9 (C5)</strong><br>
                                        <span style="color: #e74c3c;">Primary melodic center</span>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 5px; text-align: center;">
                                        <strong>String 10 (D5)</strong><br>
                                        <span style="color: #e74c3c;">Ascending phrases</span>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 5px; text-align: center;">
                                        <strong>String 11 (E5)</strong><br>
                                        <span style="color: #e74c3c;">Peak melodic moments</span>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 5px; text-align: center;">
                                        <strong>String 12 (G5)</strong><br>
                                        <span style="color: #e74c3c;">Highest register accents</span>
                                    </div>
                                </div>
                            </div>

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <h4 style="color: #3498db; margin: 0 0 10px 0;">Range and Difficulty</h4>
                                <p style="line-height: 1.6; margin: 0;"><strong>Melodic Range:</strong> D4 to G5 (spanning 1.5 octaves)<br>
                                <strong>Difficulty Level:</strong> Intermediate-Advanced - requires excellent melodic flow control<br>
                                <strong>Key Challenges:</strong> Long descending passages, precise intonation in extended patterns, expressive storytelling through melody</p>
                            </div>
                        </div>

                        <div id="patterns-tab" class="tab-content" style="display: none;">
                            <h3 style="color: #2c3e50; margin: 0 0 15px 0;">üìä Pattern Analysis</h3>

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #e74c3c; margin: 0 0 10px 0;">Top KPIC (Pitch) Patterns</h4>
                                <div style="display: grid; gap: 10px;">
                                    <div style="background: white; padding: 12px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>C5 ‚Üí C5</strong> (Same note repetition)</span>
                                        <span style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">16 times</span>
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>A4 ‚Üí C5</strong> (Ascending minor third)</span>
                                        <span style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">14 times</span>
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>C5 ‚Üí A4</strong> (Descending minor third)</span>
                                        <span style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">14 times</span>
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>C5 ‚Üí D5</strong> (Ascending major second)</span>
                                        <span style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">10 times</span>
                                    </div>
                                </div>
                                <p style="margin: 10px 0 0 0; font-size: 13px; color: #7f8c8d;"><em>These patterns form the melodic backbone of the piece, with C5-A4 oscillation being particularly characteristic.</em></p>
                            </div>

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <h4 style="color: #3498db; margin: 0 0 10px 0;">Top KPIC-3 (Three-Note) Patterns</h4>
                                <div style="display: grid; gap: 10px;">
                                    <div style="background: white; padding: 12px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>C5 ‚Üí A4 ‚Üí C5</strong> (Oscillating pattern)</span>
                                        <span style="background: #3498db; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">8 times</span>
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>D5 ‚Üí E5 ‚Üí D5</strong> (Upper register wave)</span>
                                        <span style="background: #3498db; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">7 times</span>
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>C5 ‚Üí C5 ‚Üí C5</strong> (Repeated emphasis)</span>
                                        <span style="background: #3498db; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">6 times</span>
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>C5 ‚Üí D5 ‚Üí E5</strong> (Ascending sequence)</span>
                                        <span style="background: #3498db; color: white; padding: 4px 8px; border-radius: 3px; font-size: 12px;">6 times</span>
                                    </div>
                                </div>
                                <p style="margin: 10px 0 0 0; font-size: 13px; color: #7f8c8d;"><em>The C5-A4-C5 oscillation is the song's signature melodic gesture, appearing throughout the narrative structure.</em></p>
                            </div>
                        </div>

                        <div id="rhythm-tab" class="tab-content" style="display: none;">
                            <h3 style="color: #2c3e50; margin: 0 0 15px 0;">üéµ Rhythmic Character</h3>

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #e74c3c; margin: 0 0 10px 0;">Dotted Eighth Note Emphasis</h4>
                                <p style="line-height: 1.6; margin: 0 0 15px 0;">The extensive use of dotted eighth notes (‚ô™.) is what gives "L√Ω Ng·ª±a √î" its distinctive rhythmic character. This creates a galloping rhythm that musically represents the horse's gait mentioned in the song's title.</p>

                                <div style="background: white; padding: 15px; border-radius: 5px; border-left: 4px solid #e74c3c;">
                                    <h5 style="margin: 0 0 8px 0; color: #e74c3c;">Rhythmic Impact:</h5>
                                    <ul style="margin: 0; padding-left: 20px;">
                                        <li>Creates forward momentum and energy</li>
                                        <li>Mimics the natural rhythm of horse hooves</li>
                                        <li>Provides characteristic Vietnamese folk rhythm</li>
                                        <li>Adds complexity without overwhelming the melody</li>
                                    </ul>
                                </div>
                            </div>

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <h4 style="color: #3498db; margin: 0 0 10px 0;">Practice Recommendations</h4>
                                <div style="display: grid; gap: 10px;">
                                    <div style="background: white; padding: 12px; border-radius: 5px;">
                                        <strong>1. Rhythm Isolation:</strong> Practice the dotted rhythm pattern on a single string before adding pitch changes.
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 5px;">
                                        <strong>2. Metronome Work:</strong> Start at 80 BPM and gradually increase to performance tempo (120 BPM).
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 5px;">
                                        <strong>3. Pattern Focus:</strong> Master the C5-A4-C5 melodic pattern with correct dotted rhythms.
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 5px;">
                                        <strong>4. Expression:</strong> Emphasize the strong beats while keeping dotted notes light and flowing.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="structure-tab" class="tab-content" style="display: none;">
                            <h3 style="color: #2c3e50; margin: 0 0 15px 0;">üèóÔ∏è Song Structure & Learning Efficiency</h3>

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #e74c3c; margin: 0 0 10px 0;">How Much Do You Actually Need to Learn?</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                    <div style="background: white; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #27ae60;">
                                        <h5 style="margin: 0 0 5px 0; color: #27ae60;">Unique Material</h5>
                                        <div style="font-size: 24px; font-weight: bold; color: #27ae60;">~30%</div>
                                        <p style="margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;">56 unique notes to master</p>
                                    </div>
                                    <div style="background: white; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #3498db;">
                                        <h5 style="margin: 0 0 5px 0; color: #3498db;">Repetitions</h5>
                                        <div style="font-size: 24px; font-weight: bold; color: #3498db;">~70%</div>
                                        <p style="margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;">133 notes of exact repetitions</p>
                                    </div>
                                </div>
                                <p style="line-height: 1.6; margin: 0; font-size: 14px;"><strong>Excellent news!</strong> Once you master just Section 1 plus small variations, you'll know 70% of the song through repetition. This makes "B√† R·∫±ng B√† R√≠" exceptionally efficient for learning traditional Vietnamese cyclical song structures.</p>
                            </div>

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #3498db; margin: 0 0 10px 0;">Song Structure: 3-Section Cyclical Form</h4>
                                <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 5px; border: 1px solid #ddd; font-family: monospace; font-size: 11px; line-height: 1.4;">
                                    <div style="text-align: center; margin-bottom: 10px; font-weight: bold; color: #2c3e50;">Section Structure (repeats 3 times):</div>
                                    <div style="color: #7f8c8d;">‚îå‚îÄ[7-note motif]‚îÄ‚îê ‚îå‚îÄ[development]‚îÄ‚îê ‚îå‚îÄ[16-note signature]‚îÄ‚îê ‚îå‚îÄ[closing]‚îÄ‚îê</div>
                                    <div style="color: #e74c3c;">‚îÇ "Announcement" ‚îÇ ‚îÇ "Build-up"    ‚îÇ ‚îÇ "Main story"        ‚îÇ ‚îÇ "Ending"  ‚îÇ</div>
                                    <div style="color: #3498db;">‚îÇ C5-C5-C5...    ‚îÇ ‚îÇ Transitional  ‚îÇ ‚îÇ E5-D5-C5-A4...     ‚îÇ ‚îÇ Brief     ‚îÇ</div>
                                    <div style="color: #9b59b6;">‚îÇ (positions     ‚îÇ ‚îÇ material      ‚îÇ ‚îÇ (positions          ‚îÇ ‚îÇ material  ‚îÇ</div>
                                    <div style="color: #9b59b6;">‚îÇ 0,46,89)       ‚îÇ ‚îÇ               ‚îÇ ‚îÇ 22,65,110)          ‚îÇ ‚îÇ           ‚îÇ</div>
                                    <div style="color: #7f8c8d;">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>
                                </div>
                                <div style="display: grid; gap: 8px;">
                                    <div style="background: white; padding: 10px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>Section 1</strong> - Template (learn completely)</span>
                                        <span style="background: #27ae60; color: white; padding: 2px 8px; border-radius: 3px; font-size: 11px;">Notes 0-45 (46 notes)</span>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>Section 2</strong> - Compressed version (learn variations only)</span>
                                        <span style="background: #3498db; color: white; padding: 2px 8px; border-radius: 3px; font-size: 11px;">Notes 46-88 (43 notes)</span>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>Section 3</strong> - Compressed version (learn variations only)</span>
                                        <span style="background: #3498db; color: white; padding: 2px 8px; border-radius: 3px; font-size: 11px;">Notes 89-131 (43 notes)</span>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>Coda</strong> - Brief closing (only 5 notes)</span>
                                        <span style="background: #95a5a6; color: white; padding: 2px 8px; border-radius: 3px; font-size: 11px;">Notes 132-136 (5 notes)</span>
                                    </div>
                                </div>
                            </div>

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #9b59b6; margin: 0 0 10px 0;">üîç Analysis Process Visualization</h4>
                                <div style="background: white; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; line-height: 1.3; margin-bottom: 15px;">
                                    <strong>Step 1: Pattern Detection</strong><br>
                                    <span style="color: #e74c3c;">‚óè</span> 7-note motif at positions: 0, 46, 89<br>
                                    <span style="color: #3498db;">‚óè</span> 16-note phrase at positions: 22, 65, 110<br><br>

                                    <strong>Step 2: Interval Calculation</strong><br>
                                    7-note gaps: 46, 43 (2 gaps between 3 occurrences)<br>
                                    16-note gaps: 43, 45 (2 gaps between 3 occurrences)<br>
                                    Result: Consistent ~43-46 note sections<br><br>

                                    <strong>Step 3: Section Boundary Identification</strong><br>
                                    <div style="border: 1px solid #ddd; padding: 5px; background: #f9f9f9;">
                                    Song Timeline (137 notes):<br>
                                    0‚îÄ‚îÄ‚îÄ‚îÄ22‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ45‚îÇ46‚îÄ‚îÄ‚îÄ65‚îÄ‚îÄ‚îÄ‚îÄ88‚îÇ89‚îÄ‚îÄ‚îÄ110‚îÄ‚îÄ‚îÄ131‚îÇ132‚îÄ136<br>
                                    ‚îÇ     ‚îÇ       ‚îÇ ‚îÇ    ‚îÇ      ‚îÇ ‚îÇ    ‚îÇ       ‚îÇ ‚îÇ<br>
                                    ‚îÇ     ‚îî‚îÄ16-sig‚îÇ ‚îÇ    ‚îî‚îÄ16-sig ‚îÇ    ‚îî‚îÄ16-sig ‚îÇ ‚îî‚îÄ5 notes<br>
                                    ‚îî‚îÄ7-motif     ‚îÇ ‚îî‚îÄ7-motif    ‚îÇ ‚îî‚îÄ7-motif    ‚îÇ   (coda)<br>
                                      Section 1     Section 2      Section 3      end
                                    </div>
                                </div>
                            </div>

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <h4 style="color: #9b59b6; margin: 0 0 10px 0;">Major Repeated Patterns</h4>
                                <div style="display: grid; gap: 10px;">
                                    <div style="background: white; padding: 12px; border-radius: 5px;">
                                        <strong>üéØ 16-note signature phrase:</strong> E5-D5-C5-A4-C5-A4-G4-D4-D4-G4-C5-C5-G4-A4-C5-G4
                                        <br><span style="font-size: 12px; color: #7f8c8d;">Appears 3 times at positions 22, 65, 110 (25% of the song)</span>
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 5px;">
                                        <strong>üéµ 7-note opening motif:</strong> C5-C5-C5-D5-E5-E5-G5
                                        <br><span style="font-size: 12px; color: #7f8c8d;">Appears 3 times at positions 0, 46, 89 (11% of the song)</span>
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 5px;">
                                        <strong>üîÑ Shorter patterns:</strong> 2-8 note phrases repeat frequently
                                        <br><span style="font-size: 12px; color: #7f8c8d;">Additional 15-20% consists of repeated fragments</span>
                                    </div>
                                </div>

                                <div style="background: #e8f5e8; padding: 10px; border-radius: 5px; margin-top: 15px; border-left: 4px solid #27ae60;">
                                    <h5 style="margin: 0 0 8px 0; color: #27ae60;">üéØ Ultra-Efficient Learning Strategy:</h5>
                                    <ol style="margin: 0; padding-left: 20px; font-size: 13px; line-height: 1.4;">
                                        <li><strong>Master Section 1 completely</strong> (46 notes = 24% of song)</li>
                                        <li><strong>Learn only the compression variations</strong> in Sections 2 & 3 (~10 notes total)</li>
                                        <li><strong>Recognize the cyclical pattern</strong> - same internal structure, just compressed</li>
                                        <li><strong>Result:</strong> Learn 56 notes, know 189 notes (70% efficiency gain!)</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="modal-footer" style="padding: 15px 30px; border-top: 2px solid #ecf0f1; background: #f8f9fa; border-radius: 0 0 10px 10px; text-align: right;">
                    <button onclick="exportAnalysis()" style="padding: 8px 15px; margin-right: 10px; background: #3498db; color: white; border: none; border-radius: 3px; cursor: pointer;">üìÑ Export</button>
                    <button onclick="closeAnalysisModal()" style="padding: 8px 15px; background: #95a5a6; color: white; border: none; border-radius: 3px; cursor: pointer;">Close</button>
                </div>
            </div>
        </div>

        <div class="lyrics-section">


            <!-- Collapsible Table Content -->
            <div id="lyrics-table-content" style="display: block;">
                <table style="width: 100%; border-collapse: collapse; margin: 0 0 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <thead>
                        <tr>
                            <th style="width: 65%; padding: 15px; background: #f0f8ff; border: 2px solid #3498db; text-align: center; color: #3498db;">Ti·∫øng Vi·ªát (Vietnamese)</th>
                            <th style="width: 35%; padding: 15px; background: #f8f9fa; border: 2px solid #e74c3c; text-align: center; color: #e74c3c;">English Translation</th>
                        </tr>
                    </thead>
                <tbody>
                    <tr>
                        <td style="padding: 15px; border: 1px solid #3498db; background: #f0f8ff; text-align: right; vertical-align: top;">
                            <div id="lyrics-display-container">
                                <div id="editable-lyrics" class="editable-lyrics">
                <span class="syllable editable-syllable" data-position="0" data-syllable-index="0" title="Syllable: B√† (1 note), tone: huy·ªÅn">B√†</span> <span class="line-break" data-break-after="0" onclick="toggleLineBreak(0)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="1" data-syllable-index="1" title="Syllable: R·∫±ng (1 note), tone: huy·ªÅn">R·∫±ng</span> <span class="line-break" data-break-after="1" onclick="toggleLineBreak(1)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="2" data-syllable-index="2" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span> <span class="line-break" data-break-after="2" onclick="toggleLineBreak(2)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="4" data-syllable-index="3" title="Syllable: R√≠, (1 note), tone: s·∫Øc">R√≠,</span> <span class="line-break active" data-break-after="3" onclick="toggleLineBreak(3)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable melismatic" data-position="5" data-syllable-index="4" title="Syllable: ·ªöi (melismatic, 2 notes), tone: s·∫Øc">·ªöi</span> <span class="line-break" data-break-after="4" onclick="toggleLineBreak(4)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="7" data-syllable-index="5" title="Syllable: r·∫±ng (1 note), tone: huy·ªÅn">r·∫±ng</span> <span class="line-break" data-break-after="5" onclick="toggleLineBreak(5)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="8" data-syllable-index="6" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span> <span class="line-break" data-break-after="6" onclick="toggleLineBreak(6)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="9" data-syllable-index="7" title="Syllable: ƒëi, (1 note)">ƒëi,</span> <span class="line-break active" data-break-after="7" onclick="toggleLineBreak(7)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="11" data-syllable-index="8" title="Syllable: ·ªõi (1 note), tone: s·∫Øc">·ªõi</span> <span class="line-break" data-break-after="8" onclick="toggleLineBreak(8)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable melismatic" data-position="12" data-syllable-index="9" title="Syllable: ƒëi (melismatic, 2 notes)">ƒëi</span> <span class="line-break" data-break-after="9" onclick="toggleLineBreak(9)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="14" data-syllable-index="10" title="Syllable: l√† (1 note), tone: huy·ªÅn">l√†</span> <span class="line-break" data-break-after="10" onclick="toggleLineBreak(10)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="15" data-syllable-index="11" title="Syllable: ƒë√¢u (1 note)">ƒë√¢u</span> <span class="line-break active" data-break-after="11" onclick="toggleLineBreak(11)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="16" data-syllable-index="12" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span> <span class="line-break" data-break-after="12" onclick="toggleLineBreak(12)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="17" data-syllable-index="13" title="Syllable: ƒëi (1 note)">ƒëi</span> <span class="line-break" data-break-after="13" onclick="toggleLineBreak(13)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="18" data-syllable-index="14" title="Syllable: kh·∫Øp (1 note), tone: s·∫Øc">kh·∫Øp</span> <span class="line-break" data-break-after="14" onclick="toggleLineBreak(14)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="20" data-syllable-index="15" title="Syllable: ch·ªën (1 note), tone: s·∫Øc">ch·ªën</span> <span class="line-break" data-break-after="15" onclick="toggleLineBreak(15)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="22" data-syllable-index="16" title="Syllable: n·ªëi (1 note), tone: s·∫Øc">n·ªëi</span> <span class="line-break" data-break-after="16" onclick="toggleLineBreak(16)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="23" data-syllable-index="17" title="Syllable: d√¢y (1 note)">d√¢y</span> <span class="line-break" data-break-after="17" onclick="toggleLineBreak(17)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="24" data-syllable-index="18" title="Syllable: t∆° (1 note)">t∆°</span> <span class="line-break" data-break-after="18" onclick="toggleLineBreak(18)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="25" data-syllable-index="19" title="Syllable: h·ªìng (1 note), tone: huy·ªÅn">h·ªìng</span> <span class="line-break active" data-break-after="19" onclick="toggleLineBreak(19)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="26" data-syllable-index="20" title="Syllable: c√°i (1 note), tone: s·∫Øc">c√°i</span> <span class="line-break" data-break-after="20" onclick="toggleLineBreak(20)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="27" data-syllable-index="21" title="Syllable: duy√™n (1 note)">duy√™n</span> <span class="line-break" data-break-after="21" onclick="toggleLineBreak(21)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="28" data-syllable-index="22" title="Syllable: √¥ng (1 note)">√¥ng</span> <span class="line-break" data-break-after="22" onclick="toggleLineBreak(22)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="29" data-syllable-index="23" title="Syllable: ch·ªìng (1 note), tone: huy·ªÅn">ch·ªìng</span> <span class="line-break" data-break-after="23" onclick="toggleLineBreak(23)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="30" data-syllable-index="24" title="Syllable: l√†m (1 note), tone: huy·ªÅn">l√†m</span> <span class="line-break" data-break-after="24" onclick="toggleLineBreak(24)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable melismatic" data-position="31" data-syllable-index="25" title="Syllable: kh·ªï (melismatic, 2 notes), tone: h·ªèi">kh·ªï</span> <span class="line-break" data-break-after="25" onclick="toggleLineBreak(25)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="33" data-syllable-index="26" title="Syllable: c√°i (1 note), tone: s·∫Øc">c√°i</span> <span class="line-break" data-break-after="26" onclick="toggleLineBreak(26)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="34" data-syllable-index="27" title="Syllable: ƒë·ªùi (1 note), tone: huy·ªÅn">ƒë·ªùi</span> <span class="line-break" data-break-after="27" onclick="toggleLineBreak(27)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="35" data-syllable-index="28" title="Syllable: t√¥i (1 note)">t√¥i</span> <span class="line-break" data-break-after="28" onclick="toggleLineBreak(28)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="36" data-syllable-index="29" title="Syllable: ∆°i (1 note)">∆°i</span> <span class="line-break active" data-break-after="29" onclick="toggleLineBreak(29)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="37" data-syllable-index="30" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span> <span class="line-break" data-break-after="30" onclick="toggleLineBreak(30)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="38" data-syllable-index="31" title="Syllable: R√≠ (1 note), tone: s·∫Øc">R√≠</span> <span class="line-break" data-break-after="31" onclick="toggleLineBreak(31)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="39" data-syllable-index="32" title="Syllable: ∆°i (1 note)">∆°i</span> <span class="line-break active" data-break-after="32" onclick="toggleLineBreak(32)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="40" data-syllable-index="33" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span> <span class="line-break" data-break-after="33" onclick="toggleLineBreak(33)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="41" data-syllable-index="34" title="Syllable: R·∫±ng (1 note), tone: huy·ªÅn">R·∫±ng</span> <span class="line-break" data-break-after="34" onclick="toggleLineBreak(34)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="42" data-syllable-index="35" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span> <span class="line-break" data-break-after="35" onclick="toggleLineBreak(35)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="43" data-syllable-index="36" title="Syllable: R√≠ (1 note), tone: s·∫Øc">R√≠</span> <span class="line-break" data-break-after="36" onclick="toggleLineBreak(36)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="44" data-syllable-index="37" title="Syllable: ∆°i. (1 note)">∆°i.</span> <span class="line-break active" data-break-after="37" onclick="toggleLineBreak(37)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="45" data-syllable-index="38" title="Syllable: Ch·ªìng (1 note), tone: huy·ªÅn">Ch·ªìng</span> <span class="line-break" data-break-after="38" onclick="toggleLineBreak(38)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="46" data-syllable-index="39" title="Syllable: g√¨ (1 note), tone: huy·ªÅn">g√¨</span> <span class="line-break" data-break-after="39" onclick="toggleLineBreak(39)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="47" data-syllable-index="40" title="Syllable: m√† (1 note), tone: huy·ªÅn">m√†</span> <span class="line-break" data-break-after="40" onclick="toggleLineBreak(40)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="48" data-syllable-index="41" title="Syllable: ch·ªìng (1 note), tone: huy·ªÅn">ch·ªìng</span> <span class="line-break" data-break-after="41" onclick="toggleLineBreak(41)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="50" data-syllable-index="42" title="Syllable: b√©, (1 note), tone: s·∫Øc">b√©,</span> <span class="line-break active" data-break-after="42" onclick="toggleLineBreak(42)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="52" data-syllable-index="43" title="Syllable: b√© (1 note), tone: s·∫Øc">b√©</span> <span class="line-break" data-break-after="43" onclick="toggleLineBreak(43)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="53" data-syllable-index="44" title="Syllable: t·∫πo (1 note), tone: n·∫∑ng">t·∫πo</span> <span class="line-break" data-break-after="44" onclick="toggleLineBreak(44)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="54" data-syllable-index="45" title="Syllable: t√®o (1 note), tone: huy·ªÅn">t√®o</span> <span class="line-break" data-break-after="45" onclick="toggleLineBreak(45)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="55" data-syllable-index="46" title="Syllable: teo, (1 note)">teo,</span> <span class="line-break active" data-break-after="46" onclick="toggleLineBreak(46)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="56" data-syllable-index="47" title="Syllable: ch√¢n (1 note)">ch√¢n</span> <span class="line-break" data-break-after="47" onclick="toggleLineBreak(47)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="57" data-syllable-index="48" title="Syllable: ƒëi (1 note)">ƒëi</span> <span class="line-break" data-break-after="48" onclick="toggleLineBreak(48)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="58" data-syllable-index="49" title="Syllable: c√† (1 note), tone: huy·ªÅn">c√†</span> <span class="line-break" data-break-after="49" onclick="toggleLineBreak(49)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="59" data-syllable-index="50" title="Syllable: kheo (1 note)">kheo</span> <span class="line-break" data-break-after="50" onclick="toggleLineBreak(50)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="61" data-syllable-index="51" title="Syllable: l√∫c (1 note), tone: s·∫Øc">l√∫c</span> <span class="line-break" data-break-after="51" onclick="toggleLineBreak(51)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="62" data-syllable-index="52" title="Syllable: ƒëi (1 note)">ƒëi</span> <span class="line-break" data-break-after="52" onclick="toggleLineBreak(52)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="63" data-syllable-index="53" title="Syllable: ph·∫£i (1 note), tone: h·ªèi">ph·∫£i</span> <span class="line-break" data-break-after="53" onclick="toggleLineBreak(53)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="64" data-syllable-index="54" title="Syllable: c√µng (1 note), tone: ng√£">c√µng</span> <span class="line-break" data-break-after="54" onclick="toggleLineBreak(54)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="65" data-syllable-index="55" title="Syllable: l√∫c (1 note), tone: s·∫Øc">l√∫c</span> <span class="line-break" data-break-after="55" onclick="toggleLineBreak(55)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="66" data-syllable-index="56" title="Syllable: kh√≥c (1 note), tone: s·∫Øc">kh√≥c</span> <span class="line-break" data-break-after="56" onclick="toggleLineBreak(56)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="67" data-syllable-index="57" title="Syllable: ph·∫£i (1 note), tone: h·ªèi">ph·∫£i</span> <span class="line-break" data-break-after="57" onclick="toggleLineBreak(57)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="68" data-syllable-index="58" title="Syllable: b·ªìng (1 note), tone: huy·ªÅn">b·ªìng</span> <span class="line-break" data-break-after="58" onclick="toggleLineBreak(58)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="69" data-syllable-index="59" title="Syllable: c√°i (1 note), tone: s·∫Øc">c√°i</span> <span class="line-break" data-break-after="59" onclick="toggleLineBreak(59)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="70" data-syllable-index="60" title="Syllable: duy√™n (1 note)">duy√™n</span> <span class="line-break" data-break-after="60" onclick="toggleLineBreak(60)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="71" data-syllable-index="61" title="Syllable: √¥ng (1 note)">√¥ng</span> <span class="line-break" data-break-after="61" onclick="toggleLineBreak(61)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="72" data-syllable-index="62" title="Syllable: ch·ªìng (1 note), tone: huy·ªÅn">ch·ªìng</span> <span class="line-break" data-break-after="62" onclick="toggleLineBreak(62)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="73" data-syllable-index="63" title="Syllable: l√†m (1 note), tone: huy·ªÅn">l√†m</span> <span class="line-break" data-break-after="63" onclick="toggleLineBreak(63)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable melismatic" data-position="74" data-syllable-index="64" title="Syllable: kh·ªï (melismatic, 2 notes), tone: h·ªèi">kh·ªï</span> <span class="line-break" data-break-after="64" onclick="toggleLineBreak(64)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="76" data-syllable-index="65" title="Syllable: c√°i (1 note), tone: s·∫Øc">c√°i</span> <span class="line-break" data-break-after="65" onclick="toggleLineBreak(65)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="77" data-syllable-index="66" title="Syllable: ƒë·ªùi (1 note), tone: huy·ªÅn">ƒë·ªùi</span> <span class="line-break" data-break-after="66" onclick="toggleLineBreak(66)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="78" data-syllable-index="67" title="Syllable: t√¥i (1 note)">t√¥i</span> <span class="line-break" data-break-after="67" onclick="toggleLineBreak(67)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="79" data-syllable-index="68" title="Syllable: ∆°i (1 note)">∆°i</span> <span class="line-break active" data-break-after="68" onclick="toggleLineBreak(68)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="80" data-syllable-index="69" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span> <span class="line-break" data-break-after="69" onclick="toggleLineBreak(69)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="81" data-syllable-index="70" title="Syllable: R√≠ (1 note), tone: s·∫Øc">R√≠</span> <span class="line-break" data-break-after="70" onclick="toggleLineBreak(70)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="82" data-syllable-index="71" title="Syllable: ∆°i (1 note)">∆°i</span> <span class="line-break active" data-break-after="71" onclick="toggleLineBreak(71)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="83" data-syllable-index="72" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span> <span class="line-break" data-break-after="72" onclick="toggleLineBreak(72)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="84" data-syllable-index="73" title="Syllable: R·∫±ng (1 note), tone: huy·ªÅn">R·∫±ng</span> <span class="line-break" data-break-after="73" onclick="toggleLineBreak(73)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="85" data-syllable-index="74" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span> <span class="line-break" data-break-after="74" onclick="toggleLineBreak(74)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="86" data-syllable-index="75" title="Syllable: R√≠ (1 note), tone: s·∫Øc">R√≠</span> <span class="line-break" data-break-after="75" onclick="toggleLineBreak(75)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="87" data-syllable-index="76" title="Syllable: ∆°i. (1 note)">∆°i.</span> <span class="line-break active" data-break-after="76" onclick="toggleLineBreak(76)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="88" data-syllable-index="77" title="Syllable: Ch·ªìng (1 note), tone: huy·ªÅn">Ch·ªìng</span> <span class="line-break" data-break-after="77" onclick="toggleLineBreak(77)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="89" data-syllable-index="78" title="Syllable: g√¨ (1 note), tone: huy·ªÅn">g√¨</span> <span class="line-break" data-break-after="78" onclick="toggleLineBreak(78)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="90" data-syllable-index="79" title="Syllable: m√† (1 note), tone: huy·ªÅn">m√†</span> <span class="line-break" data-break-after="79" onclick="toggleLineBreak(79)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="91" data-syllable-index="80" title="Syllable: ch·ªìng (1 note), tone: huy·ªÅn">ch·ªìng</span> <span class="line-break" data-break-after="80" onclick="toggleLineBreak(80)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="93" data-syllable-index="81" title="Syllable: ng√°y, (1 note), tone: s·∫Øc">ng√°y,</span> <span class="line-break active" data-break-after="81" onclick="toggleLineBreak(81)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="95" data-syllable-index="82" title="Syllable: ng√°y (1 note), tone: s·∫Øc">ng√°y</span> <span class="line-break" data-break-after="82" onclick="toggleLineBreak(82)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable melismatic" data-position="96" data-syllable-index="83" title="Syllable: o (melismatic, 2 notes)">o</span> <span class="line-break" data-break-after="83" onclick="toggleLineBreak(83)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="98" data-syllable-index="84" title="Syllable: o (1 note)">o</span> <span class="line-break" data-break-after="84" onclick="toggleLineBreak(84)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="99" data-syllable-index="85" title="Syllable: o (1 note)">o</span> <span class="line-break" data-break-after="85" onclick="toggleLineBreak(85)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="100" data-syllable-index="86" title="Syllable: ƒê√™m (1 note)">ƒê√™m</span> <span class="line-break" data-break-after="86" onclick="toggleLineBreak(86)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="101" data-syllable-index="87" title="Syllable: th·ªùi (1 note), tone: huy·ªÅn">th·ªùi</span> <span class="line-break" data-break-after="87" onclick="toggleLineBreak(87)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="102" data-syllable-index="88" title="Syllable: n·∫±m (1 note), tone: huy·ªÅn">n·∫±m</span> <span class="line-break" data-break-after="88" onclick="toggleLineBreak(88)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="103" data-syllable-index="89" title="Syllable: co (1 note)">co</span> <span class="line-break" data-break-after="89" onclick="toggleLineBreak(89)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="104" data-syllable-index="90" title="Syllable: l√†m (1 note), tone: huy·ªÅn">l√†m</span> <span class="line-break" data-break-after="90" onclick="toggleLineBreak(90)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="105" data-syllable-index="91" title="Syllable: ƒÉn (1 note)">ƒÉn</span> <span class="line-break" data-break-after="91" onclick="toggleLineBreak(91)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="106" data-syllable-index="92" title="Syllable: l∆∞·ªùi (1 note), tone: huy·ªÅn">l∆∞·ªùi</span> <span class="line-break" data-break-after="92" onclick="toggleLineBreak(92)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="108" data-syllable-index="93" title="Syllable: bi·∫øng (1 note), tone: s·∫Øc">bi·∫øng</span> <span class="line-break" data-break-after="93" onclick="toggleLineBreak(93)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="110" data-syllable-index="94" title="Syllable: ch·∫≥ng (1 note), tone: h·ªèi">ch·∫≥ng</span> <span class="line-break" data-break-after="94" onclick="toggleLineBreak(94)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="111" data-syllable-index="95" title="Syllable: lo (1 note)">lo</span> <span class="line-break" data-break-after="95" onclick="toggleLineBreak(95)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="112" data-syllable-index="96" title="Syllable: h·ªçc (1 note), tone: n·∫∑ng">h·ªçc</span> <span class="line-break" data-break-after="96" onclick="toggleLineBreak(96)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="113" data-syllable-index="97" title="Syllable: h√†nh (1 note), tone: huy·ªÅn">h√†nh</span> <span class="line-break" data-break-after="97" onclick="toggleLineBreak(97)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="114" data-syllable-index="98" title="Syllable: c√°i (1 note), tone: s·∫Øc">c√°i</span> <span class="line-break" data-break-after="98" onclick="toggleLineBreak(98)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="115" data-syllable-index="99" title="Syllable: duy√™n (1 note)">duy√™n</span> <span class="line-break" data-break-after="99" onclick="toggleLineBreak(99)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="116" data-syllable-index="100" title="Syllable: √¥ng (1 note)">√¥ng</span> <span class="line-break" data-break-after="100" onclick="toggleLineBreak(100)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="117" data-syllable-index="101" title="Syllable: ch·ªìng (1 note), tone: huy·ªÅn">ch·ªìng</span> <span class="line-break" data-break-after="101" onclick="toggleLineBreak(101)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="118" data-syllable-index="102" title="Syllable: l√†m (1 note), tone: huy·ªÅn">l√†m</span> <span class="line-break" data-break-after="102" onclick="toggleLineBreak(102)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable melismatic" data-position="119" data-syllable-index="103" title="Syllable: kh·ªï (melismatic, 2 notes), tone: h·ªèi">kh·ªï</span> <span class="line-break" data-break-after="103" onclick="toggleLineBreak(103)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="121" data-syllable-index="104" title="Syllable: c√°i (1 note), tone: s·∫Øc">c√°i</span> <span class="line-break" data-break-after="104" onclick="toggleLineBreak(104)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="122" data-syllable-index="105" title="Syllable: ƒë·ªùi (1 note), tone: huy·ªÅn">ƒë·ªùi</span> <span class="line-break" data-break-after="105" onclick="toggleLineBreak(105)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="123" data-syllable-index="106" title="Syllable: t√¥i, (1 note)">t√¥i,</span> <span class="line-break" data-break-after="106" onclick="toggleLineBreak(106)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="124" data-syllable-index="107" title="Syllable: ∆°i (1 note)">∆°i</span> <span class="line-break active" data-break-after="107" onclick="toggleLineBreak(107)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="125" data-syllable-index="108" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span> <span class="line-break" data-break-after="108" onclick="toggleLineBreak(108)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="126" data-syllable-index="109" title="Syllable: R√≠ (1 note), tone: s·∫Øc">R√≠</span> <span class="line-break" data-break-after="109" onclick="toggleLineBreak(109)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="127" data-syllable-index="110" title="Syllable: ∆°i (1 note)">∆°i</span> <span class="line-break active" data-break-after="110" onclick="toggleLineBreak(110)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="128" data-syllable-index="111" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span> <span class="line-break" data-break-after="111" onclick="toggleLineBreak(111)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="129" data-syllable-index="112" title="Syllable: R·∫±ng (1 note), tone: huy·ªÅn">R·∫±ng</span> <span class="line-break" data-break-after="112" onclick="toggleLineBreak(112)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="130" data-syllable-index="113" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span> <span class="line-break" data-break-after="113" onclick="toggleLineBreak(113)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="131" data-syllable-index="114" title="Syllable: R√≠ (1 note), tone: s·∫Øc">R√≠</span> <span class="line-break" data-break-after="114" onclick="toggleLineBreak(114)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="132" data-syllable-index="115" title="Syllable: ∆°i (1 note)">∆°i</span> <span class="line-break active" data-break-after="115" onclick="toggleLineBreak(115)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="133" data-syllable-index="116" title="Syllable: B√† (1 note), tone: huy·ªÅn">B√†</span> <span class="line-break" data-break-after="116" onclick="toggleLineBreak(116)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="134" data-syllable-index="117" title="Syllable: R·∫±ng (1 note), tone: huy·ªÅn">R·∫±ng</span> <span class="line-break" data-break-after="117" onclick="toggleLineBreak(117)" title="Click to toggle line break">|</span> <span class="syllable editable-syllable" data-position="135" data-syllable-index="118" title="Syllable: b√† (1 note), tone: huy·ªÅn">b√†</span>
                            </div>
                            </div>
                        </td>
                        <td style="padding: 15px; border: 1px solid #e74c3c; background: #f8f9fa; text-align: left; vertical-align: top;">
                            <div style="font-size: 13px; line-height: 1.42;">
                                <span class="eng-word" data-viet="B√†">Lady</span> <span class="eng-word" data-viet="R·∫±ng">Rang</span> <span class="eng-word" data-viet="b√†">lady</span> <span class="eng-word" data-viet="R√≠,">Ri,</span> <span class="eng-word" data-viet="·ªöi">Oh</span> <span class="eng-word" data-viet="r·∫±ng">telling</span> <span class="eng-word" data-viet="b√†">lady</span> <span class="eng-word" data-viet="ƒëi,">where-to-go,</span> <span class="eng-word" data-viet="·ªõi">oh</span> <span class="eng-word" data-viet="ƒëi">going</span> <span class="eng-word" data-viet="l√†">is</span> <span class="eng-word" data-viet="ƒë√¢u">where</span> <span class="eng-word" data-viet="b√†">lady</span> <span class="eng-word" data-viet="ƒëi">goes</span> <span class="eng-word" data-viet="kh·∫Øp">everywhere</span> <span class="eng-word" data-viet="ch·ªën">places</span> <span class="eng-word" data-viet="n·ªëi">connecting</span> <span class="eng-word" data-viet="d√¢y">threads</span> <span class="eng-word" data-viet="t∆°">silk</span> <span class="eng-word" data-viet="h·ªìng">red</span> <span class="eng-word" data-viet="c√°i">the</span> <span class="eng-word" data-viet="duy√™n">destiny</span> <span class="eng-word" data-viet="√¥ng">of</span> <span class="eng-word" data-viet="ch·ªìng">husband</span> <span class="eng-word" data-viet="l√†m">making</span> <span class="eng-word" data-viet="kh·ªï">miserable</span> <span class="eng-word" data-viet="c√°i">the</span> <span class="eng-word" data-viet="ƒë·ªùi">life</span> <span class="eng-word" data-viet="t√¥i">of-mine</span> <span class="eng-word" data-viet="∆°i">oh</span> <span class="eng-word" data-viet="b√†">lady</span> <span class="eng-word" data-viet="R√≠">Ri</span> <span class="eng-word" data-viet="∆°i">oh</span> <span class="eng-word" data-viet="b√†">lady</span> <span class="eng-word" data-viet="R·∫±ng">Rang</span> <span class="eng-word" data-viet="b√†">lady</span> <span class="eng-word" data-viet="R√≠">Ri</span> <span class="eng-word" data-viet="∆°i.">oh.</span> <span class="eng-word" data-viet="Ch·ªìng">What-husband</span> <span class="eng-word" data-viet="g√¨">what-kind</span> <span class="eng-word" data-viet="m√†">that</span> <span class="eng-word" data-viet="ch·ªìng">husband</span> <span class="eng-word" data-viet="b√©,">so-small,</span> <span class="eng-word" data-viet="b√©">small</span> <span class="eng-word" data-viet="t·∫πo">tiny</span> <span class="eng-word" data-viet="t√®o">skinny</span> <span class="eng-word" data-viet="teo,">lean,</span> <span class="eng-word" data-viet="ch√¢n">legs</span> <span class="eng-word" data-viet="ƒëi">walking</span> <span class="eng-word" data-viet="c√†">crooked</span> <span class="eng-word" data-viet="kheo">limping</span> <span class="eng-word" data-viet="l√∫c">when</span> <span class="eng-word" data-viet="ƒëi">going</span> <span class="eng-word" data-viet="ph·∫£i">must</span> <span class="eng-word" data-viet="c√µng">carry</span> <span class="eng-word" data-viet="l√∫c">when</span> <span class="eng-word" data-viet="kh√≥c">crying</span> <span class="eng-word" data-viet="ph·∫£i">must</span> <span class="eng-word" data-viet="b·ªìng">hold</span> <span class="eng-word" data-viet="c√°i">the</span> <span class="eng-word" data-viet="duy√™n">destiny</span> <span class="eng-word" data-viet="√¥ng">of</span> <span class="eng-word" data-viet="ch·ªìng">husband</span> <span class="eng-word" data-viet="l√†m">making</span> <span class="eng-word" data-viet="kh·ªï">miserable</span> <span class="eng-word" data-viet="c√°i">the</span> <span class="eng-word" data-viet="ƒë·ªùi">life</span> <span class="eng-word" data-viet="t√¥i">of-mine</span> <span class="eng-word" data-viet="∆°i">oh</span> <span class="eng-word" data-viet="b√†">lady</span> <span class="eng-word" data-viet="R√≠">Ri</span> <span class="eng-word" data-viet="∆°i">oh</span> <span class="eng-word" data-viet="b√†">lady</span> <span class="eng-word" data-viet="R·∫±ng">Rang</span> <span class="eng-word" data-viet="b√†">lady</span> <span class="eng-word" data-viet="R√≠">Ri</span> <span class="eng-word" data-viet="∆°i.">oh.</span> <span class="eng-word" data-viet="Ch·ªìng">What-husband</span> <span class="eng-word" data-viet="g√¨">what-kind</span> <span class="eng-word" data-viet="m√†">that</span> <span class="eng-word" data-viet="ch·ªìng">husband</span> <span class="eng-word" data-viet="ng√°y,">sleepy,</span> <span class="eng-word" data-viet="ng√°y">sleepy</span> <span class="eng-word" data-viet="o">oh</span> <span class="eng-word" data-viet="o">oh</span> <span class="eng-word" data-viet="o">oh</span> <span class="eng-word" data-viet="ƒê√™m">At-night</span> <span class="eng-word" data-viet="th·ªùi">time</span> <span class="eng-word" data-viet="n·∫±m">lying</span> <span class="eng-word" data-viet="co">curled-up</span> <span class="eng-word" data-viet="l√†m">doing</span> <span class="eng-word" data-viet="ƒÉn">eating</span> <span class="eng-word" data-viet="l∆∞·ªùi">lazy</span> <span class="eng-word" data-viet="bi·∫øng">reluctant</span> <span class="eng-word" data-viet="ch·∫≥ng">not</span> <span class="eng-word" data-viet="lo">caring</span> <span class="eng-word" data-viet="h·ªçc">to-study</span> <span class="eng-word" data-viet="h√†nh">or-work</span> <span class="eng-word" data-viet="c√°i">the</span> <span class="eng-word" data-viet="duy√™n">destiny</span> <span class="eng-word" data-viet="√¥ng">of</span> <span class="eng-word" data-viet="ch·ªìng">husband</span> <span class="eng-word" data-viet="l√†m">making</span> <span class="eng-word" data-viet="kh·ªï">miserable</span> <span class="eng-word" data-viet="c√°i">the</span> <span class="eng-word" data-viet="ƒë·ªùi">life</span> <span class="eng-word" data-viet="t√¥i,">of-mine,</span> <span class="eng-word" data-viet="∆°i">oh</span> <span class="eng-word" data-viet="b√†">lady</span> <span class="eng-word" data-viet="R√≠">Ri</span> <span class="eng-word" data-viet="∆°i">oh</span> <span class="eng-word" data-viet="b√†">lady</span> <span class="eng-word" data-viet="R·∫±ng">Rang</span> <span class="eng-word" data-viet="b√†">lady</span> <span class="eng-word" data-viet="R√≠">Ri</span> <span class="eng-word" data-viet="∆°i">oh</span> <span class="eng-word" data-viet="B√†">Lady</span> <span class="eng-word" data-viet="R·∫±ng">Rang</span> <span class="eng-word" data-viet="b√†">lady</span>
                            </div>
                        </td>
                    </tr>
                    <!-- Controls Row at Bottom -->
                    <tr>
                        <td colspan="2" style="padding: 10px; border: 1px solid #ddd; background: #f9f9f9; text-align: center;">
                            <div style="font-size: 11px;">
                                <strong>üìù Interactive:</strong> Click Vietnamese syllables or English words to see translations. Click "|" to adjust line breaks.
                                <button onclick="resetLyricsBreaks()" style="margin-left: 10px; padding: 2px 6px; font-size: 10px;">Reset</button>

                                <!-- Font Selector -->
                                <label style="margin-left: 10px; font-weight: bold;">Font:</label>
                                <select id="lyrics-font-selector" onchange="changeLyricsFont()" style="margin-left: 5px; padding: 2px 6px; font-size: 10px; border: 1px solid #ccc; border-radius: 3px;">
                                    <option value="inherit">Default</option>
                                    <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
                                    <option value="Arial, sans-serif">Arial</option>
                                    <option value="'Times New Roman', Times, serif">Times New Roman</option>
                                    <option value="Georgia, serif">Georgia</option>
                                    <option value="'Courier New', Courier, monospace">Courier New</option>
                                    <option value="'Trebuchet MS', Helvetica, sans-serif">Trebuchet MS</option>
                                    <option value="Verdana, Geneva, sans-serif">Verdana</option>
                                    <option value="'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', sans-serif">Lucida Sans</option>
                                    <option value="'Palatino Linotype', 'Book Antiqua', Palatino, serif">Palatino</option>
                                    <option value="'Comic Sans MS', cursive">Comic Sans</option>
                                    <option value="Impact, Charcoal, sans-serif">Impact</option>
                                    <option value="'Arial Black', Gadget, sans-serif">Arial Black</option>
                                    <option value="'Noto Sans', sans-serif">Noto Sans (Vietnamese)</option>
                                    <option value="'Roboto', sans-serif">Roboto</option>
                                </select>

                                <!-- Font Size Selector -->
                                <label style="margin-left: 10px; font-weight: bold;">Size:</label>
                                <select id="lyrics-size-selector" onchange="changeLyricsFontSize()" style="margin-left: 5px; padding: 2px 6px; font-size: 10px; border: 1px solid #ccc; border-radius: 3px;">
                                    <option value="11">11px</option>
                                    <option value="12">12px</option>
                                    <option value="13">13px</option>
                                    <option value="14">14px</option>
                                    <option value="15">15px</option>
                                    <option value="16">16px</option>
                                    <option value="18" selected>18px</option>
                                    <option value="20">20px</option>
                                    <option value="22">22px</option>
                                    <option value="24">24px</option>
                                    <option value="26">26px</option>
                                    <option value="28">28px</option>
                                    <option value="30">30px</option>
                                    <option value="32">32px</option>
                                    <option value="34">34px</option>
                                    <option value="36">36px</option>
                                    <option value="38">38px</option>
                                    <option value="40">40px</option>
                                    <option value="42">42px</option>
                                    <option value="44">44px</option>
                                    <option value="46">46px</option>
                                    <option value="48">48px</option>
                                    <option value="50">50px</option>
                                </select>

                                <!-- Vietnamese Voice Selector -->
                                <label style="margin-left: 15px; font-weight: bold; font-size: 10px;">üó£Ô∏è Voice:</label>
                                <select id="vietnamese-voice-selector" onchange="updateVietnameseVoice()" style="margin-left: 5px; padding: 2px 6px; font-size: 10px; border: 1px solid #ccc; border-radius: 3px;">
                                    <option value="female">üë© Female</option>
                                    <option value="male">üë® Male</option>
                                </select>

                                <button id="start-learning-btn" onclick="startLearning()" style="margin-left: 10px; font-size: 9px; padding: 2px 8px; background: #4CAF50; color: white; border: none; border-radius: 2px;">‚ñ∂Ô∏è Start Learning</button>
                                <button id="done-learning-btn" onclick="doneLearning()" style="margin-left: 5px; font-size: 9px; padding: 2px 8px; background: #FF9800; color: white; border: none; border-radius: 2px; display: none;">‚úÖ Done Learning</button>
                                <button onclick="clearLearningData()" style="margin-left: 5px; font-size: 9px; padding: 2px 6px; background: #FF5722; color: white; border: none; border-radius: 2px;">üóë Clear</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Floating Legend Box (Bottom Right) -->
    <div id="floating-legend" style="display: none; position: fixed; bottom: 20px; right: 20px; width: 220px; background: white; border: 2px solid #34495e; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; font-size: 11px;">
        <div style="background: #34495e; color: white; padding: 8px 12px; border-radius: 6px 6px 0 0; font-weight: bold; text-align: center;">
            üè∑Ô∏è Legend
        </div>
        <div style="padding: 10px;">
            <div style="margin: 6px 0; display: flex; align-items: center;"><span style="width: 12px; height: 12px; background: #ff6b35; display: inline-block; margin-right: 8px; border-radius: 2px;"></span>KPIC Patterns</div>
            <div style="margin: 6px 0; display: flex; align-items: center;"><span style="width: 12px; height: 12px; background: #4ecdc4; display: inline-block; margin-right: 8px; border-radius: 2px;"></span>KRIC Patterns</div>
            <div style="margin: 6px 0; display: flex; align-items: center;"><span style="width: 12px; height: 12px; background: #45b7d1; display: inline-block; margin-right: 8px; border-radius: 2px;"></span>Repeated Syllables</div>
            <div style="margin: 6px 0; display: flex; align-items: center;"><span style="width: 12px; height: 12px; background: #f39c12; display: inline-block; margin-right: 8px; border-radius: 2px;"></span>Grace Notes</div>
            <div style="margin: 6px 0; display: flex; align-items: center;"><span style="width: 12px; height: 12px; background: #e74c3c; display: inline-block; margin-right: 8px; border-radius: 2px;"></span>Melismatic</div>
        </div>
    </div>

    <script>
        // Analysis data
        const analysisData = {"kpic_patterns": {"full": {"kpic-2": [{"pattern": ["C5", "C5"], "count": 16, "positions": [0, 1, 15, 32, 45, 46, 47, 56, 75, 88, 89, 90, 103, 120, 133, 134], "analysis_mode": "full"}, {"pattern": ["A4", "C5"], "count": 14, "positions": [7, 14, 25, 35, 44, 53, 58, 68, 78, 87, 102, 113, 123, 132], "analysis_mode": "full"}, {"pattern": ["C5", "A4"], "count": 14, "positions": [13, 24, 26, 38, 43, 57, 67, 69, 81, 86, 100, 112, 114, 131], "analysis_mode": "full"}, {"pattern": ["C5", "D5"], "count": 10, "positions": [2, 8, 16, 48, 54, 59, 91, 98, 104, 106], "analysis_mode": "full"}, {"pattern": ["D5", "E5"], "count": 10, "positions": [3, 10, 17, 19, 21, 49, 60, 92, 107, 109], "analysis_mode": "full"}, {"pattern": ["E5", "D5"], "count": 9, "positions": [11, 18, 20, 22, 61, 65, 96, 108, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5"], "count": 9, "positions": [12, 23, 55, 62, 66, 97, 99, 105, 111], "analysis_mode": "full"}, {"pattern": ["G4", "C5"], "count": 8, "positions": [31, 37, 42, 74, 80, 85, 119, 130], "analysis_mode": "full"}, {"pattern": ["A4", "G4"], "count": 6, "positions": [27, 39, 70, 82, 115, 127], "analysis_mode": "full"}, {"pattern": ["C5", "G4"], "count": 6, "positions": [33, 36, 76, 79, 121, 124], "analysis_mode": "full"}], "kpic-3": [{"pattern": ["C5", "A4", "C5"], "count": 8, "positions": [13, 24, 43, 57, 67, 86, 112, 131], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5"], "count": 7, "positions": [10, 17, 19, 21, 60, 107, 109], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "C5"], "count": 6, "positions": [0, 45, 46, 88, 89, 133], "analysis_mode": "full"}, {"pattern": ["C5", "D5", "E5"], "count": 6, "positions": [2, 16, 48, 59, 91, 106], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5"], "count": 6, "positions": [11, 22, 61, 65, 96, 110], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "D5"], "count": 5, "positions": [1, 15, 47, 90, 103], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4"], "count": 5, "positions": [12, 23, 66, 99, 111], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "C5"], "count": 5, "positions": [14, 44, 87, 102, 132], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4"], "count": 5, "positions": [26, 38, 69, 81, 114], "analysis_mode": "full"}, {"pattern": ["G4", "C5", "A4"], "count": 5, "positions": [37, 42, 80, 85, 130], "analysis_mode": "full"}], "kpic-4": [{"pattern": ["C5", "C5", "D5", "E5"], "count": 4, "positions": [1, 15, 47, 90], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5"], "count": 4, "positions": [10, 21, 60, 109], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5", "A4"], "count": 4, "positions": [11, 22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5"], "count": 4, "positions": [12, 23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "C5"], "count": 4, "positions": [13, 43, 86, 131], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "C5", "D5"], "count": 3, "positions": [0, 46, 89], "analysis_mode": "full"}, {"pattern": ["C5", "D5", "E5", "E5"], "count": 3, "positions": [2, 48, 91], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "E5", "G5"], "count": 3, "positions": [3, 49, 92], "analysis_mode": "full"}, {"pattern": ["C5", "D5", "E5", "D5"], "count": 3, "positions": [16, 59, 106], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5"], "count": 3, "positions": [17, 19, 107], "analysis_mode": "full"}], "kpic-5": [{"pattern": ["E5", "D5", "C5", "A4", "C5"], "count": 4, "positions": [11, 22, 65, 110], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "C5", "D5", "E5"], "count": 3, "positions": [0, 46, 89], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "D5", "E5", "E5"], "count": 3, "positions": [1, 47, 90], "analysis_mode": "full"}, {"pattern": ["C5", "D5", "E5", "E5", "G5"], "count": 3, "positions": [2, 48, 91], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4"], "count": 3, "positions": [10, 21, 109], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5"], "count": 3, "positions": [17, 19, 107], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}], "kpic-6": [{"pattern": ["C5", "C5", "C5", "D5", "E5", "E5"], "count": 3, "positions": [0, 46, 89], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "D5", "E5", "E5", "G5"], "count": 3, "positions": [1, 47, 90], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5"], "count": 3, "positions": [10, 21, 109], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}], "kpic-7": [{"pattern": ["C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 3, "positions": [0, 46, 89], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [30, 73, 118], "analysis_mode": "full"}], "kpic-8": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [30, 73, 118], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 3, "positions": [39, 82, 127], "analysis_mode": "full"}], "kpic-9": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 3, "positions": [39, 82, 127], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "C5", "D5", "E5", "E5", "G5", "A4", "C5"], "count": 2, "positions": [0, 46], "analysis_mode": "full"}], "kpic-10": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "C5", "D5", "E5", "E5", "G5", "A4", "C5", "D5"], "count": 2, "positions": [0, 46], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}], "kpic-11": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-12": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-13": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-14": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-15": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-16": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-17": [{"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-18": [{"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}], "kpic-19": [{"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [30, 73], "analysis_mode": "full"}], "kpic-20": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [30, 73], "analysis_mode": "full"}, {"pattern": ["G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [31, 74], "analysis_mode": "full"}], "kpic-21": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [30, 73], "analysis_mode": "full"}, {"pattern": ["G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [31, 74], "analysis_mode": "full"}], "kpic-22": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [30, 73], "analysis_mode": "full"}, {"pattern": ["G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [31, 74], "analysis_mode": "full"}], "kpic-23": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [30, 73], "analysis_mode": "full"}], "kpic-24": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}], "kpic-25": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-26": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}], "kpic-27": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}], "kpic-28": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}], "kpic-29": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}], "kpic-30": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}], "kpic-31": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}], "kpic-max": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}]}, "kpic-2": [{"pattern": ["C5", "C5"], "count": 16, "positions": [0, 1, 15, 32, 45, 46, 47, 56, 75, 88, 89, 90, 103, 120, 133, 134], "analysis_mode": "full"}, {"pattern": ["A4", "C5"], "count": 14, "positions": [7, 14, 25, 35, 44, 53, 58, 68, 78, 87, 102, 113, 123, 132], "analysis_mode": "full"}, {"pattern": ["C5", "A4"], "count": 14, "positions": [13, 24, 26, 38, 43, 57, 67, 69, 81, 86, 100, 112, 114, 131], "analysis_mode": "full"}, {"pattern": ["C5", "D5"], "count": 10, "positions": [2, 8, 16, 48, 54, 59, 91, 98, 104, 106], "analysis_mode": "full"}, {"pattern": ["D5", "E5"], "count": 10, "positions": [3, 10, 17, 19, 21, 49, 60, 92, 107, 109], "analysis_mode": "full"}, {"pattern": ["E5", "D5"], "count": 9, "positions": [11, 18, 20, 22, 61, 65, 96, 108, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5"], "count": 9, "positions": [12, 23, 55, 62, 66, 97, 99, 105, 111], "analysis_mode": "full"}, {"pattern": ["G4", "C5"], "count": 8, "positions": [31, 37, 42, 74, 80, 85, 119, 130], "analysis_mode": "full"}, {"pattern": ["A4", "G4"], "count": 6, "positions": [27, 39, 70, 82, 115, 127], "analysis_mode": "full"}, {"pattern": ["C5", "G4"], "count": 6, "positions": [33, 36, 76, 79, 121, 124], "analysis_mode": "full"}], "kpic-3": [{"pattern": ["C5", "A4", "C5"], "count": 8, "positions": [13, 24, 43, 57, 67, 86, 112, 131], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5"], "count": 7, "positions": [10, 17, 19, 21, 60, 107, 109], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "C5"], "count": 6, "positions": [0, 45, 46, 88, 89, 133], "analysis_mode": "full"}, {"pattern": ["C5", "D5", "E5"], "count": 6, "positions": [2, 16, 48, 59, 91, 106], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5"], "count": 6, "positions": [11, 22, 61, 65, 96, 110], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "D5"], "count": 5, "positions": [1, 15, 47, 90, 103], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4"], "count": 5, "positions": [12, 23, 66, 99, 111], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "C5"], "count": 5, "positions": [14, 44, 87, 102, 132], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4"], "count": 5, "positions": [26, 38, 69, 81, 114], "analysis_mode": "full"}, {"pattern": ["G4", "C5", "A4"], "count": 5, "positions": [37, 42, 80, 85, 130], "analysis_mode": "full"}], "kpic-4": [{"pattern": ["C5", "C5", "D5", "E5"], "count": 4, "positions": [1, 15, 47, 90], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5"], "count": 4, "positions": [10, 21, 60, 109], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5", "A4"], "count": 4, "positions": [11, 22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5"], "count": 4, "positions": [12, 23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "C5"], "count": 4, "positions": [13, 43, 86, 131], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "C5", "D5"], "count": 3, "positions": [0, 46, 89], "analysis_mode": "full"}, {"pattern": ["C5", "D5", "E5", "E5"], "count": 3, "positions": [2, 48, 91], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "E5", "G5"], "count": 3, "positions": [3, 49, 92], "analysis_mode": "full"}, {"pattern": ["C5", "D5", "E5", "D5"], "count": 3, "positions": [16, 59, 106], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5"], "count": 3, "positions": [17, 19, 107], "analysis_mode": "full"}], "kpic-5": [{"pattern": ["E5", "D5", "C5", "A4", "C5"], "count": 4, "positions": [11, 22, 65, 110], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "C5", "D5", "E5"], "count": 3, "positions": [0, 46, 89], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "D5", "E5", "E5"], "count": 3, "positions": [1, 47, 90], "analysis_mode": "full"}, {"pattern": ["C5", "D5", "E5", "E5", "G5"], "count": 3, "positions": [2, 48, 91], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4"], "count": 3, "positions": [10, 21, 109], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5"], "count": 3, "positions": [17, 19, 107], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}], "kpic-6": [{"pattern": ["C5", "C5", "C5", "D5", "E5", "E5"], "count": 3, "positions": [0, 46, 89], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "D5", "E5", "E5", "G5"], "count": 3, "positions": [1, 47, 90], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5"], "count": 3, "positions": [10, 21, 109], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}], "kpic-7": [{"pattern": ["C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 3, "positions": [0, 46, 89], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [30, 73, 118], "analysis_mode": "full"}], "kpic-8": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [30, 73, 118], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 3, "positions": [39, 82, 127], "analysis_mode": "full"}], "kpic-9": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 3, "positions": [39, 82, 127], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "C5", "D5", "E5", "E5", "G5", "A4", "C5"], "count": 2, "positions": [0, 46], "analysis_mode": "full"}], "kpic-10": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": ["C5", "C5", "C5", "D5", "E5", "E5", "G5", "A4", "C5", "D5"], "count": 2, "positions": [0, 46], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}], "kpic-11": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-12": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-13": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-14": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-15": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-16": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-17": [{"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-18": [{"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}], "kpic-19": [{"pattern": ["D5", "E5", "D5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [30, 73], "analysis_mode": "full"}], "kpic-20": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [30, 73], "analysis_mode": "full"}, {"pattern": ["G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [31, 74], "analysis_mode": "full"}], "kpic-21": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [30, 73], "analysis_mode": "full"}, {"pattern": ["G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [31, 74], "analysis_mode": "full"}], "kpic-22": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [30, 73], "analysis_mode": "full"}, {"pattern": ["G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [31, 74], "analysis_mode": "full"}], "kpic-23": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [30, 73], "analysis_mode": "full"}], "kpic-24": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [29, 72], "analysis_mode": "full"}], "kpic-25": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [28, 71], "analysis_mode": "full"}], "kpic-26": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [27, 70], "analysis_mode": "full"}], "kpic-27": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [26, 69], "analysis_mode": "full"}], "kpic-28": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [25, 68], "analysis_mode": "full"}], "kpic-29": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [24, 67], "analysis_mode": "full"}], "kpic-30": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [23, 66], "analysis_mode": "full"}], "kpic-31": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}], "kpic-max": [{"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "D5", "E5", "E5", "G5"], "count": 2, "positions": [22, 65], "analysis_mode": "full"}], "main_melody": {"kpic-2": [{"pattern": ["C5", "C5"], "count": 16, "positions": [0, 1, 15, 32, 45, 46, 47, 56, 75, 88, 89, 90, 103, 120, 133, 134], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5"], "count": 14, "positions": [7, 14, 25, 35, 44, 53, 58, 68, 78, 87, 102, 113, 123, 132], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4"], "count": 14, "positions": [13, 24, 26, 38, 43, 57, 67, 69, 81, 86, 100, 112, 114, 131], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5"], "count": 9, "positions": [12, 23, 55, 62, 66, 97, 99, 105, 111], "analysis_mode": "main_melody"}, {"pattern": ["G4", "C5"], "count": 8, "positions": [31, 37, 42, 74, 80, 85, 119, 130], "analysis_mode": "main_melody"}, {"pattern": ["C5", "E5"], "count": 6, "positions": [2, 48, 59, 63, 91, 106], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5"], "count": 6, "positions": [11, 22, 61, 65, 96, 110], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4"], "count": 6, "positions": [27, 39, 70, 82, 115, 127], "analysis_mode": "main_melody"}, {"pattern": ["C5", "G4"], "count": 6, "positions": [33, 36, 76, 79, 121, 124], "analysis_mode": "main_melody"}, {"pattern": ["G4", "G4"], "count": 6, "positions": [40, 41, 83, 84, 128, 129], "analysis_mode": "main_melody"}], "kpic-3": [{"pattern": ["C5", "A4", "C5"], "count": 8, "positions": [13, 24, 43, 57, 67, 86, 112, 131], "analysis_mode": "main_melody"}, {"pattern": ["C5", "C5", "C5"], "count": 6, "positions": [0, 45, 46, 88, 89, 133], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5"], "count": 6, "positions": [11, 22, 61, 65, 96, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4"], "count": 5, "positions": [12, 23, 66, 99, 111], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "C5"], "count": 5, "positions": [14, 44, 87, 102, 132], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4"], "count": 5, "positions": [26, 38, 69, 81, 114], "analysis_mode": "main_melody"}, {"pattern": ["G4", "C5", "A4"], "count": 5, "positions": [37, 42, 80, 85, 130], "analysis_mode": "main_melody"}, {"pattern": ["C5", "G4", "A4"], "count": 4, "positions": [33, 76, 121, 124], "analysis_mode": "main_melody"}, {"pattern": ["C5", "C5", "E5"], "count": 3, "positions": [1, 47, 90], "analysis_mode": "main_melody"}, {"pattern": ["C5", "E5", "E5"], "count": 3, "positions": [2, 63, 106], "analysis_mode": "main_melody"}], "kpic-4": [{"pattern": ["E5", "D5", "C5", "A4"], "count": 4, "positions": [11, 22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5"], "count": 4, "positions": [12, 23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "C5"], "count": 4, "positions": [13, 43, 86, 131], "analysis_mode": "main_melody"}, {"pattern": ["C5", "C5", "C5", "E5"], "count": 3, "positions": [0, 46, 89], "analysis_mode": "main_melody"}, {"pattern": ["E5", "E5", "D5", "C5"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}], "kpic-5": [{"pattern": ["E5", "D5", "C5", "A4", "C5"], "count": 4, "positions": [11, 22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["E5", "E5", "D5", "C5", "A4"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [30, 73, 118], "analysis_mode": "main_melody"}], "kpic-6": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [30, 73, 118], "analysis_mode": "main_melody"}], "kpic-7": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [30, 73, 118], "analysis_mode": "main_melody"}], "kpic-8": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [30, 73, 118], "analysis_mode": "main_melody"}], "kpic-9": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 3, "positions": [39, 82, 127], "analysis_mode": "main_melody"}], "kpic-10": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-11": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-12": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-13": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-14": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-15": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-16": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-17": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-18": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-19": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-20": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-21": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5", "G5"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-22": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5", "G5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}], "kpic-23": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5", "G5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}], "kpic-24": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5", "G5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}], "kpic-25": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5", "G5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}], "kpic-26": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5", "G5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}], "kpic-27": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5", "G5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}], "kpic-28": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5", "G5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}], "kpic-29": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}, {"pattern": ["E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5", "G5"], "count": 2, "positions": [22, 65], "analysis_mode": "main_melody"}], "kpic-30": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5", "G5"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}], "kpic-max": [{"pattern": ["E5", "E5", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "E5", "G5"], "count": 2, "positions": [20, 64], "analysis_mode": "main_melody"}]}, "grace_units": {"kpic-2": [{"pattern": ["C5", "C5"], "count": 16, "positions": [0, 1, 15, 32, 45, 46, 47, 56, 75, 88, 89, 90, 103, 120, 133, 134], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5"], "count": 14, "positions": [7, 14, 25, 35, 44, 53, 58, 68, 78, 87, 102, 113, 123, 132], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4"], "count": 14, "positions": [13, 24, 26, 38, 43, 57, 67, 69, 81, 86, 100, 112, 114, 131], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5"], "count": 9, "positions": [12, 23, 55, 62, 66, 97, 99, 105, 111], "analysis_mode": "main_melody"}, {"pattern": ["G4", "C5"], "count": 8, "positions": [31, 37, 42, 74, 80, 85, 119, 130], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4"], "count": 6, "positions": [27, 39, 70, 82, 115, 127], "analysis_mode": "main_melody"}, {"pattern": ["C5", "G4"], "count": 6, "positions": [33, 36, 76, 79, 121, 124], "analysis_mode": "main_melody"}, {"pattern": ["G4", "G4"], "count": 6, "positions": [40, 41, 83, 84, 128, 129], "analysis_mode": "main_melody"}, {"pattern": ["C5", "(D5‚ÜíE5)"], "count": 5, "positions": [2, 48, 59, 91, 106], "analysis_mode": "main_melody"}, {"pattern": ["C5", "D5"], "count": 5, "positions": [8, 16, 54, 98, 104], "analysis_mode": "main_melody"}], "kpic-3": [{"pattern": ["C5", "A4", "C5"], "count": 8, "positions": [13, 24, 43, 57, 67, 86, 112, 131], "analysis_mode": "main_melody"}, {"pattern": ["C5", "C5", "C5"], "count": 6, "positions": [0, 45, 46, 88, 89, 133], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4"], "count": 5, "positions": [12, 23, 66, 99, 111], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "C5"], "count": 5, "positions": [14, 44, 87, 102, 132], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4"], "count": 5, "positions": [26, 38, 69, 81, 114], "analysis_mode": "main_melody"}, {"pattern": ["G4", "C5", "A4"], "count": 5, "positions": [37, 42, 80, 85, 130], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "D5", "C5"], "count": 4, "positions": [10, 21, 60, 109], "analysis_mode": "main_melody"}, {"pattern": ["C5", "G4", "A4"], "count": 4, "positions": [33, 76, 121, 124], "analysis_mode": "main_melody"}, {"pattern": ["C5", "C5", "(D5‚ÜíE5)"], "count": 3, "positions": [1, 47, 90], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}], "kpic-4": [{"pattern": ["D5", "C5", "A4", "C5"], "count": 4, "positions": [12, 23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "C5"], "count": 4, "positions": [13, 43, 86, 131], "analysis_mode": "main_melody"}, {"pattern": ["C5", "C5", "C5", "(D5‚ÜíE5)"], "count": 3, "positions": [0, 46, 89], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "D5", "C5", "A4"], "count": 3, "positions": [10, 21, 109], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}], "kpic-5": [{"pattern": ["(D5‚ÜíE5)", "D5", "C5", "A4", "C5"], "count": 3, "positions": [10, 21, 109], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [30, 73, 118], "analysis_mode": "main_melody"}, {"pattern": ["G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [31, 74, 119], "analysis_mode": "main_melody"}], "kpic-6": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [30, 73, 118], "analysis_mode": "main_melody"}, {"pattern": ["G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [31, 74, 119], "analysis_mode": "main_melody"}, {"pattern": ["C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [32, 75, 120], "analysis_mode": "main_melody"}], "kpic-7": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [30, 73, 118], "analysis_mode": "main_melody"}, {"pattern": ["G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [31, 74, 119], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 3, "positions": [39, 82, 127], "analysis_mode": "main_melody"}], "kpic-8": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [30, 73, 118], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 3, "positions": [39, 82, 127], "analysis_mode": "main_melody"}, {"pattern": ["G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 3, "positions": [40, 83, 128], "analysis_mode": "main_melody"}], "kpic-9": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 3, "positions": [39, 82, 127], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4"], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}], "kpic-10": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4"], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-11": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4"], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-12": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5"], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-13": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5"], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-14": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4"], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-15": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4"], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-16": [{"pattern": ["(D5‚ÜíE5)", "(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5"], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": ["(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-17": [{"pattern": ["(D5‚ÜíE5)", "(D5‚ÜíE5)", "D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4"], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}, {"pattern": ["G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [31, 74], "analysis_mode": "main_melody"}], "kpic-18": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}, {"pattern": ["G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [31, 74], "analysis_mode": "main_melody"}, {"pattern": ["C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)"], "count": 2, "positions": [32, 75], "analysis_mode": "main_melody"}], "kpic-19": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}, {"pattern": ["G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)"], "count": 2, "positions": [31, 74], "analysis_mode": "main_melody"}, {"pattern": ["C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)", "(E5‚ÜíG5)"], "count": 2, "positions": [32, 75], "analysis_mode": "main_melody"}], "kpic-20": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}, {"pattern": ["G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)", "(E5‚ÜíG5)"], "count": 2, "positions": [31, 74], "analysis_mode": "main_melody"}], "kpic-21": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}, {"pattern": ["D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)", "(E5‚ÜíG5)"], "count": 2, "positions": [30, 73], "analysis_mode": "main_melody"}], "kpic-22": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}, {"pattern": ["D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)", "(E5‚ÜíG5)"], "count": 2, "positions": [29, 72], "analysis_mode": "main_melody"}], "kpic-23": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}, {"pattern": ["G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)", "(E5‚ÜíG5)"], "count": 2, "positions": [28, 71], "analysis_mode": "main_melody"}], "kpic-24": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}, {"pattern": ["A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)", "(E5‚ÜíG5)"], "count": 2, "positions": [27, 70], "analysis_mode": "main_melody"}], "kpic-25": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)", "(E5‚ÜíG5)"], "count": 2, "positions": [26, 69], "analysis_mode": "main_melody"}], "kpic-26": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}, {"pattern": ["A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)", "(E5‚ÜíG5)"], "count": 2, "positions": [25, 68], "analysis_mode": "main_melody"}], "kpic-27": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}, {"pattern": ["C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)", "(E5‚ÜíG5)"], "count": 2, "positions": [24, 67], "analysis_mode": "main_melody"}], "kpic-28": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)", "(E5‚ÜíG5)"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}], "kpic-max": [{"pattern": ["D5", "C5", "A4", "C5", "A4", "G4", "D4", "D4", "G4", "C5", "C5", "G4", "A4", "C5", "G4", "C5", "A4", "G4", "G4", "G4", "C5", "A4", "C5", "C5", "C5", "C5", "(D5‚ÜíE5)", "(E5‚ÜíG5)"], "count": 2, "positions": [23, 66], "analysis_mode": "main_melody"}]}}, "kric_patterns": {"full": {"kric-2": [{"pattern": [1, 2], "count": 22, "positions": [6, 13, 26, 33, 42, 44, 47, 58, 63, 69, 76, 80, 85, 87, 90, 97, 102, 114, 121, 125, 130, 132], "analysis_mode": "full"}, {"pattern": [2, 1], "count": 21, "positions": [11, 17, 23, 29, 37, 43, 45, 57, 62, 66, 72, 79, 86, 88, 95, 101, 105, 111, 117, 124, 131], "analysis_mode": "full"}, {"pattern": [1, 1], "count": 20, "positions": [5, 12, 30, 31, 32, 40, 41, 46, 73, 74, 75, 83, 84, 89, 96, 118, 119, 120, 128, 129], "analysis_mode": "full"}, {"pattern": [2, 2], "count": 15, "positions": [0, 1, 7, 14, 27, 28, 36, 52, 53, 70, 71, 115, 116, 133, 134], "analysis_mode": "full"}, {"pattern": [3, 2], "count": 11, "positions": [16, 22, 35, 56, 61, 65, 78, 100, 104, 110, 123], "analysis_mode": "full"}, {"pattern": [2, 3], "count": 8, "positions": [15, 34, 64, 77, 81, 103, 122, 126], "analysis_mode": "full"}, {"pattern": [2, 0.5], "count": 6, "positions": [2, 20, 48, 59, 91, 108], "analysis_mode": "full"}, {"pattern": [3, 1], "count": 6, "positions": [25, 39, 68, 82, 113, 127], "analysis_mode": "full"}, {"pattern": [0.5, 2], "count": 5, "positions": [10, 19, 51, 94, 107], "analysis_mode": "full"}, {"pattern": [1, 3], "count": 4, "positions": [24, 38, 67, 112], "analysis_mode": "full"}], "kric-3": [{"pattern": [1, 1, 2], "count": 11, "positions": [5, 12, 32, 41, 46, 75, 84, 89, 96, 120, 129], "analysis_mode": "full"}, {"pattern": [3, 2, 1], "count": 10, "positions": [16, 22, 56, 61, 65, 78, 100, 104, 110, 123], "analysis_mode": "full"}, {"pattern": [1, 1, 1], "count": 9, "positions": [30, 31, 40, 73, 74, 83, 118, 119, 128], "analysis_mode": "full"}, {"pattern": [2, 1, 2], "count": 8, "positions": [43, 57, 62, 79, 86, 101, 124, 131], "analysis_mode": "full"}, {"pattern": [2, 1, 1], "count": 7, "positions": [11, 29, 45, 72, 88, 95, 117], "analysis_mode": "full"}, {"pattern": [1, 2, 3], "count": 7, "positions": [33, 63, 76, 80, 102, 121, 125], "analysis_mode": "full"}, {"pattern": [2, 2, 2], "count": 6, "positions": [0, 27, 52, 70, 115, 133], "analysis_mode": "full"}, {"pattern": [1, 2, 2], "count": 6, "positions": [6, 13, 26, 69, 114, 132], "analysis_mode": "full"}, {"pattern": [2, 3, 2], "count": 6, "positions": [15, 34, 64, 77, 103, 122], "analysis_mode": "full"}, {"pattern": [1, 2, 1], "count": 5, "positions": [42, 44, 85, 87, 130], "analysis_mode": "full"}], "kric-4": [{"pattern": [1, 1, 1, 2], "count": 6, "positions": [31, 40, 74, 83, 119, 128], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1], "count": 5, "positions": [15, 64, 77, 103, 122], "analysis_mode": "full"}, {"pattern": [1, 2, 3, 2], "count": 5, "positions": [33, 63, 76, 102, 121], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 2], "count": 5, "positions": [56, 61, 78, 100, 123], "analysis_mode": "full"}, {"pattern": [2, 1, 1, 2], "count": 4, "positions": [11, 45, 88, 95], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1], "count": 4, "positions": [23, 37, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2], "count": 4, "positions": [26, 69, 114, 132], "analysis_mode": "full"}, {"pattern": [2, 1, 2, 3], "count": 4, "positions": [62, 79, 101, 124], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2], "count": 3, "positions": [20, 59, 108], "analysis_mode": "full"}, {"pattern": [0.5, 3, 2, 1], "count": 3, "positions": [21, 60, 109], "analysis_mode": "full"}], "kric-5": [{"pattern": [3, 2, 1, 2, 3], "count": 4, "positions": [61, 78, 100, 123], "analysis_mode": "full"}, {"pattern": [1, 2, 3, 2, 1], "count": 4, "positions": [63, 76, 102, 121], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1], "count": 3, "positions": [20, 59, 108], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": [2, 2, 1, 1, 1], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}], "kric-6": [{"pattern": [3, 2, 1, 3, 1, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1, 1], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": [2, 2, 1, 1, 1, 1], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": [2, 1, 1, 1, 1, 2], "count": 3, "positions": [29, 72, 117], "analysis_mode": "full"}, {"pattern": [1, 1, 1, 1, 2, 3], "count": 3, "positions": [30, 73, 118], "analysis_mode": "full"}, {"pattern": [1, 1, 1, 2, 3, 2], "count": 3, "positions": [31, 74, 119], "analysis_mode": "full"}], "kric-7": [{"pattern": [3, 2, 1, 3, 1, 2, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": [2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": [2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [29, 72, 117], "analysis_mode": "full"}, {"pattern": [1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [30, 73, 118], "analysis_mode": "full"}, {"pattern": [3, 1, 1, 1, 2, 1, 2], "count": 3, "positions": [39, 82, 127], "analysis_mode": "full"}], "kric-8": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": [2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": [2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [29, 72, 117], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2], "count": 2, "positions": [16, 104], "analysis_mode": "full"}], "kric-9": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": [2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3], "count": 2, "positions": [17, 105], "analysis_mode": "full"}], "kric-10": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2], "count": 2, "positions": [18, 106], "analysis_mode": "full"}], "kric-11": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [19, 107], "analysis_mode": "full"}], "kric-12": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [20, 108], "analysis_mode": "full"}], "kric-13": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": [0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [21, 109], "analysis_mode": "full"}], "kric-14": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": [0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": [3, 1, 1, 1, 2, 1, 2, 1, 1, 2, 0.5, 8, 0.5, 2], "count": 2, "positions": [39, 82], "analysis_mode": "full"}], "kric-15": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": [0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [67, 112], "analysis_mode": "full"}], "kric-16": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": [0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [67, 112], "analysis_mode": "full"}], "kric-17": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [68, 113], "analysis_mode": "full"}], "kric-18": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [69, 114], "analysis_mode": "full"}], "kric-19": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [70, 115], "analysis_mode": "full"}], "kric-20": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [69, 114], "analysis_mode": "full"}], "kric-21": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [68, 113], "analysis_mode": "full"}], "kric-22": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [67, 112], "analysis_mode": "full"}], "kric-23": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [66, 111], "analysis_mode": "full"}], "kric-24": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [65, 110], "analysis_mode": "full"}], "kric-max": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [65, 110], "analysis_mode": "full"}]}, "kric-2": [{"pattern": [1, 2], "count": 22, "positions": [6, 13, 26, 33, 42, 44, 47, 58, 63, 69, 76, 80, 85, 87, 90, 97, 102, 114, 121, 125, 130, 132], "analysis_mode": "full"}, {"pattern": [2, 1], "count": 21, "positions": [11, 17, 23, 29, 37, 43, 45, 57, 62, 66, 72, 79, 86, 88, 95, 101, 105, 111, 117, 124, 131], "analysis_mode": "full"}, {"pattern": [1, 1], "count": 20, "positions": [5, 12, 30, 31, 32, 40, 41, 46, 73, 74, 75, 83, 84, 89, 96, 118, 119, 120, 128, 129], "analysis_mode": "full"}, {"pattern": [2, 2], "count": 15, "positions": [0, 1, 7, 14, 27, 28, 36, 52, 53, 70, 71, 115, 116, 133, 134], "analysis_mode": "full"}, {"pattern": [3, 2], "count": 11, "positions": [16, 22, 35, 56, 61, 65, 78, 100, 104, 110, 123], "analysis_mode": "full"}, {"pattern": [2, 3], "count": 8, "positions": [15, 34, 64, 77, 81, 103, 122, 126], "analysis_mode": "full"}, {"pattern": [2, 0.5], "count": 6, "positions": [2, 20, 48, 59, 91, 108], "analysis_mode": "full"}, {"pattern": [3, 1], "count": 6, "positions": [25, 39, 68, 82, 113, 127], "analysis_mode": "full"}, {"pattern": [0.5, 2], "count": 5, "positions": [10, 19, 51, 94, 107], "analysis_mode": "full"}, {"pattern": [1, 3], "count": 4, "positions": [24, 38, 67, 112], "analysis_mode": "full"}], "kric-3": [{"pattern": [1, 1, 2], "count": 11, "positions": [5, 12, 32, 41, 46, 75, 84, 89, 96, 120, 129], "analysis_mode": "full"}, {"pattern": [3, 2, 1], "count": 10, "positions": [16, 22, 56, 61, 65, 78, 100, 104, 110, 123], "analysis_mode": "full"}, {"pattern": [1, 1, 1], "count": 9, "positions": [30, 31, 40, 73, 74, 83, 118, 119, 128], "analysis_mode": "full"}, {"pattern": [2, 1, 2], "count": 8, "positions": [43, 57, 62, 79, 86, 101, 124, 131], "analysis_mode": "full"}, {"pattern": [2, 1, 1], "count": 7, "positions": [11, 29, 45, 72, 88, 95, 117], "analysis_mode": "full"}, {"pattern": [1, 2, 3], "count": 7, "positions": [33, 63, 76, 80, 102, 121, 125], "analysis_mode": "full"}, {"pattern": [2, 2, 2], "count": 6, "positions": [0, 27, 52, 70, 115, 133], "analysis_mode": "full"}, {"pattern": [1, 2, 2], "count": 6, "positions": [6, 13, 26, 69, 114, 132], "analysis_mode": "full"}, {"pattern": [2, 3, 2], "count": 6, "positions": [15, 34, 64, 77, 103, 122], "analysis_mode": "full"}, {"pattern": [1, 2, 1], "count": 5, "positions": [42, 44, 85, 87, 130], "analysis_mode": "full"}], "kric-4": [{"pattern": [1, 1, 1, 2], "count": 6, "positions": [31, 40, 74, 83, 119, 128], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1], "count": 5, "positions": [15, 64, 77, 103, 122], "analysis_mode": "full"}, {"pattern": [1, 2, 3, 2], "count": 5, "positions": [33, 63, 76, 102, 121], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 2], "count": 5, "positions": [56, 61, 78, 100, 123], "analysis_mode": "full"}, {"pattern": [2, 1, 1, 2], "count": 4, "positions": [11, 45, 88, 95], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1], "count": 4, "positions": [23, 37, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2], "count": 4, "positions": [26, 69, 114, 132], "analysis_mode": "full"}, {"pattern": [2, 1, 2, 3], "count": 4, "positions": [62, 79, 101, 124], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2], "count": 3, "positions": [20, 59, 108], "analysis_mode": "full"}, {"pattern": [0.5, 3, 2, 1], "count": 3, "positions": [21, 60, 109], "analysis_mode": "full"}], "kric-5": [{"pattern": [3, 2, 1, 2, 3], "count": 4, "positions": [61, 78, 100, 123], "analysis_mode": "full"}, {"pattern": [1, 2, 3, 2, 1], "count": 4, "positions": [63, 76, 102, 121], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1], "count": 3, "positions": [20, 59, 108], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": [2, 2, 1, 1, 1], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}], "kric-6": [{"pattern": [3, 2, 1, 3, 1, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1, 1], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": [2, 2, 1, 1, 1, 1], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": [2, 1, 1, 1, 1, 2], "count": 3, "positions": [29, 72, 117], "analysis_mode": "full"}, {"pattern": [1, 1, 1, 1, 2, 3], "count": 3, "positions": [30, 73, 118], "analysis_mode": "full"}, {"pattern": [1, 1, 1, 2, 3, 2], "count": 3, "positions": [31, 74, 119], "analysis_mode": "full"}], "kric-7": [{"pattern": [3, 2, 1, 3, 1, 2, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": [2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": [2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [29, 72, 117], "analysis_mode": "full"}, {"pattern": [1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [30, 73, 118], "analysis_mode": "full"}, {"pattern": [3, 1, 1, 1, 2, 1, 2], "count": 3, "positions": [39, 82, 127], "analysis_mode": "full"}], "kric-8": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": [2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": [2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [29, 72, 117], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2], "count": 2, "positions": [16, 104], "analysis_mode": "full"}], "kric-9": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": [2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [28, 71, 116], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3], "count": 2, "positions": [17, 105], "analysis_mode": "full"}], "kric-10": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [27, 70, 115], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2], "count": 2, "positions": [18, 106], "analysis_mode": "full"}], "kric-11": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [26, 69, 114], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [19, 107], "analysis_mode": "full"}], "kric-12": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [20, 108], "analysis_mode": "full"}], "kric-13": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": [0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [21, 109], "analysis_mode": "full"}], "kric-14": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": [0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": [3, 1, 1, 1, 2, 1, 2, 1, 1, 2, 0.5, 8, 0.5, 2], "count": 2, "positions": [39, 82], "analysis_mode": "full"}], "kric-15": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "full"}, {"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": [0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [67, 112], "analysis_mode": "full"}], "kric-16": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": [0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [21, 109], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [67, 112], "analysis_mode": "full"}], "kric-17": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [20, 108], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [68, 113], "analysis_mode": "full"}], "kric-18": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [19, 107], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [69, 114], "analysis_mode": "full"}], "kric-19": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [18, 106], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [69, 114], "analysis_mode": "full"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [70, 115], "analysis_mode": "full"}], "kric-20": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [17, 105], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [68, 113], "analysis_mode": "full"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [69, 114], "analysis_mode": "full"}], "kric-21": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [16, 104], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [67, 112], "analysis_mode": "full"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [68, 113], "analysis_mode": "full"}], "kric-22": [{"pattern": [2, 3, 2, 1, 0.5, 2, 0.5, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [15, 103], "analysis_mode": "full"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [66, 111], "analysis_mode": "full"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [67, 112], "analysis_mode": "full"}], "kric-23": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [65, 110], "analysis_mode": "full"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [66, 111], "analysis_mode": "full"}], "kric-24": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [65, 110], "analysis_mode": "full"}], "kric-max": [{"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [65, 110], "analysis_mode": "full"}], "main_melody": {"kric-2": [{"pattern": [1, 2], "count": 24, "positions": [6, 13, 18, 26, 33, 42, 44, 47, 58, 63, 69, 76, 80, 85, 87, 90, 97, 102, 106, 114, 121, 125, 130, 132], "analysis_mode": "main_melody"}, {"pattern": [2, 1], "count": 21, "positions": [11, 17, 23, 29, 37, 43, 45, 57, 62, 66, 72, 79, 86, 88, 95, 101, 105, 111, 117, 124, 131], "analysis_mode": "main_melody"}, {"pattern": [1, 1], "count": 20, "positions": [5, 12, 30, 31, 32, 40, 41, 46, 73, 74, 75, 83, 84, 89, 96, 118, 119, 120, 128, 129], "analysis_mode": "main_melody"}, {"pattern": [2, 2], "count": 15, "positions": [0, 1, 7, 14, 27, 28, 36, 52, 53, 70, 71, 115, 116, 133, 134], "analysis_mode": "main_melody"}, {"pattern": [2, 3], "count": 11, "positions": [15, 20, 34, 59, 64, 77, 81, 103, 108, 122, 126], "analysis_mode": "main_melody"}, {"pattern": [3, 2], "count": 11, "positions": [16, 22, 35, 56, 61, 65, 78, 100, 104, 110, 123], "analysis_mode": "main_melody"}, {"pattern": [2, 8], "count": 6, "positions": [2, 8, 48, 54, 91, 98], "analysis_mode": "main_melody"}, {"pattern": [3, 1], "count": 6, "positions": [25, 39, 68, 82, 113, 127], "analysis_mode": "main_melody"}, {"pattern": [1, 3], "count": 4, "positions": [24, 38, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [8, 2], "count": 3, "positions": [9, 50, 93], "analysis_mode": "main_melody"}], "kric-3": [{"pattern": [1, 1, 2], "count": 11, "positions": [5, 12, 32, 41, 46, 75, 84, 89, 96, 120, 129], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1], "count": 10, "positions": [16, 22, 56, 61, 65, 78, 100, 104, 110, 123], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2], "count": 10, "positions": [17, 43, 57, 62, 79, 86, 101, 105, 124, 131], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3], "count": 10, "positions": [18, 33, 58, 63, 76, 80, 102, 106, 121, 125], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2], "count": 9, "positions": [15, 20, 34, 59, 64, 77, 103, 108, 122], "analysis_mode": "main_melody"}, {"pattern": [1, 1, 1], "count": 9, "positions": [30, 31, 40, 73, 74, 83, 118, 119, 128], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 1], "count": 7, "positions": [11, 29, 45, 72, 88, 95, 117], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2], "count": 6, "positions": [0, 27, 52, 70, 115, 133], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2], "count": 6, "positions": [6, 13, 26, 69, 114, 132], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 1], "count": 5, "positions": [42, 44, 85, 87, 130], "analysis_mode": "main_melody"}], "kric-4": [{"pattern": [2, 3, 2, 1], "count": 8, "positions": [15, 20, 59, 64, 77, 103, 108, 122], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2], "count": 8, "positions": [18, 33, 58, 63, 76, 102, 106, 121], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2], "count": 7, "positions": [16, 56, 61, 78, 100, 104, 123], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3], "count": 7, "positions": [17, 57, 62, 79, 101, 105, 124], "analysis_mode": "main_melody"}, {"pattern": [1, 1, 1, 2], "count": 6, "positions": [31, 40, 74, 83, 119, 128], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 1, 2], "count": 4, "positions": [11, 45, 88, 95], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1], "count": 4, "positions": [23, 37, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2], "count": 4, "positions": [26, 69, 114, 132], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 3], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}], "kric-5": [{"pattern": [3, 2, 1, 2, 3], "count": 7, "positions": [16, 56, 61, 78, 100, 104, 123], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1], "count": 7, "positions": [18, 58, 63, 76, 102, 106, 121], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2], "count": 5, "positions": [15, 59, 77, 103, 122], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2], "count": 5, "positions": [17, 57, 62, 101, 105], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 3, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}], "kric-6": [{"pattern": [2, 3, 2, 1, 2, 3], "count": 5, "positions": [15, 59, 77, 103, 122], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2], "count": 5, "positions": [16, 56, 61, 100, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1], "count": 5, "positions": [17, 57, 62, 101, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2], "count": 4, "positions": [58, 76, 102, 121], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3], "count": 3, "positions": [18, 63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 3, 1, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}], "kric-7": [{"pattern": [3, 2, 1, 2, 3, 2, 1], "count": 5, "positions": [16, 56, 61, 100, 104], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3], "count": 4, "positions": [58, 76, 102, 121], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2, 3, 2], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3], "count": 3, "positions": [17, 62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1], "count": 3, "positions": [18, 63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 3, 1, 2, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}], "kric-8": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3], "count": 3, "positions": [16, 61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1], "count": 3, "positions": [17, 62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2], "count": 3, "positions": [18, 63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}], "kric-9": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1], "count": 3, "positions": [16, 61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2], "count": 3, "positions": [17, 62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2], "count": 3, "positions": [18, 63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}], "kric-10": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2], "count": 3, "positions": [16, 61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2], "count": 3, "positions": [17, 62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2], "count": 3, "positions": [18, 63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}], "kric-11": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2], "count": 3, "positions": [16, 61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2], "count": 3, "positions": [17, 62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [18, 63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}], "kric-12": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2], "count": 3, "positions": [16, 61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [17, 62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [18, 63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 1, 1, 2, 1, 2, 1, 1, 2, 8, 2], "count": 2, "positions": [39, 82], "analysis_mode": "main_melody"}], "kric-13": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [16, 61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [17, 62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [18, 63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}], "kric-14": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [16, 61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [17, 62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [18, 63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}], "kric-15": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [16, 61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [17, 62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [18, 63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [22, 65, 110], "analysis_mode": "main_melody"}, {"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}], "kric-16": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [16, 61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [17, 62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [18, 63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [20, 64, 108], "analysis_mode": "main_melody"}, {"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}], "kric-17": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [16, 61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [17, 62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [18, 63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [64, 108], "analysis_mode": "main_melody"}], "kric-18": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [16, 61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [17, 62, 105], "analysis_mode": "main_melody"}, {"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [64, 108], "analysis_mode": "main_melody"}], "kric-19": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [16, 61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [64, 108], "analysis_mode": "main_melody"}], "kric-20": [{"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [15, 59, 103], "analysis_mode": "main_melody"}, {"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [64, 108], "analysis_mode": "main_melody"}], "kric-21": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [64, 108], "analysis_mode": "main_melody"}], "kric-22": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [64, 108], "analysis_mode": "main_melody"}], "kric-23": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [64, 108], "analysis_mode": "main_melody"}], "kric-24": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [64, 108], "analysis_mode": "main_melody"}], "kric-25": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [63, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [64, 108], "analysis_mode": "main_melody"}], "kric-26": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [62, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [63, 106], "analysis_mode": "main_melody"}], "kric-27": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [61, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [62, 105], "analysis_mode": "main_melody"}], "kric-28": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [59, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [61, 104], "analysis_mode": "main_melody"}], "kric-29": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [59, 103], "analysis_mode": "main_melody"}], "kric-30": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [58, 102], "analysis_mode": "main_melody"}], "kric-31": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [57, 101], "analysis_mode": "main_melody"}], "kric-32": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [56, 100], "analysis_mode": "main_melody"}], "kric-33": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}, {"pattern": [8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [55, 99], "analysis_mode": "main_melody"}], "kric-34": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}], "kric-max": [{"pattern": [2, 8, 3, 2, 1, 2, 3, 2, 1, 2, 3, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [54, 98], "analysis_mode": "main_melody"}]}, "grace_units": {"kric-2": [{"pattern": [1, 2], "count": 22, "positions": [6, 13, 26, 33, 42, 44, 47, 58, 63, 69, 76, 80, 85, 87, 90, 97, 102, 114, 121, 125, 130, 132], "analysis_mode": "main_melody"}, {"pattern": [1, 1], "count": 20, "positions": [5, 12, 30, 31, 32, 40, 41, 46, 73, 74, 75, 83, 84, 89, 96, 118, 119, 120, 128, 129], "analysis_mode": "main_melody"}, {"pattern": [2, 1], "count": 19, "positions": [17, 23, 29, 37, 43, 45, 57, 62, 66, 72, 79, 86, 88, 101, 105, 111, 117, 124, 131], "analysis_mode": "main_melody"}, {"pattern": [2, 2], "count": 14, "positions": [0, 1, 7, 14, 27, 28, 36, 53, 70, 71, 115, 116, 133, 134], "analysis_mode": "main_melody"}, {"pattern": [2, 3], "count": 8, "positions": [15, 34, 64, 77, 81, 103, 122, 126], "analysis_mode": "main_melody"}, {"pattern": [3, 2], "count": 8, "positions": [16, 35, 56, 65, 78, 100, 104, 123], "analysis_mode": "main_melody"}, {"pattern": [3, 1], "count": 6, "positions": [25, 39, 68, 82, 113, 127], "analysis_mode": "main_melody"}, {"pattern": [1, 3], "count": 4, "positions": [24, 38, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [2, 8.5], "count": 3, "positions": [2, 48, 91], "analysis_mode": "main_melody"}, {"pattern": [2, 8], "count": 3, "positions": [8, 54, 98], "analysis_mode": "main_melody"}], "kric-3": [{"pattern": [1, 1, 2], "count": 11, "positions": [5, 12, 32, 41, 46, 75, 84, 89, 96, 120, 129], "analysis_mode": "main_melody"}, {"pattern": [1, 1, 1], "count": 9, "positions": [30, 31, 40, 73, 74, 83, 118, 119, 128], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2], "count": 8, "positions": [43, 57, 62, 79, 86, 101, 124, 131], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1], "count": 7, "positions": [16, 56, 65, 78, 100, 104, 123], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3], "count": 7, "positions": [33, 63, 76, 80, 102, 121, 125], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2], "count": 6, "positions": [6, 13, 26, 69, 114, 132], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2], "count": 6, "positions": [15, 34, 64, 77, 103, 122], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2], "count": 5, "positions": [0, 27, 70, 115, 133], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 1], "count": 5, "positions": [29, 45, 72, 88, 117], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 1], "count": 5, "positions": [42, 44, 85, 87, 130], "analysis_mode": "main_melody"}], "kric-4": [{"pattern": [1, 1, 1, 2], "count": 6, "positions": [31, 40, 74, 83, 119, 128], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1], "count": 5, "positions": [15, 64, 77, 103, 122], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 3, 2], "count": 5, "positions": [33, 63, 76, 102, 121], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1], "count": 4, "positions": [23, 37, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2], "count": 4, "positions": [26, 69, 114, 132], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2], "count": 4, "positions": [56, 78, 100, 123], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2, 3], "count": 4, "positions": [62, 79, 101, 124], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2, 1], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}], "kric-5": [{"pattern": [1, 2, 3, 2, 1], "count": 4, "positions": [63, 76, 102, 121], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2, 1, 1], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 1, 1, 1], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 1, 1, 1], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": [1, 1, 1, 1, 2], "count": 3, "positions": [30, 73, 118], "analysis_mode": "main_melody"}, {"pattern": [1, 1, 1, 2, 3], "count": 3, "positions": [31, 74, 119], "analysis_mode": "main_melody"}], "kric-6": [{"pattern": [2, 1, 3, 1, 2, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2, 1, 1, 1], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 1, 1, 1, 1], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 1, 1, 1, 2], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": [1, 1, 1, 1, 2, 3], "count": 3, "positions": [30, 73, 118], "analysis_mode": "main_melody"}, {"pattern": [1, 1, 1, 2, 3, 2], "count": 3, "positions": [31, 74, 119], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 1, 1, 2, 1], "count": 3, "positions": [39, 82, 127], "analysis_mode": "main_melody"}], "kric-7": [{"pattern": [2, 1, 3, 1, 2, 2, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": [1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [30, 73, 118], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 1, 1, 2, 1, 2], "count": 3, "positions": [39, 82, 127], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2.5, 3.5, 2], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}], "kric-8": [{"pattern": [2, 1, 3, 1, 2, 2, 2, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [29, 72, 117], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2.5, 3.5, 2, 1, 3], "count": 2, "positions": [16, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2.5, 3.5, 2, 1, 3, 1], "count": 2, "positions": [17, 105], "analysis_mode": "main_melody"}], "kric-9": [{"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [28, 71, 116], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1, 3], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2.5, 3.5, 2, 1, 3, 1], "count": 2, "positions": [16, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2.5, 3.5, 2, 1, 3, 1, 2], "count": 2, "positions": [17, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2.5, 3.5, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [18, 106], "analysis_mode": "main_melody"}], "kric-10": [{"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [27, 70, 115], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1, 3, 1], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2], "count": 2, "positions": [16, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [17, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [18, 106], "analysis_mode": "main_melody"}, {"pattern": [2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}], "kric-11": [{"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [26, 69, 114], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [16, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [17, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [18, 106], "analysis_mode": "main_melody"}, {"pattern": [2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": [3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}], "kric-12": [{"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [25, 68, 113], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [16, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [17, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [18, 106], "analysis_mode": "main_melody"}, {"pattern": [2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": [3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 1, 1, 2, 1, 2, 1, 1, 2, 8.5, 2.5], "count": 2, "positions": [39, 82], "analysis_mode": "main_melody"}], "kric-13": [{"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [24, 67, 112], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [16, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [17, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [18, 106], "analysis_mode": "main_melody"}, {"pattern": [2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": [3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [69, 114], "analysis_mode": "main_melody"}], "kric-14": [{"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 3, "positions": [23, 66, 111], "analysis_mode": "main_melody"}, {"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [16, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [17, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [18, 106], "analysis_mode": "main_melody"}, {"pattern": [2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": [3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [69, 114], "analysis_mode": "main_melody"}], "kric-15": [{"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [16, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [17, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [18, 106], "analysis_mode": "main_melody"}, {"pattern": [2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": [3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [21, 109], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1], "count": 2, "positions": [66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [69, 114], "analysis_mode": "main_melody"}], "kric-16": [{"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [16, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [17, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [18, 106], "analysis_mode": "main_melody"}, {"pattern": [2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [19, 107], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2], "count": 2, "positions": [66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [69, 114], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [70, 115], "analysis_mode": "main_melody"}], "kric-17": [{"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [16, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [17, 105], "analysis_mode": "main_melody"}, {"pattern": [1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [18, 106], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3], "count": 2, "positions": [66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [69, 114], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [70, 115], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [71, 116], "analysis_mode": "main_melody"}], "kric-18": [{"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [16, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [17, 105], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1], "count": 2, "positions": [66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [69, 114], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [70, 115], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [71, 116], "analysis_mode": "main_melody"}], "kric-19": [{"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [16, 104], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1], "count": 2, "positions": [66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [69, 114], "analysis_mode": "main_melody"}, {"pattern": [2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [70, 115], "analysis_mode": "main_melody"}], "kric-20": [{"pattern": [2, 3, 2, 1, 2.5, 3.5, 2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2], "count": 2, "positions": [15, 103], "analysis_mode": "main_melody"}, {"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1], "count": 2, "positions": [66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [68, 113], "analysis_mode": "main_melody"}, {"pattern": [1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [69, 114], "analysis_mode": "main_melody"}], "kric-21": [{"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2], "count": 2, "positions": [66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [67, 112], "analysis_mode": "main_melody"}, {"pattern": [3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [68, 113], "analysis_mode": "main_melody"}], "kric-22": [{"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1], "count": 2, "positions": [66, 111], "analysis_mode": "main_melody"}, {"pattern": [1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [67, 112], "analysis_mode": "main_melody"}], "kric-23": [{"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [66, 111], "analysis_mode": "main_melody"}], "kric-max": [{"pattern": [2, 1, 3, 1, 2, 2, 2, 1, 1, 1, 1, 2, 3, 2, 1, 2, 3, 1, 1, 1, 2, 1, 2], "count": 2, "positions": [66, 111], "analysis_mode": "main_melody"}]}}, "repeated_syllables": {"B√†": {"count": 2, "positions": [0, 133]}, "R·∫±ng": {"count": 5, "positions": [1, 41, 84, 129, 134]}, "b√†": {"count": 13, "positions": [2, 8, 16, 37, 40, 42, 80, 83, 85, 125, 128, 130, 135]}, "ƒëi": {"count": 4, "positions": [12, 17, 57, 62]}, "c√°i": {"count": 6, "positions": [26, 33, 69, 76, 114, 121]}, "duy√™n": {"count": 3, "positions": [27, 70, 115]}, "√¥ng": {"count": 3, "positions": [28, 71, 116]}, "ch·ªìng": {"count": 5, "positions": [29, 48, 72, 91, 117]}, "l√†m": {"count": 4, "positions": [30, 73, 104, 118]}, "kh·ªï": {"count": 3, "positions": [31, 74, 119]}, "ƒë·ªùi": {"count": 3, "positions": [34, 77, 122]}, "t√¥i": {"count": 2, "positions": [35, 78]}, "∆°i": {"count": 7, "positions": [36, 39, 79, 82, 124, 127, 132]}, "R√≠": {"count": 6, "positions": [38, 43, 81, 86, 126, 131]}, "∆°i.": {"count": 2, "positions": [44, 87]}, "Ch·ªìng": {"count": 2, "positions": [45, 88]}, "g√¨": {"count": 2, "positions": [46, 89]}, "m√†": {"count": 2, "positions": [47, 90]}, "l√∫c": {"count": 2, "positions": [61, 65]}, "ph·∫£i": {"count": 2, "positions": [63, 67]}, "o": {"count": 3, "positions": [96, 98, 99]}}, "all_syllables": {"B√†": {"count": 2, "positions": [0, 133]}, "R·∫±ng": {"count": 5, "positions": [1, 41, 84, 129, 134]}, "b√†": {"count": 13, "positions": [2, 8, 16, 37, 40, 42, 80, 83, 85, 125, 128, 130, 135]}, "R√≠,": {"count": 1, "positions": [4]}, "·ªöi": {"count": 1, "positions": [5]}, "r·∫±ng": {"count": 1, "positions": [7]}, "ƒëi,": {"count": 1, "positions": [9]}, "·ªõi": {"count": 1, "positions": [11]}, "ƒëi": {"count": 4, "positions": [12, 17, 57, 62]}, "l√†": {"count": 1, "positions": [14]}, "ƒë√¢u": {"count": 1, "positions": [15]}, "kh·∫Øp": {"count": 1, "positions": [18]}, "ch·ªën": {"count": 1, "positions": [20]}, "n·ªëi": {"count": 1, "positions": [22]}, "d√¢y": {"count": 1, "positions": [23]}, "t∆°": {"count": 1, "positions": [24]}, "h·ªìng": {"count": 1, "positions": [25]}, "c√°i": {"count": 6, "positions": [26, 33, 69, 76, 114, 121]}, "duy√™n": {"count": 3, "positions": [27, 70, 115]}, "√¥ng": {"count": 3, "positions": [28, 71, 116]}, "ch·ªìng": {"count": 5, "positions": [29, 48, 72, 91, 117]}, "l√†m": {"count": 4, "positions": [30, 73, 104, 118]}, "kh·ªï": {"count": 3, "positions": [31, 74, 119]}, "ƒë·ªùi": {"count": 3, "positions": [34, 77, 122]}, "t√¥i": {"count": 2, "positions": [35, 78]}, "∆°i": {"count": 7, "positions": [36, 39, 79, 82, 124, 127, 132]}, "R√≠": {"count": 6, "positions": [38, 43, 81, 86, 126, 131]}, "∆°i.": {"count": 2, "positions": [44, 87]}, "Ch·ªìng": {"count": 2, "positions": [45, 88]}, "g√¨": {"count": 2, "positions": [46, 89]}, "m√†": {"count": 2, "positions": [47, 90]}, "b√©,": {"count": 1, "positions": [50]}, "b√©": {"count": 1, "positions": [52]}, "t·∫πo": {"count": 1, "positions": [53]}, "t√®o": {"count": 1, "positions": [54]}, "teo,": {"count": 1, "positions": [55]}, "ch√¢n": {"count": 1, "positions": [56]}, "c√†": {"count": 1, "positions": [58]}, "kheo": {"count": 1, "positions": [59]}, "l√∫c": {"count": 2, "positions": [61, 65]}, "ph·∫£i": {"count": 2, "positions": [63, 67]}, "c√µng": {"count": 1, "positions": [64]}, "kh√≥c": {"count": 1, "positions": [66]}, "b·ªìng": {"count": 1, "positions": [68]}, "ng√°y,": {"count": 1, "positions": [93]}, "ng√°y": {"count": 1, "positions": [95]}, "o": {"count": 3, "positions": [96, 98, 99]}, "ƒê√™m": {"count": 1, "positions": [100]}, "th·ªùi": {"count": 1, "positions": [101]}, "n·∫±m": {"count": 1, "positions": [102]}, "co": {"count": 1, "positions": [103]}, "ƒÉn": {"count": 1, "positions": [105]}, "l∆∞·ªùi": {"count": 1, "positions": [106]}, "bi·∫øng": {"count": 1, "positions": [108]}, "ch·∫≥ng": {"count": 1, "positions": [110]}, "lo": {"count": 1, "positions": [111]}, "h·ªçc": {"count": 1, "positions": [112]}, "h√†nh": {"count": 1, "positions": [113]}, "t√¥i,": {"count": 1, "positions": [123]}}, "unique_syllables": ["B√†", "Ch·ªìng", "R√≠", "R√≠,", "R·∫±ng", "bi·∫øng", "b√†", "b√©", "b√©,", "b·ªìng", "ch√¢n", "ch·∫≥ng", "ch·ªën", "ch·ªìng", "co", "c√†", "c√°i", "c√µng", "duy√™n", "d√¢y", "g√¨", "h√†nh", "h·ªçc", "h·ªìng", "kheo", "kh√≥c", "kh·∫Øp", "kh·ªï", "lo", "l√†", "l√†m", "l√∫c", "l∆∞·ªùi", "m√†", "ng√°y", "ng√°y,", "n·∫±m", "n·ªëi", "o", "ph·∫£i", "r·∫±ng", "teo,", "th·ªùi", "t√®o", "t√¥i", "t√¥i,", "t∆°", "t·∫πo", "√¥ng", "ƒÉn", "ƒê√™m", "ƒëi", "ƒëi,", "ƒë√¢u", "ƒë·ªùi", "∆°i", "∆°i.", "·ªöi", "·ªõi"], "melismatic_syllables": {"·ªöi": [5], "ƒëi": [12], "kh·ªï": [31, 74, 119], "o": [96]}, "tone_syllables": {"s·∫Øc": [3, 4, 5, 6, 10, 11, 18, 19, 19, 20, 21, 21, 22, 26, 33, 38, 43, 49, 50, 51, 51, 52, 60, 61, 65, 66, 69, 76, 81, 86, 92, 93, 94, 94, 95, 107, 108, 109, 114, 121, 126, 131], "huy·ªÅn": [0, 1, 2, 3, 7, 8, 14, 16, 25, 29, 30, 34, 37, 40, 41, 42, 45, 46, 47, 48, 49, 54, 58, 68, 72, 73, 77, 80, 83, 84, 85, 88, 89, 90, 91, 92, 101, 102, 104, 106, 107, 113, 117, 118, 122, 125, 128, 129, 130, 133, 134, 135], "h·ªèi": [31, 32, 63, 67, 74, 75, 109, 110, 119, 120], "ng√£": [64], "n·∫∑ng": [53, 112], "ngang": [9, 10, 12, 13, 15, 17, 23, 24, 27, 28, 35, 36, 39, 44, 55, 56, 57, 59, 60, 62, 70, 71, 78, 79, 82, 87, 96, 97, 98, 99, 100, 103, 105, 111, 115, 116, 123, 124, 127, 132]}, "melismatic_analysis": {"melismatic_syllables": {"·ªöi": {"occurrences": [5], "note_counts": [2], "total_durations": [2], "pitch_patterns": [["E5", "G5"]]}, "ƒëi": {"occurrences": [12], "note_counts": [2], "total_durations": [2], "pitch_patterns": [["D5", "C5"]]}, "kh·ªï": {"occurrences": [31, 74, 119], "note_counts": [2, 2, 2], "total_durations": [2, 2, 2], "pitch_patterns": [["G4", "C5"], ["G4", "C5"], ["G4", "C5"]]}, "o": {"occurrences": [96], "note_counts": [2], "total_durations": [2], "pitch_patterns": [["E5", "D5"]]}}, "syllabic_syllables": {"B√†": {"occurrences": [0, 133], "pitches": ["C5", "C5"], "durations": [2, 2]}, "R·∫±ng": {"occurrences": [1, 41, 84, 129, 134], "pitches": ["C5", "G4", "G4", "G4", "C5"], "durations": [2, 1, 1, 1, 2]}, "b√†": {"occurrences": [2, 8, 16, 37, 40, 42, 80, 83, 85, 125, 128, 130, 135], "pitches": ["C5", "C5", "C5", "G4", "G4", "G4", "G4", "G4", "G4", "G4", "G4", "G4", "C5"], "durations": [2, 2, 3, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2]}, "R√≠,": {"occurrences": [4], "pitches": ["E5"], "durations": [8]}, "r·∫±ng": {"occurrences": [7], "pitches": ["A4"], "durations": [2]}, "ƒëi,": {"occurrences": [9], "pitches": ["D5"], "durations": [8]}, "·ªõi": {"occurrences": [11], "pitches": ["E5"], "durations": [2]}, "l√†": {"occurrences": [14], "pitches": ["A4"], "durations": [2]}, "ƒë√¢u": {"occurrences": [15], "pitches": ["C5"], "durations": [2]}, "ƒëi": {"occurrences": [17, 57, 62], "pitches": ["D5", "C5", "D5"], "durations": [2, 2, 2]}, "kh·∫Øp": {"occurrences": [18], "pitches": ["E5"], "durations": [1]}, "ch·ªën": {"occurrences": [20], "pitches": ["E5"], "durations": [2]}, "n·ªëi": {"occurrences": [22], "pitches": ["E5"], "durations": [3]}, "d√¢y": {"occurrences": [23], "pitches": ["D5"], "durations": [2]}, "t∆°": {"occurrences": [24], "pitches": ["C5"], "durations": [1]}, "h·ªìng": {"occurrences": [25], "pitches": ["A4"], "durations": [3]}, "c√°i": {"occurrences": [26, 33, 69, 76, 114, 121], "pitches": ["C5", "C5", "C5", "C5", "C5", "C5"], "durations": [1, 1, 1, 1, 1, 1]}, "duy√™n": {"occurrences": [27, 70, 115], "pitches": ["A4", "A4", "A4"], "durations": [2, 2, 2]}, "√¥ng": {"occurrences": [28, 71, 116], "pitches": ["G4", "G4", "G4"], "durations": [2, 2, 2]}, "ch·ªìng": {"occurrences": [29, 48, 72, 91, 117], "pitches": ["D4", "C5", "D4", "C5", "D4"], "durations": [2, 2, 2, 2, 2]}, "l√†m": {"occurrences": [30, 73, 104, 118], "pitches": ["D4", "D4", "C5", "D4"], "durations": [1, 1, 3, 1]}, "ƒë·ªùi": {"occurrences": [34, 77, 122], "pitches": ["G4", "G4", "G4"], "durations": [2, 2, 2]}, "t√¥i": {"occurrences": [35, 78], "pitches": ["A4", "A4"], "durations": [3, 3]}, "∆°i": {"occurrences": [36, 39, 79, 82, 124, 127, 132], "pitches": ["C5", "A4", "C5", "A4", "C5", "A4", "A4"], "durations": [2, 3, 2, 3, 2, 3, 1]}, "R√≠": {"occurrences": [38, 43, 81, 86, 126, 131], "pitches": ["C5", "C5", "C5", "C5", "A4", "C5"], "durations": [1, 2, 2, 2, 2, 2]}, "∆°i.": {"occurrences": [44, 87], "pitches": ["A4", "A4"], "durations": [1, 1]}, "Ch·ªìng": {"occurrences": [45, 88], "pitches": ["C5", "C5"], "durations": [2, 2]}, "g√¨": {"occurrences": [46, 89], "pitches": ["C5", "C5"], "durations": [1, 1]}, "m√†": {"occurrences": [47, 90], "pitches": ["C5", "C5"], "durations": [1, 1]}, "b√©,": {"occurrences": [50], "pitches": ["E5"], "durations": [8]}, "b√©": {"occurrences": [52], "pitches": ["G5"], "durations": [2]}, "t·∫πo": {"occurrences": [53], "pitches": ["A4"], "durations": [2]}, "t√®o": {"occurrences": [54], "pitches": ["C5"], "durations": [2]}, "teo,": {"occurrences": [55], "pitches": ["D5"], "durations": [8]}, "ch√¢n": {"occurrences": [56], "pitches": ["C5"], "durations": [3]}, "c√†": {"occurrences": [58], "pitches": ["A4"], "durations": [1]}, "kheo": {"occurrences": [59], "pitches": ["C5"], "durations": [2]}, "l√∫c": {"occurrences": [61, 65], "pitches": ["E5", "E5"], "durations": [3, 3]}, "ph·∫£i": {"occurrences": [63, 67], "pitches": ["C5", "C5"], "durations": [1, 1]}, "c√µng": {"occurrences": [64], "pitches": ["E5"], "durations": [2]}, "kh√≥c": {"occurrences": [66], "pitches": ["D5"], "durations": [2]}, "b·ªìng": {"occurrences": [68], "pitches": ["A4"], "durations": [3]}, "ng√°y,": {"occurrences": [93], "pitches": ["E5"], "durations": [8]}, "ng√°y": {"occurrences": [95], "pitches": ["G5"], "durations": [2]}, "o": {"occurrences": [98, 99], "pitches": ["C5", "D5"], "durations": [2, 8]}, "ƒê√™m": {"occurrences": [100], "pitches": ["C5"], "durations": [3]}, "th·ªùi": {"occurrences": [101], "pitches": ["A4"], "durations": [2]}, "n·∫±m": {"occurrences": [102], "pitches": ["A4"], "durations": [1]}, "co": {"occurrences": [103], "pitches": ["C5"], "durations": [2]}, "ƒÉn": {"occurrences": [105], "pitches": ["D5"], "durations": [2]}, "l∆∞·ªùi": {"occurrences": [106], "pitches": ["C5"], "durations": [1]}, "bi·∫øng": {"occurrences": [108], "pitches": ["E5"], "durations": [2]}, "ch·∫≥ng": {"occurrences": [110], "pitches": ["E5"], "durations": [3]}, "lo": {"occurrences": [111], "pitches": ["D5"], "durations": [2]}, "h·ªçc": {"occurrences": [112], "pitches": ["C5"], "durations": [1]}, "h√†nh": {"occurrences": [113], "pitches": ["A4"], "durations": [3]}, "t√¥i,": {"occurrences": [123], "pitches": ["A4"], "durations": [3]}}, "total_melismatic": 6, "total_syllabic": 113, "unique_melismatic": ["·ªöi", "kh·ªï", "ƒëi", "o"], "unique_syllabic": ["h·ªçc", "ng√°y,", "ph·∫£i", "∆°i.", "∆°i", "B√†", "d√¢y", "Ch·ªìng", "g√¨", "duy√™n", "b√©", "teo,", "kheo", "lo", "ch·ªìng", "ƒÉn", "kh√≥c", "n·ªëi", "m√†", "c√†", "r·∫±ng", "c√°i", "t√¥i,", "l√†", "h√†nh", "·ªõi", "t·∫πo", "R·∫±ng", "l√∫c", "th·ªùi", "R√≠", "l∆∞·ªùi", "R√≠,", "ƒê√™m", "√¥ng", "b√†", "t∆°", "b·ªìng", "ƒë·ªùi", "b√©,", "ƒë√¢u", "ng√°y", "h·ªìng", "ch·∫≥ng", "ch·ªën", "ch√¢n", "t√®o", "ƒëi,", "n·∫±m", "ƒëi", "c√µng", "kh·∫Øp", "bi·∫øng", "o", "co", "t√¥i", "l√†m"]}, "tone_mark_analysis": {"tone_statistics": {"s·∫Øc": {"total_occurrences": 26, "unique_syllables": ["ch·ªën", "R√≠,", "ng√°y", "c√°i", "ng√°y,", "·ªöi", "b√©", "b√©,", "kh·∫Øp", "·ªõi", "l√∫c", "bi·∫øng", "kh√≥c", "n·ªëi", "R√≠"], "unique_count": 15, "pitch_patterns": [["E5"], ["E5", "G5"], ["E5"], ["E5"], ["E5"], ["E5"], ["C5"], ["C5"], ["C5"], ["C5"], ["E5"], ["G5"], ["E5"], ["E5"], ["D5"], ["C5"], ["C5"], ["C5"], ["C5"], ["E5"], ["G5"], ["E5"], ["C5"], ["C5"], ["A4"], ["C5"]], "average_duration": 2.5, "syllable_list": ["R√≠,", "·ªöi", "·ªõi", "kh·∫Øp", "ch·ªën", "n·ªëi", "c√°i", "c√°i", "R√≠", "R√≠", "b√©,", "b√©", "l√∫c", "l√∫c", "kh√≥c", "c√°i", "c√°i", "R√≠", "R√≠", "ng√°y,", "ng√°y", "bi·∫øng", "c√°i", "c√°i", "R√≠", "R√≠"]}, "huy·ªÅn": {"total_occurrences": 48, "unique_syllables": ["g√¨", "B√†", "Ch·ªìng", "ch·ªìng", "c√†", "m√†", "r·∫±ng", "l√†", "h√†nh", "R·∫±ng", "th·ªùi", "l∆∞·ªùi", "b√†", "b·ªìng", "ƒë·ªùi", "h·ªìng", "t√®o", "n·∫±m", "l√†m"], "unique_count": 19, "pitch_patterns": [["C5"], ["C5"], ["C5"], ["A4"], ["C5"], ["A4"], ["C5"], ["A4"], ["D4"], ["D4"], ["G4"], ["G4"], ["G4"], ["G4"], ["G4"], ["C5"], ["C5"], ["C5"], ["C5"], ["C5"], ["A4"], ["A4"], ["D4"], ["D4"], ["G4"], ["G4"], ["G4"], ["G4"], ["G4"], ["C5"], ["C5"], ["C5"], ["C5"], ["A4"], ["A4"], ["C5"], ["C5"], ["A4"], ["D4"], ["D4"], ["G4"], ["G4"], ["G4"], ["G4"], ["G4"], ["C5"], ["C5"], ["C5"]], "average_duration": 1.6666666666666667, "syllable_list": ["B√†", "R·∫±ng", "b√†", "r·∫±ng", "b√†", "l√†", "b√†", "h·ªìng", "ch·ªìng", "l√†m", "ƒë·ªùi", "b√†", "b√†", "R·∫±ng", "b√†", "Ch·ªìng", "g√¨", "m√†", "ch·ªìng", "t√®o", "c√†", "b·ªìng", "ch·ªìng", "l√†m", "ƒë·ªùi", "b√†", "b√†", "R·∫±ng", "b√†", "Ch·ªìng", "g√¨", "m√†", "ch·ªìng", "th·ªùi", "n·∫±m", "l√†m", "l∆∞·ªùi", "h√†nh", "ch·ªìng", "l√†m", "ƒë·ªùi", "b√†", "b√†", "R·∫±ng", "b√†", "B√†", "R·∫±ng", "b√†"]}, "h·ªèi": {"total_occurrences": 6, "unique_syllables": ["ph·∫£i", "kh·ªï", "ch·∫≥ng"], "unique_count": 3, "pitch_patterns": [["G4", "C5"], ["C5"], ["C5"], ["G4", "C5"], ["E5"], ["G4", "C5"]], "average_duration": 1.8333333333333333, "syllable_list": ["kh·ªï", "ph·∫£i", "ph·∫£i", "kh·ªï", "ch·∫≥ng", "kh·ªï"]}, "ng√£": {"total_occurrences": 1, "unique_syllables": ["c√µng"], "unique_count": 1, "pitch_patterns": [["E5"]], "average_duration": 2.0, "syllable_list": ["c√µng"]}, "n·∫∑ng": {"total_occurrences": 2, "unique_syllables": ["h·ªçc", "t·∫πo"], "unique_count": 2, "pitch_patterns": [["A4"], ["C5"]], "average_duration": 1.5, "syllable_list": ["t·∫πo", "h·ªçc"]}, "ngang": {"total_occurrences": 36, "unique_syllables": ["∆°i.", "∆°i", "d√¢y", "teo,", "duy√™n", "lo", "kheo", "ƒÉn", "o", "ƒê√™m", "√¥ng", "t∆°", "ƒë√¢u", "ch√¢n", "ƒëi,", "ƒëi", "t√¥i,", "co", "t√¥i"], "unique_count": 19, "pitch_patterns": [["D5"], ["D5", "C5"], ["C5"], ["D5"], ["D5"], ["C5"], ["A4"], ["G4"], ["A4"], ["C5"], ["A4"], ["A4"], ["D5"], ["C5"], ["C5"], ["C5"], ["D5"], ["A4"], ["G4"], ["A4"], ["C5"], ["A4"], ["A4"], ["E5", "D5"], ["C5"], ["D5"], ["C5"], ["C5"], ["D5"], ["D5"], ["A4"], ["G4"], ["A4"], ["C5"], ["A4"], ["A4"]], "average_duration": 2.611111111111111, "syllable_list": ["ƒëi,", "ƒëi", "ƒë√¢u", "ƒëi", "d√¢y", "t∆°", "duy√™n", "√¥ng", "t√¥i", "∆°i", "∆°i", "∆°i.", "teo,", "ch√¢n", "ƒëi", "kheo", "ƒëi", "duy√™n", "√¥ng", "t√¥i", "∆°i", "∆°i", "∆°i.", "o", "o", "o", "ƒê√™m", "co", "ƒÉn", "lo", "duy√™n", "√¥ng", "t√¥i,", "∆°i", "∆°i", "∆°i"]}}, "tone_distribution": {"s·∫Øc": 26, "huy·ªÅn": 48, "h·ªèi": 6, "ng√£": 1, "n·∫∑ng": 2, "ngang": 36}, "most_common_tone": "huy·ªÅn"}, "grace_main_units": [10, 11, 60, 61, 92, 93, 94, 95], "total_notes": 136, "kpic_max_n": 31, "kric_max_n": 24, "ornamentation_stats": {"pitch_ornamentation": {"E5": {"total_occurrences": 14, "ornamented_occurrences": 9, "grace_note_count": 9, "grace_types": ["D5"], "ornamentation_rate": 64.28571428571429}, "G5": {"total_occurrences": 3, "ornamented_occurrences": 2, "grace_note_count": 2, "grace_types": ["E5"], "ornamentation_rate": 66.66666666666666}, "C5": {"total_occurrences": 48, "ornamented_occurrences": 0, "grace_note_count": 0, "grace_types": [], "ornamentation_rate": 0.0}, "A4": {"total_occurrences": 22, "ornamented_occurrences": 0, "grace_note_count": 0, "grace_types": [], "ornamentation_rate": 0.0}, "D5": {"total_occurrences": 11, "ornamented_occurrences": 0, "grace_note_count": 0, "grace_types": [], "ornamentation_rate": 0.0}, "G4": {"total_occurrences": 21, "ornamented_occurrences": 0, "grace_note_count": 0, "grace_types": [], "ornamentation_rate": 0.0}, "D4": {"total_occurrences": 6, "ornamented_occurrences": 0, "grace_note_count": 0, "grace_types": [], "ornamentation_rate": 0.0}}, "syllable_ornamentation": {"R√≠,": {"total_occurrences": 1, "ornamented_occurrences": 1, "grace_note_count": 1, "associated_pitches": ["E5"], "ornamentation_rate": 100.0}, "·ªõi": {"total_occurrences": 1, "ornamented_occurrences": 1, "grace_note_count": 1, "associated_pitches": ["E5"], "ornamentation_rate": 100.0}, "ch·ªën": {"total_occurrences": 1, "ornamented_occurrences": 1, "grace_note_count": 1, "associated_pitches": ["E5"], "ornamentation_rate": 100.0}, "n·ªëi": {"total_occurrences": 1, "ornamented_occurrences": 1, "grace_note_count": 1, "associated_pitches": ["E5"], "ornamentation_rate": 100.0}, "b√©,": {"total_occurrences": 1, "ornamented_occurrences": 1, "grace_note_count": 1, "associated_pitches": ["E5"], "ornamentation_rate": 100.0}, "b√©": {"total_occurrences": 1, "ornamented_occurrences": 1, "grace_note_count": 1, "associated_pitches": ["G5"], "ornamentation_rate": 100.0}, "l√∫c": {"total_occurrences": 2, "ornamented_occurrences": 1, "grace_note_count": 1, "associated_pitches": ["E5"], "ornamentation_rate": 50.0}, "ng√°y,": {"total_occurrences": 1, "ornamented_occurrences": 1, "grace_note_count": 1, "associated_pitches": ["E5"], "ornamentation_rate": 100.0}, "ng√°y": {"total_occurrences": 1, "ornamented_occurrences": 1, "grace_note_count": 1, "associated_pitches": ["G5"], "ornamentation_rate": 100.0}, "bi·∫øng": {"total_occurrences": 1, "ornamented_occurrences": 1, "grace_note_count": 1, "associated_pitches": ["E5"], "ornamentation_rate": 100.0}, "ch·∫≥ng": {"total_occurrences": 1, "ornamented_occurrences": 1, "grace_note_count": 1, "associated_pitches": ["E5"], "ornamentation_rate": 100.0}, "B√†": {"total_occurrences": 2, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "R·∫±ng": {"total_occurrences": 5, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "b√†": {"total_occurrences": 13, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "·ªöi": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["E5"], "ornamentation_rate": 0.0}, "r·∫±ng": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}, "ƒëi,": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["D5"], "ornamentation_rate": 0.0}, "ƒëi": {"total_occurrences": 4, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["D5"], "ornamentation_rate": 0.0}, "l√†": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}, "ƒë√¢u": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "kh·∫Øp": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["E5"], "ornamentation_rate": 0.0}, "d√¢y": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["D5"], "ornamentation_rate": 0.0}, "t∆°": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "h·ªìng": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}, "c√°i": {"total_occurrences": 6, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "duy√™n": {"total_occurrences": 3, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}, "√¥ng": {"total_occurrences": 3, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["G4"], "ornamentation_rate": 0.0}, "ch·ªìng": {"total_occurrences": 5, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["D4"], "ornamentation_rate": 0.0}, "l√†m": {"total_occurrences": 4, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["D4"], "ornamentation_rate": 0.0}, "kh·ªï": {"total_occurrences": 3, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["G4"], "ornamentation_rate": 0.0}, "ƒë·ªùi": {"total_occurrences": 3, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["G4"], "ornamentation_rate": 0.0}, "t√¥i": {"total_occurrences": 2, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}, "∆°i": {"total_occurrences": 7, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "R√≠": {"total_occurrences": 6, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "∆°i.": {"total_occurrences": 2, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}, "Ch·ªìng": {"total_occurrences": 2, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "g√¨": {"total_occurrences": 2, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "m√†": {"total_occurrences": 2, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "t·∫πo": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}, "t√®o": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "teo,": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["D5"], "ornamentation_rate": 0.0}, "ch√¢n": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "c√†": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}, "kheo": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "ph·∫£i": {"total_occurrences": 2, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "c√µng": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["E5"], "ornamentation_rate": 0.0}, "kh√≥c": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["D5"], "ornamentation_rate": 0.0}, "b·ªìng": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}, "o": {"total_occurrences": 3, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["E5"], "ornamentation_rate": 0.0}, "ƒê√™m": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "th·ªùi": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}, "n·∫±m": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}, "co": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "ƒÉn": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["D5"], "ornamentation_rate": 0.0}, "l∆∞·ªùi": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "lo": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["D5"], "ornamentation_rate": 0.0}, "h·ªçc": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["C5"], "ornamentation_rate": 0.0}, "h√†nh": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}, "t√¥i,": {"total_occurrences": 1, "ornamented_occurrences": 0, "grace_note_count": 0, "associated_pitches": ["A4"], "ornamentation_rate": 0.0}}, "total_grace_clusters": 11, "total_main_notes": 125, "total_grace_notes": 11}};
        
        
        let currentHighlighting = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            populateSyllableDropdown();
            updateMinCountDisplay();
            updateMaxLabels();

            // Set default Y-zoom to 30%
            updateYZoom(currentYZoom);

            // Initialize slider label positions
            initializeSliderPositions();

            // Load auto-scroll preference
            loadAutoScrollPreference();

            // Initialize KPIC/KRIC thresholds to prevent 'none' state issues
            // Don't set sliders or call update functions, just ensure variables are ready
            if (!window.kpicThreshold) {
                window.kpicThreshold = 'none';  // Explicit initialization
            }
            if (!window.kricThreshold) {
                window.kricThreshold = 'none';  // Explicit initialization
            }

            // Add listener for analysis mode changes
            document.getElementById('analysisMode').addEventListener('change', function() {
                // Refresh pattern options when analysis mode changes
                updateKpicPatternOptions();
                updateKricPatternOptions();
            });

            // Initialize synchronization system
            setTimeout(() => {
                addSankeyClickHandlers();
                addTablaturePatternSync();
                console.log('‚úÖ Synchronization system initialized');
            }, 1000); // Wait for Sankey generation
        });
        
        function populateSyllableDropdown() {
            const select = document.getElementById('specificSyllable');
            select.innerHTML = '';
            
            // Use all_syllables data which includes both repeated and single syllables
            const sortedSyllables = Object.entries(analysisData.all_syllables)
                .sort((a, b) => {
                    if (b[1].count !== a[1].count) return b[1].count - a[1].count; // By frequency
                    return a[0].localeCompare(b[0]); // Then alphabetically
                });
            
            sortedSyllables.forEach(([syllable, data]) => {
                const option = document.createElement('option');
                option.value = syllable;
                option.textContent = data.count > 1 ? `${syllable} (${data.count}√ó)` : syllable;
                select.appendChild(option);
            });
        }
        
        function updateMaxLabels() {
            // Update KPIC-MAX label to show actual n value
            const kpicSelect = document.getElementById('kpicFilter');
            if (kpicSelect) {
                const kpicMaxOption = kpicSelect.querySelector('option[value="kpic-max"]');
                if (kpicMaxOption) {
                    kpicMaxOption.textContent = `KPIC-MAX (KPIC-${analysisData.kpic_max_n} with 2+ reps)`;
                }
            }

            // Update KRIC-MAX label to show actual n value
            const kricSelect = document.getElementById('kricFilter');
            if (kricSelect) {
                const kricMaxOption = kricSelect.querySelector('option[value="kric-max"]');
                if (kricMaxOption) {
                    kricMaxOption.textContent = `KRIC-MAX (KRIC-${analysisData.kric_max_n} with 2+ reps)`;
                }
            }
        }
        
        function updateZoomFromSelect() {
            const zoomSelect = document.getElementById('zoomLevel');
            const xSlider = document.getElementById('xZoomSlider');
            const xValue = document.getElementById('xZoomValue');
            
            if (zoomSelect.value === 'fit-width') {
                // Calculate fit-to-width zoom level
                const fitZoomLevel = calculateFitWidthZoom();
                const fitPercent = Math.round(fitZoomLevel * 100);
                currentXZoom = fitZoomLevel;
                xSlider.value = fitPercent;
                xValue.textContent = fitPercent + '%';
                updateZoom();
            } else if (zoomSelect.value === 'custom') {
                // Use current stored zoom value
                updateZoom();
            } else {
                // Update slider to match selected value
                const zoomPercent = Math.round(parseFloat(zoomSelect.value) * 100);
                currentXZoom = parseFloat(zoomSelect.value);
                xSlider.value = zoomPercent;
                xValue.textContent = zoomPercent + '%';
                updateZoom();
            }
        }
        
        function calculateFitWidthZoom() {
            const svg = document.getElementById('tablatureSvg');
            const container = document.querySelector('.tablature-container');

            // Calculate available width, accounting for right bar chart
            const viewportWidth = window.innerWidth;
            const rightBarChartWidth = rightBarChartVisible ? 340 : 0; // 300px + 40px gap (more space)
            const availableWidth = viewportWidth - rightBarChartWidth - 150; // More conservative padding

            // Use the original SVG base width which already includes all content + padding
            const baseWidth = parseInt(svg.getAttribute('data-base-width'));

            // Calculate fit zoom to make tablature touch the right bar chart
            const fitZoomLevel = availableWidth / baseWidth;

            // Be much more conservative with the zoom to ensure proper spacing
            const conservativeFitZoom = fitZoomLevel * 0.8; // Use 80% for more space

            return Math.max(0.01, Math.min(5.0, conservativeFitZoom));
        }
        
        function updateZoomFromInput() {
            const customZoomInput = document.getElementById('customZoom');
            const zoomSelect = document.getElementById('zoomLevel');
            
            // Set dropdown to custom when user types
            zoomSelect.value = 'custom';
            updateZoom();
        }
        
        let currentXZoom = 1.0;
        let currentYZoom = 0.30;
        
        function updateZoomFromSlider(axis) {
            if (axis === 'x') {
                const xSlider = document.getElementById('xZoomSlider');
                const xValue = document.getElementById('xZoomValue');
                const zoomSelect = document.getElementById('zoomLevel');
                
                const sliderValue = parseInt(xSlider.value);
                xValue.textContent = sliderValue + '%';

                // Position the value label directly above the slider handle
                const percentage = ((sliderValue - 5) / (200 - 5)) * 100;
                const sliderWidth = 100;
                const handleWidth = 20;
                const leftPosition = (percentage / 100) * (sliderWidth - handleWidth) + (handleWidth / 2) - 0;
                xValue.style.left = `${Math.max(0, Math.min(leftPosition, sliderWidth - 30))}px`;

                // Store current zoom level
                currentXZoom = sliderValue / 100;

                // Update the zoom select to custom
                zoomSelect.value = 'custom';
                updateZoom();
            } else if (axis === 'y') {
                const ySlider = document.getElementById('yZoomSlider');
                const yValue = document.getElementById('yZoomValue');
                const yZoomSelect = document.getElementById('yZoomLevel');
                
                const sliderValue = parseInt(ySlider.value);
                yValue.textContent = sliderValue + '%';

                // Position the value label directly above the slider handle
                const percentage = ((sliderValue - 5) / (300 - 5)) * 100;
                const sliderWidth = 100;
                const handleWidth = 20;
                const leftPosition = (percentage / 100) * (sliderWidth - handleWidth) + (handleWidth / 2) - 0;
                yValue.style.left = `${Math.max(0, Math.min(leftPosition, sliderWidth - 30))}px`;

                // Store current zoom level
                currentYZoom = sliderValue / 100;

                // Update the Y-zoom select to custom
                yZoomSelect.value = 'custom';
                updateYZoom(currentYZoom);
            }
        }
        
        function updateYZoomFromSelect() {
            const yZoomSelect = document.getElementById('yZoomLevel');
            const ySlider = document.getElementById('yZoomSlider');
            const yValue = document.getElementById('yZoomValue');
            
            if (yZoomSelect.value === 'fit-height') {
                const fitZoomLevel = calculateFitHeightZoom();
                const fitPercent = Math.round(fitZoomLevel * 100);
                currentYZoom = fitZoomLevel;
                ySlider.value = fitPercent;
                yValue.textContent = fitPercent + '%';
                updateYZoom(currentYZoom);
            } else if (yZoomSelect.value === 'custom') {
                // Use current stored zoom value
                updateYZoom(currentYZoom);
            } else {
                // Update slider to match selected value
                const zoomPercent = Math.round(parseFloat(yZoomSelect.value) * 100);
                currentYZoom = parseFloat(yZoomSelect.value);
                ySlider.value = zoomPercent;
                yValue.textContent = zoomPercent + '%';
                updateYZoom(currentYZoom);
            }
        }
        
        function calculateFitHeightZoom() {
            const svg = document.getElementById('tablatureSvg');
            const container = window;
            const availableHeight = container.innerHeight - 300; // Reserve space for controls and margins
            
            const baseHeight = parseInt(svg.getAttribute('data-base-height') || svg.getAttribute('height'));
            const fitZoomLevel = availableHeight / baseHeight;
            
            // Be conservative to ensure no cutoff
            const conservativeFitZoom = fitZoomLevel * 0.9;
            
            return Math.max(0.05, Math.min(2.0, conservativeFitZoom));
        }
        
        function updateYZoom(yZoomLevel) {
            const svg = document.getElementById('tablatureSvg');
            const baseHeight = parseInt(svg.getAttribute('data-base-height') || svg.getAttribute('height'));
            
            if (!svg.getAttribute('data-base-height')) {
                svg.setAttribute('data-base-height', baseHeight);
            }
            
            // Scale the SVG height
            const newHeight = baseHeight * yZoomLevel;
            svg.setAttribute('height', newHeight);
            
            // Scale string line positions
            const stringLines = svg.querySelectorAll('.string-line');
            const stringLabels = svg.querySelectorAll('.string-label');
            const stringNumbers = svg.querySelectorAll('.string-number');
            const notes = svg.querySelectorAll('.note-circle');

            // Find all resonance bands including dynamically created ones
            const allRects = svg.querySelectorAll('rect');
            const resonanceBands = Array.from(allRects).filter(rect => {
                // Exclude the background rect
                if (rect === allRects[0] && rect.getAttribute('width') === '11475') {
                    return false;
                }

                const fill = rect.getAttribute('fill');
                const dataBaseX = rect.getAttribute('data-base-x');
                const dataBaseY = rect.getAttribute('data-base-y');
                const isColored = rect.classList.contains('resonance-band-colored');
                const hasColorFill = fill && (fill.startsWith('#') || fill.startsWith('rgb'));
                const height = parseFloat(rect.getAttribute('height'));
                const isResonanceBandSize = height === 10 || height === 6;

                // Find resonance bands by various criteria
                return isColored ||
                       (fill && (fill.includes('resonanceBand') || fill.includes('dynamicResonance'))) ||
                       (dataBaseX && dataBaseY && isResonanceBandSize) ||
                       (hasColorFill && dataBaseX && dataBaseY && isResonanceBandSize);
            });

            const allTexts = svg.querySelectorAll('text');
            
            // Update string lines and labels
            stringLines.forEach((line) => {
                const baseY = parseFloat(line.getAttribute('data-base-y1') || line.getAttribute('y1'));
                if (!line.getAttribute('data-base-y1')) {
                    line.setAttribute('data-base-y1', baseY);
                    line.setAttribute('data-base-y2', baseY);
                }
                const scaledY = baseY * yZoomLevel;
                line.setAttribute('y1', scaledY);
                line.setAttribute('y2', scaledY);
            });
            
            stringLabels.forEach((label) => {
                const baseY = parseFloat(label.getAttribute('data-base-y') || label.getAttribute('y'));
                if (!label.getAttribute('data-base-y')) {
                    label.setAttribute('data-base-y', baseY);
                }
                const scaledY = baseY * yZoomLevel;
                label.setAttribute('y', scaledY);
            });
            
            // String numbers will be handled with other text elements to maintain offset from notes
            
            // Update note positions
            notes.forEach((note) => {
                const baseY = parseFloat(note.getAttribute('data-base-y') || note.getAttribute('cy'));
                if (!note.getAttribute('data-base-y')) {
                    note.setAttribute('data-base-y', baseY);
                }
                const scaledY = baseY * yZoomLevel;
                note.setAttribute('cy', scaledY);
            });
            
            // Update resonance bands - center them with scaled note positions
            resonanceBands.forEach((band) => {
                // Find the corresponding note for this band
                // Band should be just before its note in the DOM
                let associatedNote = band.nextElementSibling;
                while (associatedNote && !associatedNote.classList.contains('note-circle')) {
                    associatedNote = associatedNote.nextElementSibling;
                }

                if (associatedNote) {
                    // Get the note's base (unscaled) center position
                    const noteBaseY = parseFloat(associatedNote.getAttribute('data-base-y') || associatedNote.getAttribute('cy'));

                    // Store note's base-y if not already stored
                    if (!associatedNote.getAttribute('data-base-y')) {
                        associatedNote.setAttribute('data-base-y', noteBaseY);
                    }

                    // Get band height to center it
                    const bandHeight = parseFloat(band.getAttribute('height'));

                    // Calculate and store the band's base (unscaled) Y position if not already stored
                    if (!band.getAttribute('data-base-y')) {
                        const baseBandY = noteBaseY - (bandHeight / 2);
                        band.setAttribute('data-base-y', baseBandY);
                    }

                    // Get the stored base position and scale it
                    const baseBandY = parseFloat(band.getAttribute('data-base-y'));
                    const scaledBandY = baseBandY * yZoomLevel;
                    band.setAttribute('y', scaledBandY);
                } else {
                    // Fallback: just scale the position
                    const baseY = parseFloat(band.getAttribute('data-base-y') || band.getAttribute('y'));
                    if (!band.getAttribute('data-base-y')) {
                        band.setAttribute('data-base-y', baseY);
                    }
                    const scaledY = baseY * yZoomLevel;
                    band.setAttribute('y', scaledY);
                }
            });
            
            // Update text elements with improved anchoring to note circles
            allTexts.forEach((text) => {
                // Skip only string labels (on the left side)
                if (text.classList.contains('string-label')) {
                    return;
                }

                const baseY = parseFloat(text.getAttribute('data-base-y') || text.getAttribute('y'));
                const baseX = parseFloat(text.getAttribute('data-base-x') || text.getAttribute('x'));

                if (!text.getAttribute('data-base-y') && text.getAttribute('y')) {
                    text.setAttribute('data-base-y', baseY);
                }
                if (!text.getAttribute('data-base-x') && text.getAttribute('x')) {
                    text.setAttribute('data-base-x', baseX);
                }

                if (text.getAttribute('data-base-y')) {
                    // Find the exact note at the same X position (same column)
                    const noteElements = svg.querySelectorAll('.note-circle');
                    let associatedNote = null;
                    let minDistance = Infinity;

                    noteElements.forEach(note => {
                        const noteBaseX = parseFloat(note.getAttribute('data-base-x') || note.getAttribute('cx'));
                        const distance = Math.abs(baseX - noteBaseX);

                        // Look for exact X match (same column) with small tolerance
                        // String numbers, duration, position all have same X as note
                        // Lyrics have X+4 offset
                        if (distance < 5 && distance < minDistance) {
                            minDistance = distance;
                            associatedNote = note;
                        }
                    });

                    if (associatedNote) {
                        // Found the exact note this text belongs to
                        const noteBaseY = parseFloat(associatedNote.getAttribute('data-base-y') || associatedNote.getAttribute('cy'));
                        const scaledNoteY = noteBaseY * yZoomLevel;

                        // For lyrics, keep fixed distance (40px) from note
                        // For other text, scale with note position
                        let scaledY;
                        if (text.classList.contains('lyric-text')) {
                            // Lyrics: fixed 40px offset from note (don't scale)
                            scaledY = scaledNoteY + 40;
                        } else {
                            // Other text: maintain original scaled offset
                            const originalOffset = baseY - noteBaseY;
                            scaledY = scaledNoteY + originalOffset;
                        }

                        text.setAttribute('y', scaledY);

                        // Debug specific elements
                        if (text.classList.contains('string-number') && minDistance < 1) {
                            console.log(`String number: baseY=${baseY}, noteBaseY=${noteBaseY}, scaledY=${scaledY}`);
                        }

                        // Update transforms for rotated text (lyrics)
                        const transform = text.getAttribute('transform');
                        if (transform && transform.includes('rotate')) {
                            const x = parseFloat(text.getAttribute('x'));
                            text.setAttribute('transform', `rotate(-90, ${x}, ${scaledY})`);
                        }
                    } else {
                        // Fallback: scale the Y position directly
                        const scaledY = baseY * yZoomLevel;
                        text.setAttribute('y', scaledY);

                        const transform = text.getAttribute('transform');
                        if (transform && transform.includes('rotate')) {
                            const x = parseFloat(text.getAttribute('x'));
                            text.setAttribute('transform', `rotate(-90, ${x}, ${scaledY})`);
                        }
                    }
                }
            });
            
            // Update connection lines
            const connectionLines = svg.querySelectorAll('.pattern-connection-line');
            connectionLines.forEach((line) => {
                const baseY1 = parseFloat(line.getAttribute('data-base-y1') || line.getAttribute('y1'));
                const baseY2 = parseFloat(line.getAttribute('data-base-y2') || line.getAttribute('y2'));
                
                if (!line.getAttribute('data-base-y1')) {
                    line.setAttribute('data-base-y1', baseY1);
                    line.setAttribute('data-base-y2', baseY2);
                }
                
                line.setAttribute('y1', baseY1 * yZoomLevel);
                line.setAttribute('y2', baseY2 * yZoomLevel);
            });

            // Don't reapply colors after Y-zoom - only if needed
            setTimeout(() => {
                const bandsAfter = svg.querySelectorAll('rect[data-base-x][data-base-y]');
                const needsColorUpdate = Array.from(bandsAfter).some(band => {
                    const fill = band.getAttribute('fill');
                    return fill && fill.includes('url(#resonanceBand');
                });

                if (needsColorUpdate) {
                    // updateResonanceBandColors(); // Commented out to preserve gradients
                }
            }, 50);

            // Update KP/RIC-1 right bar chart when tablature Y-zoom changes
            console.log('üîÑ Y-zoom changed, updating KP/RIC-1. Visible:', typeof rightBarChartVisible !== 'undefined' ? rightBarChartVisible : 'UNDEFINED');
            if (typeof rightBarChartVisible !== 'undefined' && rightBarChartVisible) {
                console.log('üìä Updating KP/RIC-1 chart for Y-zoom:', yZoomLevel);
                updateRightBarChartZoom();
            }
        }
        
        function getCurrentZoomLevel() {
            const zoomSelect = document.getElementById('zoomLevel');
            
            if (zoomSelect.value === 'fit-width') {
                return calculateFitWidthZoom();
            } else if (zoomSelect.value === 'custom') {
                return currentXZoom;
            } else {
                return parseFloat(zoomSelect.value);
            }
        }
        
        function updateZoom() {
            const zoomLevel = getCurrentZoomLevel();
            const svg = document.getElementById('tablatureSvg');
            const baseWidth = parseInt(svg.getAttribute('data-base-width'));

            // Store resonance band info before any changes
            const bandsBeforeZoom = svg.querySelectorAll('.resonance-band-colored, rect[fill*="#008080"], rect[fill*="#FFD700"]');
            const bandInfo = Array.from(bandsBeforeZoom).map(band => ({
                x: band.getAttribute('x'),
                y: band.getAttribute('y'),
                width: band.getAttribute('width'),
                height: band.getAttribute('height'),
                fill: band.getAttribute('fill'),
                opacity: band.getAttribute('opacity') || band.style.opacity,
                class: band.className.baseVal || band.className
            }));
            console.log(`Preserving ${bandInfo.length} bands before zoom`);

            // Scale the SVG width
            const newWidth = baseWidth * zoomLevel;
            svg.setAttribute('width', newWidth);
            
            // Scale all note positions and widths
            const notes = svg.querySelectorAll('.note-circle');
            const allRects = svg.querySelectorAll('rect');
            const resonanceBands = Array.from(allRects).filter(rect => {
                // Exclude the background rect (first rect with full width)
                if (rect === allRects[0] && rect.getAttribute('width') === '11475') {
                    return false;
                }

                const fill = rect.getAttribute('fill');
                const dataBaseX = rect.getAttribute('data-base-x');
                const dataBaseY = rect.getAttribute('data-base-y');
                const isColored = rect.classList.contains('resonance-band-colored');
                const isNewBand = rect.classList.contains('new-resonance-band');
                const hasColorFill = fill && (fill.startsWith('#') || fill.startsWith('rgb'));
                const height = parseFloat(rect.getAttribute('height'));

                // Resonance bands are typically 10px or 6px in height
                const isResonanceBandSize = height === 10 || height === 6;

                // Find resonance bands by various criteria
                return isNewBand || isColored ||
                       (fill && (fill.includes('resonanceBand') || fill.includes('dynamicResonance'))) ||
                       (dataBaseX && dataBaseY && isResonanceBandSize) ||
                       (hasColorFill && dataBaseX && dataBaseY && isResonanceBandSize);
            });
            const texts = svg.querySelectorAll('text');

            // Get container width to determine if scrolling is needed
            const container = document.querySelector('.tablature-container');
            const containerWidth = container.clientWidth;
            const needsScrolling = newWidth > containerWidth;

            notes.forEach((note, index) => {
                const baseX = parseFloat(note.getAttribute('data-base-x') || note.getAttribute('cx'));
                if (!note.getAttribute('data-base-x')) {
                    note.setAttribute('data-base-x', baseX);
                }
                // Apply zoom proportionally, maintaining relative spacing
                // Start notes at 120px but scale the offset proportionally
                const baseOffset = baseX - 120; // Distance from starting position
                const scaledOffset = baseOffset * zoomLevel;
                const scaledX = 120 + scaledOffset;
                note.setAttribute('cx', scaledX);
            });

            console.log(`Found ${resonanceBands.length} resonance bands to scale in X-zoom`);
            console.log(`- Colored bands: ${resonanceBands.filter(r => r.classList.contains('resonance-band-colored')).length}`);
            console.log(`- Gradient bands: ${resonanceBands.filter(r => r.getAttribute('fill')?.includes('resonanceBand')).length}`);

            // Scale resonance band positions
            resonanceBands.forEach((band, index) => {
                const baseX = parseFloat(band.getAttribute('data-base-x') || band.getAttribute('x'));
                const baseWidth = parseFloat(band.getAttribute('data-base-width') || band.getAttribute('width'));
                const height = band.getAttribute('height'); // Preserve height

                if (!band.getAttribute('data-base-x')) {
                    band.setAttribute('data-base-x', baseX);
                    band.setAttribute('data-base-width', baseWidth);
                }

                // Apply same scaling as notes for position
                const baseOffset = baseX - 120;
                const scaledOffset = baseOffset * zoomLevel;
                const scaledX = 120 + scaledOffset;

                // Scale width with zoom but always 8 eighth-note durations
                // Base: 320px for main bands (8 eighth notes), 80px for grace bands
                const isGraceBand = parseFloat(band.getAttribute('height')) === 6;
                const baseFixedWidth = isGraceBand ? 80 : 320;
                const scaledWidth = baseFixedWidth * zoomLevel;

                band.setAttribute('x', scaledX);
                band.setAttribute('width', scaledWidth);

                // Ensure height is preserved
                if (height) {
                    band.setAttribute('height', height);
                }

                // Make sure band stays visible with proper opacity
                const currentOpacity = band.getAttribute('opacity') || band.style.opacity;
                if (!currentOpacity || currentOpacity === '0') {
                    band.setAttribute('opacity', '0.8');
                    band.style.opacity = '0.8';
                }

                if (index === 0) {
                    console.log(`First band scaled: baseX=${baseX} -> scaledX=${scaledX}, width=${scaledWidth}`);
                    console.log(`  fill=${band.getAttribute('fill')}, opacity=${band.getAttribute('opacity')}, class=${band.className}`);
                }
            });
            
            
            // Scale text positions (notes and lyrics, not string labels)
            texts.forEach((text, index) => {
                const baseX = parseFloat(text.getAttribute('data-base-x') || text.getAttribute('x'));
                if (!text.getAttribute('data-base-x')) {
                    text.setAttribute('data-base-x', baseX);
                }

                // Scale string numbers with their notes
                if (text.classList.contains('string-number')) {
                    // String numbers should move with their notes
                    if (baseX > 100) { // Only scale if it's associated with a note (not a label)
                        const baseOffset = baseX - 120;
                        const scaledOffset = baseOffset * zoomLevel;
                        const scaledX = 120 + scaledOffset;
                        text.setAttribute('x', scaledX);
                    }
                }
                // Only scale note-related text (x > 120), keep string labels fixed
                else if (baseX > 120) {
                    const baseOffset = baseX - 120;
                    const scaledOffset = baseOffset * zoomLevel;
                    const scaledX = 120 + scaledOffset;
                    text.setAttribute('x', scaledX);

                    // For lyric text with rotation, update the transform with current Y position
                    if (text.classList.contains('lyric-text')) {
                        const currentY = parseFloat(text.getAttribute('y'));
                        text.setAttribute('transform', `rotate(-90, ${scaledX}, ${currentY})`);
                    }
                }
            });
            
            // Scale connection lines
            const connectionLines = svg.querySelectorAll('.pattern-connection-line');
            connectionLines.forEach((line, index) => {
                const baseX1 = parseFloat(line.getAttribute('data-base-x1') || line.getAttribute('x1'));
                const baseX2 = parseFloat(line.getAttribute('data-base-x2') || line.getAttribute('x2'));
                
                if (!line.getAttribute('data-base-x1')) {
                    line.setAttribute('data-base-x1', baseX1);
                    line.setAttribute('data-base-x2', baseX2);
                }
                
                // Apply zoom scaling to X coordinates
                const baseOffset1 = baseX1 - 120;
                const baseOffset2 = baseX2 - 120;
                const scaledOffset1 = baseOffset1 * zoomLevel;
                const scaledOffset2 = baseOffset2 * zoomLevel;
                const scaledX1 = 120 + scaledOffset1;
                const scaledX2 = 120 + scaledOffset2;
                
                line.setAttribute('x1', scaledX1);
                line.setAttribute('x2', scaledX2);
                // Y coordinates don't change with X-axis zoom
            });
            
            // Update string lines to extend beyond the last note
            const stringLines = svg.querySelectorAll('.string-line');
            
            // Find the rightmost note position after scaling
            let maxNoteX = 120; // Minimum starting position
            notes.forEach((note) => {
                const noteX = parseFloat(note.getAttribute('cx'));
                maxNoteX = Math.max(maxNoteX, noteX);
            });
            
            // Extend string lines beyond the last note with padding
            const lineEndX = maxNoteX + 100; // Add 100px padding beyond last note
            
            stringLines.forEach((line) => {
                line.setAttribute('x2', lineEndX);
            });
            
            // Also update SVG width if needed to accommodate the extended lines
            if (lineEndX > newWidth) {
                svg.setAttribute('width', lineEndX + 50);
            }
            
            // Update container scroll behavior based on actual content size vs container size
            if (needsScrolling) {
                container.style.overflowX = 'auto';
                container.style.overflowY = 'hidden';
            } else {
                container.style.overflowX = 'hidden';
                container.style.overflowY = 'hidden';
            }

            // After zoom, ensure resonance bands are in the correct rendering order
            setTimeout(() => {
                console.log('Ensuring resonance band rendering order after X-zoom');

                // Get all bands and notes
                const bands = svg.querySelectorAll('rect[data-base-x][data-base-y]');
                const notes = svg.querySelectorAll('.note-circle');

                console.log(`Found ${bands.length} bands and ${notes.length} notes after zoom`);

                // Check actual visibility of bands
                let visibleCount = 0;
                let hiddenCount = 0;
                let outOfBoundsCount = 0;

                bands.forEach((band, index) => {
                    const rect = band.getBoundingClientRect();
                    const computedStyle = window.getComputedStyle(band);
                    const svgRect = svg.getBoundingClientRect();

                    const isVisible = rect.width > 0 && rect.height > 0 &&
                                    computedStyle.display !== 'none' &&
                                    computedStyle.visibility !== 'hidden' &&
                                    computedStyle.opacity !== '0';

                    const isInBounds = rect.left < svgRect.right && rect.right > svgRect.left;

                    if (isVisible && isInBounds) {
                        visibleCount++;
                    } else if (!isVisible) {
                        hiddenCount++;
                    } else {
                        outOfBoundsCount++;
                    }

                    // Debug first band in detail
                    if (index === 0) {
                        console.log(`First band details:
                            Position: x=${band.getAttribute('x')}, y=${band.getAttribute('y')}
                            Size: width=${band.getAttribute('width')}, height=${band.getAttribute('height')}
                            Fill: ${band.getAttribute('fill')}
                            Opacity: attr=${band.getAttribute('opacity')}, style=${band.style.opacity}, computed=${computedStyle.opacity}
                            Display: style=${band.style.display}, computed=${computedStyle.display}
                            Visibility: style=${band.style.visibility}, computed=${computedStyle.visibility}
                            BoundingRect: ${rect.width}x${rect.height} at (${rect.left}, ${rect.top})
                            SVG BoundingRect: ${svgRect.width}x${svgRect.height} at (${svgRect.left}, ${svgRect.top})`);
                    }
                });

                console.log(`Band visibility: ${visibleCount} visible, ${hiddenCount} hidden, ${outOfBoundsCount} out of bounds`);

                // Ensure all bands are positioned before notes in the DOM
                // This ensures bands render behind notes
                if (bands.length > 0 && notes.length > 0) {
                    const firstNote = notes[0];
                    const firstNoteParent = firstNote.parentNode;

                    // Move all bands to be before the first note
                    bands.forEach(band => {
                        // Only move if it's not already before the first note
                        if (band.compareDocumentPosition(firstNote) & Node.DOCUMENT_POSITION_FOLLOWING) {
                            firstNoteParent.insertBefore(band, firstNote);
                        }

                        // Force visibility but don't override gradient fill
                        band.setAttribute('style', `
                            opacity: 0.9 !important;
                            display: block !important;
                            visibility: visible !important;
                            pointer-events: none !important;
                        `);

                        // Ensure proper opacity attribute too
                        band.setAttribute('opacity', '0.8');
                    });

                    console.log('Resonance bands repositioned in DOM hierarchy');
                }

                // Only update colors if bands have lost their colors (first time setup)
                const needsColorUpdate = Array.from(bands).some(band => {
                    const fill = band.getAttribute('fill');
                    return fill && fill.includes('url(#resonanceBand');
                });

                if (needsColorUpdate) {
                    console.log('Keeping gradient bands - not applying solid colors');
                    // updateResonanceBandColors(); // Commented out to preserve gradients
                }
            }, 50);
        }
        
        function updateKpicPatternOptions() {
            const kpicFilter = window.kpicThreshold || 'none';
            const patternSelect = document.getElementById('specificKpicPattern');

            // CRITICAL: Save current selections before rebuilding dropdown
            const previousSelections = Array.from(patternSelect.selectedOptions).map(opt => ({
                value: opt.value,
                text: opt.textContent
            }));
            console.log('updateKpicPatternOptions: Saving selections:', previousSelections);

            if (kpicFilter === 'none') {
                // Show placeholder text when no filter selected
                patternSelect.innerHTML = '<option disabled style="text-align: center; color: #6c757d;">Move KPIC slider to see patterns...</option>';
                // Don't call updateHighlighting here to avoid clearing selections
                return;
            }

            // Populate with actual patterns based on current analysis mode
            const analysisMode = document.querySelector('input[name="analysisMode"]:checked')?.value || 'full';
            const modePatterns = analysisData.kpic_patterns[analysisMode] || analysisData.kpic_patterns.full;
            let patterns = modePatterns[kpicFilter] || [];

            // For ALL KPIC levels, include ALL patterns (even single occurrences)
            if (kpicFilter !== 'none' && kpicFilter.startsWith('kpic-')) {
                // Get all transitions from the note data
                const noteCircles = document.querySelectorAll('.note-circle');
                const allTransitions = {};

                // Build string mapping
                const stringLabels = document.querySelectorAll('.string-label');
                const stringLines = document.querySelectorAll('.string-line');
                const stringInfo = {};

                stringLines.forEach(line => {
                    const yPos = parseFloat(line.getAttribute('data-base-y1') || line.getAttribute('y1'));
                    let closestLabel = null;
                    let minDistance = Infinity;
                    stringLabels.forEach(label => {
                        const labelY = parseFloat(label.getAttribute('data-base-y') || label.getAttribute('y'));
                        const distance = Math.abs(yPos - labelY);
                        if (distance < minDistance && distance < 20) {
                            minDistance = distance;
                            closestLabel = label;
                        }
                    });
                    if (closestLabel) {
                        const text = closestLabel.textContent;
                        const match = text.match(/String (\d+): ([A-G]#?\d)/);
                        if (match) {
                            stringInfo[match[1]] = {
                                note: match[2],
                                yPos: yPos
                            };
                        }
                    }
                });

                // Extract the n-gram size from kpicFilter (e.g., 'kpic-2' -> 2)
                const ngramSize = parseInt(kpicFilter.split('-')[1]);

                // Find all n-note transitions
                for (let i = 0; i <= noteCircles.length - ngramSize; i++) {
                    const pattern = [];
                    let allPitchesFound = true;

                    // Build the n-gram pattern
                    for (let j = 0; j < ngramSize; j++) {
                        const note = noteCircles[i + j];
                        const cy = parseFloat(note.getAttribute('data-base-y') || note.getAttribute('cy'));

                        // Find closest string
                        let pitch = null;
                        let minDist = Infinity;

                        for (const [stringNum, info] of Object.entries(stringInfo)) {
                            const dist = Math.abs(cy - info.yPos);
                            if (dist < minDist && dist < 30) {
                                minDist = dist;
                                pitch = info.note;
                            }
                        }

                        if (pitch) {
                            pattern.push(pitch);
                        } else {
                            allPitchesFound = false;
                            break;
                        }
                    }

                    if (allPitchesFound && pattern.length === ngramSize) {
                        const key = pattern.join(',');
                        if (!allTransitions[key]) {
                            allTransitions[key] = {
                                pattern: pattern,
                                positions: [],
                                count: 0
                            };
                        }
                        allTransitions[key].positions.push(i);
                        allTransitions[key].count++;
                    }
                }

                // Filter existing patterns to only include correct n-gram size
                patterns = patterns.filter(p => p.pattern.length === ngramSize);

                // Add missing patterns (including single occurrences)
                Object.values(allTransitions).forEach(trans => {
                    // Check if this pattern already exists
                    const exists = patterns.some(p =>
                        JSON.stringify(p.pattern) === JSON.stringify(trans.pattern)
                    );

                    if (!exists) {
                        patterns.push(trans);
                    }
                });

                // Sort patterns by count (descending) then by pattern string
                patterns.sort((a, b) => {
                    if (b.count !== a.count) return b.count - a.count;
                    return JSON.stringify(a.pattern).localeCompare(JSON.stringify(b.pattern));
                });

                // Calculate total for verification
                const dropdownTotal = patterns.reduce((sum, p) => sum + p.count, 0);
                console.log('üìä KPIC-2 DROPDOWN VERIFICATION:');
                console.log(`Patterns in dropdown: ${patterns.length}`);
                console.log(`Total count in dropdown: ${dropdownTotal}`);
                console.log('Pattern details:', patterns.map(p => `${p.pattern.join('‚Üí')}(${p.count}√ó)`));

                // Update the patterns in analysisData for consistency
                // FIX: Use the actual kpicFilter value, not hardcoded 'kpic-2'
                modePatterns[kpicFilter] = patterns;
            }

            patternSelect.innerHTML = '';

            if (patterns.length === 0) {
                patternSelect.innerHTML = '<option disabled style="text-align: center; color: #6c757d;">No patterns found for this threshold</option>';
            } else {
                patterns.forEach((pattern, index) => {
                    const option = document.createElement('option');
                    option.value = index;

                    // Add grace prefixes to pitch names where applicable
                    const graceNoteIndices = [3, 10, 19, 21, 49, 51, 60, 92, 94, 107, 109];

                    // Create a summary showing the most common grace/main form of this pattern
                    const displayPattern = pattern.pattern.map((pitch, noteIndex) => {
                        // Check if this note position tends to be grace across all occurrences
                        let graceCount = 0;
                        let totalCount = 0;

                        pattern.positions.forEach(startPos => {
                            const absoluteNoteIndex = startPos + noteIndex;
                            if (graceNoteIndices.includes(absoluteNoteIndex)) {
                                graceCount++;
                            }
                            totalCount++;
                        });

                        // If majority of occurrences are grace notes, show grace prefix
                        const isMainlyGrace = graceCount > totalCount / 2;
                        return isMainlyGrace ? 'g' + pitch : pitch;
                    });

                    const label = pattern.count === 1 ?
                        `${displayPattern.join(' ‚Üí ')} (1√ó) [single]` :
                        `${displayPattern.join(' ‚Üí ')} (${pattern.count}√ó)`;
                    option.textContent = label;
                    patternSelect.appendChild(option);
                });

                // CRITICAL: Restore previous selections after rebuilding dropdown
                if (previousSelections.length > 0) {
                    console.log('updateKpicPatternOptions: Restoring selections');
                    previousSelections.forEach(prev => {
                        // Find the option with matching text (since indices might have changed)
                        for (let i = 0; i < patternSelect.options.length; i++) {
                            if (patternSelect.options[i].textContent === prev.text) {
                                patternSelect.options[i].selected = true;
                                console.log('Restored selection:', prev.text);
                                break;
                            }
                        }
                    });
                }
            }

            // Don't call updateHighlighting here - let the caller decide when to update
        }
        
        function updateKricPatternOptions() {
            const kricFilter = window.kricThreshold || 'none';
            const patternSelect = document.getElementById('specificKricPattern');

            // CRITICAL: Save current selections before rebuilding dropdown
            const previousSelections = Array.from(patternSelect.selectedOptions).map(opt => ({
                value: opt.value,
                text: opt.textContent
            }));

            if (kricFilter === 'none') {
                // Show placeholder text when no filter selected
                patternSelect.innerHTML = '<option disabled style="text-align: center; color: #6c757d;">Move KRIC slider to see patterns...</option>';
                // Don't call updateHighlighting here to avoid clearing selections
                return;
            }

            // Generate KRIC patterns if not already generated
            if (!window.kricPatterns) {
                generateKricPatterns();
            }

            // Get patterns for the current filter
            const patterns = window.kricPatterns[kricFilter] || [];
            patternSelect.innerHTML = '';

            if (patterns.length === 0) {
                patternSelect.innerHTML = '<option disabled style="text-align: center; color: #6c757d;">No patterns found for this threshold</option>';
            } else {
                // Include ALL patterns (even single occurrences)
                patterns.forEach((pattern, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    // Convert duration values to readable note names
                    const readablePattern = pattern.pattern.map(duration => durationToNoteName(duration));
                    option.textContent = `${readablePattern.join(' ‚Üí ')} (${pattern.count}√ó)`;
                    patternSelect.appendChild(option);
                });

                // CRITICAL: Restore previous selections after rebuilding dropdown
                if (previousSelections.length > 0) {
                    previousSelections.forEach(prev => {
                        for (let i = 0; i < patternSelect.options.length; i++) {
                            if (patternSelect.options[i].textContent === prev.text) {
                                patternSelect.options[i].selected = true;
                                break;
                            }
                        }
                    });
                }
            }

            // Don't call updateHighlighting here - let the caller decide when to update
        }

        function resetPatternsAndUpdate() {
            console.log('üîÑ Analysis mode changed - resetting patterns');

            // Get the new analysis mode
            const analysisMode = document.querySelector('input[name="analysisMode"]:checked')?.value || 'full';

            // Sync with Sankey mode radio buttons (only if not triggered by Sankey itself)
            if (!window.skipSankeySync) {
                const sankeyModeMap = {
                    'full': 'all',
                    'main_melody': 'main',
                    'grace_units': 'grace'
                };
                const correspondingSankeyMode = sankeyModeMap[analysisMode];
                const sankeyRadio = document.querySelector(`input[name="sankeyMode"][value="${correspondingSankeyMode}"]`);
                if (sankeyRadio) {
                    sankeyRadio.checked = true;
                }
            }

            // Reset KPIC dropdown to "none"
            const kpicFilter = document.getElementById('kpicFilter');
            if (kpicFilter) {
                // kpicFilter.value = 'none'; // Keep current KPIC level when switching modes
            }

            // Reset KRIC dropdown to "none"
            const kricFilter = document.getElementById('kricFilter');
            if (kricFilter) {
                kricFilter.value = 'none';
            }

            // Hide pattern selection dropdowns
            const kpicGroup = document.getElementById('kpicPatternGroup');
            const kricGroup = document.getElementById('kricPatternGroup');
            // if (kpicGroup) kpicGroup.style.display = 'none'; // Keep pattern group visible when switching modes
            // if (kricGroup) kricGroup.style.display = 'none'; // Keep pattern group visible when switching modes

            // Clear KRIC pattern cache to force regeneration with new mode
            console.log('üîÑ Clearing KRIC pattern cache for mode:', analysisMode);
            window.kricPatterns = null;

            // Update highlighting with new mode
            // Refresh pattern options for the new mode
            if (window.kpicThreshold && window.kpicThreshold !== "none") {
                updateKpicPatternOptions();
            }
            if (window.kricThreshold && window.kricThreshold !== "none") {
                updateKricPatternOptions();
            }
            updateHighlighting();

            console.log('‚úÖ Patterns reset and highlighting updated');
        }

        function handleMultiCheckbox() {
            console.log('üîß Multi-checkbox triggered');

            // Get current checkbox states
            const multiStates = {
                sac: document.getElementById('multi_sac')?.checked || false,
                huyen: document.getElementById('multi_huyen')?.checked || false,
                hoi: document.getElementById('multi_hoi')?.checked || false,
                nga: document.getElementById('multi_nga')?.checked || false,
                nang: document.getElementById('multi_nang')?.checked || false,
                ngang: document.getElementById('multi_ngang')?.checked || false,
                grace: document.getElementById('multi_grace')?.checked || false,
                melisma: document.getElementById('multi_melisma')?.checked || false,
                repeated: document.getElementById('multi_repeated')?.checked || false,
                repeated_syllable: document.getElementById('multiRepeatedSelect')?.value || ''
            };

            console.log('üìã Multi-checkboxes:', multiStates);

            // Enable/disable repeated syllable dropdown based on checkbox
            const repeatedDropdown = document.getElementById('multiRepeatedSelect');
            if (multiStates.repeated) {
                repeatedDropdown.disabled = false;
                repeatedDropdown.style.opacity = '1.0';
            } else {
                repeatedDropdown.disabled = true;
                repeatedDropdown.style.opacity = '0.5';
                repeatedDropdown.value = ''; // Clear selection when disabled
            }

            // Clear current highlighting first
            clearHighlighting();

            // Dim all notes to 40% opacity for better contrast
            document.querySelectorAll('.note-circle').forEach(circle => {
                circle.style.opacity = '0.4';
            });

            // Apply each checked analysis type
            if (multiStates.sac) {
                processSingleTone('s·∫Øc', 'sac');
            }

            if (multiStates.huyen) {
                processSingleTone('huy·ªÅn', 'huyen');
            }

            if (multiStates.hoi) {
                processSingleTone('h·ªèi', 'hoi');
            }

            if (multiStates.nga) {
                processSingleTone('ng√£', 'nga');
            }

            if (multiStates.nang) {
                processSingleTone('n·∫∑ng', 'nang');
            }

            if (multiStates.ngang) {
                processSingleTone('ngang', 'ngang');
            }

            if (multiStates.grace) {
                processSingleGraceUnits();
            }

            if (multiStates.melisma) {
                processSingleMelismas();
            }

            if (multiStates.repeated && multiStates.repeated_syllable) {
                console.log(`üîç About to process repeated: enabled=${multiStates.repeated}, syllable="${multiStates.repeated_syllable}"`);
                processSingleRepeated(multiStates.repeated_syllable);
            } else {
                console.log(`‚ö†Ô∏è Repeated not processed: enabled=${multiStates.repeated}, syllable="${multiStates.repeated_syllable}"`);
            }

            // Don't call updateHighlighting() here - it clears checkbox highlighting
            // Checkbox highlighting should persist until cleared by user
        }

        function processSingleTone(tone, toneType) {
            if (analysisData.tone_syllables && analysisData.tone_syllables[tone]) {
                const toneColors = {
                    's·∫Øc': '#e53e3e',    // Bright red (rising tone)
                    'huy·ªÅn': '#3182ce',  // Bright blue (falling tone)
                    'h·ªèi': '#38a169',    // Bright green (dipping tone)
                    'ng√£': '#d69e2e',    // Bright gold (broken rising)
                    'n·∫∑ng': '#805ad5',   // Bright purple (heavy tone)
                    'ngang': '#718096'   // Grey (flat tone)
                };

                analysisData.tone_syllables[tone].forEach(pos => {
                    const noteElement = document.getElementById(`note-${pos}`);
                    if (noteElement) {
                        noteElement.classList.add('syllable-tone', `tone-${toneType}`);
                        noteElement.style.opacity = '1.0'; // Restore full opacity for selected notes
                    }
                });

                highlightCorrespondingLyrics(analysisData.tone_syllables[tone], toneColors[tone], `${tone} Tone`, tone);
            }
        }

        function processSingleGraceUnits() {
            // Define all grace note positions and their connections to main notes
            const graceNotePairs = [
                [3, 4],    // Grace note #3 connects to main note #4
                [10, 11],  // Grace note #10 connects to main note #11
                [19, 20],  // Grace note #19 connects to main note #20
                [21, 22],  // Grace note #21 connects to main note #22
                [49, 50],  // Grace note #49 connects to main note #50
                [51, 52],  // Grace note #51 connects to main note #52
                [60, 61],  // Grace note #60 connects to main note #61
                [92, 93],  // Grace note #92 connects to main note #93
                [94, 95],  // Grace note #94 connects to main note #95
                [107, 108], // Grace note #107 connects to main note #108
                [109, 110]  // Grace note #109 connects to main note #110
            ];

            // Highlight all grace notes and their connections
            const allGracePositions = [];

            graceNotePairs.forEach((pair, pairIndex) => {
                const [gracePos, mainPos] = pair;

                // Highlight grace note
                const graceElement = document.getElementById(`note-${gracePos}`);
                if (graceElement) {
                    graceElement.classList.add('grace-note');
                    graceElement.style.opacity = '1.0';
                    allGracePositions.push(gracePos);
                }

                // Highlight main note
                const mainElement = document.getElementById(`note-${mainPos}`);
                if (mainElement) {
                    mainElement.style.opacity = '1.0';
                    allGracePositions.push(mainPos);
                }

                // Draw connection line between grace and main note
                if (graceElement && mainElement) {
                    // Create a simple direct connection
                    const svg = document.querySelector('svg');
                    if (svg) {
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');

                        const x1 = parseFloat(graceElement.getAttribute('cx'));
                        const y1 = parseFloat(graceElement.getAttribute('cy'));
                        const x2 = parseFloat(mainElement.getAttribute('cx'));
                        const y2 = parseFloat(mainElement.getAttribute('cy'));

                        line.setAttribute('x1', x1);
                        line.setAttribute('y1', y1);
                        line.setAttribute('x2', x2);
                        line.setAttribute('y2', y2);
                        line.setAttribute('stroke', '#38a169'); // Green color for grace connections
                        line.setAttribute('stroke-width', '3');
                        line.setAttribute('opacity', '0.8');
                        line.setAttribute('class', `pattern-connection-line grace-connection-${pairIndex}`);

                        // Store base coordinates for zoom
                        line.setAttribute('data-base-x1', graceElement.getAttribute('data-base-x') || x1);
                        line.setAttribute('data-base-y1', graceElement.getAttribute('data-base-y') || y1);
                        line.setAttribute('data-base-x2', mainElement.getAttribute('data-base-x') || x2);
                        line.setAttribute('data-base-y2', mainElement.getAttribute('data-base-y') || y2);

                        // Insert line before notes so it appears behind them
                        const firstNote = svg.querySelector('.note-circle');
                        if (firstNote) {
                            svg.insertBefore(line, firstNote);
                        } else {
                            svg.appendChild(line);
                        }

                        console.log(`‚úÖ Grace connection created: ${gracePos} ‚Üí ${mainPos}`);
                    }
                }
            });

            if (allGracePositions.length > 0) {
                highlightCorrespondingLyrics(allGracePositions, '#38a169', 'Grace Notes', 'grace');
            }
        }

        function processSingleMelismas() {
            const syllables = document.querySelectorAll('.editable-syllable.melismatic');
            const allMelismaPositions = [];

            syllables.forEach((syllableElement, index) => {
                const syllableText = syllableElement.textContent;
                const syllablePos = parseInt(syllableElement.getAttribute('data-position'));
                const syllableTitle = syllableElement.getAttribute('title');
                const noteCountMatch = syllableTitle.match(/\(melismatic, (\d+) notes?\)/);

                if (noteCountMatch) {
                    const noteCount = parseInt(noteCountMatch[1]);
                    const syllableNotePositions = [];

                    for (let i = 0; i < noteCount; i++) {
                        const notePos = syllablePos + i;
                        const noteElement = document.getElementById(`note-${notePos}`);
                        if (noteElement) {
                            noteElement.classList.add('syllable-melismatic');
                            noteElement.style.opacity = '1.0'; // Restore full opacity for selected notes
                            syllableNotePositions.push(notePos);
                            allMelismaPositions.push(notePos);
                        }
                    }

                    // Draw connections within this melismatic syllable
                    if (syllableNotePositions.length > 1) {
                        drawGraceAwareConnections(syllableNotePositions, '#d69e2e', 3, `multi-melisma-${syllableText}-${index}`);
                    }
                }
            });

            if (allMelismaPositions.length > 0) {
                highlightCorrespondingLyrics(allMelismaPositions, '#d69e2e', 'Melismatic', 'melisma');
            }
        }

        function processSingleRepeated(selectedSyllable) {
            console.log(`üîç Processing repeated syllable: "${selectedSyllable}"`);

            if (analysisData.repeated_syllables && analysisData.repeated_syllables[selectedSyllable]) {
                const data = analysisData.repeated_syllables[selectedSyllable];
                console.log(`‚úÖ Found data for "${selectedSyllable}": ${data.count} instances at positions [${data.positions}]`);

                data.positions.forEach(pos => {
                    const noteElement = document.getElementById(`note-${pos}`);
                    if (noteElement) {
                        noteElement.classList.add('syllable-repetition');
                        noteElement.style.opacity = '1.0'; // Restore full opacity for selected notes
                        console.log(`  ‚úÖ Highlighted note ${pos}`);
                    } else {
                        console.log(`  ‚ùå Note ${pos} not found`);
                    }
                });

                highlightCorrespondingLyrics(data.positions, '#e53e3e', 'Repeated', selectedSyllable);
            } else {
                console.log(`‚ùå No data found for repeated syllable: "${selectedSyllable}"`);
                console.log('Available repeated syllables:', Object.keys(analysisData.repeated_syllables || {}));
            }
        }

        function initializeSliderPositions() {
            // Initialize KPIC slider label position
            const kpicSlider = document.getElementById('kpicSlider');
            const kpicValue = document.getElementById('kpicSliderValue');
            if (kpicSlider && kpicValue) {
                const kpicSliderValue = parseInt(kpicSlider.value);
                const kpicPercentage = (kpicSliderValue / 136) * 100;
                const kpicSliderRect = kpicSlider.getBoundingClientRect();
                const kpicSliderWidth = kpicSliderRect.width || 280;
                const kpicHandleWidth = 20;
                const kpicLeftPosition = (kpicPercentage / 100) * (kpicSliderWidth - kpicHandleWidth) + (kpicHandleWidth / 2) - 0;
                kpicValue.style.left = `${Math.max(0, Math.min(kpicLeftPosition, kpicSliderWidth - 30))}px`;
            }

            // Initialize KRIC slider label position
            const kricSlider = document.getElementById('kricSlider');
            const kricValue = document.getElementById('kricSliderValue');
            if (kricSlider && kricValue) {
                const kricSliderValue = parseInt(kricSlider.value);
                const kricPercentage = (kricSliderValue / 136) * 100;
                const kricSliderRect = kricSlider.getBoundingClientRect();
                const kricSliderWidth = kricSliderRect.width || 280;
                const kricHandleWidth = 20;
                const kricLeftPosition = (kricPercentage / 100) * (kricSliderWidth - kricHandleWidth) + (kricHandleWidth / 2) - 0;
                kricValue.style.left = `${Math.max(0, Math.min(kricLeftPosition, kricSliderWidth - 30))}px`;
            }

            // Initialize zoom slider positions by calling their handlers
            updateZoomFromSlider('x');
            updateZoomFromSlider('y');
        }

        function handleKpicSlider() {
            const slider = document.getElementById('kpicSlider');
            const display = document.getElementById('kpicSliderValue');
            const value = parseInt(slider.value);

            display.textContent = value;

            // Position the value label directly above the slider handle
            const percentage = (value / 136) * 100;
            const sliderRect = slider.getBoundingClientRect();
            const sliderWidth = sliderRect.width;
            const handleWidth = 20;
            const leftPosition = (percentage / 100) * (sliderWidth - handleWidth) + (handleWidth / 2) - 0;
            display.style.left = `${Math.max(0, Math.min(leftPosition, sliderWidth - 30))}px`;

            // Store the threshold value for pattern detection
            window.kpicThreshold = value === 0 ? 'none' : (value === 136 ? 'kpic-max' : `kpic-${value}`);

            // Show Transition Analysis window when KPIC-2 or higher is selected
            if (value >= 2 && value <= 16) {
                showTransitionAnalysisWindow();
            }

            updateKpicPatternOptions();
            // Refresh pattern options for the new mode
            if (window.kpicThreshold && window.kpicThreshold !== "none") {
                updateKpicPatternOptions();
            }            updateHighlighting();
        }

        function handleKricSlider() {
            const slider = document.getElementById('kricSlider');
            const display = document.getElementById('kricSliderValue');
            const value = parseInt(slider.value);

            display.textContent = value;

            // Position the value label directly above the slider handle
            const percentage = (value / 136) * 100;
            const sliderRect = slider.getBoundingClientRect();
            const sliderWidth = sliderRect.width;
            const handleWidth = 20;
            const leftPosition = (percentage / 100) * (sliderWidth - handleWidth) + (handleWidth / 2) - 0;
            display.style.left = `${Math.max(0, Math.min(leftPosition, sliderWidth - 30))}px`;

            // Store the threshold value for pattern detection
            window.kricThreshold = value === 0 ? 'none' : (value === 136 ? 'kric-max' : `kric-${value}`);

            // Show appropriate analysis window based on KRIC level
            if (value === 2) {
                // Show KRIC-2 Sankey
                showContent('kpic-kric-sankey');
            } else if (value === 3) {
                // Show KRIC-3 Sankey
                showContent('kric3-sankey');
            } else if (value >= 2 && value <= 16) {
                showTransitionAnalysisWindow();
            }

            updateKricPatternOptions();
            // Refresh pattern options for the new mode
            if (window.kpicThreshold && window.kpicThreshold !== "none") {
                updateKpicPatternOptions();
            }            updateHighlighting();
        }


        function updateResonanceBandColors() {
            // Update resonance band colors to match their associated note circles
            const svg = document.getElementById('tablatureSvg');
            if (!svg) {
                console.error('SVG not found!');
                return;
            }

            // Remove any previously created new bands
            const newBands = svg.querySelectorAll('.new-resonance-band');
            if (newBands.length > 0) {
                console.log(`Removing ${newBands.length} previously created bands`);
                newBands.forEach(band => band.remove());
            }

            // Check if bands are already colored - if so, clear them first
            const coloredBands = svg.querySelectorAll('.resonance-band-colored');
            if (coloredBands.length > 0) {
                console.log(`Clearing ${coloredBands.length} previously colored bands`);
                coloredBands.forEach(band => {
                    band.classList.remove('resonance-band-colored');
                    band.style.display = ''; // Show them again
                    // Reset to original gradient fills
                    const height = parseFloat(band.getAttribute('height'));
                    if (height === 6) {
                        band.setAttribute('fill', 'url(#graceResonanceBand)');
                    } else {
                        band.setAttribute('fill', 'url(#resonanceBand)');
                    }
                    band.removeAttribute('stroke');
                    band.style.opacity = '';
                    band.style.visibility = '';
                });
            }

            const allRects = svg.querySelectorAll('rect');
            console.log(`Total rectangles found: ${allRects.length}`);

            const resonanceBands = Array.from(allRects).filter(rect => {
                const fill = rect.getAttribute('fill');
                const dataBaseX = rect.getAttribute('data-base-x');
                const dataBaseY = rect.getAttribute('data-base-y');
                // Look for bands that need coloring
                return (fill && (fill.includes('resonanceBand') || fill.includes('dynamicResonance'))) ||
                       (dataBaseX && dataBaseY && rect !== allRects[0] && !rect.classList.contains('resonance-band-colored'));
            });

            console.log(`Found ${resonanceBands.length} resonance bands that need coloring`);

            // Log first few bands for debugging
            resonanceBands.slice(0, 3).forEach((band, i) => {
                console.log(`Band ${i}: fill="${band.getAttribute('fill')}", x="${band.getAttribute('x')}", y="${band.getAttribute('y')}", width="${band.getAttribute('width')}", height="${band.getAttribute('height')}"`);
            });

            resonanceBands.forEach((band) => {
                // Get the band's original X position (before zoom)
                const bandBaseX = parseFloat(band.getAttribute('data-base-x') || band.getAttribute('x'));

                // Find the note circle at the same X position
                const noteCircles = document.querySelectorAll('.note-circle');
                let matchingNote = null;

                noteCircles.forEach(note => {
                    const noteBaseX = parseFloat(note.getAttribute('data-base-x') || note.getAttribute('cx'));
                    if (Math.abs(bandBaseX - noteBaseX) < 2) { // Small tolerance for floating point
                        matchingNote = note;
                    }
                });

                if (matchingNote) {
                    // Get the actual fill color from the note's attribute first, then computed style
                    let noteFill = matchingNote.getAttribute('fill');
                    if (!noteFill || noteFill === 'none') {
                        const computedStyle = window.getComputedStyle(matchingNote);
                        noteFill = computedStyle.fill;
                    }
                    console.log(`Matched band at x=${bandBaseX} with note, fill color: ${noteFill}`);

                    // Convert rgb to hex if needed
                    if (noteFill.startsWith('rgb')) {
                        const rgbMatch = noteFill.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
                        if (rgbMatch) {
                            const r = parseInt(rgbMatch[1]).toString(16).padStart(2, '0');
                            const g = parseInt(rgbMatch[2]).toString(16).padStart(2, '0');
                            const b = parseInt(rgbMatch[3]).toString(16).padStart(2, '0');
                            noteFill = `#${r}${g}${b}`;
                        }
                    }

                    // Keep the gradient fill, don't override with solid color
                    // band.setAttribute('fill', noteFill); // Don't override gradient
                    band.setAttribute('opacity', '0.9');

                    // Use inline styles but don't override the gradient fill
                    band.setAttribute('style', `
                        opacity: 0.9 !important;
                        display: block !important;
                        visibility: visible !important;
                        pointer-events: none !important;
                    `);

                    band.classList.add('resonance-band-colored');

                    // Ensure band is positioned before the note in DOM hierarchy
                    if (band.compareDocumentPosition(matchingNote) & Node.DOCUMENT_POSITION_FOLLOWING) {
                        matchingNote.parentNode.insertBefore(band, matchingNote);
                    }

                    console.log(`Updated resonance band at x=${bandBaseX} with color ${noteFill}`);
                } else {
                    console.log(`No matching note found for band at x=${bandBaseX}`);
                }
            });
        }

        function updateHighlighting(source = 'other') {
            // Debounce to prevent rapid successive calls that cause flashing
            if (window.updateHighlightingTimeout) {
                clearTimeout(window.updateHighlightingTimeout);
            }

            window.updateHighlightingTimeout = setTimeout(() => {
                performUpdateHighlighting(source);
            }, 50);
        }

        function performUpdateHighlighting(source = 'other') {
            console.log('üéØ performUpdateHighlighting called at', new Date().toLocaleTimeString(), 'source:', source);

            // Clear previous highlighting
            clearHighlighting();

            // Dim all notes to 40% opacity for better contrast
            document.querySelectorAll('.note-circle').forEach(circle => {
                circle.style.opacity = '0.4';
            });

            const kpicFilter = window.kpicThreshold || 'none';
            const kricFilter = window.kricThreshold || 'none';
            const analysisMode = document.querySelector('input[name="analysisMode"]:checked')?.value || 'full';

            // Get syllable filter state from checkboxes
            const graceMainCheckbox = document.getElementById('multi_grace_main');
            const melismaCheckbox = document.getElementById('multi_melisma');
            const repetitionsCheckbox = document.getElementById('multi_repetitions');
            const specificSyllableSelect = document.getElementById('specificSyllable');

            let syllableFilter = 'none';
            if (graceMainCheckbox && graceMainCheckbox.checked) {
                syllableFilter = 'grace_main_units';
            } else if (melismaCheckbox && melismaCheckbox.checked) {
                syllableFilter = 'melismatic';
            } else if (repetitionsCheckbox && repetitionsCheckbox.checked) {
                syllableFilter = 'repetitions';
            } else if (specificSyllableSelect && specificSyllableSelect.selectedOptions.length > 0) {
                syllableFilter = 'specific';
            }

            // Multi-selection checkbox system - no dropdown dependencies

            let patternDetails = '';

            // Apply KPIC highlighting (specific patterns)
            console.log('üéØ KPIC Filter:', kpicFilter);
            if (kpicFilter !== 'none') {
                console.log('üéØ Entering KPIC highlighting section');
                // Get patterns based on analysis mode
                const modePatterns = analysisData.kpic_patterns[analysisMode] || analysisData.kpic_patterns.full;
                const patterns = modePatterns[kpicFilter] || [];
                const patternSelect = document.getElementById('specificKpicPattern');
                const selectedOptions = Array.from(patternSelect.selectedOptions);
                console.log('üéØ KPIC Selected options:', selectedOptions.length);

                const selectedIndices = Array.from(patternSelect.selectedOptions).map(opt => parseInt(opt.value));
                const selectedPatterns = selectedIndices.map(i => patterns[i]).filter(Boolean);

                console.log('üéØ KPIC Selected patterns:', selectedPatterns.length);

                selectedPatterns.forEach((pattern, patternIndex) => {
                    console.log('üéØ Processing KPIC pattern:', pattern.pattern, 'count:', pattern.count, 'positions:', pattern.positions);
                    const colorIndex = patternIndex % 5; // Cycle through 5 colors
                    const patternColors = ['#ff9800', '#e91e63', '#9c27b0', '#3f51b5', '#009688']; // KPIC colors
                    
                    pattern.positions.forEach(startPos => {
                        const ngramSize = pattern.pattern.length;
                        const patternPositions = [];
                        
                        for (let i = 0; i < ngramSize; i++) {
                            const noteIndex = startPos + i;
                            const noteElement = document.getElementById(`note-${noteIndex}`);
                            console.log(`üéØ Looking for note-${noteIndex}:`, noteElement ? 'FOUND' : 'NOT FOUND');
                            if (noteElement) {
                                console.log(`üéØ Highlighting note-${noteIndex} with direct SVG attributes`);
                                noteElement.classList.add('kpic-highlight', 'pattern-member', `pattern-color-${colorIndex}`);

                                // Force SVG attributes directly
                                noteElement.setAttribute('fill', '#ffff00'); // Bright yellow
                                noteElement.setAttribute('stroke', '#ff0000'); // Bright red
                                noteElement.setAttribute('stroke-width', '8'); // Thick stroke
                                noteElement.setAttribute('opacity', '1.0'); // Full opacity
                                noteElement.setAttribute('filter', 'drop-shadow(0 0 20px #ff0000)'); // Red glow

                                // Verify attributes were actually set
                                console.log(`üîç Attributes set on note-${noteIndex}:`, {
                                    fill: noteElement.getAttribute('fill'),
                                    stroke: noteElement.getAttribute('stroke'),
                                    strokeWidth: noteElement.getAttribute('stroke-width'),
                                    opacity: noteElement.getAttribute('opacity')
                                });

                                noteElement.setAttribute('data-pattern-type', 'KPIC');
                                noteElement.setAttribute('data-pattern-info',
                                    `${kpicFilter.toUpperCase()}: ${pattern.pattern.join('‚Üí')} (${pattern.count}√ó)`);
                                patternPositions.push(noteIndex);
                            }
                        }
                        
                        // Draw connection lines for this pattern instance
                        if (patternPositions.length > 1) {
                            console.log(`üéØ Drawing connections for pattern at position ${startPos}, positions:`, patternPositions);
                            drawGraceAwareConnections(patternPositions, patternColors[colorIndex], 3, `kpic-${patternIndex}-${startPos}`);
                        } else {
                            console.log(`üéØ Not drawing connections - only ${patternPositions.length} positions`);
                        }
                        
                        // Highlight corresponding lyrics with coverage analysis
                        highlightCorrespondingLyrics(patternPositions, patternColors[colorIndex], `KPIC-${kpicFilter}`, patternIndex);
                    });
                });

                // Sync Sankey highlighting for all selected patterns
                selectedPatterns.forEach(pattern => {
                    syncSankeySelectionForPattern(pattern.pattern);
                });

                // Show and scroll to Sankey when patterns are selected
                if (selectedPatterns.length > 0) {
                    showAndScrollToSankey();
                }

                // Always highlight KPIC-3 Sankey bands if this is a KPIC-3 pattern
                if (kpicFilter === 'kpic-3' && selectedPatterns.length > 0) {
                    highlightKpic3SankeyPatterns(selectedPatterns);
                }

                patternDetails += `<h4>${kpicFilter.toUpperCase()} Selected Patterns</h4>`;
                patternDetails += '<ul>';
                selectedPatterns.forEach(p => {
                    patternDetails += `<li>${p.pattern.join(' ‚Üí ')} <strong>(${p.count}√ó)</strong> at positions: ${p.positions.join(', ')}</li>`;
                });
                patternDetails += '</ul>';
            }
            
            // Apply KRIC highlighting (specific patterns)
            if (kricFilter !== 'none') {
                // Generate KRIC patterns if not already generated
                if (!window.kricPatterns) {
                    generateKricPatterns();
                }

                // Get patterns for the current filter
                const patterns = window.kricPatterns[kricFilter] || [];
                const patternSelect = document.getElementById('specificKricPattern');
                const selectedIndices = Array.from(patternSelect.selectedOptions).map(opt => parseInt(opt.value));

                // Only highlight specifically selected patterns from dropdown
                // Don't auto-select all patterns when none are selected

                const selectedPatterns = selectedIndices.map(i => patterns[i]).filter(Boolean);
                
                selectedPatterns.forEach((pattern, patternIndex) => {
                    const colorIndex = patternIndex % 5; // Cycle through 5 colors
                    const patternColors = ['#2196f3', '#4caf50', '#ff5722', '#9c27b0', '#ff9800']; // KRIC colors
                    
                    pattern.positions.forEach(startPos => {
                        const ngramSize = pattern.pattern.length;
                        const patternPositions = [];
                        
                        for (let i = 0; i < ngramSize; i++) {
                            const noteIndex = startPos + i;
                            const noteElement = document.getElementById(`note-${noteIndex}`);
                            if (noteElement) {
                                noteElement.classList.add('kric-highlight', 'pattern-member', `pattern-color-${colorIndex}`);
                                noteElement.style.opacity = '1.0'; // Restore full opacity for selected notes
                                noteElement.setAttribute('data-pattern-type', 'KRIC');
                                noteElement.setAttribute('data-pattern-info', 
                                    `${kricFilter.toUpperCase()}: ${pattern.pattern.join('‚Üí')} (${pattern.count}√ó)`);
                                patternPositions.push(noteIndex);
                            }
                        }
                        
                        // Draw connection lines for this pattern instance
                        if (patternPositions.length > 1) {
                            drawGraceAwareConnections(patternPositions, patternColors[colorIndex], 3, `kric-${patternIndex}-${startPos}`);
                        }
                        
                        // Highlight corresponding lyrics with coverage analysis
                        highlightCorrespondingLyrics(patternPositions, patternColors[colorIndex], `KRIC-${kricFilter}`, patternIndex);
                    });
                });

                // Always sync KRIC Sankey highlighting for selected patterns
                selectedPatterns.forEach(pattern => {
                    // For KRIC-2, use the existing sync function
                    if (kricFilter === 'kric-2') {
                        syncKricSankeySelectionForPattern(pattern.pattern);
                    }
                });

                // For KRIC-3, always highlight the Sankey bands if KRIC-3 view is open
                if (kricFilter === 'kric-3' && selectedPatterns.length > 0) {
                    highlightKric3SankeyPatterns(selectedPatterns);
                }

                patternDetails += `<h4>${kricFilter.toUpperCase()} Selected Patterns</h4>`;
                patternDetails += '<ul>';
                selectedPatterns.forEach(p => {
                    patternDetails += `<li>${p.pattern.join(' ‚Üí ')} <strong>(${p.count}√ó)</strong> at positions: ${p.positions.join(', ')}</li>`;
                });
                patternDetails += '</ul>';
            }
            
            // Apply syllable highlighting
            if (syllableFilter === 'grace_main_units') {
                // Always rebuild grace_main_units data to ensure it's correct
                console.log('Force rebuilding grace_main_units data...');
                analysisData.grace_main_units = [];

                // Find all grace notes and their following main notes
                const allNotes = document.querySelectorAll('.note-circle');
                console.log(`Scanning ${allNotes.length} notes for grace-main pairs...`);

                // Build a sorted list of all notes for easier sequential processing
                const noteList = [];
                allNotes.forEach(circle => {
                    const noteIndex = parseInt(circle.getAttribute('data-note-index'));
                    const isGrace = circle.getAttribute('data-is-grace') === 'true';
                    const radius = circle.getAttribute('r');
                    noteList.push({ index: noteIndex, isGrace, radius, element: circle });
                });

                // Sort by note index
                noteList.sort((a, b) => a.index - b.index);

                // Process each note to find grace-main relationships
                for (let i = 0; i < noteList.length; i++) {
                    const note = noteList[i];

                    if (note.isGrace) {
                        // Grace note found - add it and its main note
                        analysisData.grace_main_units.push(note.index);

                        // Find the next main note (not grace)
                        for (let j = i + 1; j < noteList.length; j++) {
                            const nextNote = noteList[j];
                            if (!nextNote.isGrace) {
                                analysisData.grace_main_units.push(nextNote.index);
                                break;
                            }
                        }
                    }
                }

                // Remove duplicates and sort
                analysisData.grace_main_units = [...new Set(analysisData.grace_main_units)].sort((a, b) => a - b);

                // Group grace-main pairs together
                const graceMainGroups = new Map();
                analysisData.grace_main_units.forEach(pos => {
                    const noteElement = document.getElementById(`note-${pos}`);
                    if (noteElement) {
                        noteElement.classList.add('grace-main-unit');

                        // Group into pairs
                        const graceMainPairIndex = Math.floor(analysisData.grace_main_units.indexOf(pos) / 2);
                        if (!graceMainGroups.has(graceMainPairIndex)) {
                            graceMainGroups.set(graceMainPairIndex, []);
                        }
                        graceMainGroups.get(graceMainPairIndex).push(pos);
                    }
                });

                // Draw connections for each grace-main pair
                graceMainGroups.forEach((notePositions, pairIndex) => {
                    if (notePositions.length > 1) {
                        notePositions.sort((a, b) => a - b);
                        drawSimpleConnections(notePositions, '#2e7d32', 4, `grace-main-pair-${pairIndex}`);
                    }
                });

                // Highlight corresponding syllables in lyrics box
                if (analysisData.grace_main_units.length > 0) {
                    highlightCorrespondingLyrics(analysisData.grace_main_units, '#2e7d32', 'Grace-Main Units', 'grace');
                }
                
                const unitCount = analysisData.grace_main_units.length;
                patternDetails += `<h4>Grace-Main Units</h4>`;
                patternDetails += `<p>Highlighted ${unitCount} notes that are part of grace-main units.</p>`;
                patternDetails += `<p>Grace-main units consist of one or more grace notes followed by a main note.</p>`;
            } else if (syllableFilter === 'melismatic') {
                // Highlight melismatic syllables - but treat each instance separately
                console.log('üé® Processing melismatic syllables...');

                // Find all syllables marked as melismatic in the HTML
                const syllables = document.querySelectorAll('.editable-syllable.melismatic');
                console.log(`Found ${syllables.length} melismatic syllable elements`);

                syllables.forEach((syllableElement, index) => {
                    const syllableText = syllableElement.textContent;
                    const syllablePos = parseInt(syllableElement.getAttribute('data-position'));
                    const syllableTitle = syllableElement.getAttribute('title');
                    const noteCountMatch = syllableTitle.match(/\(melismatic, (\d+) notes?\)/);

                    if (noteCountMatch) {
                        const noteCount = parseInt(noteCountMatch[1]);
                        console.log(`Melismatic syllable "${syllableText}" at pos ${syllablePos} with ${noteCount} notes`);

                        // Highlight all notes in this melismatic syllable
                        const syllableNotePositions = [];
                        for (let i = 0; i < noteCount; i++) {
                            const notePos = syllablePos + i;
                            const noteElement = document.getElementById(`note-${notePos}`);
                            if (noteElement) {
                                noteElement.classList.add('syllable-melismatic');
                                noteElement.setAttribute('data-syllable-info',
                                    `Melismatic: "${syllableText}" (${i + 1}/${noteCount})`);
                                syllableNotePositions.push(notePos);
                                console.log(`  ‚Üí Highlighted note ${notePos}`);
                            }
                        }

                        // Draw connections within this specific melismatic syllable
                        if (syllableNotePositions.length > 1) {
                            console.log(`Drawing connections for "${syllableText}": ${syllableNotePositions}`);
                            drawSimpleConnections(syllableNotePositions, '#6a1b9a', 3, `melisma-${syllableText}-${index}`);
                        }

                        // Highlight corresponding syllable in lyrics box
                        highlightCorrespondingLyrics(syllableNotePositions, '#6a1b9a', 'Melismatic Syllable', syllableText);
                    }
                });
                
                const melismaCount = Object.keys(analysisData.melismatic_syllables).length;
                patternDetails += `<h4>Multi-note Syllables (Melismas)</h4>`;
                patternDetails += `<p>Found ${melismaCount} melismatic syllables.</p>`;
                patternDetails += '<ul>';
                Object.entries(analysisData.melismatic_syllables).slice(0, 10).forEach(([syl, positions]) => {
                    patternDetails += `<li>"${syl}" - ${positions.length} occurrence(s)</li>`;
                });
                patternDetails += '</ul>';
            } else if (syllableFilter.startsWith('tone_')) {
                // Highlight syllables by tone mark
                const toneType = syllableFilter.replace('tone_', '');
                const toneMap = {
                    'sac': 's·∫Øc', 'huyen': 'huy·ªÅn', 'hoi': 'h·ªèi',
                    'nga': 'ng√£', 'nang': 'n·∫∑ng', 'ngang': 'ngang'
                };
                const tone = toneMap[toneType];
                
                if (analysisData.tone_syllables && analysisData.tone_syllables[tone]) {
                    const toneColors = {
                        's·∫Øc': '#ff5722',    // Rising tone - orange
                        'huy·ªÅn': '#3f51b5',  // Falling tone - blue  
                        'h·ªèi': '#009688',    // Dipping tone - teal
                        'ng√£': '#ff9800',    // Broken rising - amber
                        'n·∫∑ng': '#795548',   // Heavy tone - brown
                        'ngang': '#607d8b'   // Flat tone - blue-grey
                    };
                    
                    analysisData.tone_syllables[tone].forEach(pos => {
                        const noteElement = document.getElementById(`note-${pos}`);
                        if (noteElement) {
                            noteElement.classList.add('syllable-tone', `tone-${toneType}`);
                            noteElement.setAttribute('data-syllable-info', 
                                `Tone: ${tone}`);
                        }
                    });
                    
                    // Draw connection lines ONLY within individual syllables (not across different syllables)
                    // Group notes by syllable first, then draw connections within each syllable
                    const syllableGroups = new Map();

                    // Only use the original tone notes (don't add grace notes globally)
                    // Grace notes will be included only when they're within syllable boundaries

                    analysisData.tone_syllables[tone].forEach(notePos => {
                        // Find which syllable this note belongs to
                        const syllables = document.querySelectorAll('.editable-syllable');
                        syllables.forEach(syllableElement => {
                            const syllablePos = parseInt(syllableElement.getAttribute('data-position'));
                            const syllableTitle = syllableElement.getAttribute('title');
                            const syllableIndex = parseInt(syllableElement.getAttribute('data-syllable-index'));

                            // Get exact syllable range
                            let syllableStartPos = syllablePos;
                            let syllableEndPos = syllablePos;

                            // Try multiple regex patterns for note count
                            let noteCountMatch = syllableTitle.match(/\((\d+) notes?\)/);
                            if (!noteCountMatch) {
                                noteCountMatch = syllableTitle.match(/\(melismatic, (\d+) notes?\)/);
                            }

                            if (noteCountMatch) {
                                const noteCount = parseInt(noteCountMatch[1]);
                                syllableEndPos = syllableStartPos + noteCount - 1;
                            }

                            // Check if note belongs to this syllable
                            if (notePos >= syllableStartPos && notePos <= syllableEndPos) {
                                if (!syllableGroups.has(syllableIndex)) {
                                    syllableGroups.set(syllableIndex, []);
                                }
                                syllableGroups.get(syllableIndex).push(notePos);

                                // Also check for grace notes immediately before this syllable's start
                                if (notePos === syllableStartPos) {
                                    // This is the main note that starts the syllable
                                    // Include any grace notes immediately before it
                                    for (let gracePos = syllableStartPos - 1; gracePos >= Math.max(0, syllableStartPos - 2); gracePos--) {
                                        const graceNote = document.getElementById(`note-${gracePos}`);
                                        if (graceNote && graceNote.getAttribute('data-is-grace') === 'true') {
                                            if (!syllableGroups.get(syllableIndex).includes(gracePos)) {
                                                syllableGroups.get(syllableIndex).push(gracePos);
                                                console.log(`  ‚ûï Added grace note ${gracePos} to syllable ${syllableIndex} (precedes main note ${notePos})`);
                                            }
                                        } else {
                                            break; // Stop at first non-grace note
                                        }
                                    }
                                }
                            }
                        });
                    });

                    // Draw connections only within each syllable
                    console.log(`Tone ${tone} syllable groups:`, syllableGroups);
                    const allTonePositions = [];

                    syllableGroups.forEach((notePositions, syllableIndex) => {
                        console.log(`Syllable ${syllableIndex}: positions [${notePositions}]`);
                        allTonePositions.push(...notePositions); // Add positions to array for lyrics highlighting

                        if (notePositions.length > 1) {
                            notePositions.sort((a, b) => a - b); // Sort by position
                            console.log(`Drawing connections for syllable ${syllableIndex}: ${notePositions}`);
                            // Use simple connection drawing
                            drawSimpleConnections(notePositions, toneColors[tone], 3, `tone-${tone}-syllable-${syllableIndex}`);
                        } else {
                            console.log(`Syllable ${syllableIndex} has only ${notePositions.length} note(s) - no connections needed`);
                        }
                    });

                    // Highlight corresponding syllables in lyrics box
                    console.log(`üé® About to call lyrics highlighting with ${allTonePositions.length} positions`);
                    if (allTonePositions.length > 0) {
                        highlightCorrespondingLyrics(allTonePositions, toneColors[tone], `${tone.charAt(0).toUpperCase() + tone.slice(1)} Tone`, tone);
                    } else {
                        console.log('‚ö†Ô∏è No tone positions to highlight in lyrics');
                    }

                    const toneCount = analysisData.tone_syllables[tone].length;
                    patternDetails += `<h4>Tone Mark: ${tone.charAt(0).toUpperCase() + tone.slice(1)}</h4>`;
                    patternDetails += `<p>Found ${toneCount} notes with ${tone} tone (including melismatic notes).</p>`;
                }
            } else if (syllableFilter === 'repetitions') {
                // Handle repeated syllables with dropdown selection (like KPIC)
                const selectedSyllable = document.getElementById('repeatedSyllableSelect').value;

                if (selectedSyllable && analysisData.repeated_syllables[selectedSyllable]) {
                    const data = analysisData.repeated_syllables[selectedSyllable];

                    // Highlight only the selected repeated syllable
                    data.positions.forEach(pos => {
                        const noteElement = document.getElementById(`note-${pos}`);
                        if (noteElement) {
                            noteElement.classList.add('syllable-repetition');
                            noteElement.setAttribute('data-syllable-info',
                                `Repeated syllable: "${selectedSyllable}" (${data.count}√ó)`);
                        }
                    });

                    // Highlight corresponding syllables in lyrics box
                    highlightCorrespondingLyrics(data.positions, '#f44336', 'Repeated Syllable', selectedSyllable);

                    patternDetails += `<h4>Repeated Syllable: "${selectedSyllable}"</h4>`;
                    patternDetails += `<p>Found ${data.count} instances at positions: ${data.positions.join(', ')}</p>`;
                } else {
                    patternDetails += `<h4>Repeated Syllables</h4>`;
                    patternDetails += `<p>Select a specific repeated syllable from the dropdown above.</p>`;
                }
            } else if (syllableFilter === 'specific') {
                const syllableSelect = document.getElementById('specificSyllable');
                const selectedSyllables = Array.from(syllableSelect.selectedOptions).map(opt => opt.value);
                
                if (selectedSyllables.length > 0) {
                    selectedSyllables.forEach((selectedSyllable, syllableIndex) => {
                        const colorIndex = syllableIndex % 5; // Cycle through 5 colors
                        const syllableColors = ['#e91e63', '#9c27b0', '#3f51b5', '#009688', '#ff9800']; // Syllable colors
                        
                        // Get syllable data from all_syllables (includes both repeated and single)
                        const data = analysisData.all_syllables[selectedSyllable];
                        if (!data) return; // Skip if syllable not found
                        
                        const positions = data.positions;
                        const count = data.count;
                        
                        positions.forEach(pos => {
                            const noteElement = document.getElementById(`note-${pos}`);
                            if (noteElement) {
                                noteElement.classList.add('syllable-focus', `pattern-color-${colorIndex}`);
                                noteElement.setAttribute('data-syllable-info', 
                                    `Selected syllable: "${selectedSyllable}" (${count}√ó)`);
                            }
                        });
                        
                        // Draw connection lines only for consecutive notes within each selected syllable
                        if (positions.length > 1) {
                            drawGraceAwareConnections(positions, syllableColors[colorIndex], 2, `syllable-${selectedSyllable}`);
                        }
                    });
                    
                    patternDetails += `<h4>Selected Syllables</h4>`;
                    patternDetails += '<ul>';
                    selectedSyllables.forEach(syl => {
                        const data = analysisData.all_syllables[syl];
                        if (data) {
                            patternDetails += `<li>"${syl}" appears ${data.count} times at positions: ${data.positions.join(', ')}</li>`;
                        }
                    });
                    patternDetails += '</ul>';
                }
            }
            
            // Apply dimming to non-highlighted notes if any highlighting is active
            const hasHighlighting = kpicFilter !== 'none' || kricFilter !== 'none' || syllableFilter !== 'none';
            if (hasHighlighting) {
                const notes = document.querySelectorAll('.note-circle');
                notes.forEach(note => {
                    // Check if this note has any highlighting classes
                    const hasHighlightClass = note.classList.contains('kpic-highlight') ||
                                            note.classList.contains('kric-highlight') ||
                                            note.classList.contains('syllable-repetition') ||
                                            note.classList.contains('syllable-focus') ||
                                            note.classList.contains('syllable-melismatic') ||
                                            note.classList.contains('grace-main-unit') ||
                                            note.classList.contains('syllable-tone') ||
                                            note.classList.contains('pattern-member') ||
                                            Array.from(note.classList).some(cls => cls.startsWith('pattern-color-')) ||
                                            Array.from(note.classList).some(cls => cls.startsWith('tone-'));
                    
                    // If no highlighting class, dim the note
                    if (!hasHighlightClass) {
                        note.classList.add('note-dimmed');
                    }
                });
            }
            
        }
        
        function highlightCorrespondingLyrics(notePositions, color, patternType, patternIndex) {
            // Create a more accurate syllable-note mapping
            const syllableCoverage = new Map(); // syllableIndex -> {total: X, covered: Y}
            
            // For each note position, find which syllable it EXACTLY belongs to (prevents cross-contamination)
            notePositions.forEach(notePos => {
                // Find the exact syllable that owns this note
                const syllables = document.querySelectorAll('.editable-syllable');
                let foundSyllable = null;

                for (const syllableElement of syllables) {
                    const syllablePos = parseInt(syllableElement.getAttribute('data-position'));
                    const syllableTitle = syllableElement.getAttribute('title');
                    const syllableIndex = parseInt(syllableElement.getAttribute('data-syllable-index'));

                    // Get exact syllable range using note count
                    let syllableStartPos = syllablePos;
                    let syllableEndPos = syllablePos;

                    let noteCountMatch = syllableTitle.match(/\((\d+) notes?\)/);
                    if (!noteCountMatch) {
                        noteCountMatch = syllableTitle.match(/\(melismatic, (\d+) notes?\)/);
                    }

                    if (noteCountMatch) {
                        const noteCount = parseInt(noteCountMatch[1]);
                        syllableEndPos = syllableStartPos + noteCount - 1;
                    }

                    // Check if note EXACTLY belongs to this syllable
                    if (notePos >= syllableStartPos && notePos <= syllableEndPos) {
                        foundSyllable = { index: syllableIndex, element: syllableElement };
                        break; // Found exact match, stop searching to prevent cross-contamination
                    }
                }

                if (foundSyllable) {
                    if (!syllableCoverage.has(foundSyllable.index)) {
                        syllableCoverage.set(foundSyllable.index, {total: 1, covered: 1});
                    } else {
                        const coverage = syllableCoverage.get(foundSyllable.index);
                        coverage.covered++;
                    }
                }
            });
            
            // Apply highlighting with coverage indicators
            syllableCoverage.forEach((coverage, syllableIndex) => {
                const syllableElement = document.querySelector(`[data-syllable-index="${syllableIndex}"]`);
                if (syllableElement) {
                    // Store original title for clearing
                    if (!syllableElement.getAttribute('data-original-title')) {
                        syllableElement.setAttribute('data-original-title', syllableElement.title || '');
                    }
                    
                    // Add pattern highlighting with same colors as tablature
                    syllableElement.classList.add(`lyrics-pattern-${patternIndex}`);
                    syllableElement.style.backgroundColor = color;
                    syllableElement.style.color = 'white';
                    syllableElement.style.borderRadius = '3px';
                    syllableElement.style.padding = '2px 4px';
                    syllableElement.style.fontWeight = 'bold';
                    
                    // Coverage analysis
                    const coverageRatio = coverage.covered / coverage.total;
                    
                    if (coverageRatio < 1.0) {
                        // Partial coverage - add warning indicators
                        syllableElement.style.border = '2px dashed orange';
                        syllableElement.style.position = 'relative';
                        
                        // Add coverage percentage to title
                        const coveragePercent = Math.round(coverageRatio * 100);
                        syllableElement.title = syllableElement.getAttribute('data-original-title') + 
                            ` [${patternType} Pattern ${patternIndex + 1} - ${coveragePercent}% coverage]`;
                        
                        // Add visual indicator
                        if (!syllableElement.querySelector('.coverage-indicator')) {
                            const indicator = document.createElement('span');
                            indicator.className = 'coverage-indicator';
                            indicator.textContent = '‚ö†';
                            indicator.style.position = 'absolute';
                            indicator.style.top = '-5px';
                            indicator.style.right = '-5px';
                            indicator.style.fontSize = '8px';
                            indicator.style.color = 'orange';
                            indicator.style.fontWeight = 'bold';
                            syllableElement.style.position = 'relative';
                            syllableElement.appendChild(indicator);
                        }
                    } else {
                        // Full coverage
                        syllableElement.title = syllableElement.getAttribute('data-original-title') + 
                            ` [${patternType} Pattern ${patternIndex + 1} - Full Match]`;
                    }
                }
            });
        }
        
        function drawConsecutiveConnections(positions, color, strokeWidth = 2, patternId = '') {
            // Only connect consecutive positions to avoid long-distance network connections
            const svg = document.querySelector('svg');
            if (!svg || positions.length < 2) return;
            
            // Sort positions
            const sortedPositions = [...positions].sort((a, b) => a - b);
            
            // Find groups of consecutive positions
            const consecutiveGroups = [];
            let currentGroup = [sortedPositions[0]];
            
            for (let i = 1; i < sortedPositions.length; i++) {
                if (sortedPositions[i] === sortedPositions[i-1] + 1) {
                    // Consecutive position, add to current group
                    currentGroup.push(sortedPositions[i]);
                } else {
                    // Non-consecutive, start new group
                    if (currentGroup.length > 1) {
                        consecutiveGroups.push(currentGroup);
                    }
                    currentGroup = [sortedPositions[i]];
                }
            }
            
            // Add the last group if it has multiple positions
            if (currentGroup.length > 1) {
                consecutiveGroups.push(currentGroup);
            }
            
            // Draw connections within each consecutive group
            consecutiveGroups.forEach((group, groupIndex) => {
                for (let i = 0; i < group.length - 1; i++) {
                    const currentPos = group[i];
                    const nextPos = group[i + 1];
                    
                    const currentNote = document.getElementById(`note-${currentPos}`);
                    const nextNote = document.getElementById(`note-${nextPos}`);
                    
                    if (currentNote && nextNote) {
                        // Get note centers
                        const currentX = parseFloat(currentNote.getAttribute('cx'));
                        const currentY = parseFloat(currentNote.getAttribute('cy'));
                        const nextX = parseFloat(nextNote.getAttribute('cx'));
                        const nextY = parseFloat(nextNote.getAttribute('cy'));
                        
                        // Create connection line
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', currentX);
                        line.setAttribute('y1', currentY);
                        line.setAttribute('x2', nextX);
                        line.setAttribute('y2', nextY);
                        line.setAttribute('stroke', color);
                        line.setAttribute('stroke-width', strokeWidth);
                        line.setAttribute('opacity', '0.8');
                        line.setAttribute('class', `pattern-connection-line pattern-${patternId}-group-${groupIndex}`);
                        
                        // Store base coordinates for zoom scaling
                        line.setAttribute('data-base-x1', currentX);
                        line.setAttribute('data-base-y1', currentY);
                        line.setAttribute('data-base-x2', nextX);
                        line.setAttribute('data-base-y2', nextY);
                        
                        // Insert line before notes so it appears behind them
                        const firstNote = svg.querySelector('.note-circle');
                        if (firstNote) {
                            svg.insertBefore(line, firstNote);
                        } else {
                            svg.appendChild(line);
                        }
                    }
                }
            });
        }
        
        function drawSimpleConnections(positions, color, strokeWidth = 2, patternId = '') {
            // Simple, clean connection logic - just connect consecutive notes
            console.log(`drawSimpleConnections called: positions=[${positions}], color=${color}, pattern=${patternId}`);
            const svg = document.querySelector('svg');
            if (!svg || positions.length < 2) {
                console.log(`Cannot draw connections: svg=${!!svg}, positions.length=${positions.length}`);
                return;
            }

            // Sort positions to ensure proper connection order
            const sortedPositions = [...positions].sort((a, b) => a - b);
            console.log(`Sorted positions: [${sortedPositions}]`);

            // Draw simple consecutive connections
            for (let i = 0; i < sortedPositions.length - 1; i++) {
                const pos1 = sortedPositions[i];
                const pos2 = sortedPositions[i + 1];

                const note1 = document.getElementById(`note-${pos1}`);
                const note2 = document.getElementById(`note-${pos2}`);

                if (!note1 || !note2) {
                    console.log(`Missing notes: note-${pos1}=${!!note1}, note-${pos2}=${!!note2}`);
                    continue;
                }

                const x1 = parseFloat(note1.getAttribute('cx'));
                const y1 = parseFloat(note1.getAttribute('cy'));
                const x2 = parseFloat(note2.getAttribute('cx'));
                const y2 = parseFloat(note2.getAttribute('cy'));

                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x1);
                line.setAttribute('y1', y1);
                line.setAttribute('x2', x2);
                line.setAttribute('y2', y2);
                line.setAttribute('stroke', color);
                line.setAttribute('stroke-width', strokeWidth);
                line.setAttribute('opacity', '0.8');
                line.setAttribute('class', `pattern-connection-line pattern-${patternId}-line-${i}`);

                // Store base coordinates for zoom scaling
                line.setAttribute('data-base-x1', note1.getAttribute('data-base-x') || x1);
                line.setAttribute('data-base-y1', note1.getAttribute('data-base-y') || y1);
                line.setAttribute('data-base-x2', note2.getAttribute('data-base-x') || x2);
                line.setAttribute('data-base-y2', note2.getAttribute('data-base-y') || y2);

                // Insert line before notes so it appears behind them
                const firstNote = svg.querySelector('.note-circle');
                if (firstNote) {
                    svg.insertBefore(line, firstNote);
                } else {
                    svg.appendChild(line);
                }

                console.log(`‚úÖ Created simple line ${i}: note-${pos1} ‚Üí note-${pos2} (${x1},${y1}) ‚Üí (${x2},${y2})`);
            }

            console.log(`‚úÖ drawSimpleConnections completed for pattern ${patternId}: ${sortedPositions.length - 1} lines drawn`);
        }

        // ===== SYNCHRONIZATION SYSTEM =====

        function syncPatternSelection(pattern, source = 'unknown') {
            console.log(`üîÑ Syncing pattern selection: ${pattern.join(' ‚Üí ')} from ${source}`);

            // 1. Update dropdown selection
            syncDropdownSelection(pattern);

            // 2. Update Sankey band highlighting
            syncSankeySelection(pattern);

            // 3. Update tablature highlighting
            syncTablatureHighlighting(pattern);
        }

        function syncDropdownSelection(pattern) {
            const patternSelect = document.getElementById('specificKpicPattern');
            if (!patternSelect) return;

            // Find matching pattern in dropdown
            const patternStr = pattern.join(' ‚Üí ');
            for (let i = 0; i < patternSelect.options.length; i++) {
                const optionText = patternSelect.options[i].textContent;
                if (optionText.startsWith(patternStr + ' (')) {
                    patternSelect.options[i].selected = true;
                    console.log(`‚úÖ Selected dropdown pattern: ${optionText}`);
                    break;
                }
            }

            // Trigger highlighting update
            updateHighlighting();
        }

        function syncSankeySelection(pattern) {
            // Clear previous Sankey selections
            document.querySelectorAll('.sankey-link').forEach(link => {
                link.classList.remove('selected-band');
                link.style.stroke = link.getAttribute('data-original-stroke') || link.style.stroke;
                link.style.strokeWidth = link.getAttribute('data-original-width') || link.style.strokeWidth;
            });

            // Find and highlight matching Sankey band
            const patternStr = pattern.join('-');
            document.querySelectorAll('.sankey-link').forEach(link => {
                const bandPattern = link.getAttribute('data-pattern-raw');
                if (bandPattern === patternStr) {
                    link.classList.add('selected-band');
                    const currentStroke = link.style.stroke;
                    const currentWidth = link.style.strokeWidth;
                    link.setAttribute('data-original-stroke', currentStroke);
                    link.setAttribute('data-original-width', currentWidth);
                    link.style.stroke = currentStroke.replace('0.5', '0.9');
                    link.style.strokeWidth = Math.min(16, parseInt(currentWidth) + 4);
                    console.log(`‚úÖ Highlighted Sankey band: ${bandPattern}`);
                }
            });
        }

        function syncSankeySelectionForPattern(pattern) {
            console.log(`üîÑ syncSankeySelectionForPattern called with pattern:`, pattern);

            // Clear previous Sankey selections first
            document.querySelectorAll('.sankey-link').forEach(link => {
                link.classList.remove('selected-band', 'dramatic-kpic-glow');
                const originalStroke = link.getAttribute('data-original-stroke');
                const originalWidth = link.getAttribute('data-original-width');
                if (originalStroke) link.style.stroke = originalStroke;
                if (originalWidth) link.style.strokeWidth = originalWidth;
                link.style.filter = '';
                link.style.animation = '';
            });

            // Remove grace prefixes for Sankey matching
            const cleanPattern = pattern.map(note => note.startsWith('g') ? note.substring(1) : note);
            const patternStr = cleanPattern.join('-');
            console.log(`üîç Looking for Sankey band with pattern: ${patternStr}`);

            let foundBands = 0;
            document.querySelectorAll('.sankey-link').forEach(link => {
                const bandPattern = link.getAttribute('data-pattern-raw');
                console.log(`   Checking band: ${bandPattern} vs ${patternStr}`);

                if (bandPattern === patternStr) {
                    link.classList.add('selected-band');
                    const currentStroke = link.style.stroke || link.getAttribute('stroke');
                    const currentWidth = link.style.strokeWidth || link.getAttribute('stroke-width');

                    // Store original values
                    link.setAttribute('data-original-stroke', currentStroke);
                    link.setAttribute('data-original-width', currentWidth);

                    // Apply DRAMATIC 2-layer highlighting: glow behind + original on top
                    link.style.stroke = '#ff0000'; // Bright red
                    link.style.strokeWidth = Math.max(8, parseInt(currentWidth) * 1.5);
                    link.style.opacity = '1.0';

                    // Add dramatic glow effect directly to the original band
                    link.style.filter = 'drop-shadow(0 0 8px #ff0000) drop-shadow(0 0 16px #ff0000) drop-shadow(0 0 24px #ff0000)';
                    link.style.animation = 'sankeyPulse 2s ease-in-out infinite';

                    // Add CSS class for additional glow via stylesheet
                    link.classList.add('dramatic-kpic-glow');

                    foundBands++;
                    console.log(`‚úÖ DRAMATICALLY highlighted Sankey band: ${bandPattern} (stroke: ${link.style.stroke}, width: ${link.style.strokeWidth})`);
                }
            });

            console.log(`üéØ Total bands highlighted: ${foundBands}`);
        }

        function syncKricSankeySelectionForPattern(pattern) {
            console.log(`üîÑ syncKricSankeySelectionForPattern called with pattern:`, pattern);

            // Clear previous KRIC Sankey selections first
            document.querySelectorAll('#rhythm-sankey-svg .sankey-link').forEach(link => {
                link.classList.remove('selected-band', 'dramatic-kric-glow');
                const originalStroke = link.getAttribute('data-original-stroke');
                const originalWidth = link.getAttribute('data-original-width');
                if (originalStroke) link.style.stroke = originalStroke;
                if (originalWidth) link.style.strokeWidth = originalWidth;
                link.style.filter = '';
                link.style.animation = '';
            });

            // Find and highlight matching KRIC Sankey band
            const patternStr = pattern.join('-');
            console.log(`üîç Looking for KRIC Sankey band with pattern: ${patternStr}`);

            let foundBands = 0;
            document.querySelectorAll('#rhythm-sankey-svg .sankey-link').forEach(link => {
                const bandPattern = link.getAttribute('data-pattern-raw');
                if (bandPattern === patternStr) {
                    link.classList.add('selected-band');
                    const currentStroke = link.style.stroke || link.getAttribute('stroke');
                    const currentWidth = link.style.strokeWidth || link.getAttribute('stroke-width');

                    // Store original values
                    link.setAttribute('data-original-stroke', currentStroke);
                    link.setAttribute('data-original-width', currentWidth);

                    // Apply DRAMATIC 2-layer highlighting: blue glow for KRIC
                    link.style.stroke = '#2196f3'; // Bright blue
                    link.style.strokeWidth = Math.max(8, parseInt(currentWidth) * 1.5);
                    link.style.opacity = '1.0';

                    // Add dramatic blue glow effect
                    link.style.filter = 'drop-shadow(0 0 8px #2196f3) drop-shadow(0 0 16px #2196f3) drop-shadow(0 0 24px #2196f3)';
                    link.style.animation = 'kricPulse 2s ease-in-out infinite';

                    // Add CSS class for additional glow via stylesheet
                    link.classList.add('dramatic-kric-glow');

                    foundBands++;
                    console.log(`‚úÖ Created 2-layer blue glow for KRIC Sankey band: ${bandPattern}`);
                }
            });

            console.log(`üéØ Total KRIC bands highlighted: ${foundBands}`);
        }

        function syncTablatureHighlighting(pattern) {
            // This is handled by updateHighlighting() which is called from syncDropdownSelection
            console.log(`‚úÖ Tablature highlighting synced via updateHighlighting()`);
        }

        function showAndScrollToSankey() {
            const kpicFilter = window.kpicThreshold || 'none';

            // Check if this is KPIC-3 and open the KPIC-3 Sankey window instead
            if (kpicFilter === 'kpic-3') {
                console.log('‚úÖ Opening KPIC-3 Sankey window');
                showContent('kpic3-kric3-sankey');
                return;
            }

            // For KPIC-2 and other patterns, show the traditional KPIC-2 Sankey
            const sankeyContainer = document.getElementById('kpic-sankey');
            if (sankeyContainer) {
                // Make sure the parent containers are expanded
                const analysisContainer = sankeyContainer.closest('.analysis-container');
                if (analysisContainer && analysisContainer.style.display === 'none') {
                    analysisContainer.style.display = 'block';
                }

                // Scroll the Sankey into view
                sankeyContainer.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });

                // Add a subtle highlight effect to draw attention
                sankeyContainer.style.transition = 'box-shadow 0.3s ease';
                sankeyContainer.style.boxShadow = '0 0 20px rgba(255, 152, 0, 0.5)';
                setTimeout(() => {
                    sankeyContainer.style.boxShadow = '';
                }, 2000);

                console.log('‚úÖ KPIC-2 Sankey diagram shown and scrolled into view');
            }
        }

        function showTransitionAnalysisWindow() {
            // Show the KPIC-2 & KRIC-2 Transition Analysis window
            const kpicActive = window.kpicThreshold === 'kpic-2';
            const kricActive = window.kricThreshold === 'kric-2';

            if (kpicActive || kricActive) {
                console.log('üéØ Showing Transition Analysis window for KPIC-2/KRIC-2');

                // Use the existing showContent function which properly generates Sankey diagrams
                showContent('kpic-kric-sankey');

                // Add extra highlight effect after a short delay
                setTimeout(() => {
                    const contentArea = document.getElementById('content-area');
                    if (contentArea && contentArea.style.display === 'block') {
                        // Add highlight effect
                        contentArea.style.transition = 'box-shadow 0.3s ease';
                        contentArea.style.boxShadow = '0 0 30px rgba(155, 89, 182, 0.4)';
                        setTimeout(() => {
                            contentArea.style.boxShadow = '';
                        }, 3000);

                        console.log('‚úÖ Transition Analysis window highlighted');
                    }
                }, 800);
            }
        }

        // Add click handler to Sankey bands
        function addSankeyClickHandlers() {
            // Handle KPIC-2/KRIC-2 bands
            document.querySelectorAll('.sankey-link.clickable-band').forEach(band => {
                band.addEventListener('click', function(e) {
                    e.stopPropagation();

                    const patternRaw = this.getAttribute('data-pattern-raw');
                    if (patternRaw) {
                        const pattern = patternRaw.split('-');
                        console.log(`üñ±Ô∏è Sankey band clicked: ${pattern.join(' ‚Üí ')}`);
                        syncPatternSelection(pattern, 'sankey');
                    }
                });
            });

            // Handle KPIC-3/KRIC-3 bands
            document.querySelectorAll('.clickable-band-3col').forEach(band => {
                band.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();

                    const type = this.getAttribute('data-type');
                    const patternArray = JSON.parse(this.getAttribute('data-pattern-array'));
                    const positionsArray = JSON.parse(this.getAttribute('data-positions-array'));
                    const isMultiSelect = e.ctrlKey || e.metaKey;

                    console.log(`üñ±Ô∏è 3-Column band clicked: ${patternArray.join(' ‚Üí ')}, type: ${type}, multiSelect: ${isMultiSelect}`);

                    // Highlight the pattern in tablature
                    highlightThreeNotePattern(type, patternArray, positionsArray);

                    // If it's a pitch pattern, also trigger the dropdown selection
                    if (type === 'pitch') {
                        triggerKPIC3Pattern(patternArray, isMultiSelect);
                    }

                    // If it's a rhythm pattern, trigger KRIC-3 dropdown
                    if (type === 'rhythm') {
                        console.log(`üéµ Triggering KRIC-3 dropdown for rhythm pattern: ${patternArray.join(' ‚Üí ')}`);
                        triggerKRIC3Pattern(patternArray, isMultiSelect);
                    }
                });
            });

            console.log(`‚úÖ Added click handlers to ${document.querySelectorAll('.sankey-link.clickable-band').length} KPIC-2 bands and ${document.querySelectorAll('.clickable-band-3col').length} KPIC-3 bands`);
        }

        // Add click handler for tablature notes to find their patterns
        function addTablaturePatternSync() {
            document.querySelectorAll('.note-circle').forEach(circle => {
                const originalHandler = circle.onclick;

                circle.addEventListener('contextmenu', function(e) {
                    e.preventDefault(); // Prevent context menu

                    const noteIndex = parseInt(this.getAttribute('data-note-index'));
                    const pitch = getPitchFromAnalysisData(noteIndex);

                    // Find patterns that include this note
                    findPatternsContainingNote(noteIndex, pitch);
                });
            });
        }

        function findPatternsContainingNote(noteIndex, pitch) {
            console.log(`üîç Finding patterns containing note ${noteIndex} (${pitch})`);

            // Look for KPIC-2 patterns containing this note
            const kpicFilter = window.kpicThreshold || 'kpic-2';
            if (kpicFilter.startsWith('kpic-')) {
                const analysisMode = document.querySelector('input[name="analysisMode"]:checked')?.value || 'full';
                const modePatterns = analysisData.kpic_patterns[analysisMode] || analysisData.kpic_patterns.full;
                const patterns = modePatterns[kpicFilter] || [];

                patterns.forEach(pattern => {
                    pattern.positions.forEach(startPos => {
                        for (let i = 0; i < pattern.pattern.length; i++) {
                            if (startPos + i === noteIndex) {
                                console.log(`üìç Found pattern: ${pattern.pattern.join(' ‚Üí ')} starting at ${startPos}`);
                                syncPatternSelection(pattern.pattern, 'tablature');
                                return;
                            }
                        }
                    });
                });
            }
        }

        // Handle Sankey band clicks
        function handleSankeyBandClick(bandElement, patternRaw) {
            console.log(`üñ±Ô∏è Sankey band clicked: ${patternRaw}`);

            const pattern = patternRaw.split('-');
            syncPatternSelection(pattern, 'sankey');
        }

        function drawGraceAwareConnections(positions, color, strokeWidth = 2, patternId = '') {
            console.log(`üéØ drawGraceAwareConnections called: positions=${positions}, color=${color}, patternId=${patternId}`);

            // Smart connection logic that respects grace-main units
            const svg = document.querySelector('svg');
            if (!svg || positions.length < 2) {
                console.log(`üéØ drawGraceAwareConnections early return: svg=${!!svg}, positions.length=${positions.length}`);
                return;
            }
            
            // Sort positions to ensure proper connection order
            const sortedPositions = [...positions].sort((a, b) => a - b);
            
            // Helper function to create a line
            function createConnectionLine(pos1, pos2, lineId) {
                console.log(`üéØ Creating line between note-${pos1} and note-${pos2}, lineId: ${lineId}`);
                const note1 = document.getElementById(`note-${pos1}`);
                const note2 = document.getElementById(`note-${pos2}`);

                if (!note1 || !note2) {
                    console.log(`üéØ Line creation failed: note1=${!!note1}, note2=${!!note2}`);
                    return;
                }
                
                // Use base coordinates if available, otherwise current coordinates
                const baseX1 = parseFloat(note1.getAttribute('data-base-x') || note1.getAttribute('cx'));
                const baseY1 = parseFloat(note1.getAttribute('data-base-y') || note1.getAttribute('cy'));
                const baseX2 = parseFloat(note2.getAttribute('data-base-x') || note2.getAttribute('cx'));
                const baseY2 = parseFloat(note2.getAttribute('data-base-y') || note2.getAttribute('cy'));
                
                // Use current coordinates for display
                const x1 = parseFloat(note1.getAttribute('cx'));
                const y1 = parseFloat(note1.getAttribute('cy'));
                const x2 = parseFloat(note2.getAttribute('cx'));
                const y2 = parseFloat(note2.getAttribute('cy'));
                
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x1);
                line.setAttribute('y1', y1);
                line.setAttribute('x2', x2);
                line.setAttribute('y2', y2);
                line.setAttribute('stroke', '#ff0000'); // Bright red lines
                line.setAttribute('stroke-width', '8'); // Very thick lines
                line.setAttribute('opacity', '1.0'); // Fully opaque
                line.setAttribute('class', `pattern-connection-line pattern-${patternId}-${lineId}`);

                // Store base coordinates for zoom scaling
                line.setAttribute('data-base-x1', baseX1);
                line.setAttribute('data-base-y1', baseY1);
                line.setAttribute('data-base-x2', baseX2);
                line.setAttribute('data-base-y2', baseY2);

                // Insert line before notes so it appears behind them
                const firstNote = svg.querySelector('.note-circle');
                if (firstNote) {
                    svg.insertBefore(line, firstNote);
                    console.log(`üéØ Line inserted before first note: ${lineId}, coordinates: (${x1},${y1}) ‚Üí (${x2},${y2})`);
                } else {
                    svg.appendChild(line);
                    console.log(`üéØ Line appended to svg: ${lineId}, coordinates: (${x1},${y1}) ‚Üí (${x2},${y2})`);
                }
            }
            
            // Process connections with grace-aware logic
            for (let i = 0; i < sortedPositions.length; i++) {
                const currentPos = sortedPositions[i];
                const currentNote = document.getElementById(`note-${currentPos}`);
                if (!currentNote) continue;
                
                const currentIsGrace = currentNote.getAttribute('data-is-grace') === 'true';
                
                if (currentIsGrace) {
                    // Grace note: connect to immediately following note (grace or main)
                    if (i + 1 < sortedPositions.length) {
                        const nextPos = sortedPositions[i + 1];
                        createConnectionLine(currentPos, nextPos, `grace-${i}`);
                    }
                } else {
                    // Main note: connect to next main note (skip any intervening grace notes)
                    for (let j = i + 1; j < sortedPositions.length; j++) {
                        const targetPos = sortedPositions[j];
                        const targetNote = document.getElementById(`note-${targetPos}`);
                        if (!targetNote) continue;
                        
                        const targetIsGrace = targetNote.getAttribute('data-is-grace') === 'true';
                        
                        if (!targetIsGrace) {
                            // Found next main note, connect to it
                            createConnectionLine(currentPos, targetPos, `main-${i}-${j}`);
                            break;
                        }
                        // Skip grace notes and continue looking for main note
                    }
                }
            }
        }
        
        function drawPatternConnections(positions, color, strokeWidth = 2, patternId = '') {
            const svg = document.querySelector('svg');
            if (!svg || positions.length < 2) return;
            
            // Sort positions to ensure proper connection order
            const sortedPositions = [...positions].sort((a, b) => a - b);
            
            for (let i = 0; i < sortedPositions.length - 1; i++) {
                const currentPos = sortedPositions[i];
                const nextPos = sortedPositions[i + 1];
                
                const currentNote = document.getElementById(`note-${currentPos}`);
                const nextNote = document.getElementById(`note-${nextPos}`);
                
                if (currentNote && nextNote) {
                    // Get note centers
                    const currentX = parseFloat(currentNote.getAttribute('cx'));
                    const currentY = parseFloat(currentNote.getAttribute('cy'));
                    const nextX = parseFloat(nextNote.getAttribute('cx'));
                    const nextY = parseFloat(nextNote.getAttribute('cy'));
                    
                    // Create connection line
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', currentX);
                    line.setAttribute('y1', currentY);
                    line.setAttribute('x2', nextX);
                    line.setAttribute('y2', nextY);
                    line.setAttribute('stroke', color);
                    line.setAttribute('stroke-width', strokeWidth);
                    line.setAttribute('opacity', '0.8');
                    line.setAttribute('class', `pattern-connection-line pattern-${patternId}`);
                    
                    // Store base coordinates for zoom scaling
                    line.setAttribute('data-base-x1', currentX);
                    line.setAttribute('data-base-y1', currentY);
                    line.setAttribute('data-base-x2', nextX);
                    line.setAttribute('data-base-y2', nextY);
                    
                    // Insert line before notes so it appears behind them
                    const firstNote = svg.querySelector('.note-circle');
                    if (firstNote) {
                        svg.insertBefore(line, firstNote);
                    } else {
                        svg.appendChild(line);
                    }
                }
            }

            // Keep gradient bands - don't update to solid colors
            setTimeout(() => {
                // updateResonanceBandColors(); // Commented out to preserve gradients
            }, 100);
        }

        function clearHighlighting() {
            const notes = document.querySelectorAll('.note-circle');
            notes.forEach(note => {
                note.classList.remove('kpic-highlight', 'kric-highlight', 'syllable-repetition', 'syllable-focus', 
                                     'syllable-melismatic', 'grace-main-unit', 'syllable-tone', 'pattern-member',
                                     'tone-sac', 'tone-huyen', 'tone-hoi', 'tone-nga', 'tone-nang', 'tone-ngang',
                                     'note-dimmed');
                // Remove pattern color classes
                for (let i = 0; i < 5; i++) {
                    note.classList.remove(`pattern-color-${i}`);
                }
                note.removeAttribute('data-pattern-type');
                note.removeAttribute('data-pattern-info');
                note.removeAttribute('data-syllable-info');

                // Clear inline styles that override CSS
                note.style.removeProperty('filter');
                note.style.removeProperty('stroke');
                note.style.removeProperty('stroke-width');
                note.style.removeProperty('opacity');

                // Clear SVG attributes
                note.removeAttribute('fill');
                note.removeAttribute('stroke');
                note.removeAttribute('stroke-width');
                note.removeAttribute('opacity');
                note.removeAttribute('filter');
            });
            
            // Remove all pattern connection lines
            const existingLines = document.querySelectorAll('.pattern-connection-line');
            existingLines.forEach(line => line.remove());

            // Reset resonance band colors to default
            const svg = document.getElementById('tablatureSvg');
            const allRects = svg.querySelectorAll('rect');
            const resonanceBands = Array.from(allRects).filter(rect => {
                const fill = rect.getAttribute('fill');
                return fill && (fill.includes('resonanceBand') || fill.includes('dynamicResonance'));
            });

            resonanceBands.forEach((band) => {
                // Determine if this is a grace note band based on height
                const height = parseFloat(band.getAttribute('height'));
                if (height <= 6) {
                    band.setAttribute('fill', 'url(#graceResonanceBand)');
                } else {
                    band.setAttribute('fill', 'url(#resonanceBand)');
                }
            });

            // Clear lyrics highlighting
            const lyricsElements = document.querySelectorAll('.editable-syllable');
            lyricsElements.forEach(syllable => {
                // Remove pattern highlighting classes
                for (let i = 0; i < 10; i++) {
                    syllable.classList.remove(`lyrics-pattern-${i}`);
                }
                // Reset styles
                syllable.style.backgroundColor = '';
                syllable.style.color = '';
                syllable.style.border = '';
                syllable.style.borderRadius = '';
                syllable.style.padding = '2px 4px';
                
                // Reset title to original content
                const originalTitle = syllable.getAttribute('data-original-title');
                if (originalTitle) {
                    syllable.title = originalTitle;
                } else {
                    // Remove pattern info from title
                    syllable.title = syllable.title.replace(/\s*\[.*?Pattern.*?\]/g, '');
                }
            });

            // Clear KPIC-3 Sankey highlighting
            document.querySelectorAll('.sankey-band-3col, .clickable-band-3col').forEach(band => {
                band.classList.remove('selected-band-3col');
                band.style.stroke = '';
                band.style.strokeWidth = '';
                band.style.filter = '';
            });
        }
        
        function showLegend() {
            const legend = document.getElementById('legend');

            if (legend.style.display === 'none') {
                // Show the floating legend in bottom right corner
                legend.style.display = 'block';
                legend.style.position = 'fixed';
                legend.style.bottom = '20px';
                legend.style.right = '20px';
                legend.style.top = '';
                legend.style.left = '';
                legend.style.transform = '';
                legend.style.zIndex = '1001';
                legend.style.boxShadow = '0 8px 24px rgba(0,0,0,0.2)';
                legend.style.border = '2px solid #34495e';
                legend.style.maxWidth = '320px';
                legend.style.maxHeight = '60vh';
                legend.style.overflow = 'auto';
            } else {
                // Hide the legend
                legend.style.display = 'none';
                // Reset positioning properties
                legend.style.position = '';
                legend.style.top = '';
                legend.style.left = '';
                legend.style.bottom = '';
                legend.style.right = '';
                legend.style.transform = '';
                legend.style.zIndex = '';
                legend.style.boxShadow = '';
                legend.style.border = '';
                legend.style.maxWidth = '';
                legend.style.maxHeight = '';
                legend.style.overflow = '';
            }
        }
        
        function toggleSection(sectionId) {
            const content = document.getElementById(`${sectionId}-content`);
            const icon = document.getElementById(`${sectionId}-icon`);
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
                icon.textContent = '‚ñº';
            } else {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
                icon.textContent = '‚ñ∂';
            }
        }
        
        function toggleLineBreak(syllableIndex) {
            const breakElement = document.querySelector(`[data-break-after="${syllableIndex}"]`);
            if (!breakElement) return;

            // Simply toggle the active class - CSS handles the line break
            breakElement.classList.toggle('active');

            // Update lyrics playback controls when line breaks change
            updateLyricsPlaybackControls();
        }

        // Variables for lyrics line playback
        let lyricsLinePlaybackState = {
            isPlaying: false,
            currentLineIndex: -1,
            isLooping: false,
            timeouts: [],
            currentPlaybackNotes: []
        };

        function updateLyricsPlaybackControls() {
            // Remove any existing playback buttons
            document.querySelectorAll('.lyrics-playback-buttons').forEach(btn => btn.remove());

            const lines = getLyricsLines();
            const lyricsContainer = document.getElementById('editable-lyrics');
            if (!lyricsContainer) return;

            // First, add buttons for the first line at the beginning
            if (lines.length > 0) {
                const firstLine = lines[0];
                const firstSyllable = lyricsContainer.querySelector('.syllable');
                if (firstSyllable) {
                    const buttonContainer = createPlaybackButtons(0, lines);
                    buttonContainer.style.marginRight = '8px';
                    firstSyllable.parentNode.insertBefore(buttonContainer, firstSyllable);
                }
            }

            // Then add buttons after each active line break for the NEXT line
            const activeBreaks = Array.from(lyricsContainer.querySelectorAll('.line-break.active'));

            activeBreaks.forEach((lineBreak) => {
                const breakAfterIndex = parseInt(lineBreak.getAttribute('data-break-after'));

                // Find which line this break ENDS, then the next line gets the buttons
                let lineIndexAfterBreak = -1;
                lines.forEach((line, lineIdx) => {
                    // Check if this break ends this line, then the buttons are for the NEXT line
                    if (line.endSyllableIndex === breakAfterIndex && lineIdx + 1 < lines.length) {
                        lineIndexAfterBreak = lineIdx + 1;
                    }
                });

                if (lineIndexAfterBreak === -1) return; // Skip if we can't find the next line

                const buttonContainer = createPlaybackButtons(lineIndexAfterBreak, lines);

                // Insert the button container right after the line break
                lineBreak.parentNode.insertBefore(buttonContainer, lineBreak.nextSibling);
            });
        }

        function createPlaybackButtons(lineIndex, lines) {
            // Create button container
            const buttonContainer = document.createElement('span');
            buttonContainer.className = 'lyrics-playback-buttons';
            buttonContainer.style.cssText = 'margin-left: 8px; display: inline-block; vertical-align: middle;';

            // Check if audio is enabled
            const audioEnabled = !!audioContext;

            // Create play button
            const playBtn = document.createElement('button');
            playBtn.innerHTML = '‚ñ∂Ô∏è';
            playBtn.title = audioEnabled ? `Play line ${lineIndex + 1}: "${lines[lineIndex]?.text}"` : 'Enable Audio first';
            playBtn.disabled = !audioEnabled;
            playBtn.style.cssText = `margin-right: 3px; padding: 1px 4px; font-size: 9px; background: ${audioEnabled ? '#4CAF50' : '#ccc'}; color: white; border: none; border-radius: 2px; cursor: ${audioEnabled ? 'pointer' : 'not-allowed'}; vertical-align: middle;`;
            playBtn.onclick = (e) => {
                e.stopPropagation();
                if (audioEnabled) playLyricsLine(lineIndex, false);
            };

            // Create loop button
            const loopBtn = document.createElement('button');
            loopBtn.innerHTML = 'üîÑ';
            loopBtn.title = audioEnabled ? `Loop line ${lineIndex + 1}` : 'Enable Audio first';
            loopBtn.disabled = !audioEnabled;
            loopBtn.style.cssText = `margin-right: 3px; padding: 1px 4px; font-size: 9px; background: ${audioEnabled ? '#2196F3' : '#ccc'}; color: white; border: none; border-radius: 2px; cursor: ${audioEnabled ? 'pointer' : 'not-allowed'}; vertical-align: middle;`;
            loopBtn.onclick = (e) => {
                e.stopPropagation();
                if (audioEnabled) playLyricsLine(lineIndex, true);
            };

            // Create stop button
            const stopBtn = document.createElement('button');
            stopBtn.innerHTML = '‚èπÔ∏è';
            stopBtn.title = audioEnabled ? 'Stop playback' : 'Enable Audio first';
            stopBtn.disabled = !audioEnabled;
            stopBtn.style.cssText = `padding: 1px 4px; font-size: 9px; background: ${audioEnabled ? '#f44336' : '#ccc'}; color: white; border: none; border-radius: 2px; cursor: ${audioEnabled ? 'pointer' : 'not-allowed'}; vertical-align: middle;`;
            stopBtn.onclick = (e) => {
                e.stopPropagation();
                if (audioEnabled) {
                    stopLyricsLinePlayback();
                    stopPlayback(); // Stop both line and full song playback
                }
            };

            // Highlight buttons if this line is currently playing
            if (audioEnabled && lyricsLinePlaybackState.isPlaying && lyricsLinePlaybackState.currentLineIndex === lineIndex) {
                playBtn.style.background = '#66BB6A';
                loopBtn.style.background = '#42A5F5';
                stopBtn.style.background = '#EF5350';
            }

            // Get the line text for tooltips
            const lineText = lines[lineIndex]?.text || `Line ${lineIndex + 1}`;
            const shortText = lineText.length > 30 ? lineText.substring(0, 30) + '...' : lineText;

            // Create phonetic guide button
            const phoneticBtn = document.createElement('button');
            phoneticBtn.innerHTML = 'üìù';
            phoneticBtn.title = `"${shortText}"\nüìù Vietnamese pronunciation guide - Shows how to read this phrase`;
            phoneticBtn.style.cssText = 'margin-left: 5px; padding: 1px 4px; font-size: 9px; background: #9C27B0; color: white; border: none; border-radius: 2px; cursor: pointer; vertical-align: middle;';
            phoneticBtn.onclick = (e) => {
                e.stopPropagation();
                openPhoneticGuidePopup(lines[lineIndex]?.text);
            };

            // Create Google Translate button
            const googleBtn = document.createElement('button');
            googleBtn.innerHTML = 'üåê';
            googleBtn.title = `"${shortText}"\nüåê Google Translate - High quality Vietnamese pronunciation`;
            googleBtn.style.cssText = 'margin-left: 2px; padding: 1px 4px; font-size: 9px; background: #4285F4; color: white; border: none; border-radius: 2px; cursor: pointer; vertical-align: middle;';
            googleBtn.onclick = (e) => {
                e.stopPropagation();
                openGoogleTranslatePopup(lines[lineIndex]?.text);
            };

            // Create Vietnamese voice button
            const voiceBtn = document.createElement('button');
            voiceBtn.innerHTML = 'üîä';
            voiceBtn.title = `"${shortText}"\nüîä System voice - Basic Vietnamese pronunciation (natural pitch)`;
            voiceBtn.style.cssText = 'margin-left: 2px; padding: 1px 4px; font-size: 9px; background: #FF7043; color: white; border: none; border-radius: 2px; cursor: pointer; vertical-align: middle;';
            voiceBtn.onclick = (e) => {
                e.stopPropagation();
                playVietnameseNaturalVoice(lines[lineIndex]?.text, lineIndex);
            };

            buttonContainer.appendChild(playBtn);
            buttonContainer.appendChild(loopBtn);
            buttonContainer.appendChild(stopBtn);
            buttonContainer.appendChild(phoneticBtn);
            buttonContainer.appendChild(googleBtn);
            buttonContainer.appendChild(voiceBtn);

            return buttonContainer;
        }

        function getLyricsLines() {
            const lyricsContainer = document.getElementById('editable-lyrics');
            if (!lyricsContainer) return [];

            const syllables = Array.from(lyricsContainer.querySelectorAll('.syllable'));
            const activeBreaks = Array.from(lyricsContainer.querySelectorAll('.line-break.active'));

            const lines = [];
            let currentLine = {
                text: '',
                syllables: [],
                startSyllableIndex: 0,
                endSyllableIndex: -1
            };

            syllables.forEach((syllable, index) => {
                const syllableIndex = parseInt(syllable.getAttribute('data-syllable-index'));
                const position = parseInt(syllable.getAttribute('data-position'));

                currentLine.text += (currentLine.text ? ' ' : '') + syllable.textContent;
                currentLine.syllables.push({
                    index: syllableIndex,
                    position: position,
                    text: syllable.textContent,
                    element: syllable
                });
                currentLine.endSyllableIndex = syllableIndex;

                // Check if there's an active line break after this syllable
                const hasActiveBreak = activeBreaks.some(br =>
                    parseInt(br.getAttribute('data-break-after')) === syllableIndex
                );

                if (hasActiveBreak || index === syllables.length - 1) {
                    lines.push({ ...currentLine });
                    currentLine = {
                        text: '',
                        syllables: [],
                        startSyllableIndex: syllableIndex + 1,
                        endSyllableIndex: -1
                    };
                }
            });

            return lines;
        }

        function playLyricsLine(lineIndex, isLooping = false) {
            if (!audioContext) {
                alert('Please click "Enable Audio" first.');
                return;
            }

            // Stop any existing playback (both line and full song)
            stopLyricsLinePlayback();
            stopPlayback(); // Stop full song playback

            const lines = getLyricsLines();
            if (lineIndex < 0 || lineIndex >= lines.length) return;

            const line = lines[lineIndex];
            lyricsLinePlaybackState.isPlaying = true;
            lyricsLinePlaybackState.currentLineIndex = lineIndex;
            lyricsLinePlaybackState.isLooping = isLooping;

            // Get all notes for this line (including melismatic notes)
            const notes = collectNotesForLine(line);
            lyricsLinePlaybackState.currentPlaybackNotes = notes;

            // Debug: console.log(`üéµ Playing line ${lineIndex + 1}: "${line.text}" (${notes.length} notes, loop: ${isLooping})`);

            playNotesSequence(notes, 0);
            updateLyricsPlaybackControls();
        }

        function collectNotesForLine(line) {
            const allNotes = collectAllNotes();
            const lineNotes = [];

            // Debug: console.log(`üîç collectNotesForLine: Line has ${line.syllables.length} syllables`);

            line.syllables.forEach((syllable, index) => {
                // Debug: console.log(`üîç Syllable ${index}: "${syllable.text}" at position ${syllable.position}`);

                // Find notes that belong to this syllable position
                // The syllable.position corresponds to the note index
                const syllableNotes = allNotes.filter(note => {
                    return note.noteIndex === syllable.position;
                });

                // Debug: console.log(`üîç Found ${syllableNotes.length} notes for syllable "${syllable.text}" at position ${syllable.position}`);

                if (syllableNotes.length > 0) {
                    lineNotes.push(...syllableNotes);

                    // For melismatic syllables, we need to find additional consecutive notes
                    if (syllable.element.classList.contains('melismatic')) {
                        // Debug: console.log(`üîç Syllable "${syllable.text}" is melismatic`);

                        // Look for the next few consecutive notes
                        let nextNoteIndex = syllable.position + 1;
                        let foundMelismaNotes = 0;

                        // Find how many notes this melisma spans (limit to 5 to be safe)
                        for (let i = 0; i < 5; i++) {
                            const nextNote = allNotes.find(note => note.noteIndex === nextNoteIndex);
                            if (nextNote) {
                                // Check if this note belongs to the next syllable
                                const nextSyllable = line.syllables.find(s => s.position === nextNoteIndex);
                                if (!nextSyllable) {
                                    // This note doesn't belong to another syllable, so it's part of the melisma
                                    lineNotes.push(nextNote);
                                    foundMelismaNotes++;
                                    nextNoteIndex++;
                                } else {
                                    break; // Found the next syllable, stop looking
                                }
                            } else {
                                break; // No more notes
                            }
                        }
                        // Debug: console.log(`üîç Found ${foundMelismaNotes} additional melisma notes`);
                    }
                }
            });

            // Remove duplicates and sort by note index
            const uniqueNotes = lineNotes.filter((note, index, self) =>
                index === self.findIndex(n => n.noteIndex === note.noteIndex)
            );

            // Debug: console.log(`üîç Final result: ${uniqueNotes.length} unique notes for line`);
            return uniqueNotes.sort((a, b) => a.noteIndex - b.noteIndex);
        }

        function playNotesSequence(notes, currentIndex) {
            if (!lyricsLinePlaybackState.isPlaying || currentIndex >= notes.length) {
                if (lyricsLinePlaybackState.isLooping && lyricsLinePlaybackState.isPlaying) {
                    // Restart the sequence
                    const timeout = setTimeout(() => {
                        playNotesSequence(lyricsLinePlaybackState.currentPlaybackNotes, 0);
                    }, 500); // Brief pause before loop
                    lyricsLinePlaybackState.timeouts.push(timeout);
                } else {
                    stopLyricsLinePlayback();
                }
                return;
            }

            const note = notes[currentIndex];
            const quarterNoteMs = 60000 / tempo; // 4th note duration in ms

            // Get actual duration from the duration text in the tablature
            let noteDurationBeats = 0.5; // Default eighth note

            // Find the duration text element associated with this note
            const noteElement = note.element;
            const noteX = parseFloat(noteElement.getAttribute('cx'));
            const noteY = parseFloat(noteElement.getAttribute('cy'));

            // Look for duration text near this note
            const durationValue = extractDurationFromTablature(noteX, noteY);

            // Convert duration value to beats
            if (durationValue >= 4) noteDurationBeats = 1; // Quarter note or longer
            else if (durationValue >= 2) noteDurationBeats = 0.5; // Eighth note
            else if (durationValue >= 1) noteDurationBeats = 0.25; // Sixteenth note
            else noteDurationBeats = 0.125; // Thirty-second note or shorter

            // Grace notes have shorter duration
            if (note.isGrace) {
                noteDurationBeats = 0.1;
            }

            const delay = quarterNoteMs * noteDurationBeats;

            // Highlight the note
            note.element.classList.add('active-note-glow');

            // Play the note
            const soundDuration = note.isGrace ? 0.1 : Math.min(delay * 0.8 / 1000, 2.0);
            playNote(note.frequency, soundDuration, note.isGrace);

            // Auto-scroll to keep the playing note in view
            scrollToNote(note.element);

            // Remove highlight from previous note
            if (currentIndex > 0) {
                const prevNote = notes[currentIndex - 1];
                prevNote.element.classList.remove('active-note-glow');
                prevNote.element.classList.add('fade-note-glow');
                setTimeout(() => {
                    prevNote.element.classList.remove('fade-note-glow');
                }, 200);
            }

            // Schedule next note
            const timeout = setTimeout(() => {
                playNotesSequence(notes, currentIndex + 1);
            }, delay);

            lyricsLinePlaybackState.timeouts.push(timeout);
        }

        function stopLyricsLinePlayback() {
            lyricsLinePlaybackState.isPlaying = false;
            lyricsLinePlaybackState.isLooping = false;
            lyricsLinePlaybackState.currentLineIndex = -1;

            // Clear all timeouts
            lyricsLinePlaybackState.timeouts.forEach(timeout => clearTimeout(timeout));
            lyricsLinePlaybackState.timeouts = [];

            // Remove note highlights
            document.querySelectorAll('.note-circle').forEach(circle => {
                circle.classList.remove('active-note-glow', 'fade-note-glow');
            });

            lyricsLinePlaybackState.currentPlaybackNotes = [];
            updateLyricsPlaybackControls();
        }

        // Initialize lyrics playback controls when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit for other initialization to complete
            setTimeout(() => {
                updateLyricsPlaybackControls();
            }, 1000);
        });

        // Function to calculate fingerings based on pitch direction
        function calculateFingerings() {
            const noteCircles = document.querySelectorAll('.note-circle');
            const notes = [];

            // Collect note data sorted by note index
            noteCircles.forEach(circle => {
                const noteIndex = parseInt(circle.getAttribute('data-note-index'));
                const cy = parseFloat(circle.getAttribute('cy'));
                const cx = parseFloat(circle.getAttribute('cx'));
                const isGrace = circle.getAttribute('data-is-grace') === 'true';

                notes[noteIndex] = { cy, cx, isGrace, element: circle };
            });

            // Calculate fingerings based on pitch direction
            const fingerings = [];

            for (let i = 0; i < notes.length; i++) {
                if (!notes[i]) continue; // Skip if note doesn't exist

                let fingering = 't'; // Default to thumb
                const currentY = notes[i].cy;

                // Look ahead to find the next note to determine fingering
                let nextNote = null;
                for (let j = i + 1; j < notes.length; j++) {
                    if (notes[j]) {
                        nextNote = notes[j];
                        break;
                    }
                }

                if (nextNote) {
                    const nextY = nextNote.cy;
                    const yDiff = nextY - currentY;

                    // Calculate string difference for middle finger detection
                    const stringDiff = Math.abs(yDiff) / 60; // Approximate string spacing

                    if (yDiff > 5) {
                        // Next note is ascending (bigger Y = lower on screen = higher pitch)
                        fingering = 'i'; // Index for ascending direction
                    } else if (yDiff < -5) {
                        // Next note is descending (smaller Y = higher on screen = lower pitch)
                        fingering = 't'; // Thumb for descending direction
                    } else {
                        // Next note is same pitch or very close - look further ahead
                        let furtherNote = null;
                        for (let k = i + 2; k < notes.length; k++) {
                            if (notes[k] && Math.abs(notes[k].cy - currentY) > 5) {
                                furtherNote = notes[k];
                                break;
                            }
                        }

                        if (furtherNote) {
                            const furtherYDiff = furtherNote.cy - currentY;
                            if (furtherYDiff > 5) {
                                fingering = 'i'; // Future direction is ascending, use index
                            } else if (furtherYDiff < -5) {
                                fingering = 't'; // Future direction is descending, use thumb
                            }
                        }
                    }

                    // Use middle finger for jumps > 4 strings
                    if (stringDiff > 4) {
                        fingering = 'm';
                    }
                }

                fingerings[i] = fingering;
            }

            return fingerings;
        }

        // Function to apply fingerings to duration text elements
        function applyFingerings() {
            const fingerings = calculateFingerings();
            const durationTexts = document.querySelectorAll('text[style*="font-size: 10px"][style*="opacity: 0.0"]');

            durationTexts.forEach(text => {
                const x = parseFloat(text.getAttribute('x'));
                const y = parseFloat(text.getAttribute('y'));

                // Find the corresponding note by matching X position
                const noteCircles = document.querySelectorAll('.note-circle');
                let matchingNoteIndex = null;

                noteCircles.forEach(circle => {
                    const noteX = parseFloat(circle.getAttribute('cx'));
                    const noteIndex = parseInt(circle.getAttribute('data-note-index'));

                    if (Math.abs(x - noteX) < 5) { // Small tolerance for matching
                        matchingNoteIndex = noteIndex;
                    }
                });

                if (matchingNoteIndex !== null && fingerings[matchingNoteIndex]) {
                    // Store original duration value in data attribute before replacing
                    const originalDuration = text.textContent.trim();
                    text.setAttribute('data-original-duration', originalDuration);

                    // Update the text content and make it visible with italic style
                    text.textContent = fingerings[matchingNoteIndex];
                    text.setAttribute('style', 'font-size: 10px; fill: #000; font-weight: bold; opacity: 1.0; font-style: italic;');
                }
            });
        }

        // Initialize fingerings when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                applyFingerings();
            }, 500);
        });
        
        // Function to change lyrics font
        function changeLyricsFont() {
            const selector = document.getElementById('lyrics-font-selector');
            const selectedFont = selector.value;

            // Apply font to Vietnamese lyrics container
            const vietnameseLyrics = document.getElementById('editable-lyrics');
            if (vietnameseLyrics) {
                vietnameseLyrics.style.fontFamily = selectedFont;
            }

            // Apply font to English lyrics container (parent div of eng-words)
            const englishContainer = document.querySelector('.eng-word')?.parentElement;
            if (englishContainer) {
                englishContainer.style.fontFamily = selectedFont;
            }

            // Also apply to individual syllables and words for consistency
            document.querySelectorAll('.editable-syllable').forEach(syllable => {
                syllable.style.fontFamily = selectedFont;
            });

            document.querySelectorAll('.eng-word').forEach(word => {
                word.style.fontFamily = selectedFont;
            });

            // Save preference to localStorage
            localStorage.setItem('dantranh_lyrics_font', selectedFont);
            console.log('Lyrics font changed to:', selectedFont);
        }

        // Function to change lyrics font size
        function changeLyricsFontSize() {
            const selector = document.getElementById('lyrics-size-selector');
            const selectedSize = selector.value + 'px';

            // Apply size to Vietnamese lyrics container
            const vietnameseLyrics = document.getElementById('editable-lyrics');
            if (vietnameseLyrics) {
                vietnameseLyrics.style.fontSize = selectedSize;
            }

            // Apply size to English lyrics container
            const englishContainer = document.querySelector('.eng-word')?.parentElement;
            if (englishContainer) {
                englishContainer.style.fontSize = selectedSize;
            }

            // Also apply to individual syllables and words
            document.querySelectorAll('.editable-syllable').forEach(syllable => {
                syllable.style.fontSize = selectedSize;
            });

            document.querySelectorAll('.eng-word').forEach(word => {
                word.style.fontSize = selectedSize;
            });

            // Save preference to localStorage
            localStorage.setItem('dantranh_lyrics_size', selector.value);
            console.log('Lyrics font size changed to:', selectedSize);
        }

        // Load saved font preference on page load
        function loadLyricsFontPreference() {
            // Load font family
            const savedFont = localStorage.getItem('dantranh_lyrics_font');
            if (savedFont) {
                const fontSelector = document.getElementById('lyrics-font-selector');
                if (fontSelector) {
                    fontSelector.value = savedFont;
                    changeLyricsFont();
                }
            }

            // Load font size - default to 18px if no saved preference
            const savedSize = localStorage.getItem('dantranh_lyrics_size') || '18';
            const sizeSelector = document.getElementById('lyrics-size-selector');
            if (sizeSelector) {
                sizeSelector.value = "18";
                changeLyricsFontSize();
            }
        }

        // Store the original line breaks - will be captured on first page load
        let ORIGINAL_ACTIVE_BREAKS = null;

        // Capture the initial state when page first loads
        function captureOriginalBreaks() {
            // Always recapture to get the latest state
            ORIGINAL_ACTIVE_BREAKS = [];
            const activeBreaks = document.querySelectorAll('.line-break.active');
            activeBreaks.forEach(breakEl => {
                const index = parseInt(breakEl.getAttribute('data-break-after'));
                if (!isNaN(index)) {
                    ORIGINAL_ACTIVE_BREAKS.push(index);
                }
            });
            console.log('Captured original breaks:', ORIGINAL_ACTIVE_BREAKS);
        }

        // Call this when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', captureOriginalBreaks);
        } else {
            // DOM is already loaded
            captureOriginalBreaks();
        }

        function resetLyricsBreaks() {
            // Make sure we have captured the original state
            if (ORIGINAL_ACTIVE_BREAKS === null) {
                captureOriginalBreaks();
            }
            console.log('Resetting to original breaks:', ORIGINAL_ACTIVE_BREAKS);

            // Reset all breaks to their original state
            const breaks = document.querySelectorAll('.line-break');
            console.log('Total line breaks found:', breaks.length);

            breaks.forEach(breakEl => {
                const syllableIndex = parseInt(breakEl.getAttribute('data-break-after'));

                if (ORIGINAL_ACTIVE_BREAKS.includes(syllableIndex)) {
                    if (!breakEl.classList.contains('active')) {
                        breakEl.classList.add('active');
                        console.log('Activated break after syllable', syllableIndex);
                    }
                } else {
                    if (breakEl.classList.contains('active')) {
                        breakEl.classList.remove('active');
                        console.log('Deactivated break after syllable', syllableIndex);
                    }
                }
            });

            // First clear all English line breaks
            const englishContainer = document.querySelector('td .eng-word')?.parentElement;
            if (englishContainer) {
                // Remove all existing <br> tags
                const brs = englishContainer.querySelectorAll('br');
                brs.forEach(br => br.remove());
                console.log('Cleared', brs.length, 'English line breaks');
            }

            // Update the playback controls and English synchronization
            updateLyricsPlaybackControls();
            // Sync English line breaks with the reset Vietnamese breaks
            setTimeout(syncEnglishLineBreaks, 100);

            console.log('Reset complete');
        }
        
        function showNoteDetails(noteIndex) {
            const noteElement = document.getElementById(`note-${noteIndex}`);
            if (!noteElement) return;
            
            let details = `Note ${noteIndex + 1} Details:\n`;
            
            const patternType = noteElement.getAttribute('data-pattern-type');
            const patternInfo = noteElement.getAttribute('data-pattern-info');
            const syllableInfo = noteElement.getAttribute('data-syllable-info');
            
            if (patternInfo) {
                details += `${patternInfo}\n`;
            }
            
            if (syllableInfo) {
                details += `${syllableInfo}\n`;
            }
            
            if (!patternInfo && !syllableInfo) {
                details += 'No current pattern highlighting';
            }
            
            alert(details);
        }
        
        function updateMinCountDisplay() {
            const slider = document.getElementById('minCount');
            const display = document.getElementById('minCountValue');

            if (slider && display) {
                slider.addEventListener('input', function() {
                    display.textContent = slider.value;
                });
            }
        }

        // ====== AUDIO FUNCTIONALITY ======
        let audioContext = null;
        let isPlaying = false;
        let currentNoteIndex = 0;
        let playbackTimeouts = [];
        let tempo = 120; // Default from MusicXML
        let activeOscillators = []; // Track active oscillators to stop them

        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            return audioContext;
        }

        function initializeAudio() {
            try {
                const ctx = initAudioContext();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                gainNode.gain.setValueAtTime(0, ctx.currentTime);
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.1);

                document.getElementById('initAudioBtn').style.background = '#27ae60';
                document.getElementById('initAudioBtn').innerHTML = 'üîä Ready';
                document.getElementById('initAudioBtn').disabled = true;

                const playBtn = document.getElementById('playPauseBtn');
                const stopBtn = document.getElementById('stopBtn');

                // Enable and style play button
                playBtn.disabled = false;
                playBtn.style.opacity = '1';
                playBtn.style.cursor = 'pointer';
                playBtn.style.background = '#27ae60';
                playBtn.style.color = 'white';

                // Enable and style stop button
                stopBtn.disabled = false;
                stopBtn.style.opacity = '1';
                stopBtn.style.cursor = 'pointer';
                stopBtn.style.background = '#e67e22';
                stopBtn.style.color = 'white';

                // Update lyrics playback controls to enable buttons
                updateLyricsPlaybackControls();

                console.log('‚úÖ Audio initialized successfully');
            } catch (error) {
                console.error('Audio initialization failed:', error);
            }
        }

        function getNoteFrequency(pitch) {
            // Remove grace note prefix if present
            if (pitch.startsWith('g')) {
                pitch = pitch.substring(1);
            }

            const noteMap = { 'C': 0, 'D': 2, 'E': 4, 'F': 5, 'G': 7, 'A': 9, 'B': 11 };
            const match = pitch.match(/([A-G])([#b]?)(\d+)/);
            if (!match) return 440;

            const [, note, accidental, octaveStr] = match;
            const octave = parseInt(octaveStr);
            let noteOffset = noteMap[note];
            if (accidental === '#') noteOffset += 1;
            if (accidental === 'b') noteOffset -= 1;

            const A4 = 440;
            const semitoneOffset = (octave - 4) * 12 + (noteOffset - 9);
            return A4 * Math.pow(2, semitoneOffset / 12);
        }

        function playNote(frequency, duration = 0.5, isGrace = false) {
            try {
                if (!audioContext) return;
                const ctx = audioContext;
                if (ctx.state === 'suspended') {
                    ctx.resume().then(() => playNoteImmediate(ctx, frequency, duration, isGrace));
                } else {
                    playNoteImmediate(ctx, frequency, duration, isGrace);
                }
            } catch (error) {
                console.error('Error playing note:', error);
            }
        }

        function stopAllCurrentAudio() {
            // Stop all active oscillators immediately
            activeOscillators.forEach(oscillator => {
                try {
                    oscillator.stop();
                } catch (e) {
                    // Oscillator might already be stopped
                }
            });
            activeOscillators = [];
            console.log('üîá Stopped all current audio to prevent overlap');
        }

        function playNoteImmediate(ctx, frequency, duration, isGrace) {
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);
            oscillator.frequency.setValueAtTime(frequency, ctx.currentTime);
            oscillator.type = 'triangle';

            const volume = isGrace ? 0.2 : 0.3;
            const resonanceDuration = isGrace ? duration + 1.5 : duration + 3.0;

            gainNode.gain.setValueAtTime(0, ctx.currentTime);
            gainNode.gain.linearRampToValueAtTime(volume, ctx.currentTime + 0.005);
            gainNode.gain.linearRampToValueAtTime(volume * 0.8, ctx.currentTime + 0.1);
            gainNode.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + resonanceDuration);

            // Track this oscillator
            activeOscillators.push(oscillator);

            oscillator.start(ctx.currentTime);
            oscillator.stop(ctx.currentTime + resonanceDuration);

            // Remove from tracking when done
            setTimeout(() => {
                const index = activeOscillators.indexOf(oscillator);
                if (index > -1) {
                    activeOscillators.splice(index, 1);
                }
            }, resonanceDuration * 1000);
        }

        function getPitchFromAnalysisData(noteIndex) {
            // Grace note indices - positions where notes are marked as grace notes
            const graceNoteIndices = [3, 10, 19, 21, 49, 51, 60, 92, 94, 107, 109];

            if (typeof analysisData === 'undefined' || !analysisData.kpic_patterns || !analysisData.kpic_patterns.full) {
                return 'C5';
            }
            for (const [kpicKey, patterns] of Object.entries(analysisData.kpic_patterns.full)) {
                for (const pattern of patterns) {
                    const positions = pattern.positions;
                    const patternNotes = pattern.pattern;
                    for (let i = 0; i < positions.length; i++) {
                        const startPos = positions[i];
                        for (let j = 0; j < patternNotes.length; j++) {
                            if (startPos + j === noteIndex) {
                                let pitch = patternNotes[j];
                                // Add grace note prefix if this is a grace note
                                if (graceNoteIndices.includes(noteIndex)) {
                                    pitch = 'g' + pitch;
                                }
                                return pitch;
                            }
                        }
                    }
                }
            }
            return 'C5';
        }

        function updateTempo() {
            const slider = document.getElementById('tempoSlider');
            const display = document.getElementById('tempoValue');
            tempo = parseInt(slider.value);
            display.textContent = tempo + ' BPM';
        }

        function togglePlayback() {
            console.log('üéµ togglePlayback() called, isPlaying:', isPlaying, 'linePlaybackActive:', lyricsLinePlaybackState.isPlaying);

            // Stop both types of playback
            if (isPlaying || lyricsLinePlaybackState.isPlaying) {
                stopPlayback();
                stopLyricsLinePlayback();
            } else {
                startPlayback();
            }
        }

        function startPlayback() {
            console.log('üéµ startPlayback() called, audioContext:', !!audioContext);
            if (!audioContext) {
                alert('Please click "Enable Audio" first.');
                return;
            }

            // Stop any line playback first
            stopLyricsLinePlayback();

            const notes = collectAllNotes();
            console.log(`üéµ Collected ${notes.length} notes for playback`);
            if (notes.length === 0) return;
            isPlaying = true;
            currentNoteIndex = 0;
            document.getElementById('playPauseBtn').innerHTML = '‚è∏Ô∏è Pause';
            console.log('üéµ Starting sequence playback...');
            playSequence(notes);
        }

        function startPlaybackFromNote(startNoteIndex) {
            console.log(`üéµ startPlaybackFromNote() called from note ${startNoteIndex}`);
            if (!audioContext) {
                alert('Please click "Enable Audio" first.');
                return;
            }

            const notes = collectAllNotes();
            if (notes.length === 0) return;

            // Find the index in the notes array that corresponds to the clicked note
            const startIndex = notes.findIndex(note => note.noteIndex === startNoteIndex);
            if (startIndex === -1) {
                console.log(`‚ö†Ô∏è Could not find note ${startNoteIndex} in collected notes`);
                return;
            }

            isPlaying = true;
            currentNoteIndex = startIndex;
            document.getElementById('playPauseBtn').innerHTML = '‚è∏Ô∏è Pause';
            console.log(`üéµ Starting playback from note ${startNoteIndex} (array index ${startIndex})`);
            playSequence(notes);
        }

        function stopPlayback() {
            isPlaying = false;
            currentNoteIndex = 0;
            document.getElementById('playPauseBtn').innerHTML = '‚ñ∂Ô∏è Play';
            playbackTimeouts.forEach(timeout => clearTimeout(timeout));
            playbackTimeouts = [];
            document.querySelectorAll('.note-circle').forEach(circle => {
                circle.classList.remove('active-note-glow', 'fade-note-glow');
                circle.style.stroke = '';
                circle.style.strokeWidth = '';
            });
        }

        // Auto-scroll function to keep playing note in view
        function scrollToNote(noteElement) {
            // Check if auto-scroll is enabled
            const autoScrollEnabled = document.getElementById('autoScrollToggle')?.checked;
            if (!autoScrollEnabled) return;

            const container = document.querySelector('.tablature-container');
            const svg = document.getElementById('tablatureSvg');

            if (!container || !noteElement) return;

            // Get the note's position relative to the SVG
            const noteCx = parseFloat(noteElement.getAttribute('cx')) || parseFloat(noteElement.getAttribute('data-base-x'));

            // Get current zoom level
            const currentTransform = svg.style.transform || '';
            let scaleX = 1;
            const scaleMatch = currentTransform.match(/scaleX\(([\d.]+)\)/);
            if (scaleMatch) {
                scaleX = parseFloat(scaleMatch[1]);
            }

            // Calculate the scaled position
            const scaledNoteX = noteCx * scaleX;

            // Get container dimensions
            const containerWidth = container.clientWidth;
            const containerScrollLeft = container.scrollLeft;

            // Calculate the note's position relative to the current view
            const noteRelativeX = scaledNoteX - containerScrollLeft;

            // Define the "safe zone" - keep note in middle third of view
            const leftBoundary = containerWidth * 0.3;
            const rightBoundary = containerWidth * 0.7;

            // Only scroll if the note is outside the safe zone
            if (noteRelativeX < leftBoundary || noteRelativeX > rightBoundary) {
                // Center the note in the view
                const targetScrollLeft = scaledNoteX - (containerWidth / 2);

                // Smooth scroll to the new position
                container.scrollTo({
                    left: targetScrollLeft,
                    behavior: 'smooth'
                });
            }

            // Also handle vertical scrolling if needed (for Y zoom)
            const noteCy = parseFloat(noteElement.getAttribute('cy')) || parseFloat(noteElement.getAttribute('data-base-y'));
            let scaleY = 1;
            const scaleYMatch = currentTransform.match(/scaleY\(([\d.]+)\)/);
            if (scaleYMatch) {
                scaleY = parseFloat(scaleYMatch[1]);
            }

            const scaledNoteY = noteCy * scaleY;
            const containerScrollTop = container.scrollTop;
            const containerHeight = container.clientHeight;
            const noteRelativeY = scaledNoteY - containerScrollTop;

            // Check if vertical scroll is needed
            if (noteRelativeY < 50 || noteRelativeY > containerHeight - 50) {
                const targetScrollTop = scaledNoteY - (containerHeight / 2);
                container.scrollTop = targetScrollTop;
            }
        }

        function collectAllNotes() {
            const notes = [];
            document.querySelectorAll('.note-circle').forEach(circle => {
                const x = parseFloat(circle.getAttribute('cx'));
                const noteIndex = parseInt(circle.getAttribute('data-note-index'));
                const pitch = getPitchFromAnalysisData(noteIndex);
                const isGrace = circle.getAttribute('data-is-grace') === 'true';
                notes.push({
                    element: circle, x: x, pitch: pitch,
                    frequency: getNoteFrequency(pitch), isGrace: isGrace, noteIndex: noteIndex
                });
            });
            notes.sort((a, b) => a.x - b.x);
            return notes;
        }

        function playSequence(notes) {
            if (!isPlaying || currentNoteIndex >= notes.length) {
                stopPlayback();
                return;
            }
            const note = notes[currentNoteIndex];
            const quarterNoteMs = 60000 / tempo; // 4th note duration in ms

            // Get actual duration from the duration text in the tablature
            let noteDurationBeats = 0.5; // Default eighth note

            // Find the duration text element associated with this note
            const noteElement = note.element;
            const noteX = parseFloat(noteElement.getAttribute('cx'));
            const noteY = parseFloat(noteElement.getAttribute('cy'));

            // Look for duration text near this note (usually 20px above)
            const durationTexts = document.querySelectorAll('text[style*="font-size: 10px"]');
            let durationValue = 2; // Default to 8th note (value 2)

            durationTexts.forEach(text => {
                const textX = parseFloat(text.getAttribute('x'));
                const textY = parseFloat(text.getAttribute('y'));
                // Duration text is typically at the same X and about 20px above the note
                if (Math.abs(textX - noteX) < 5 && Math.abs(textY - (noteY - 20)) < 30) {
                    // Check for original duration stored in data attribute first
                    const originalDuration = text.getAttribute('data-original-duration');
                    const textContent = originalDuration || text.textContent.trim();
                    const value = parseFloat(textContent);
                    if (!isNaN(value)) {
                        durationValue = value;
                    }
                }
            });

            // Convert duration value to beats (quarter note = 1.0)
            // In tablature: 0.5 = grace note, 1 = sixteenth, 2 = eighth, 4 = quarter, 8 = half, 16 = whole
            if (durationValue === 0.5) noteDurationBeats = 0.125;      // Grace note (very short)
            else if (durationValue === 1) noteDurationBeats = 0.25;    // 16th note
            else if (durationValue === 2) noteDurationBeats = 0.5;     // 8th note
            else if (durationValue === 3) noteDurationBeats = 0.75;    // Dotted 8th
            else if (durationValue === 4) noteDurationBeats = 1.0;     // 4th note
            else if (durationValue === 8) noteDurationBeats = 2.0;     // 2nd note
            else if (durationValue === 16) noteDurationBeats = 4.0;    // 1st note
            else noteDurationBeats = durationValue / 4;                // General formula

            console.log(`Note ${currentNoteIndex}: duration value=${durationValue} ‚Üí ${noteDurationBeats} beats`);

            // Calculate actual delay for this note's duration
            const delay = noteDurationBeats * quarterNoteMs;

            note.element.classList.add('active-note-glow');
            const soundDuration = note.isGrace ? 0.1 : Math.min(delay * 0.8 / 1000, 2.0);
            playNote(note.frequency, soundDuration, note.isGrace);

            // Auto-scroll to keep the playing note in view
            scrollToNote(note.element);

            if (currentNoteIndex > 0) {
                const prevNote = notes[currentNoteIndex - 1];
                prevNote.element.classList.remove('active-note-glow');
                prevNote.element.classList.add('fade-note-glow');
                setTimeout(() => prevNote.element.classList.add('fading'), 50);
                setTimeout(() => prevNote.element.classList.remove('fade-note-glow', 'fading'), 3000);
            }

            currentNoteIndex++;
            const timeout = setTimeout(() => playSequence(notes), delay);
            playbackTimeouts.push(timeout);
        }

        // Save auto-scroll preference
        function saveAutoScrollPreference() {
            const autoScrollEnabled = document.getElementById('autoScrollToggle')?.checked;
            localStorage.setItem('dantranh_autoscroll', autoScrollEnabled ? 'true' : 'false');
            console.log('Auto-scroll preference saved:', autoScrollEnabled);
        }

        // Load auto-scroll preference on page load
        function loadAutoScrollPreference() {
            const savedPref = localStorage.getItem('dantranh_autoscroll');
            if (savedPref !== null) {
                const autoScrollToggle = document.getElementById('autoScrollToggle');
                if (autoScrollToggle) {
                    autoScrollToggle.checked = savedPref === 'true';
                }
            }
        }

        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                togglePlayback();
            }
        });

        function showNoteDetails(noteIndex) {
            console.log(`Note ${noteIndex + 1} clicked - audio enabled`);
        }

        // Auto-trigger fit width zoom on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const zoomSelect = document.getElementById('zoomLevel');
                if (zoomSelect) {
                    zoomSelect.value = 'fit-width';  // Force fit-width as default
                    updateZoomFromSelect();
                    console.log('‚úÖ Auto-triggered fit-width zoom');
                }
            }, 200);

            // Add note click listeners
            setTimeout(() => {
                const circles = document.querySelectorAll('.note-circle');
                circles.forEach((circle) => {
                    // Force entire circle area to be clickable
                    circle.style.cursor = 'pointer';
                    circle.style.pointerEvents = 'all';
                    circle.style.fillOpacity = '1';

                    // Ensure fill is solid for clickability
                    const currentFill = circle.getAttribute('fill');
                    if (!currentFill || currentFill === 'none') {
                        circle.setAttribute('fill', '#008080'); // Default teal if no fill
                    }

                    circle.removeAttribute('onclick');

                    // Create invisible rectangle click area that's guaranteed to work
                    const svg = circle.closest('svg');
                    if (svg) {
                        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                        const cx = parseFloat(circle.getAttribute('cx'));
                        const cy = parseFloat(circle.getAttribute('cy'));
                        const radius = parseInt(circle.getAttribute('r'));
                        const size = Math.max(radius * 2 + 8, 24); // Square click area

                        rect.setAttribute('x', cx - size/2);
                        rect.setAttribute('y', cy - size/2);
                        rect.setAttribute('width', size);
                        rect.setAttribute('height', size);
                        rect.style.fill = 'transparent';
                        rect.style.cursor = 'pointer';
                        rect.style.pointerEvents = 'all';
                        rect.setAttribute('data-note-index', circle.getAttribute('data-note-index'));

                        // Insert before the visible circle
                        circle.parentNode.insertBefore(rect, circle);

                        // Add click handler directly to the rectangle
                        rect.addEventListener('click', function(e) {
                            e.stopPropagation();
                            e.preventDefault();

                            const noteIndex = parseInt(this.getAttribute('data-note-index'));
                            console.log(`üñ±Ô∏è Rectangle click detected on note ${noteIndex}`);

                            // Trigger audio and visual effects on the visible circle
                            const clickEvent = new MouseEvent('click', {
                                bubbles: false,
                                cancelable: true,
                                clientX: e.clientX,
                                clientY: e.clientY
                            });
                            circle.dispatchEvent(clickEvent);
                        });

                        console.log(`‚úÖ Added invisible click rectangle for note ${circle.getAttribute('data-note-index')}: ${size}x${size}px`);
                    }

                    circle.addEventListener('click', function(e) {
                        e.stopPropagation();
                        e.preventDefault();

                        const noteIndex = parseInt(this.getAttribute('data-note-index'));
                        const pitch = getPitchFromAnalysisData(noteIndex);
                        const frequency = getNoteFrequency(pitch);
                        const isGrace = this.getAttribute('data-is-grace') === 'true';

                        // Check for double-click to start playback from this note
                        const now = Date.now();
                        const lastClick = this.lastClickTime || 0;
                        const isDoubleClick = (now - lastClick) < 400;
                        this.lastClickTime = now;

                        if (isDoubleClick) {
                            // Double-click: Stop all audio and start playback from this note
                            stopAllCurrentAudio();
                            stopPlayback(); // Stop any existing sequence playback
                            console.log(`üéµ Double-click detected on note ${noteIndex}, starting playback from here`);
                            startPlaybackFromNote(noteIndex);
                        } else {
                            // Single-click: Stop current audio and play individual note
                            stopAllCurrentAudio();
                            playNote(frequency, isGrace ? 0.4 : 0.8, isGrace);

                            this.classList.add('active-note-glow');
                            setTimeout(() => {
                                this.classList.remove('active-note-glow');
                                this.classList.add('fade-note-glow');
                                setTimeout(() => this.classList.add('fading'), 50);
                                setTimeout(() => this.classList.remove('fade-note-glow', 'fading'), 3000);
                            }, 200);
                        }
                    }, true);

                    circle.addEventListener('mouseenter', function() {
                        this.style.filter = 'brightness(0.9)';
                    });
                    circle.addEventListener('mouseleave', function() {
                        this.style.filter = 'brightness(1)';
                    });
                });
                console.log('‚úÖ Audio click listeners added');
            }, 300);

            // Initialize tempo display
            const tempoSlider = document.getElementById('tempoSlider');
            const tempoDisplay = document.getElementById('tempoValue');
            if (tempoSlider && tempoDisplay) {
                tempoSlider.addEventListener('input', function() {
                    tempo = parseInt(this.value);
                    tempoDisplay.textContent = tempo;
                });
            }
        });

        // =================== SYLLABLE LEARNING SYSTEM ===================

        // Storage for learning patterns
        let syllableLearningData = JSON.parse(localStorage.getItem('dantranh_syllable_learning') || '{}');
        let learningMode = false;
        let initialLineBreaks = null;

        // Simplified learning functions
        function startLearning() {
            learningMode = true;
            // Capture current state as baseline
            initialLineBreaks = Array.from(document.querySelectorAll('.line-break')).map(lb => lb.classList.contains('active'));

            // Update UI
            document.getElementById('start-learning-btn').style.display = 'none';
            document.getElementById('done-learning-btn').style.display = 'inline-block';
            document.getElementById('learning-status').textContent = 'Learning mode: ON - Click "|" to adjust breaks';
            document.getElementById('learning-status').style.color = '#4caf50';

            console.log('üéì Learning mode started. Click "|" breaks to adjust.');
        }

        function doneLearning() {
            if (!learningMode) return;

            // Capture final state
            const finalLineBreaks = Array.from(document.querySelectorAll('.line-break')).map(lb => lb.classList.contains('active'));

            // Record changes for learning
            const changes = [];
            for (let i = 0; i < initialLineBreaks.length; i++) {
                if (initialLineBreaks[i] !== finalLineBreaks[i]) {
                    const syllableElement = document.querySelector(`[data-syllable-index="${i}"]`);
                    const syllableText = syllableElement ? syllableElement.textContent.trim() : '';
                    changes.push({
                        position: i,
                        syllable: syllableText,
                        before: initialLineBreaks[i],
                        after: finalLineBreaks[i]
                    });
                }
            }

            // Store learning data
            if (changes.length > 0) {
                const timestamp = new Date().toISOString();
                if (!syllableLearningData.sessions) syllableLearningData.sessions = [];
                syllableLearningData.sessions.push({
                    timestamp,
                    changes
                });
                localStorage.setItem('dantranh_syllable_learning', JSON.stringify(syllableLearningData));
                console.log(`üéì Learned ${changes.length} line break changes:`, changes);
            }

            learningMode = false;
            initialLineBreaks = null;

            // Update UI
            document.getElementById('start-learning-btn').style.display = 'inline-block';
            document.getElementById('done-learning-btn').style.display = 'none';
            document.getElementById('learning-status').textContent = `Learning mode: Off (${changes.length} changes recorded)`;
            document.getElementById('learning-status').style.color = '#666';
        }

        // Improved line breaking algorithm for Vietnamese poetry
        function improveLineBreaks() {
            const syllables = Array.from(document.querySelectorAll('.editable-syllable'));
            const lineBreaks = document.querySelectorAll('.line-break');

            // First, remove all active breaks
            lineBreaks.forEach(lb => lb.classList.remove('active'));

            // Get syllable texts
            const syllableTexts = syllables.map(s => s.textContent.trim());

            // Vietnamese poetic pattern recognition
            for (let i = 0; i < syllableTexts.length - 1; i++) {
                let shouldBreak = false;
                const current = syllableTexts[i].toLowerCase();
                const next = syllableTexts[i + 1] ? syllableTexts[i + 1].toLowerCase() : '';
                const prev = i > 0 ? syllableTexts[i - 1].toLowerCase() : '';
                const nextNext = syllableTexts[i + 2] ? syllableTexts[i + 2].toLowerCase() : '';

                // Rule 1: Break after punctuation (but not if it's "∆°i" after the punctuation)
                if ((current.endsWith(',') || current.endsWith('.')) && next !== '∆°i') {
                    shouldBreak = true;
                }

                // Rule 2: Break before "·ªõi" at the start of a phrase
                if (next === '·ªõi' && i > 0) {
                    shouldBreak = true;
                }

                // Rule 3: Break after "ƒë√¢u" (question ending)
                if (current === 'ƒë√¢u') {
                    shouldBreak = true;
                }

                // Rule 4: Break after "h·ªìng" (end of "t∆° h·ªìng")
                if (current === 'h·ªìng' && prev === 't∆°') {
                    shouldBreak = true;
                }

                // Rule 5: Don't break "∆°i" from what follows (vocative)
                // Break BEFORE "∆°i" if previous word is "t√¥i" or "∆°i"
                if (current === 't√¥i' && next === '∆°i') {
                    shouldBreak = true; // Break after "t√¥i", keep "∆°i" with next phrase
                }

                // Rule 6: Break after complete "b√† R√≠ ∆°i" phrases
                // Also handle "∆°i b√† R√≠ ∆°i" by breaking before the "∆°i" that starts it
                if (current === '∆°i' && prev === 'r√≠' && syllableTexts[i - 2]?.toLowerCase() === 'b√†') {
                    shouldBreak = true;
                }

                // Rule 6b: Break before "∆°i" when it starts "∆°i b√† R√≠ ∆°i" pattern
                // This handles the vocative "∆°i" that begins the phrase
                if (current === '∆°i' && next === 'b√†' && nextNext === 'r√≠' && syllableTexts[i + 3]?.toLowerCase() === '∆°i') {
                    // Break BEFORE this "∆°i" to start a new phrase
                    if (i > 0 && lineBreaks[i - 1]) {
                        lineBreaks[i - 1].classList.add('active');
                    }
                }

                // Rule 7: Detect parallel structures (l√∫c...ph·∫£i pattern)
                if (current === 'c√µng' && prev === 'ph·∫£i' && syllableTexts[i - 2]?.toLowerCase() === 'ƒëi' && syllableTexts[i - 3]?.toLowerCase() === 'l√∫c') {
                    // Look ahead for the parallel "l√∫c kh√≥c ph·∫£i b·ªìng"
                    if (next === 'l√∫c' && nextNext === 'kh√≥c') {
                        shouldBreak = true;
                    }
                }

                // Rule 8: Break after "teo," (onomatopoeia ending)
                if (current === 'teo,') {
                    shouldBreak = true;
                }

                // Rule 9: Break after "kheo" before "l√∫c"
                if (current === 'kheo' && next === 'l√∫c') {
                    shouldBreak = true;
                }

                // Rule 10: Break after parallel structure endings
                if (current === 'b·ªìng' && prev === 'ph·∫£i' && syllableTexts[i - 2]?.toLowerCase() === 'kh√≥c') {
                    shouldBreak = true;
                }

                // Rule 11: Break AFTER the complete "ng√°y o o o" onomatopoeia
                // Check if we're at the last "o" of "ng√°y o o o"
                if (current === 'o' && prev === 'o' && syllableTexts[i - 2]?.toLowerCase() === 'o' && syllableTexts[i - 3]?.toLowerCase() === 'ng√°y') {
                    shouldBreak = true;
                }

                // Rule 12: Break after "co" when it's part of "n·∫±m co" (body position)
                if (current === 'co' && prev === 'n·∫±m') {
                    shouldBreak = true;
                }

                // Rule 13: Break after "bi·∫øng" (end of "l∆∞·ªùi bi·∫øng" - lazy)
                if (current === 'bi·∫øng' && prev === 'l∆∞·ªùi') {
                    shouldBreak = true;
                }

                // Rule 14: Break after "h√†nh" (end of "h·ªçc h√†nh" - studying)
                if (current === 'h√†nh' && prev === 'h·ªçc') {
                    shouldBreak = true;
                }

                // Rule 15: Break before "ƒë√™m" (night/evening time marker)
                if (next === 'ƒë√™m' && i > 0) {
                    shouldBreak = true;
                }

                // Rule 16: Break before "ch·∫≥ng" (negation word that often starts phrases)
                if (next === 'ch·∫≥ng' && i > 5) { // Don't break too early in the song
                    shouldBreak = true;
                }

                // Apply the break if needed
                if (shouldBreak && lineBreaks[i]) {
                    lineBreaks[i].classList.add('active');
                }
            }

            // Line breaks updated in DOM, no additional display update needed
        }

        // Initialize simplified syllable system
        function initializeSyllableEditor() {
            console.log('üéì Initializing simplified syllable learning system...');

            // Just improve the default line breaks - no complex editing needed
            improveLineBreaks();

            // Capture the state AFTER improveLineBreaks has run
            // This is the actual initial state users see after Cmd+Shift+R
            setTimeout(() => {
                captureOriginalBreaks();
                console.log('Captured breaks after initialization:', ORIGINAL_ACTIVE_BREAKS);
            }, 100);
        }


        // Show learning indicator
        function showLearningIndicator(message) {
            const indicator = document.getElementById('learningIndicator');
            indicator.textContent = message;
            indicator.style.display = 'block';

            setTimeout(() => {
                indicator.style.display = 'none';
            }, 3000);
        }

        // Re-index syllables after modifications
        function reindexSyllables() {
            const syllables = document.querySelectorAll('.editable-syllable');
            syllables.forEach((syllable, index) => {
                syllable.setAttribute('data-syllable-index', index);
            });
        }

        // Export learning data
        function exportLearningData() {
            const data = JSON.stringify(syllableLearningData, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dantranh_syllable_learning.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // View learning statistics

        // Clear learning data
        function clearLearningData() {
            if (confirm('Clear all learning data? This cannot be undone.')) {
                localStorage.removeItem('dantranh_syllable_learning');
                syllableLearningData = {};
                showLearningIndicator('Learning data cleared');
            }
        }

        // Initialize the syllable editor when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initializeSyllableEditor, 500);

            // Keep gradient fills - don't replace with solid colors
            setTimeout(() => {
                // updateResonanceBandColors(); // Commented out to preserve gradients
                console.log('‚úÖ Using gradient resonance bands');

                // Debug: Check if bands are visible
                const svg = document.getElementById('tablatureSvg');
                const bands = svg.querySelectorAll('.resonance-band-colored, rect[fill*="resonanceBand"], rect[data-base-x][data-base-y]');
                console.log(`Debug: Found ${bands.length} total bands after initial color update`);

                const visibleBands = Array.from(bands).filter(band => {
                    const opacity = band.getAttribute('opacity') || band.style.opacity;
                    return opacity && parseFloat(opacity) > 0;
                });
                console.log(`Debug: ${visibleBands.length} bands are visible`);

                if (visibleBands.length > 0) {
                    const band = visibleBands[0];
                    console.log(`First visible band: fill=${band.getAttribute('fill')}, opacity=${band.getAttribute('opacity')}, class=${band.className}`);
                }
            }, 800);
        });

        // Collapsible lyrics toggle
        function toggleLyrics() {
            const content = document.getElementById('lyrics-table-content');
            const icon = document.getElementById('lyrics-toggle-icon');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '‚ñº';
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñ∂';
            }
        }

        // Dynamic line break synchronization
        function syncEnglishLineBreaks() {
            const englishContainer = document.querySelector('td .eng-word').parentElement;
            if (!englishContainer) {
                console.error('English container not found');
                return;
            }
            console.log('Found English container:', englishContainer);
            console.log('Container current content length:', englishContainer.innerHTML.length);

            // Get all active line breaks in Vietnamese
            const activeBreaks = [];
            const allBreaks = document.querySelectorAll('.line-break');
            console.log('Total line break elements found:', allBreaks.length);

            allBreaks.forEach(breakEl => {
                const isActive = breakEl.classList.contains('active');
                const breakAfter = parseInt(breakEl.getAttribute('data-break-after'));
                if (isActive) {
                    activeBreaks.push(breakAfter);
                }
                console.log('Break after syllable', breakAfter, '- active:', isActive);
            });

            console.log('Active line breaks after syllables:', activeBreaks);

            // Show which specific syllables have active breaks
            activeBreaks.forEach(index => {
                const syllable = document.querySelector(`[data-syllable-index="${index}"]`);
                if (syllable) {
                    console.log(`Active break after syllable ${index}: "${syllable.textContent}"`);
                }
            });

            // Rebuild English content with synchronized breaks
            const englishWords = englishContainer.querySelectorAll('.eng-word');
            let newHTML = '';

            englishWords.forEach((word, index) => {
                newHTML += word.outerHTML;

                // Use direct index mapping instead of text matching to avoid duplicates
                const correspondingSyllableIndex = index; // English word 0 ‚Üí Vietnamese syllable 0, etc.

                if (index < 10 || index > 110) { // Debug first 10 and last 9 words
                    console.log('English word ' + index + ' "' + word.textContent + '" ‚Üí Vietnamese syllable ' + correspondingSyllableIndex);
                }

                if (activeBreaks.includes(correspondingSyllableIndex)) {
                    newHTML += '<br>';
                    console.log('  ‚Üí Adding line break after English word ' + index + ' (syllable ' + correspondingSyllableIndex + ')');
                } else {
                    newHTML += ' ';
                }
            });

            console.log('About to update English container with new HTML...');
            englishContainer.innerHTML = newHTML;

            // Force visual refresh
            englishContainer.style.display = 'none';
            englishContainer.offsetHeight; // Trigger reflow
            englishContainer.style.display = 'block';

            console.log('English container updated and refreshed!');
            console.log('New container content length:', englishContainer.innerHTML.length);
            console.log('Synchronized English line breaks with Vietnamese');
            console.log('Total Vietnamese syllables:', document.querySelectorAll('.syllable.editable-syllable').length);
            console.log('Total English words:', document.querySelectorAll('.eng-word').length);
        }

        // Simple bilingual highlighting
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved font preference
            loadLyricsFontPreference();

            // Initial sync of line breaks
            setTimeout(syncEnglishLineBreaks, 500);

            // Add click handlers to Vietnamese syllables
            document.querySelectorAll('.syllable.editable-syllable').forEach(vietSyl => {
                vietSyl.addEventListener('click', function() {
                    const vietText = this.textContent;
                    highlightTranslation(vietText, true);
                });
            });

            // Add click handlers to English words
            document.querySelectorAll('.eng-word').forEach(engWord => {
                engWord.addEventListener('click', function() {
                    const vietText = this.getAttribute('data-viet');
                    highlightTranslation(vietText, false);
                });
            });

            // Re-sync when line breaks change (both adding and removing)
            document.querySelectorAll('.line-break').forEach(lineBreak => {
                lineBreak.addEventListener('click', function() {
                    const breakAfter = this.getAttribute('data-break-after');
                    const willBeActive = !this.classList.contains('active'); // Will toggle
                    console.log(`Line break clicked after syllable ${breakAfter}, will be active: ${willBeActive}`);
                    setTimeout(syncEnglishLineBreaks, 200);
                });
            });
        });

        function highlightTranslation(vietnameseText, fromVietnamese) {
            // Clear previous highlights
            document.querySelectorAll('.syllable.editable-syllable, .eng-word').forEach(el => {
                el.style.backgroundColor = '';
                el.style.color = '';
                el.style.fontWeight = '';
            });

            if (fromVietnamese) {
                // Highlight Vietnamese syllable
                document.querySelectorAll('.syllable.editable-syllable').forEach(vietSyl => {
                    if (vietSyl.textContent === vietnameseText) {
                        vietSyl.style.backgroundColor = '#3498db';
                        vietSyl.style.color = 'white';
                        vietSyl.style.fontWeight = 'bold';
                    }
                });

                // Highlight corresponding English words
                document.querySelectorAll('.eng-word').forEach(engWord => {
                    if (engWord.getAttribute('data-viet') === vietnameseText) {
                        engWord.style.backgroundColor = '#e74c3c';
                        engWord.style.color = 'white';
                        engWord.style.fontWeight = 'bold';
                    }
                });
            } else {
                // Highlight English word
                document.querySelectorAll('.eng-word').forEach(engWord => {
                    if (engWord.getAttribute('data-viet') === vietnameseText) {
                        engWord.style.backgroundColor = '#e74c3c';
                        engWord.style.color = 'white';
                        engWord.style.fontWeight = 'bold';
                    }
                });

                // Highlight corresponding Vietnamese syllables
                document.querySelectorAll('.syllable.editable-syllable').forEach(vietSyl => {
                    if (vietSyl.textContent === vietnameseText) {
                        vietSyl.style.backgroundColor = '#3498db';
                        vietSyl.style.color = 'white';
                        vietSyl.style.fontWeight = 'bold';
                    }
                });
            }

            console.log('Highlighted:', vietnameseText);
        }

        // Toggle content areas for analysis tools
        function showContent(contentType) {
            const contentArea = document.getElementById('content-area');
            const lyricsSection = document.querySelector('.lyrics-section');

            if (contentType === 'lyrics') {
                // Toggle lyrics section visibility
                if (lyricsSection.style.display === 'none') {
                    // Restore normal note visibility when leaving Sankey view
                    restoreNormalNoteVisibility();
                    lyricsSection.style.display = 'block';
                    contentArea.style.display = 'none';
                } else {
                    lyricsSection.style.display = 'none';
                    contentArea.style.display = 'none';
                }
            } else if (contentType === 'kpic-kric-sankey') {
                // Generate and display KPIC-2 & KRIC-2 Sankey diagrams
                lyricsSection.style.display = 'none';
                try {
                    // Get the current mode from either Sankey mode or analysis mode
                    let currentMode = document.querySelector('input[name="sankeyMode"]:checked')?.value;
                    if (!currentMode) {
                        // If no Sankey mode is set, derive from analysis mode
                        const analysisMode = document.querySelector('input[name="analysisMode"]:checked')?.value || 'full';
                        currentMode = analysisMode === 'main_melody' ? 'main' : 'all';
                    }
                    console.log('Opening Sankey view with mode:', currentMode);

                    // First reset all notes to visible
                    document.querySelectorAll('.note-circle').forEach(circle => {
                        circle.style.display = 'block';
                        circle.style.opacity = '1';
                    });

                    // Auto-set sliders to level 2 for KPIC-2 & KRIC-2
                    const kpicSlider = document.getElementById('kpicSlider');
                    const kricSlider = document.getElementById('kricSlider');

                    if (kpicSlider && kpicSlider.value !== '2') {
                        kpicSlider.value = 2;
                        window.kpicThreshold = 'kpic-2';
                        const kpicDisplay = document.getElementById('kpicSliderValue');
                        if (kpicDisplay) {
                            kpicDisplay.textContent = '2';
                            // Update position
                            const percentage = (2 / 136) * 100;
                            const sliderRect = kpicSlider.getBoundingClientRect();
                            const sliderWidth = sliderRect.width;
                            const handleWidth = 20;
                            const leftPosition = (percentage / 100) * (sliderWidth - handleWidth) + (handleWidth / 2);
                            kpicDisplay.style.left = `${Math.max(0, Math.min(leftPosition, sliderWidth - 30))}px`;
                        }
                        updateKpicPatternOptions();
                    }

                    if (kricSlider && kricSlider.value !== '2') {
                        kricSlider.value = 2;
                        window.kricThreshold = 'kric-2';
                        const kricDisplay = document.getElementById('kricSliderValue');
                        if (kricDisplay) {
                            kricDisplay.textContent = '2';
                            // Update position
                            const percentage = (2 / 136) * 100;
                            const sliderRect = kricSlider.getBoundingClientRect();
                            const sliderWidth = sliderRect.width;
                            const handleWidth = 20;
                            const leftPosition = (percentage / 100) * (sliderWidth - handleWidth) + (handleWidth / 2);
                            kricDisplay.style.left = `${Math.max(0, Math.min(leftPosition, sliderWidth - 30))}px`;
                        }
                        updateKricPatternOptions();
                    }

                    // Generate diagrams which will also apply the mode
                    generateSankeyDiagrams(currentMode);

                    // Apply the mode to the notes after generation
                    setTimeout(() => {
                        regenerateSankeyWithMode();
                    }, 100);

                    contentArea.style.display = 'block';
                } catch (error) {
                    console.error('Error generating Sankey diagrams:', error);
                    contentArea.innerHTML = '<div style="padding: 20px; color: red;">Error generating Sankey diagrams. Check console for details.</div>';
"<div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;\">" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #e74c3c;\"><div style=\"font-size: 20px; font-weight: bold; color: #e74c3c;\">137</div><div style=\"font-size: 12px; color: #7f8c8d;\">Total Notes</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #3498db;\"><div style=\"font-size: 20px; font-weight: bold; color: #3498db;\">7</div><div style=\"font-size: 12px; color: #7f8c8d;\">Strings Used</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #9b59b6;\"><div style=\"font-size: 20px; font-weight: bold; color: #9b59b6;\">3</div><div style=\"font-size: 12px; color: #7f8c8d;\">Sections (cyclical)</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #f39c12;\"><div style=\"font-size: 20px; font-weight: bold; color: #f39c12;\">2</div><div style=\"font-size: 12px; color: #7f8c8d;\">Key Phrases</div></div></div>";
contentArea.innerHTML += "<div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;\"><div style=\"background: #e8f5e8; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #27ae60;\"><h5 style=\"margin: 0 0 5px 0; color: #27ae60;\">Learn Only</h5><div style=\"font-size: 24px; font-weight: bold; color: #27ae60;\">56 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">40.9% of song</p></div><div style=\"background: #f0f8ff; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #3498db;\"><h5 style=\"margin: 0 0 5px 0; color: #3498db;\">Know Entire Song</h5><div style=\"font-size: 24px; font-weight: bold; color: #3498db;\">137 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">59% efficiency gain!</p></div></div>";
contentArea.innerHTML += "<div style=\"background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;\"><h4>üèóÔ∏è Song Structure</h4><div style=\"background: white; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px;\">Section 1 (0-45): 7-note motif + 16-note signature<br>Section 2 (46-88): Repeat with compression<br>Section 3 (89-131): Repeat with compression<br>Coda (132-136): Brief ending</div></div>";
                    contentArea.style.display = 'block';
                }
            } else if (contentType === 'kric3-sankey') {
                // Generate and display KRIC-3 Sankey diagram only
                lyricsSection.style.display = 'none';
                try {
                    // Get the current mode from either Sankey mode or analysis mode
                    let currentMode = document.querySelector('input[name="sankeyMode"]:checked')?.value;
                    if (!currentMode) {
                        // If no Sankey mode is set, derive from analysis mode
                        const analysisMode = document.querySelector('input[name="analysisMode"]:checked')?.value || 'full';
                        currentMode = analysisMode === 'main_melody' ? 'main' : 'all';
                    }
                    console.log('Opening KRIC-3 Sankey view with mode:', currentMode);

                    // Generate KRIC-3 diagram only
                    generateKric3SankeyDiagram(currentMode);
                    contentArea.style.display = 'block';
                } catch (error) {
                    console.error('Error generating KRIC-3 Sankey diagram:', error);
                    contentArea.innerHTML = '<div style="padding: 20px; color: red;">Error generating KRIC-3 Sankey diagram. Check console for details.</div>';
"<div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;\">" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #e74c3c;\"><div style=\"font-size: 20px; font-weight: bold; color: #e74c3c;\">137</div><div style=\"font-size: 12px; color: #7f8c8d;\">Total Notes</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #3498db;\"><div style=\"font-size: 20px; font-weight: bold; color: #3498db;\">7</div><div style=\"font-size: 12px; color: #7f8c8d;\">Strings Used</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #9b59b6;\"><div style=\"font-size: 20px; font-weight: bold; color: #9b59b6;\">3</div><div style=\"font-size: 12px; color: #7f8c8d;\">Sections (cyclical)</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #f39c12;\"><div style=\"font-size: 20px; font-weight: bold; color: #f39c12;\">2</div><div style=\"font-size: 12px; color: #7f8c8d;\">Key Phrases</div></div></div>";
contentArea.innerHTML += "<div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;\"><div style=\"background: #e8f5e8; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #27ae60;\"><h5 style=\"margin: 0 0 5px 0; color: #27ae60;\">Learn Only</h5><div style=\"font-size: 24px; font-weight: bold; color: #27ae60;\">56 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">40.9% of song</p></div><div style=\"background: #f0f8ff; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #3498db;\"><h5 style=\"margin: 0 0 5px 0; color: #3498db;\">Know Entire Song</h5><div style=\"font-size: 24px; font-weight: bold; color: #3498db;\">137 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">59% efficiency gain!</p></div></div>";
contentArea.innerHTML += "<div style=\"background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;\"><h4>üèóÔ∏è Song Structure</h4><div style=\"background: white; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px;\">Section 1 (0-45): 7-note motif + 16-note signature<br>Section 2 (46-88): Repeat with compression<br>Section 3 (89-131): Repeat with compression<br>Coda (132-136): Brief ending</div></div>";
                    contentArea.style.display = 'block';
                }
            } else if (contentType === 'kpic3-kric3-sankey') {
                // Generate and display KPIC-3 & KRIC-3 Sankey diagrams
                lyricsSection.style.display = 'none';
                try {
                    // Get the current mode from either Sankey mode or analysis mode
                    let currentMode = document.querySelector('input[name="sankeyMode"]:checked')?.value;
                    if (!currentMode) {
                        // If no Sankey mode is set, derive from analysis mode
                        const analysisMode = document.querySelector('input[name="analysisMode"]:checked')?.value || 'full';
                        currentMode = analysisMode === 'main_melody' ? 'main' : 'all';
                    }
                    console.log('Opening KPIC-3 & KRIC-3 Sankey view with mode:', currentMode);

                    // First reset all notes to visible
                    document.querySelectorAll('.note-circle').forEach(circle => {
                        circle.style.display = 'block';
                        circle.style.opacity = '1';
                    });

                    // Auto-set sliders to level 3 for KPIC-3 & KRIC-3
                    const kpicSlider = document.getElementById('kpicSlider');
                    const kricSlider = document.getElementById('kricSlider');

                    if (kpicSlider && kpicSlider.value !== '3') {
                        kpicSlider.value = 3;
                        window.kpicThreshold = 'kpic-3';
                        const kpicDisplay = document.getElementById('kpicSliderValue');
                        if (kpicDisplay) {
                            kpicDisplay.textContent = '3';
                            // Update position
                            const percentage = (3 / 136) * 100;
                            const sliderRect = kpicSlider.getBoundingClientRect();
                            const sliderWidth = sliderRect.width;
                            const handleWidth = 20;
                            const leftPosition = (percentage / 100) * (sliderWidth - handleWidth) + (handleWidth / 2);
                            kpicDisplay.style.left = `${Math.max(0, Math.min(leftPosition, sliderWidth - 30))}px`;
                        }
                        updateKpicPatternOptions();
                    }

                    if (kricSlider && kricSlider.value !== '3') {
                        kricSlider.value = 3;
                        window.kricThreshold = 'kric-3';
                        const kricDisplay = document.getElementById('kricSliderValue');
                        if (kricDisplay) {
                            kricDisplay.textContent = '3';
                            // Update position
                            const percentage = (3 / 136) * 100;
                            const sliderRect = kricSlider.getBoundingClientRect();
                            const sliderWidth = sliderRect.width;
                            const handleWidth = 20;
                            const leftPosition = (percentage / 100) * (sliderWidth - handleWidth) + (handleWidth / 2);
                            kricDisplay.style.left = `${Math.max(0, Math.min(leftPosition, sliderWidth - 30))}px`;
                        }
                        updateKricPatternOptions();
                    }

                    // Generate KPIC-3 & KRIC-3 diagrams
                    generateKpic3Kric3SankeyDiagrams(currentMode);

                    contentArea.style.display = 'block';
                } catch (error) {
                    console.error('Error generating KPIC-3 & KRIC-3 Sankey diagrams:', error);
                    contentArea.innerHTML = '<div style="padding: 20px; color: red;">Error generating KPIC-3 & KRIC-3 Sankey diagrams. Check console for details.</div>';
"<div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;\">" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #e74c3c;\"><div style=\"font-size: 20px; font-weight: bold; color: #e74c3c;\">137</div><div style=\"font-size: 12px; color: #7f8c8d;\">Total Notes</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #3498db;\"><div style=\"font-size: 20px; font-weight: bold; color: #3498db;\">7</div><div style=\"font-size: 12px; color: #7f8c8d;\">Strings Used</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #9b59b6;\"><div style=\"font-size: 20px; font-weight: bold; color: #9b59b6;\">3</div><div style=\"font-size: 12px; color: #7f8c8d;\">Sections (cyclical)</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #f39c12;\"><div style=\"font-size: 20px; font-weight: bold; color: #f39c12;\">2</div><div style=\"font-size: 12px; color: #7f8c8d;\">Key Phrases</div></div></div>";
contentArea.innerHTML += "<div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;\"><div style=\"background: #e8f5e8; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #27ae60;\"><h5 style=\"margin: 0 0 5px 0; color: #27ae60;\">Learn Only</h5><div style=\"font-size: 24px; font-weight: bold; color: #27ae60;\">56 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">40.9% of song</p></div><div style=\"background: #f0f8ff; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #3498db;\"><h5 style=\"margin: 0 0 5px 0; color: #3498db;\">Know Entire Song</h5><div style=\"font-size: 24px; font-weight: bold; color: #3498db;\">137 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">59% efficiency gain!</p></div></div>";
contentArea.innerHTML += "<div style=\"background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;\"><h4>üèóÔ∏è Song Structure</h4><div style=\"background: white; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px;\">Section 1 (0-45): 7-note motif + 16-note signature<br>Section 2 (46-88): Repeat with compression<br>Section 3 (89-131): Repeat with compression<br>Coda (132-136): Brief ending</div></div>";
                    contentArea.style.display = 'block';
                }
            } else if (contentType === 'analysis') {
                lyricsSection.style.display = 'none';
                contentArea.innerHTML = "<h3>üîç Song Analysis: B√† R·∫±ng B√† R√≠</h3>" +
"<div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;\">" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #e74c3c;\"><div style=\"font-size: 20px; font-weight: bold; color: #e74c3c;\">137</div><div style=\"font-size: 12px; color: #7f8c8d;\">Total Notes</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #3498db;\"><div style=\"font-size: 20px; font-weight: bold; color: #3498db;\">7</div><div style=\"font-size: 12px; color: #7f8c8d;\">Strings Used</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #9b59b6;\"><div style=\"font-size: 20px; font-weight: bold; color: #9b59b6;\">3</div><div style=\"font-size: 12px; color: #7f8c8d;\">Sections (cyclical)</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #f39c12;\"><div style=\"font-size: 20px; font-weight: bold; color: #f39c12;\">2</div><div style=\"font-size: 12px; color: #7f8c8d;\">Key Phrases</div></div></div>";
contentArea.innerHTML += "<div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;\"><div style=\"background: #e8f5e8; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #27ae60;\"><h5 style=\"margin: 0 0 5px 0; color: #27ae60;\">Learn Only</h5><div style=\"font-size: 24px; font-weight: bold; color: #27ae60;\">56 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">40.9% of song</p></div><div style=\"background: #f0f8ff; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #3498db;\"><h5 style=\"margin: 0 0 5px 0; color: #3498db;\">Know Entire Song</h5><div style=\"font-size: 24px; font-weight: bold; color: #3498db;\">137 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">59% efficiency gain!</p></div></div>";
contentArea.innerHTML += "<div style=\"background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;\"><h4>üèóÔ∏è Song Structure</h4><div style=\"background: white; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px;\">Section 1 (0-45): 7-note motif + 16-note signature<br>Section 2 (46-88): Repeat with compression<br>Section 3 (89-131): Repeat with compression<br>Coda (132-136): Brief ending</div></div>";
                contentArea.style.display = 'block';
            }
        }


        // Update both number and label positions based on current zoom level
        function updateStringAnalysisNumbers() {
            const numberLayer = document.getElementById('stringAnalysisNumberLayer');
            const textLayer = document.getElementById('stringAnalysisTextLayer');
            const content = document.getElementById('stringAnalysisContent');
            if (!numberLayer || !textLayer || !content) return;

            // Get current transform scale
            const transform = content.style.transform;
            const scaleMatch = transform.match(/scale\(([\d.]+),\s*([\d.]+)\)/);
            const scaleX = scaleMatch ? parseFloat(scaleMatch[1]) : 1;
            const scaleY = scaleMatch ? parseFloat(scaleMatch[2]) : 1;

            // Clear existing overlays
            numberLayer.innerHTML = '';
            textLayer.innerHTML = '';

            // Update string labels to align with scaled string lines (using relative positioning)
            if (window.stringAnalysisData) {
                const stringYPositions = Object.values(window.stringAnalysisData).map(info => info.yPos);
                const minStringY = Math.min(...stringYPositions);

                Object.entries(window.stringAnalysisData).forEach(([stringNum, info]) => {
                    const relativeY = info.yPos - minStringY + 50; // Match bar generation logic
                    const scaledY = relativeY * scaleY;

                    textLayer.innerHTML += `<div style="position: absolute; left: 0px; top: ${scaledY}px; font-size: 14px; font-weight: 600; color: #2c3e50; white-space: nowrap; transform: translateY(-50%);">String ${stringNum}: ${info.note}</div>`;
                });
            }

            // Generate numbers positioned relative to scaled bars
            const bars = content.querySelectorAll('[data-count]');
            bars.forEach(bar => {
                const barX = parseFloat(bar.getAttribute('data-bar-x'));
                const barY = parseFloat(bar.getAttribute('data-bar-y'));
                const count = bar.getAttribute('data-count');
                const barHeight = parseFloat(bar.getAttribute('data-bar-height'));

                // Calculate scaled position
                const scaledX = barX * scaleX;
                const scaledY = barY * scaleY;

                // Add number centered on the string line
                numberLayer.innerHTML += `
                    <div style="position: absolute;
                                left: ${scaledX}px;
                                top: ${scaledY}px;
                                color: white;
                                font-size: ${Math.max(10, Math.min(14, barHeight * 0.6))}px;
                                font-weight: 700;
                                text-shadow: 0 1px 3px rgba(0,0,0,0.5);
                                pointer-events: none;
                                transform: translate(-50%, -50%);
                                z-index: 25;">
                        ${count}
                    </div>
                `;
            });
        }

        // Helper function to get darker color for gradients (tablature colors)
        function getDarkerColor(color) {
            const colorMap = {
                // Main notes: teal (#008080) variants
                '#008080': '#006666',    // Darker teal for main notes

                // Grace notes: gold (#FFD700) variants
                '#FFD700': '#E6C200'     // Darker gold for grace notes
            };
            return colorMap[color] || color;
        }

        // Highlight notes on tablature when bar is clicked (persistent until another is selected)
        function highlightStringNotes(stringNum, durationType) {
            // Remove previous selections from all bars
            document.querySelectorAll('[onclick*="highlightStringNotes"]').forEach(bar => {
                bar.classList.remove('selected-bar');
                bar.style.boxShadow = bar.getAttribute('data-original-shadow') || '0 2px 4px rgba(0,0,0,0.2)';
                bar.style.filter = '';
                bar.style.transform = 'scale(1)';
            });

            // Clear previous note highlights
            document.querySelectorAll('.note-circle').forEach(circle => {
                circle.style.filter = '';
                // Don't reset stroke, strokeWidth, transform, or any positioning/sizing
            });

            if (!window.stringAnalysisData || !window.stringAnalysisData[stringNum]) return;

            const notes = window.stringAnalysisData[stringNum].durations[durationType];
            if (!notes || notes.length === 0) return;

            // Find and persistently select the clicked bar
            const targetBar = document.querySelector(`[onclick="highlightStringNotes('${stringNum}', '${durationType}')"]`);
            if (targetBar) {
                // Store original shadow if not already stored
                if (!targetBar.getAttribute('data-original-shadow')) {
                    targetBar.setAttribute('data-original-shadow', targetBar.style.boxShadow || '0 2px 4px rgba(0,0,0,0.2)');
                }

                // Mark as selected and add persistent glow
                targetBar.classList.add('selected-bar');
                targetBar.style.boxShadow = '0 0 20px #e74c3c, 0 0 30px #e74c3c, 0 4px 8px rgba(231,76,60,0.4)';
                targetBar.style.filter = 'brightness(1.1)';
                targetBar.style.transform = 'scale(1.02)'; // Slight scale to show selection
            }

            // Highlight the selected notes with glow only
            notes.forEach((noteData, index) => {
                const circle = noteData.element;

                // Apply only glow effect with animation delay - preserve everything else
                setTimeout(() => {
                    circle.style.filter = 'drop-shadow(0 0 15px #e74c3c) drop-shadow(0 0 25px #e74c3c) drop-shadow(0 0 35px #e74c3c)';
                    circle.style.transition = 'filter 0.3s ease';

                    // Ensure position, size, stroke, and numbers remain unchanged
                    // Do NOT modify: cx, cy, r, transform, stroke, strokeWidth
                }, index * 80); // Slightly faster staggered animation
            });

            // Show notification
            const stringNote = window.stringAnalysisData[stringNum].note;
            const durationLabel = durationType.replace('grace-', 'Grace ').replace(/^\w/, c => c.toUpperCase());
            showNotification(`Highlighted ${notes.length} ${durationLabel} notes on String ${stringNum} (${stringNote})`);
        }

        // Show temporary notification
        function showNotification(message) {
            // Remove existing notification if any
            const existing = document.getElementById('string-analysis-notification');
            if (existing) existing.remove();

            const notification = document.createElement('div');
            notification.id = 'string-analysis-notification';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #2c3e50, #3498db);
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 6px 20px rgba(0,0,0,0.3);
                z-index: 1002;
                font-size: 14px;
                font-weight: 500;
                opacity: 0;
                transform: translateX(100%) scale(0.8);
                transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                border-left: 4px solid #e74c3c;
                max-width: 300px;
            `;

            document.body.appendChild(notification);

            // Animate in
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0) scale(1)';
            }, 10);

            // Animate out and remove
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%) scale(0.8)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 400);
            }, 3500);
        }

        // Update String Analysis zoom (matches tablature zoom functionality)
        function updateStringAnalysisZoom(axis) {
            const content = document.getElementById('stringAnalysisContent');
            if (!content) return;

            const xSlider = document.getElementById('stringAnalysisXZoom');
            const ySlider = document.getElementById('stringAnalysisYZoom');
            const xValue = document.getElementById('stringAnalysisXValue');
            const yValue = document.getElementById('stringAnalysisYValue');

            if (!xSlider || !ySlider) return;

            let xZoom, yZoom;

            if (axis === 'x') {
                xZoom = parseFloat(xSlider.value) / 100;
                yZoom = parseFloat(ySlider.value) / 100;

                // Update X value display
                if (xSlider.value == 100) {
                    xValue.textContent = 'Fit';
                } else {
                    xValue.textContent = Math.round(xZoom * 100) + '%';
                }
            } else if (axis === 'y') {
                xZoom = parseFloat(xSlider.value) / 100;
                yZoom = parseFloat(ySlider.value) / 100;

                // Update Y value display
                yValue.textContent = Math.round(yZoom * 100) + '%';
            }

            // Apply transform using dynamic content width
            let scaleX, scaleY;

            if (xSlider.value == 100) {
                // Fit width mode - calculate based on actual content width
                const container = document.getElementById('stringAnalysisContainer');
                if (container && content) {
                    const containerWidth = container.clientWidth - 40; // Account for padding
                    const actualContentWidth = parseFloat(content.getAttribute('data-content-width')) || 11475;
                    scaleX = Math.max(0.1, containerWidth / actualContentWidth);
                    scaleY = yZoom;

                    console.log('Dynamic fit width calculation:', {
                        containerWidth,
                        actualContentWidth,
                        scaleX,
                        scaleY
                    });

                    content.style.transform = `scale(${scaleX}, ${scaleY})`;

                    // Update number positions after scaling
                    setTimeout(() => updateStringAnalysisNumbers(), 50);
                }
            } else {
                // Custom zoom mode
                scaleX = xZoom;
                scaleY = yZoom;
                content.style.transform = `scale(${scaleX}, ${scaleY})`;

                // Update number positions after scaling
                setTimeout(() => updateStringAnalysisNumbers(), 50);

                // Update right bar chart when Y-zoom changes
                if (axis === 'y') {
                    updateRightBarChartZoom();
                }
            }
        }

        // Initialize String Analysis zoom on content generation
        // Unified duration extraction function
        function extractDurationFromTablature(cx, cy) {
            let durationValue = 2; // Default
            const durationTexts = document.querySelectorAll('text[style*="font-size: 10px"][text-anchor="middle"]');

            durationTexts.forEach(text => {
                const textX = parseFloat(text.getAttribute('data-base-x') || text.getAttribute('x'));
                const textY = parseFloat(text.getAttribute('data-base-y') || text.getAttribute('y'));

                // Duration text is typically at the same X and about 20px above the note
                if (Math.abs(textX - cx) < 10 && Math.abs(textY - (cy - 20)) < 40) {
                    // Check for original duration stored in data attribute first (for fingering mode)
                    const originalDuration = text.getAttribute('data-original-duration');
                    const textContent = originalDuration || text.textContent.trim();
                    const value = parseFloat(textContent);
                    if (!isNaN(value)) {
                        durationValue = value;
                    }
                }
            });

            return durationValue;
        }

        function initializeStringAnalysisZoom() {
            // Set default: fit-width X, 67% Y
            const xSlider = document.getElementById('stringAnalysisXZoom');
            const ySlider = document.getElementById('stringAnalysisYZoom');
            const xValue = document.getElementById('stringAnalysisXValue');
            const yValue = document.getElementById('stringAnalysisYValue');

            if (xSlider && ySlider) {
                // Set fit width for X-zoom (value 100 = fit mode)
                xSlider.value = 100;
                ySlider.value = 67;

                // Update display values
                if (xValue) xValue.textContent = 'Fit';
                if (yValue) yValue.textContent = '67%';

                // Apply initial zoom after a brief delay
                setTimeout(() => {
                    updateStringAnalysisZoom('x');
                }, 150);
            }
        }

        // Generate KPIC-2 and KRIC-2 Sankey diagrams
        function generateSankeyDiagrams(kpicMode = 'all') {
            console.log('generateSankeyDiagrams called with mode:', kpicMode);
            const contentArea = document.getElementById('content-area');
            if (!contentArea) {
                console.error('Content area not found');
                return;
            }

            // Extract note data and calculate transitions
            const noteCircles = document.querySelectorAll('.note-circle');
            const pitchTransitions = {};
            const graceTransitions = {}; // Track which transitions involve grace notes
            const rhythmTransitions = {};
            const stringLabels = document.querySelectorAll('.string-label');
            const stringLines = document.querySelectorAll('.string-line');

            // Create string mapping
            const stringInfo = {};
            stringLines.forEach(line => {
                const yPos = parseFloat(line.getAttribute('data-base-y1') || line.getAttribute('y1'));
                let closestLabel = null;
                let minDistance = Infinity;
                stringLabels.forEach(label => {
                    const labelY = parseFloat(label.getAttribute('data-base-y') || label.getAttribute('y'));
                    const distance = Math.abs(yPos - labelY);
                    if (distance < minDistance && distance < 20) {
                        minDistance = distance;
                        closestLabel = label;
                    }
                });
                if (closestLabel) {
                    const text = closestLabel.textContent;
                    const match = text.match(/String (\d+): ([A-G]#?\d)/);
                    if (match) {
                        stringInfo[match[1]] = {
                            note: match[2],
                            yPos: yPos
                        };
                    }
                }
            });

            // Extract pitch and rhythm data for each note
            const noteData = [];
            let graceCount = 0;
            noteCircles.forEach((circle, index) => {
                const cy = parseFloat(circle.getAttribute('data-base-y') || circle.getAttribute('cy'));
                const cx = parseFloat(circle.getAttribute('data-base-x') || circle.getAttribute('cx'));
                const isGrace = circle.getAttribute('data-is-grace') === 'true';
                if (isGrace) graceCount++;

                // Skip grace notes in main mode (same as KRIC pattern generation)
                if (kpicMode === 'main' && isGrace) {
                    return;
                }

                // Find string/pitch
                let closestString = null;
                let minDistance = Infinity;
                for (const [stringNum, info] of Object.entries(stringInfo)) {
                    const distance = Math.abs(cy - info.yPos);
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestString = stringNum;
                    }
                }

                // Get actual duration from tablature text (same as KRIC dropdown)
                const durationValue = extractDurationFromTablature(cx, cy);

                // Use the actual duration values from the tablature
                let duration = durationValue.toString();

                // Add grace prefix if this is a grace note (same as KRIC pattern generation)
                const rhythmDuration = isGrace ? 'g' + duration : duration;

                noteData.push({
                    index: index,
                    pitch: closestString && stringInfo[closestString] ? stringInfo[closestString].note : 'Unknown',
                    stringNum: closestString || '0',
                    duration: rhythmDuration,
                    cx: cx,
                    isGrace: isGrace
                });
            });


            // Calculate KPIC-2 transitions (pitch to pitch) based on mode
            if (kpicMode === 'all') {
                // All notes mode - track main and grace transitions separately
                const mainTransitions = {};
                const graceRelatedTransitions = {};

                for (let i = 0; i < noteData.length - 1; i++) {
                    const from = `String ${noteData[i].stringNum}: ${noteData[i].pitch}`;
                    const to = `String ${noteData[i + 1].stringNum}: ${noteData[i + 1].pitch}`;
                    const baseKey = `${from}|||${to}`;

                    // Determine transition type
                    if (!noteData[i].isGrace && !noteData[i + 1].isGrace) {
                        // Main to main
                        if (!mainTransitions[baseKey]) {
                            mainTransitions[baseKey] = 0;
                        }
                        mainTransitions[baseKey]++;
                    } else {
                        // Involves grace notes - create a unique key for grace transitions
                        let graceKey = baseKey;
                        if (noteData[i].isGrace && noteData[i + 1].isGrace) {
                            graceKey = `${from}|||${to}|||grace-grace`;
                        } else if (noteData[i].isGrace) {
                            graceKey = `${from}|||${to}|||grace-main`;
                        } else {
                            graceKey = `${from}|||${to}|||main-grace`;
                        }

                        if (!graceRelatedTransitions[graceKey]) {
                            graceRelatedTransitions[graceKey] = 0;
                        }
                        graceRelatedTransitions[graceKey]++;

                        // Track grace info
                        graceTransitions[graceKey] = {
                            fromGrace: noteData[i].isGrace,
                            toGrace: noteData[i + 1].isGrace,
                            count: graceRelatedTransitions[graceKey]
                        };
                    }
                }

                // Combine both transition types
                Object.assign(pitchTransitions, mainTransitions);
                Object.assign(pitchTransitions, graceRelatedTransitions);
            } else if (kpicMode === 'main') {
                // Main notes mode - exclude grace notes
                for (let i = 0; i < noteData.length - 1; i++) {
                    if (!noteData[i].isGrace && !noteData[i + 1].isGrace) {
                        const from = `String ${noteData[i].stringNum}: ${noteData[i].pitch}`;
                        const to = `String ${noteData[i + 1].stringNum}: ${noteData[i + 1].pitch}`;
                        const key = `${from}|||${to}`;
                        if (!pitchTransitions[key]) {
                            pitchTransitions[key] = 0;
                        }
                        pitchTransitions[key]++;
                    }
                }
            } else if (kpicMode === 'grace') {
                // Grace units mode - analyze complete grace unit sequences
                const graceUnits = []; // Store complete grace unit information

                // Find all grace unit sequences: main ‚Üí grace_sequence ‚Üí main
                for (let i = 0; i < noteData.length; i++) {
                    if (noteData[i].isGrace) {
                        // Find the main note before this grace sequence
                        let beforeMainIndex = i - 1;
                        while (beforeMainIndex >= 0 && noteData[beforeMainIndex].isGrace) {
                            beforeMainIndex--;
                        }

                        // Find the complete grace sequence
                        let graceStartIndex = i;
                        let graceEndIndex = i;
                        while (graceEndIndex + 1 < noteData.length && noteData[graceEndIndex + 1].isGrace) {
                            graceEndIndex++;
                        }

                        // Find the main note after this grace sequence
                        let afterMainIndex = graceEndIndex + 1;
                        while (afterMainIndex < noteData.length && noteData[afterMainIndex].isGrace) {
                            afterMainIndex++;
                        }

                        // Only process if we have complete sequence: main ‚Üí grace(s) ‚Üí main
                        if (beforeMainIndex >= 0 && afterMainIndex < noteData.length) {
                            const beforeMain = noteData[beforeMainIndex];
                            const afterMain = noteData[afterMainIndex];
                            const graceSequence = noteData.slice(graceStartIndex, graceEndIndex + 1);

                            // Create grace unit identifier
                            const graceUnitId = `${beforeMain.pitch}‚Üí(${graceSequence.map(g => g.pitch).join('‚Üí')})‚Üí${afterMain.pitch}`;

                            // Store complete grace unit information
                            graceUnits.push({
                                beforeMain,
                                graceSequence,
                                afterMain,
                                graceUnitId,
                                startIndex: beforeMainIndex,
                                endIndex: afterMainIndex
                            });

                            // Skip to end of this grace sequence to avoid double processing
                            i = graceEndIndex;
                        }
                    }
                }

                console.log('Found grace units:', graceUnits.map(gu => gu.graceUnitId));

                // Create transitions for complete grace unit sequences
                graceUnits.forEach(graceUnit => {
                    const { beforeMain, graceSequence, afterMain } = graceUnit;

                    // Column positions for 3-column layout
                    const beforeMainKey = `String ${beforeMain.stringNum}: ${beforeMain.pitch}`;
                    const afterMainKey = `String ${afterMain.stringNum}: ${afterMain.pitch}`;

                    // Create grace unit summary (all grace notes in sequence)
                    const graceUnitKey = `GraceUnit(${graceSequence.map(g => g.pitch).join('-')})`;

                    // Transition 1: BeforeMain ‚Üí GraceUnit (column 2 ‚Üí column 1/3)
                    const key1 = `${beforeMainKey}|||${graceUnitKey}|||unit-approach`;
                    if (!pitchTransitions[key1]) {
                        pitchTransitions[key1] = 0;
                    }
                    pitchTransitions[key1]++;

                    graceTransitions[key1] = {
                        fromGrace: false,
                        toGrace: true,
                        isGraceUnit: true,
                        stage: 'approach',
                        graceSequence: graceSequence,
                        count: pitchTransitions[key1]
                    };

                    // Transition 2: GraceUnit ‚Üí AfterMain (column 1/3 ‚Üí column 2)
                    const key2 = `${graceUnitKey}|||${afterMainKey}|||unit-departure`;
                    if (!pitchTransitions[key2]) {
                        pitchTransitions[key2] = 0;
                    }
                    pitchTransitions[key2]++;

                    graceTransitions[key2] = {
                        fromGrace: true,
                        toGrace: false,
                        isGraceUnit: true,
                        stage: 'departure',
                        graceSequence: graceSequence,
                        count: pitchTransitions[key2]
                    };

                    console.log(`Grace unit: ${beforeMain.pitch} ‚Üí (${graceSequence.map(g => g.pitch).join('‚Üí')}) ‚Üí ${afterMain.pitch}`);
                });
            }

            // Calculate KRIC-2 transitions (rhythm to rhythm)
            // Use actual duration values from tablature
            const durationRanks = {
                '0.5': 0.5,
                '1': 1,
                '2': 2,
                '3': 3,
                '4': 4,
                '5': 5,
                '6': 6,
                '7': 7,
                '8': 8
            };

            // Apply mode-based filtering for KRIC (same as KPIC)
            if (kpicMode === 'main') {
                // Main notes mode - exclude grace notes for KRIC
                for (let i = 0; i < noteData.length - 1; i++) {
                    if (!noteData[i].isGrace && !noteData[i + 1].isGrace) {
                        const from = noteData[i].duration;
                        const to = noteData[i + 1].duration;
                        const key = `${from}|||${to}|||main-main`;
                        if (!rhythmTransitions[key]) {
                            rhythmTransitions[key] = 0;
                        }
                        rhythmTransitions[key]++;
                    }
                }
            } else {
                // All notes mode - include all transitions with proper types
                for (let i = 0; i < noteData.length - 1; i++) {
                    const from = noteData[i].duration;
                    const to = noteData[i + 1].duration;
                    const fromIsGrace = from.startsWith('g');
                    const toIsGrace = to.startsWith('g');

                    // Determine transition type
                    let transitionType;
                    if (fromIsGrace && toIsGrace) {
                        transitionType = 'grace-grace';
                    } else if (fromIsGrace && !toIsGrace) {
                        transitionType = 'grace-main';
                    } else if (!fromIsGrace && toIsGrace) {
                        transitionType = 'main-grace';
                    } else {
                        transitionType = 'main-main';
                    }

                    const key = `${from}|||${to}|||${transitionType}`;
                    if (!rhythmTransitions[key]) {
                        rhythmTransitions[key] = 0;
                    }
                    rhythmTransitions[key]++;
                }
            }

            // Calculate totals for verification and ranking
            const kpicTotal = Object.values(pitchTransitions).reduce((sum, count) => sum + count, 0);
            const kricTotal = Object.values(rhythmTransitions).reduce((sum, count) => sum + count, 0);

            const totalNoteTransitions = noteData.length - 1;

            // Create transition rankings for tooltips
            const pitchTransitionRankings = Object.entries(pitchTransitions)
                .sort(([,a], [,b]) => b - a)
                .map(([key, count], index) => ({ key, count, rank: index + 1, percentage: (count / kpicTotal * 100).toFixed(1) }));

            const rhythmTransitionRankings = Object.entries(rhythmTransitions)
                .sort(([,a], [,b]) => b - a)
                .map(([key, count], index) => ({ key, count, rank: index + 1, percentage: (count / kricTotal * 100).toFixed(1) }));

            // Create lookup maps for quick access
            const pitchRankingMap = new Map(pitchTransitionRankings.map(r => [r.key, r]));
            const rhythmRankingMap = new Map(rhythmTransitionRankings.map(r => [r.key, r]));

            // Create HTML structure
            console.log('Generating Sankey HTML...');
            console.log('üìä TRANSITION COUNT VERIFICATION:');
            console.log(`Total notes: ${noteData.length}`);
            console.log(`Expected transitions: ${totalNoteTransitions}`);
            console.log(`KPIC-2 total: ${kpicTotal}`);
            console.log(`KRIC-2 total: ${kricTotal}`);
            console.log(`KPIC-2 = KRIC-2? ${kpicTotal === kricTotal ? '‚úÖ YES' : '‚ùå NO'}`);
            console.log('Rhythm transitions found:', Object.keys(rhythmTransitions).length);
            console.log('Rhythm transition details:', rhythmTransitions);
            const pitchSankeyHTML = generateSankeyHTML('pitch', pitchTransitions, noteData, null, graceTransitions, kpicMode, pitchRankingMap, rhythmTransitions, rhythmRankingMap, kpicTotal);
            const rhythmSankeyHTML = generateSankeyHTML('rhythm', rhythmTransitions, noteData, durationRanks, null, kpicMode, null, rhythmTransitions, rhythmRankingMap, kricTotal);

            contentArea.innerHTML = `
"<div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;\">" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #e74c3c;\"><div style=\"font-size: 20px; font-weight: bold; color: #e74c3c;\">137</div><div style=\"font-size: 12px; color: #7f8c8d;\">Total Notes</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #3498db;\"><div style=\"font-size: 20px; font-weight: bold; color: #3498db;\">7</div><div style=\"font-size: 12px; color: #7f8c8d;\">Strings Used</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #9b59b6;\"><div style=\"font-size: 20px; font-weight: bold; color: #9b59b6;\">3</div><div style=\"font-size: 12px; color: #7f8c8d;\">Sections (cyclical)</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #f39c12;\"><div style=\"font-size: 20px; font-weight: bold; color: #f39c12;\">2</div><div style=\"font-size: 12px; color: #7f8c8d;\">Key Phrases</div></div></div>";
contentArea.innerHTML += "<div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;\"><div style=\"background: #e8f5e8; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #27ae60;\"><h5 style=\"margin: 0 0 5px 0; color: #27ae60;\">Learn Only</h5><div style=\"font-size: 24px; font-weight: bold; color: #27ae60;\">56 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">40.9% of song</p></div><div style=\"background: #f0f8ff; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #3498db;\"><h5 style=\"margin: 0 0 5px 0; color: #3498db;\">Know Entire Song</h5><div style=\"font-size: 24px; font-weight: bold; color: #3498db;\">137 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">59% efficiency gain!</p></div></div>";
contentArea.innerHTML += "<div style=\"background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;\"><h4>üèóÔ∏è Song Structure</h4><div style=\"background: white; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px;\">Section 1 (0-45): 7-note motif + 16-note signature<br>Section 2 (46-88): Repeat with compression<br>Section 3 (89-131): Repeat with compression<br>Coda (132-136): Brief ending</div></div>";
                <div style="padding: 20px;">
                    <h3 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">üìà KPIC-2 & KRIC-2 Transition Analysis</h3>

                    <!-- Controls -->
                    <div style="display: flex; gap: 20px; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <div style="flex: 1;">
                            <label style="font-weight: bold; color: #495057;">X-Zoom:</label>
                            <input type="range" id="sankey-x-zoom" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
                            <span id="sankey-x-zoom-value">1.0x</span>
                        </div>
                        <div style="flex: 1;">
                            <label style="font-weight: bold; color: #495057;">Y-Zoom:</label>
                            <input type="range" id="sankey-y-zoom" min="0.05" max="3" step="0.01" value="0.67" style="width: 100%;">
                            <span id="sankey-y-zoom-value">67%</span>
                        </div>
                        <div style="flex: 1;">
                            <label style="font-weight: bold; color: #495057;">KPIC-2 Mode:</label>
                            <div style="display: flex; gap: 10px; align-items: center; margin-top: 5px;">
                                <label style="display: flex; align-items: center; font-size: 13px; cursor: pointer;">
                                    <input type="radio" name="sankeyMode" value="all" onchange="regenerateSankeyWithMode()" ${kpicMode === 'all' ? 'checked' : ''} style="margin-right: 4px;">
                                    All Notes
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; cursor: pointer;">
                                    <input type="radio" name="sankeyMode" value="main" onchange="regenerateSankeyWithMode()" ${kpicMode === 'main' ? 'checked' : ''} style="margin-right: 4px;">
                                    Main Only
                                </label>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 20px;">
                        <!-- KPIC-2 Sankey -->
                        <div style="flex: 1; background: white; padding: 15px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="text-align: center; color: #3498db;">KPIC-2: Pitch Transitions</h4>
                            <div id="kpic-sankey" style="overflow: auto; max-height: 600px;">
                                ` + pitchSankeyHTML + `
                            </div>
                        </div>

                        <!-- KRIC-2 Sankey -->
                        <div style="flex: 1; background: white; padding: 15px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="text-align: center; color: #e74c3c;">KRIC-2: Rhythm Transitions</h4>
                            <div id="kric-sankey" style="overflow: auto; max-height: 600px;">
                                ` + rhythmSankeyHTML + `
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Add zoom event listeners
            document.getElementById('sankey-x-zoom').addEventListener('input', function() {
                const zoomValue = this.value;
                document.getElementById('sankey-x-zoom-value').textContent = zoomValue + 'x';
                updateSankeyZoom();
            });

            document.getElementById('sankey-y-zoom').addEventListener('input', function() {
                const zoomValue = this.value;
                const percentage = Math.round(zoomValue * 100);
                document.getElementById('sankey-y-zoom-value').textContent = percentage + '%';
                updateSankeyZoom();
            });

            // Apply initial zoom to match tablature after a delay to ensure elements are rendered
            setTimeout(() => {
                updateSankeyZoom();
            }, 50);
        }

        // Generate KRIC-3 Sankey diagram only
        function generateKric3SankeyDiagram(kricMode = 'all') {
            console.log('generateKric3SankeyDiagram called with mode:', kricMode);
            const contentArea = document.getElementById('content-area');
            if (!contentArea) {
                console.error('Content area not found');
                return;
            }

            // Use existing KRIC-3 patterns from dropdown data
            // Generate KRIC patterns if not already generated
            if (!window.kricPatterns) {
                generateKricPatterns();
            }

            // Get KRIC-3 patterns from the existing system
            const kric3Patterns = window.kricPatterns['kric-3'] || [];

            console.log('Using existing KRIC-3 patterns from dropdown:', kric3Patterns.length);

            console.log('KRIC-3 patterns found:', kric3Patterns.length);

            // Log all KRIC-3 patterns in dropdown format
            console.log('\n=== ALL KRIC-3 PATTERNS (Dropdown Format) ===');
            kric3Patterns.forEach((pattern, index) => {
                const patternStr = pattern.pattern.map(d => durationToNoteName(d)).join(' ‚Üí ');
                const positionStr = pattern.positions.slice(0, 5).map(p => `Note ${p + 1}`).join(', ');
                const positionSuffix = pattern.positions.length > 5 ? `, +${pattern.positions.length - 5} more` : '';
                console.log(`${index + 1}. ${patternStr} (√ó${pattern.count}) - Positions: ${positionStr}${positionSuffix}`);
            });
            console.log('=== END KRIC-3 PATTERNS ===\n');

            // Generate KRIC-3 Sankey HTML with proper 3-column FROM-MIDDLE-TO layout
            const kric3SankeyHTML = generateKric3FormattedSankeyHTML(kric3Patterns, kricMode);

            contentArea.innerHTML = `
"<div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;\">" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #e74c3c;\"><div style=\"font-size: 20px; font-weight: bold; color: #e74c3c;\">137</div><div style=\"font-size: 12px; color: #7f8c8d;\">Total Notes</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #3498db;\"><div style=\"font-size: 20px; font-weight: bold; color: #3498db;\">7</div><div style=\"font-size: 12px; color: #7f8c8d;\">Strings Used</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #9b59b6;\"><div style=\"font-size: 20px; font-weight: bold; color: #9b59b6;\">3</div><div style=\"font-size: 12px; color: #7f8c8d;\">Sections (cyclical)</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #f39c12;\"><div style=\"font-size: 20px; font-weight: bold; color: #f39c12;\">2</div><div style=\"font-size: 12px; color: #7f8c8d;\">Key Phrases</div></div></div>";
contentArea.innerHTML += "<div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;\"><div style=\"background: #e8f5e8; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #27ae60;\"><h5 style=\"margin: 0 0 5px 0; color: #27ae60;\">Learn Only</h5><div style=\"font-size: 24px; font-weight: bold; color: #27ae60;\">56 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">40.9% of song</p></div><div style=\"background: #f0f8ff; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #3498db;\"><h5 style=\"margin: 0 0 5px 0; color: #3498db;\">Know Entire Song</h5><div style=\"font-size: 24px; font-weight: bold; color: #3498db;\">137 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">59% efficiency gain!</p></div></div>";
contentArea.innerHTML += "<div style=\"background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;\"><h4>üèóÔ∏è Song Structure</h4><div style=\"background: white; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px;\">Section 1 (0-45): 7-note motif + 16-note signature<br>Section 2 (46-88): Repeat with compression<br>Section 3 (89-131): Repeat with compression<br>Coda (132-136): Brief ending</div></div>";
                <div style="padding: 20px;">
                    <h3 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">üìà KRIC-3 Rhythm Pattern Analysis</h3>

                    <!-- Controls -->
                    <div style="display: flex; gap: 20px; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <div style="flex: 1;">
                            <label style="font-weight: bold; color: #495057;">X-Zoom:</label>
                            <input type="range" id="kric3-x-zoom" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
                            <span id="kric3-x-zoom-value">1.0x</span>
                        </div>
                        <div style="flex: 1;">
                            <label style="font-weight: bold; color: #495057;">Y-Zoom:</label>
                            <input type="range" id="kric3-y-zoom" min="0.05" max="3" step="0.01" value="0.67" style="width: 100%;">
                            <span id="kric3-y-zoom-value">67%</span>
                        </div>
                        <div style="flex: 1;">
                            <label style="font-weight: bold; color: #495057;">KRIC-3 Mode:</label>
                            <div style="display: flex; gap: 10px; align-items: center; margin-top: 5px;">
                                <label style="display: flex; align-items: center; font-size: 13px; cursor: pointer;">
                                    <input type="radio" name="kric3Mode" value="all" onchange="regenerateKric3WithMode()" ${kricMode === 'all' ? 'checked' : ''} style="margin-right: 4px;">
                                    All Notes
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; cursor: pointer;">
                                    <input type="radio" name="kric3Mode" value="main" onchange="regenerateKric3WithMode()" ${kricMode === 'main' ? 'checked' : ''} style="margin-right: 4px;">
                                    Main Only
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- KRIC-3 Sankey -->
                    <div style="background: white; padding: 15px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h4 style="text-align: center; color: #e74c3c;">KRIC-3: Three-Note Rhythm Transitions</h4>
                        <div id="kric3-sankey" style="overflow: auto; max-height: 600px;">
                            ${kric3SankeyHTML}
                        </div>
                    </div>
                </div>
            `;

            // Add zoom event listeners
            document.getElementById('kric3-x-zoom').addEventListener('input', function() {
                const zoomValue = this.value;
                document.getElementById('kric3-x-zoom-value').textContent = zoomValue + 'x';
                updateKric3Zoom();
            });

            document.getElementById('kric3-y-zoom').addEventListener('input', function() {
                const zoomValue = this.value;
                const percentage = Math.round(zoomValue * 100);
                document.getElementById('kric3-y-zoom-value').textContent = percentage + '%';
                updateKric3Zoom();
            });

            // Apply initial zoom to match default Y-zoom of 67%
            setTimeout(() => {
                updateKric3Zoom();
            }, 50);
        }

        // Generate KPIC-3 and KRIC-3 Sankey diagrams
        function generateKpic3Kric3SankeyDiagrams(kpicMode = 'all') {
            console.log('generateKpic3Kric3SankeyDiagrams called with mode:', kpicMode);
            const contentArea = document.getElementById('content-area');
            if (!contentArea) {
                console.error('Content area not found');
                return;
            }

            // Get KPIC-3 patterns from existing data
            const analysisMode = kpicMode === 'main' ? 'main' : 'full';
            let kpic3Patterns = analysisData.kpic_patterns[analysisMode]['kpic-3'] || [];
            // Get KRIC-3 patterns from the existing system (same as dropdown)
            // Force regeneration to ensure fresh data
            console.log('üîÑ Force regenerating KRIC patterns for KRIC-3 analysis');
            window.kricPatterns = null;
            generateKricPatterns();
            const kric3Patterns = window.kricPatterns['kric-3'] || [];

            // Extract ALL KPIC-3 patterns to match the dropdown (including single occurrences)
            const noteCircles = document.querySelectorAll('.note-circle');
            const allKpic3Patterns = {};

            // Build string mapping
            const stringLabels = document.querySelectorAll('.string-label');
            const stringLines = document.querySelectorAll('.string-line');
            const stringInfo = {};

            stringLines.forEach(line => {
                const yPos = parseFloat(line.getAttribute('data-base-y1') || line.getAttribute('y1'));
                let closestLabel = null;
                let minDistance = Infinity;
                stringLabels.forEach(label => {
                    const labelY = parseFloat(label.getAttribute('data-base-y') || label.getAttribute('y'));
                    const distance = Math.abs(yPos - labelY);
                    if (distance < minDistance && distance < 20) {
                        minDistance = distance;
                        closestLabel = label;
                    }
                });

                if (closestLabel) {
                    const text = closestLabel.textContent;
                    const match = text.match(/String (\d+): ([A-G]#?\d)/);
                    if (match) {
                        const stringNum = match[1];
                        const note = match[2];
                        stringInfo[stringNum] = { yPos: yPos, note: note };
                    }
                }
            });

            // Extract all 3-note patterns
            for (let i = 0; i <= noteCircles.length - 3; i++) {
                const pattern = [];
                let allPitchesFound = true;

                // Build the 3-note pattern
                for (let j = 0; j < 3; j++) {
                    const note = noteCircles[i + j];
                    const cy = parseFloat(note.getAttribute('data-base-y') || note.getAttribute('cy'));

                    // Find closest string
                    let pitch = null;
                    let minDist = Infinity;

                    for (const [stringNum, info] of Object.entries(stringInfo)) {
                        const dist = Math.abs(cy - info.yPos);
                        if (dist < minDist && dist < 30) {
                            minDist = dist;
                            pitch = info.note;
                        }
                    }

                    if (pitch) {
                        pattern.push(pitch);
                    } else {
                        allPitchesFound = false;
                        break;
                    }
                }

                if (allPitchesFound && pattern.length === 3) {
                    const key = pattern.join(',');
                    if (!allKpic3Patterns[key]) {
                        allKpic3Patterns[key] = {
                            pattern: pattern,
                            positions: [],
                            count: 0
                        };
                    }
                    allKpic3Patterns[key].positions.push(i);
                    allKpic3Patterns[key].count++;
                }
            }

            // Convert to array and combine with existing patterns
            const dynamicPatterns = Object.values(allKpic3Patterns);

            // Merge with existing patterns, avoiding duplicates
            dynamicPatterns.forEach(dynPattern => {
                const exists = kpic3Patterns.some(p =>
                    JSON.stringify(p.pattern) === JSON.stringify(dynPattern.pattern)
                );
                if (!exists) {
                    kpic3Patterns.push(dynPattern);
                }
            });

            // Sort patterns by count (descending) then by pattern string
            kpic3Patterns.sort((a, b) => {
                if (b.count !== a.count) return b.count - a.count;
                return JSON.stringify(a.pattern).localeCompare(JSON.stringify(b.pattern));
            });

            console.log('KPIC-3 patterns found:', kpic3Patterns.length, '(including all occurrences to match dropdown)');
            console.log('KRIC-3 patterns found:', kric3Patterns.length);

            // Generate KPIC-3 Sankey HTML
            const kpic3SankeyHTML = generateKpic3SankeyHTML(kpic3Patterns);

            // Generate KRIC-3 Sankey HTML with proper 3-column FROM-MIDDLE-TO layout
            const kric3SankeyHTML = generateKric3FormattedSankeyHTML(kric3Patterns, kpicMode);

            contentArea.innerHTML = `
"<div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;\">" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #e74c3c;\"><div style=\"font-size: 20px; font-weight: bold; color: #e74c3c;\">137</div><div style=\"font-size: 12px; color: #7f8c8d;\">Total Notes</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #3498db;\"><div style=\"font-size: 20px; font-weight: bold; color: #3498db;\">7</div><div style=\"font-size: 12px; color: #7f8c8d;\">Strings Used</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #9b59b6;\"><div style=\"font-size: 20px; font-weight: bold; color: #9b59b6;\">3</div><div style=\"font-size: 12px; color: #7f8c8d;\">Sections (cyclical)</div></div>" +
"<div style=\"background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border-left: 3px solid #f39c12;\"><div style=\"font-size: 20px; font-weight: bold; color: #f39c12;\">2</div><div style=\"font-size: 12px; color: #7f8c8d;\">Key Phrases</div></div></div>";
contentArea.innerHTML += "<div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;\"><div style=\"background: #e8f5e8; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #27ae60;\"><h5 style=\"margin: 0 0 5px 0; color: #27ae60;\">Learn Only</h5><div style=\"font-size: 24px; font-weight: bold; color: #27ae60;\">56 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">40.9% of song</p></div><div style=\"background: #f0f8ff; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #3498db;\"><h5 style=\"margin: 0 0 5px 0; color: #3498db;\">Know Entire Song</h5><div style=\"font-size: 24px; font-weight: bold; color: #3498db;\">137 notes</div><p style=\"margin: 5px 0 0 0; font-size: 12px; color: #7f8c8d;\">59% efficiency gain!</p></div></div>";
contentArea.innerHTML += "<div style=\"background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;\"><h4>üèóÔ∏è Song Structure</h4><div style=\"background: white; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px;\">Section 1 (0-45): 7-note motif + 16-note signature<br>Section 2 (46-88): Repeat with compression<br>Section 3 (89-131): Repeat with compression<br>Coda (132-136): Brief ending</div></div>";
                <div style="padding: 20px;">
                    <h3 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">üìà KPIC-3 & KRIC-3 Pattern Analysis</h3>

                    <!-- Controls -->
                    <div style="display: flex; gap: 20px; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <div style="flex: 1;">
                            <label style="font-weight: bold; color: #495057;">X-Zoom:</label>
                            <input type="range" id="kpic3-x-zoom" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
                            <span id="kpic3-x-zoom-value">1.0x</span>
                        </div>
                        <div style="flex: 1;">
                            <label style="font-weight: bold; color: #495057;">Y-Zoom:</label>
                            <input type="range" id="kpic3-y-zoom" min="0.05" max="3" step="0.01" value="0.67" style="width: 100%;">
                            <span id="kpic3-y-zoom-value">67%</span>
                        </div>
                        <div style="flex: 1;">
                            <label style="font-weight: bold; color: #495057;">KPIC-3 Mode:</label>
                            <div style="display: flex; gap: 10px; align-items: center; margin-top: 5px;">
                                <label style="display: flex; align-items: center; font-size: 13px; cursor: pointer;">
                                    <input type="radio" name="kpic3Mode" value="all" onchange="regenerateKpic3WithMode()" ${kpicMode === 'all' ? 'checked' : ''} style="margin-right: 4px;">
                                    All Notes
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; cursor: pointer;">
                                    <input type="radio" name="kpic3Mode" value="main" onchange="regenerateKpic3WithMode()" ${kpicMode === 'main' ? 'checked' : ''} style="margin-right: 4px;">
                                    Main Only
                                </label>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 20px;">
                        <!-- KPIC-3 Patterns -->
                        <div style="flex: 1; background: white; padding: 10px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="text-align: center; color: #3498db; margin-bottom: 15px;">KPIC-3: Three-Note Pitch Patterns</h4>
                            <div id="kpic3-patterns">
                                ` + kpic3SankeyHTML + `
                            </div>
                        </div>

                        <!-- KRIC-3 Patterns -->
                        <div style="flex: 1; background: white; padding: 10px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="text-align: center; color: #e74c3c; margin-bottom: 15px;">KRIC-3: Three-Note Rhythm Patterns</h4>
                            <div id="kric3-patterns">
                                ` + kric3SankeyHTML + `
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Add zoom event listeners
            document.getElementById('kpic3-x-zoom').addEventListener('input', function() {
                const zoomValue = this.value;
                document.getElementById('kpic3-x-zoom-value').textContent = zoomValue + 'x';
                updateKpic3Zoom();
            });

            document.getElementById('kpic3-y-zoom').addEventListener('input', function() {
                const zoomValue = this.value;
                const percentage = Math.round(zoomValue * 100);
                document.getElementById('kpic3-y-zoom-value').textContent = percentage + '%';
                updateKpic3Zoom();
            });

            // Apply initial zoom to match tablature after a delay to ensure elements are rendered
            setTimeout(() => {
                updateKpic3Zoom();
                // Add click handlers to the new Sankey bands
                addSankeyClickHandlers();
            }, 50);
        }

        // Generate KPIC-3 Sankey diagram HTML with 3 columns
        function generateKpic3SankeyHTML(patterns) {
            if (!patterns || patterns.length === 0) {
                return '<div style="text-align: center; padding: 40px; color: #999;">No KPIC-3 patterns found</div>';
            }

            return generateThreeColumnSankey(patterns, 'pitch');
        }

        // KRIC-3 helper functions
        function showKric3Tooltip(event, data, transition, segment) {
            // Remove existing tooltip
            const existingTooltip = document.querySelector('.sankey-tooltip');
            if (existingTooltip) {
                existingTooltip.remove();
            }

            // Create new tooltip
            const tooltip = document.createElement('div');
            tooltip.className = 'sankey-tooltip';

            const pattern = data.pattern ? data.pattern.join(' ‚Üí ') : data.fullPattern.join(' ‚Üí ');
            const count = data.count;
            const positions = data.positions.slice(0, 5).map(p => `Note ${p + 1}`).join(', ');
            const positionSuffix = data.positions.length > 5 ? `, +${data.positions.length - 5} more` : '';

            // Check for grace notes
            const patternArray = data.pattern || data.fullPattern;
            const hasGrace = patternArray.some(d => d.toString().startsWith('g'));
            let texturePattern = '';
            if (hasGrace) {
                const textures = patternArray.map(d => d.toString().startsWith('g') ? '‚îÖ‚îÖ‚îÖ‚îÖ' : '‚îÅ‚îÅ‚îÅ‚îÅ').join(' ');
                texturePattern = `<div class="tooltip-section"><span class="tooltip-label">Texture Pattern:</span><br><span style="font-family: monospace;">${textures}</span></div>`;
            }

            const segmentLabel = segment ? ` (Segment ${segment}/2)` : '';

            tooltip.innerHTML = `
                <div class="tooltip-title">KRIC-3: ${pattern}</div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Transition:</span> <span class="tooltip-value">${transition}${segmentLabel}</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Occurrences:</span> <span class="tooltip-value">${count}</span>
                </div>
                ${texturePattern}
                <div class="tooltip-section">
                    <span class="tooltip-label">Positions:</span> <span class="tooltip-value">${positions}${positionSuffix}</span>
                </div>
            `;

            // Position tooltip
            tooltip.style.left = (event.pageX + 15) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
            document.body.appendChild(tooltip);
        }

        function selectKric3Pattern(pattern, positions, event) {
            console.log('KRIC-3 pattern selected:', pattern, 'positions:', positions);

            // Clear any existing selections
            document.querySelectorAll('.kric3-pattern-group-0, .kric3-pattern-group-1, .kric3-pattern-group-2, .kric3-pattern-group-3, .kric3-pattern-group-4, .kric3-pattern-group-5, .kric3-pattern-group-6, .kric3-pattern-group-7, .kric3-pattern-group-8, .kric3-pattern-group-9').forEach(band => {
                band.classList.remove('selected-kric3-band');
                band.style.stroke = '';
                band.style.strokeWidth = '';
                band.style.filter = '';
            });

            // Get the pattern group from the clicked element
            const clickedElement = event.target;
            const patternGroup = clickedElement.getAttribute('data-pattern-group');

            if (patternGroup) {
                // Select both segments of this pattern
                const groupElements = document.querySelectorAll(`.kric3-pattern-group-${patternGroup}`);
                groupElements.forEach(element => {
                    element.classList.add('selected-kric3-band');
                    element.style.stroke = '#FFD700';
                    element.style.strokeWidth = '4';
                    element.style.filter = 'drop-shadow(0 0 10px #FFD700)';
                });
            }

            // Highlight corresponding notes in tablature
            if (positions && positions.length > 0) {
                highlightKric3PatternInTablature(pattern, positions);
            }

            // Trigger KRIC-3 dropdown selection
            triggerKRIC3Pattern(pattern, event?.ctrlKey || event?.metaKey || false);

            // Prevent event bubbling
            if (event) {
                event.stopPropagation();
            }
        }

        // Highlight KRIC-3 pattern in tablature
        function highlightKric3PatternInTablature(pattern, positions) {
            console.log('Highlighting KRIC-3 pattern in tablature:', pattern, 'at positions:', positions);

            // Clear existing highlights
            clearHighlighting();

            // Highlight the notes in the pattern
            positions.forEach(startPos => {
                // Highlight the 3-note sequence starting at this position
                for (let i = 0; i < 3; i++) {
                    const noteIndex = startPos + i;
                    const noteElement = document.getElementById(`note-${noteIndex}`);
                    if (noteElement) {
                        noteElement.classList.add('kric-highlight', 'pattern-member');
                        noteElement.setAttribute('data-pattern-type', 'kric-3');
                        noteElement.setAttribute('data-pattern-info', `KRIC-3: ${pattern.join(' ‚Üí ')}`);
                    }
                }
            });

            console.log(`üéØ Highlighted ${positions.length} KRIC-3 pattern occurrences in tablature`);
        }

        // Select KRIC-3 pattern from element data attributes (safer than inline JSON)
        function selectKric3PatternFromElement(element, event) {
            try {
                const pattern = JSON.parse(element.getAttribute('data-pattern'));
                const positions = JSON.parse(element.getAttribute('data-positions'));
                selectKric3Pattern(pattern, positions, event);
            } catch (e) {
                console.error('Error parsing KRIC-3 pattern data:', e);
            }
        }

        // Show detailed KRIC-3 tooltip (matching KPIC-3 style)
        function showKric3DetailedTooltip(event, transitionInfo, segment) {
            // Remove existing tooltip
            hideSankeyTooltip();

            if (!transitionInfo) return;

            // Create new tooltip
            const tooltip = document.createElement('div');
            tooltip.className = 'sankey-tooltip';

            const { fullPattern, segment1, segment2, count, totalPatterns, percentage, rank, positions, hasGrace } = transitionInfo;

            // Determine which segment is being hovered
            const currentSegment = segment === 2 ? segment2 : segment1;
            const segmentLabel = segment === 2 ? ' (Segment 2/2)' : ' (Segment 1/2)';

            let typeLabel = hasGrace ? ' (includes grace notes)' : '';

            // Position information
            const positionList = positions.slice(0, 5).map(pos => `Note ${pos + 1}`).join(', ');
            const positionSuffix = positions.length > 5 ? `, +${positions.length - 5} more` : '';

            // Convert rhythm values to readable note names
            const readablePattern = transitionInfo.pattern.map(d => durationToNoteName(d)).join(' ‚Üí ');
            const readableSegment1 = `${durationToNoteName(transitionInfo.pattern[0])} ‚Üí ${durationToNoteName(transitionInfo.pattern[1])}`;
            const readableSegment2 = `${durationToNoteName(transitionInfo.pattern[1])} ‚Üí ${durationToNoteName(transitionInfo.pattern[2])}`;
            const currentReadableSegment = segment === 2 ? readableSegment2 : readableSegment1;

            tooltip.innerHTML = `
                <div class="tooltip-title">KRIC-3: ${currentReadableSegment}${segmentLabel}</div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Full Pattern:</span> <span class="tooltip-value">${readablePattern}</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Occurrences:</span> <span class="tooltip-value">${count}/${totalPatterns} (${percentage}%)</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Frequency Rank:</span> <span class="tooltip-value">#${rank}</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Pattern Type:</span> <span class="tooltip-value">3-Note Rhythm${typeLabel}</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Positions:</span> <span class="tooltip-value">${positionList}${positionSuffix}</span>
                </div>
                ${hasGrace ? '<div class="tooltip-section"><span class="tooltip-label">Grace Pattern:</span> <span class="tooltip-value">Contains grace note transitions</span></div>' : ''}
            `;

            // Position tooltip
            tooltip.style.position = 'absolute';
            tooltip.style.left = (event.pageX + 10) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
            tooltip.style.zIndex = '10000';

            document.body.appendChild(tooltip);
        }

        // Trigger KRIC-3 pattern selection in dropdown
        function triggerKRIC3Pattern(pattern, isMultiSelect = false) {
            console.log('triggerKRIC3Pattern called with:', pattern, 'multiSelect:', isMultiSelect);

            const kricSlider = document.getElementById('kricSlider');
            if (!kricSlider) return;

            // Ensure we're at KRIC-3
            if (kricSlider.value !== '3') {
                // Update KRIC slider to 3
                kricSlider.value = 3;
                window.kricThreshold = 'kric-3';

                // Update slider display
                const display = document.getElementById('kricSliderValue');
                if (display) {
                    display.textContent = '3';
                    const percentage = (3 / 136) * 100;
                    const sliderRect = kricSlider.getBoundingClientRect();
                    const sliderWidth = sliderRect.width;
                    const handleWidth = 20;
                    const leftPosition = (percentage / 100) * (sliderWidth - handleWidth) + (handleWidth / 2) - 0;
                    display.style.left = `${Math.max(0, Math.min(leftPosition, sliderWidth - 30))}px`;
                }

                // Update pattern options for KRIC-3
                updateKricPatternOptions();
            }

            // Find and select the pattern in the dropdown
            const kricPatternSelect = document.getElementById('specificKricPattern');
            if (kricPatternSelect) {
                // Look for the pattern in the dropdown options
                const patternString = pattern.map(d => durationToNoteName(d)).join(' ‚Üí ');
                const options = Array.from(kricPatternSelect.options);

                console.log(`üîç Looking for KRIC-3 pattern: "${patternString}" in ${options.length} options`);
                console.log(`üîç Raw pattern values:`, pattern);
                console.log(`üîç Available options:`, options.slice(0, 10).map(o => o.text));

                // Try exact match first, then partial match
                let matchingOption = options.find(option => {
                    return option.text.includes(patternString);
                });

                // If no exact match, try finding by the pattern structure
                if (!matchingOption) {
                    console.log('üîç Trying pattern matching by structure...');
                    matchingOption = options.find(option => {
                        // Extract pattern from option text (before the count)
                        const optionPattern = option.text.split(' (')[0];
                        return optionPattern === patternString;
                    });
                }

                if (matchingOption) {
                    console.log(`‚úÖ Found match: "${matchingOption.text}"`);

                    // Select the pattern
                    if (isMultiSelect) {
                        // For multi-select, hold the current selection and add this one
                        const currentSelections = Array.from(kricPatternSelect.selectedOptions);
                        matchingOption.selected = true;
                        console.log(`üéØ Added KRIC-3 pattern to selection: ${patternString}`);
                    } else {
                        // Single select - clear others and select this one
                        kricPatternSelect.value = matchingOption.value;
                        console.log(`üéØ Selected KRIC-3 pattern: ${patternString}`);
                    }

                    // Scroll the selected option into view
                    matchingOption.scrollIntoView({ behavior: 'smooth', block: 'center' });

                    // Small delay to ensure selection is properly registered before triggering change
                    setTimeout(() => {
                        const changeEvent = new Event('change', { bubbles: true });
                        kricPatternSelect.dispatchEvent(changeEvent);
                        console.log(`üîß Dispatched change event for KRIC-3 selection: ${patternString}`);
                    }, 100);
                } else {
                    console.log(`‚ö†Ô∏è KRIC-3 pattern not found in dropdown: ${patternString}`);
                }
            }
        }

        function updateKric3Zoom() {
            // Simple zoom - just scale the entire SVG container
            const xZoom = document.getElementById('kric3-x-zoom')?.value || 1;
            const yZoom = document.getElementById('kric3-y-zoom')?.value || 0.67;
            const container = document.getElementById('kric3-sankey');

            if (container) {
                // Find or create a wrapper div for the SVG
                let wrapper = container.querySelector('.kric3-zoom-wrapper');
                if (!wrapper) {
                    const svg = container.querySelector('svg');
                    if (svg) {
                        wrapper = document.createElement('div');
                        wrapper.className = 'kric3-zoom-wrapper';
                        svg.parentNode.insertBefore(wrapper, svg);
                        wrapper.appendChild(svg);
                    }
                }

                if (wrapper) {
                    // Apply zoom to the wrapper
                    wrapper.style.transform = `scale(${xZoom}, ${yZoom})`;
                    wrapper.style.transformOrigin = 'top left';
                }
            }
        }

        function regenerateKric3WithMode() {
            const mode = document.querySelector('input[name="kric3Mode"]:checked')?.value || 'all';
            generateKric3SankeyDiagram(mode);
        }

        // Generate KRIC-3 Sankey HTML with proper 3-column format
        function generateKric3FormattedSankeyHTML(patterns, mode = 'all') {
            if (!patterns || patterns.length === 0) {
                return '<div style="text-align: center; padding: 40px; color: #999;">No KRIC-3 patterns found</div>';
            }

            // Collect unique rhythm values for each column position
            const col1Nodes = new Set();
            const col2Nodes = new Set();
            const col3Nodes = new Set();
            const patternData = [];

            patterns.forEach(pattern => {
                if (pattern.pattern.length === 3) {
                    const [first, second, third] = pattern.pattern;
                    // Strip grace prefix for node grouping (same format as KRIC-2)
                    const cleanFirst = first.startsWith('g') ? first.substring(1) : first;
                    const cleanSecond = second.startsWith('g') ? second.substring(1) : second;
                    const cleanThird = third.startsWith('g') ? third.substring(1) : third;

                    col1Nodes.add(cleanFirst);
                    col2Nodes.add(cleanSecond);
                    col3Nodes.add(cleanThird);
                    patternData.push({
                        pattern: [cleanFirst, cleanSecond, cleanThird], // Use clean durations
                        originalPattern: pattern.pattern, // Keep original for grace detection
                        count: pattern.count,
                        positions: pattern.positions
                    });
                }
            });

            // Convert to sorted arrays - longest duration on top
            const sortByDuration = (a, b) => {
                const valueA = parseFloat(a) || 0;
                const valueB = parseFloat(b) || 0;
                return valueB - valueA; // Descending order (largest first)
            };

            const col1Array = Array.from(col1Nodes).sort(sortByDuration);
            const col2Array = Array.from(col2Nodes).sort(sortByDuration);
            const col3Array = Array.from(col3Nodes).sort(sortByDuration);

            // Function to get duration height (same as KRIC-2)
            const getDurationHeight = (duration) => {
                const baseHeight = 20;
                const multiplier = parseFloat(duration) || 1;
                return Math.max(baseHeight, multiplier * 20);
            };

            // Use dynamic Y positioning like KRIC-2
            const eighthNoteSpacing = 80; // Same spacing as KRIC-2
            const startY = 110; // Anchor at top, same as KPIC charts

            // Calculate Y positions for each column dynamically (like KRIC-2)
            const calculateNodePositions = (nodeArray) => {
                const positions = {};
                let currentY = startY;

                nodeArray.forEach(node => {
                    const nodeHeight = getDurationHeight(node);
                    const centerY = currentY + nodeHeight / 2;
                    positions[node] = centerY;
                    currentY += nodeHeight + eighthNoteSpacing;
                });

                return positions;
            };

            // Calculate positions for all three columns
            const col1Positions = calculateNodePositions(col1Array);
            const col2Positions = calculateNodePositions(col2Array);
            const col3Positions = calculateNodePositions(col3Array);

            // Calculate SVG height based on actual content
            const calculateMaxY = (positions) => {
                let maxY = startY;
                Object.keys(positions).forEach(node => {
                    const nodeHeight = getDurationHeight(node);
                    const bottomY = positions[node] + nodeHeight / 2 + 50; // Add padding
                    maxY = Math.max(maxY, bottomY);
                });
                return maxY;
            };

            // Use fixed height for consistency across all Sankey diagrams
            const maxHeight = 900; // Fixed height for all Sankey diagrams

            const svgWidth = 640;  // Wider to accommodate better spacing
            const columnWidth = 80;  // Match KRIC-2 node width
            const col1X = 40;
            const col2X = 280;  // More spacing between columns
            const col3X = 520;

            // Start building SVG
            let svg = `<svg width="${svgWidth}" height="${maxHeight}" id="kric3-sankey-svg">`;

            // Add column labels at top
            svg += `<text x="${col1X + columnWidth/2}" y="30" text-anchor="middle" style="font-size: 11px; font-weight: bold; fill: #666;">FROM</text>`;
            svg += `<text x="${col2X + columnWidth/2}" y="30" text-anchor="middle" style="font-size: 11px; font-weight: bold; fill: #666;">MIDDLE</text>`;
            svg += `<text x="${col3X + columnWidth/2}" y="30" text-anchor="middle" style="font-size: 11px; font-weight: bold; fill: #666;">TO</text>`;

            // Draw duration nodes in column 1 (FROM) with dynamic positions
            col1Array.forEach(duration => {
                const y = col1Positions[duration];
                const nodeHeight = getDurationHeight(duration);
                const label = durationToNoteName(duration);
                const nodeY = y - nodeHeight/2;

                svg += `<rect x="${col1X}" y="${nodeY}" width="${columnWidth}" height="${nodeHeight}"
                        fill="#e74c3c" opacity="0.8" rx="3" class="sankey-node"/>`;
                svg += `<text x="${col1X + columnWidth/2}" y="${y + 4}" text-anchor="middle"
                        style="font-size: 11px; fill: white; font-weight: bold;">${label}</text>`;
            });

            // Draw duration nodes in column 2 (MIDDLE) with dynamic positions
            col2Array.forEach(duration => {
                const y = col2Positions[duration];
                const nodeHeight = getDurationHeight(duration);
                const label = durationToNoteName(duration);
                const nodeY = y - nodeHeight/2;

                svg += `<rect x="${col2X}" y="${nodeY}" width="${columnWidth}" height="${nodeHeight}"
                        fill="#9b59b6" opacity="0.8" rx="3" class="sankey-node"/>`;
                svg += `<text x="${col2X + columnWidth/2}" y="${y + 4}" text-anchor="middle"
                        style="font-size: 11px; fill: white; font-weight: bold;">${label}</text>`;
            });

            // Draw duration nodes in column 3 (TO) with dynamic positions
            col3Array.forEach(duration => {
                const y = col3Positions[duration];
                const nodeHeight = getDurationHeight(duration);
                const label = durationToNoteName(duration);
                const nodeY = y - nodeHeight/2;

                svg += `<rect x="${col3X}" y="${nodeY}" width="${columnWidth}" height="${nodeHeight}"
                        fill="#c0392b" opacity="0.8" rx="3" class="sankey-node"/>`;
                svg += `<text x="${col3X + columnWidth/2}" y="${y + 4}" text-anchor="middle"
                        style="font-size: 11px; fill: white; font-weight: bold;">${label}</text>`;
            });

            // Draw transition bands
            let bandIndex = 0;
            patternData.forEach(data => {
                const [first, second, third] = data.pattern;
                // Use dynamic positions from the calculated column positions
                const y1 = col1Positions[first];
                const y2 = col2Positions[second];
                const y3 = col3Positions[third];

                if (y1 && y2 && y3) {
                    const thickness = Math.min(25, Math.max(2, data.count * 1.5));
                    const opacity = Math.min(0.6, 0.15 + data.count * 0.03);

                    // Check if pattern involves grace notes
                    const hasGrace = data.pattern.some(d => d.toString().startsWith('g'));
                    const color = hasGrace ? 'rgba(255, 140, 0, 0.4)' : `hsl(${(bandIndex * 60) % 360}, 60%, 50%)`;
                    const strokeDasharray = hasGrace ? 'stroke-dasharray="8,4"' : '';

                    // Store transition data for tooltips
                    if (!window.kric3TransitionData) {
                        window.kric3TransitionData = new Map();
                    }

                    // Calculate percentage and rank (same as KPIC-3)
                    const totalPatterns = patternData.reduce((sum, p) => sum + p.count, 0);
                    const percentage = ((data.count / totalPatterns) * 100).toFixed(1);
                    const sortedPatterns = [...patternData].sort((a, b) => b.count - a.count);
                    const rank = sortedPatterns.findIndex(p => JSON.stringify(p.pattern) === JSON.stringify(data.pattern)) + 1;

                    const transitionId = `kric3-${first}-${second}-${third}-${bandIndex}`;
                    window.kric3TransitionData.set(transitionId, {
                        pattern: data.pattern,
                        fullPattern: `${first} ‚Üí ${second} ‚Üí ${third}`,
                        segment1: `${first} ‚Üí ${second}`,
                        segment2: `${second} ‚Üí ${third}`,
                        count: data.count,
                        totalPatterns: totalPatterns,
                        percentage: percentage,
                        rank: rank,
                        positions: data.positions,
                        hasGrace: hasGrace,
                        type: 'rhythm',
                        bandIndex: bandIndex
                    });

                    // Path from column 1 to column 2 (exact KRIC-2 style)
                    const sourceX1 = col1X + columnWidth; // Right edge of FROM box
                    const targetX1 = col2X; // Left edge of MIDDLE box
                    const midX1 = (sourceX1 + targetX1) / 2; // Perfect midpoint
                    const path1 = `M ${sourceX1} ${y1}
                                   C ${midX1} ${y1}, ${midX1} ${y2}, ${targetX1} ${y2}`;

                    // Path from column 2 to column 3 (exact KRIC-2 style)
                    const sourceX2 = col2X + columnWidth; // Right edge of MIDDLE box
                    const targetX2 = col3X; // Left edge of TO box
                    const midX2 = (sourceX2 + targetX2) / 2; // Perfect midpoint
                    const path2 = `M ${sourceX2} ${y2}
                                   C ${midX2} ${y2}, ${midX2} ${y3}, ${targetX2} ${y3}`;

                    // Draw both segments
                    svg += `<g class="kric3-pattern-group" data-pattern='${JSON.stringify(data.pattern)}'>`;

                    svg += `<path d="${path1}" fill="none" stroke="${color}"
                            stroke-width="${thickness}" opacity="${opacity}" ${strokeDasharray}
                            class="clickable-band kric3-band segment-1 kric3-pattern-group-${bandIndex}"
                            data-pattern='${JSON.stringify(data.pattern)}'
                            data-positions='${JSON.stringify(data.positions)}'
                            data-segment="1"
                            data-count="${data.count}"
                            data-band-id="kric3-${bandIndex}-1"
                            data-pattern-group="${bandIndex}"
                            style="cursor: pointer;"
                            onmouseover="event.stopPropagation(); highlightKric3PatternGroup(${bandIndex}, '${color}', '${color}', event, 1)"
                            onmouseout="unhighlightKric3PatternGroup(${bandIndex}, '${opacity}'); hideSankeyTooltip()"
                            onmousemove="event.stopPropagation(); highlightKric3PatternGroup(${bandIndex}, '${color}', '${color}', event, 1);"
                            onclick="selectKric3PatternFromElement(this, event)">
                            <title>${first} ‚Üí ${second}: √ó${data.count}</title>
                        </path>`;

                    svg += `<path d="${path2}" fill="none" stroke="${color}"
                            stroke-width="${thickness}" opacity="${opacity}" ${strokeDasharray}
                            class="clickable-band kric3-band segment-2 kric3-pattern-group-${bandIndex}"
                            data-pattern='${JSON.stringify(data.pattern)}'
                            data-positions='${JSON.stringify(data.positions)}'
                            data-segment="2"
                            data-count="${data.count}"
                            data-band-id="kric3-${bandIndex}-2"
                            data-pattern-group="${bandIndex}"
                            style="cursor: pointer;"
                            onmouseover="event.stopPropagation(); highlightKric3PatternGroup(${bandIndex}, '${color}', '${color}', event, 2)"
                            onmouseout="unhighlightKric3PatternGroup(${bandIndex}, '${opacity}'); hideSankeyTooltip()"
                            onmousemove="event.stopPropagation(); highlightKric3PatternGroup(${bandIndex}, '${color}', '${color}', event, 2);"
                            onclick="selectKric3PatternFromElement(this, event)">
                            <title>${second} ‚Üí ${third}: √ó${data.count}</title>
                        </path>`;

                    svg += '</g>';
                }
                bandIndex++;
            });

            svg += '</svg>';
            return svg;
        }

        // Generate KRIC-3 Sankey diagram HTML with 3 columns
        function generateKric3SankeyHTML(patterns) {
            if (!patterns || patterns.length === 0) {
                return '<div style="text-align: center; padding: 40px; color: #999;">No KRIC-3 patterns found</div>';
            }

            return generateThreeColumnSankey(patterns, 'rhythm');
        }

        // Generate a proper 3-note Sankey diagram with 3 columns
        function generateThreeColumnSankey(patterns, type) {
            if (!patterns || patterns.length === 0) {
                return '<div style="text-align: center; padding: 40px; color: #999;">No patterns found</div>';
            }

            // Process 3-note patterns to create proper 3-column structure
            const transitions = {};
            const nodeSet = new Set();

            patterns.forEach(pattern => {
                if (pattern.pattern.length === 3) {
                    const [from, middle, to] = pattern.pattern;

                    // Create transitions for 3-column layout
                    const key1 = `${from}|||${middle}|||1-2`; // From column 1 to column 2
                    const key2 = `${middle}|||${to}|||2-3`; // From column 2 to column 3

                    if (!transitions[key1]) transitions[key1] = 0;
                    if (!transitions[key2]) transitions[key2] = 0;

                    transitions[key1] += pattern.count;
                    transitions[key2] += pattern.count;

                    nodeSet.add(from);
                    nodeSet.add(middle);
                    nodeSet.add(to);
                }
            });

            // Generate the 3-column Sankey diagram
            const svgWidth = 580;  // Reduced to fit in 50% container
            const svgHeight = 900; // Fixed height for all Sankey diagrams
            const columnWidth = 60;
            const columnSpacing = 200;  // Reduced spacing

            // Column positions
            const col1X = 50;
            const col2X = col1X + columnSpacing;
            const col3X = col2X + columnSpacing;

            const timestamp = Date.now();
            let svg = `<svg width="${svgWidth}" height="${svgHeight}" id="${type}-3col-sankey-${timestamp}">`;

            if (type === 'pitch') {
                // Get all note circles to find which notes are grace notes
                const noteCircles = document.querySelectorAll('.note-circle');
                const graceNoteIndices = new Set();
                noteCircles.forEach(circle => {
                    if (circle.getAttribute('data-is-grace') === 'true') {
                        graceNoteIndices.add(parseInt(circle.getAttribute('data-note-index')));
                    }
                });

                // Get string positions - anchor at top without offset
                const stringPositions = {
                    'D4': 110,  // String 5
                    'G4': 260,  // String 7
                    'A4': 320,  // String 8
                    'C5': 410,  // String 9
                    'D5': 470,  // String 10
                    'E5': 530,  // String 11
                    'G5': 620   // String 12
                };

                // Draw all 7 nodes in each of the 3 columns
                // All notes should appear in all columns, just like KPIC-2
                const nodes = Array.from(nodeSet);

                // Ensure we show all 7 pitches from the string positions
                // Add all notes from stringPositions to nodeSet to ensure all are displayed
                Object.keys(stringPositions).forEach(note => nodeSet.add(note));

                // Draw all nodes in all 3 columns
                Array.from(nodeSet).forEach(note => {
                    const y = stringPositions[note];
                    if (y) {
                        // Column 1: Source notes (all notes shown)
                        svg += `<rect x="${col1X}" y="${y - 30}" width="${columnWidth}" height="60"
                                fill="#3498db" opacity="0.8" rx="3"
                                class="sankey-node-3col" data-node="${note}" data-column="1"/>`;
                        svg += `<text x="${col1X + columnWidth/2}" y="${y + 5}" text-anchor="middle"
                                style="font-size: 11px; fill: white; font-weight: bold;">${note}</text>`;

                        // Column 2: Middle notes (all notes shown)
                        svg += `<rect x="${col2X}" y="${y - 30}" width="${columnWidth}" height="60"
                                fill="#e74c3c" opacity="0.8" rx="3"
                                class="sankey-node-3col" data-node="${note}" data-column="2"/>`;
                        svg += `<text x="${col2X + columnWidth/2}" y="${y + 5}" text-anchor="middle"
                                style="font-size: 11px; fill: white; font-weight: bold;">${note}</text>`;

                        // Column 3: Target notes (all notes shown)
                        svg += `<rect x="${col3X}" y="${y - 30}" width="${columnWidth}" height="60"
                                fill="#27ae60" opacity="0.8" rx="3"
                                class="sankey-node-3col" data-node="${note}" data-column="3"/>`;
                        svg += `<text x="${col3X + columnWidth/2}" y="${y + 5}" text-anchor="middle"
                                style="font-size: 11px; fill: white; font-weight: bold;">${note}</text>`;
                    }
                });

                // Draw connecting bands for each 3-note pattern
                patterns.forEach((pattern, index) => {
                    const [from, middle, to] = pattern.pattern;

                    // Get y positions directly
                    const fromY = stringPositions[from];
                    const middleY = stringPositions[middle];
                    const toY = stringPositions[to];

                    if (fromY && middleY && toY) {
                        // Check if any position in this pattern involves a grace note
                        const hasGraceNote = pattern.positions.some(startPos => {
                            return graceNoteIndices.has(startPos) ||
                                   graceNoteIndices.has(startPos + 1) ||
                                   graceNoteIndices.has(startPos + 2);
                        });

                        const bandHeight = Math.min(40, Math.max(3, pattern.count * 2));
                        const opacity = Math.min(0.7, 0.2 + pattern.count * 0.05);
                        const color = `hsl(${(index * 360 / patterns.length) % 360}, 70%, 50%)`;

                        // Enhanced styling for grace note patterns (matching KPIC-2)
                        const strokeColor = hasGraceNote ? 'rgba(255, 140, 0, 0.5)' : color;
                        const strokeDasharray = hasGraceNote ? 'stroke-dasharray="12 3 9 4 6 5 3 6 1 7"' : '';
                        const strokeWidth = hasGraceNote ? '2' : '1';
                        const transitionId = `kpic3-${from}-${middle}-${index}`;

                        // Store transition data for tooltips
                        if (!window.kpic3TransitionData) {
                            window.kpic3TransitionData = new Map();
                        }

                        // Calculate percentage and rank
                        const totalPatterns = patterns.reduce((sum, p) => sum + p.count, 0);
                        const percentage = ((pattern.count / totalPatterns) * 100).toFixed(1);
                        const sortedPatterns = [...patterns].sort((a, b) => b.count - a.count);
                        const rank = sortedPatterns.findIndex(p => JSON.stringify(p.pattern) === JSON.stringify(pattern.pattern)) + 1;

                        window.kpic3TransitionData.set(transitionId, {
                            pattern: pattern.pattern,
                            fullPattern: `${from} ‚Üí ${middle} ‚Üí ${to}`,
                            segment1: `${from} ‚Üí ${middle}`,
                            segment2: `${middle} ‚Üí ${to}`,
                            count: pattern.count,
                            totalPatterns: totalPatterns,
                            percentage: percentage,
                            rank: rank,
                            positions: pattern.positions,
                            hasGraceNote: hasGraceNote,
                            type: type
                        });

                        // Draw path from column 1 to column 2
                        const path1 = `M ${col1X + columnWidth} ${fromY}
                                      C ${col1X + columnWidth + 50} ${fromY},
                                        ${col2X - 50} ${middleY},
                                        ${col2X} ${middleY}
                                      L ${col2X} ${middleY + bandHeight}
                                      C ${col2X - 50} ${middleY + bandHeight},
                                        ${col1X + columnWidth + 50} ${fromY + bandHeight},
                                        ${col1X + columnWidth} ${fromY + bandHeight}
                                      Z`;

                        svg += `<path d="${path1}" fill="${strokeColor}" opacity="${opacity}"
                                ${hasGraceNote ? 'stroke="' + strokeColor + '" stroke-width="' + strokeWidth + '" ' + strokeDasharray : ''}
                                class="sankey-band-3col clickable-band-3col pattern-group-${index}"
                                data-pattern="${pattern.pattern.join('-')}"
                                data-pattern-array='${JSON.stringify(pattern.pattern)}'
                                data-positions="${pattern.positions.join(',')}"
                                data-positions-array='${JSON.stringify(pattern.positions)}'
                                data-has-grace="${hasGraceNote}"
                                data-type="${type}"
                                data-count="${pattern.count}"
                                data-transition-id="${transitionId}"
                                data-pattern-group="${index}"
                                style="cursor: pointer;"
                                onmouseover="event.stopPropagation(); highlightKpic3PatternGroup(${index}, '${hasGraceNote ? 'rgba(255, 140, 0, 0.8)' : color}', '${hasGraceNote ? 'rgba(255, 140, 0, 0.6)' : color}', event, 1);"
                                onmouseout="unhighlightKpic3PatternGroup(${index}, '${opacity}');"
                                onmousemove="event.stopPropagation(); highlightKpic3PatternGroup(${index}, '${hasGraceNote ? 'rgba(255, 140, 0, 0.8)' : color}', '${hasGraceNote ? 'rgba(255, 140, 0, 0.6)' : color}', event, 1);">
                                <title>${from} ‚Üí ${middle}: √ó${pattern.count}${hasGraceNote ? ' (includes grace notes)' : ''}</title>
                                </path>`;

                        // Draw path from column 2 to column 3
                        const path2 = `M ${col2X + columnWidth} ${middleY}
                                      C ${col2X + columnWidth + 50} ${middleY},
                                        ${col3X - 50} ${toY},
                                        ${col3X} ${toY}
                                      L ${col3X} ${toY + bandHeight}
                                      C ${col3X - 50} ${toY + bandHeight},
                                        ${col2X + columnWidth + 50} ${middleY + bandHeight},
                                        ${col2X + columnWidth} ${middleY + bandHeight}
                                      Z`;

                        svg += `<path d="${path2}" fill="${strokeColor}" opacity="${opacity}"
                                ${hasGraceNote ? 'stroke="' + strokeColor + '" stroke-width="' + strokeWidth + '" ' + strokeDasharray : ''}
                                class="sankey-band-3col clickable-band-3col pattern-group-${index}"
                                data-pattern="${pattern.pattern.join('-')}"
                                data-pattern-array='${JSON.stringify(pattern.pattern)}'
                                data-positions="${pattern.positions.join(',')}"
                                data-positions-array='${JSON.stringify(pattern.positions)}'
                                data-has-grace="${hasGraceNote}"
                                data-type="${type}"
                                data-count="${pattern.count}"
                                data-transition-id="${transitionId}-2"
                                data-pattern-group="${index}"
                                style="cursor: pointer;"
                                onmouseover="event.stopPropagation(); highlightKpic3PatternGroup(${index}, '${hasGraceNote ? 'rgba(255, 140, 0, 0.8)' : color}', '${hasGraceNote ? 'rgba(255, 140, 0, 0.6)' : color}', event, 2);"
                                onmouseout="unhighlightKpic3PatternGroup(${index}, '${opacity}');"
                                onmousemove="event.stopPropagation(); highlightKpic3PatternGroup(${index}, '${hasGraceNote ? 'rgba(255, 140, 0, 0.8)' : color}', '${hasGraceNote ? 'rgba(255, 140, 0, 0.6)' : color}', event, 2);">
                                <title>${middle} ‚Üí ${to}: √ó${pattern.count}${hasGraceNote ? ' (includes grace notes)' : ''}</title>
                                </path>`;
                    }
                });

            } else {
                // Rhythm type - simpler layout
                const durationPositions = {
                    '0.5': 50,
                    '1': 120,
                    '2': 190,
                    '3': 260,
                    '4': 330,
                    '8': 400
                };

                // Ensure we show all possible durations (including grace variants)
                // Add all possible durations to nodeSet
                const allDurations = ['0.5', '1', '2', '3', '4', '8', 'g0.5', 'g1', 'g2', 'g3', 'g4', 'g8'];
                allDurations.forEach(dur => {
                    if (durationPositions[dur] || durationPositions[dur.replace('g', '')]) {
                        nodeSet.add(dur);
                    }
                });

                // Draw all rhythm nodes in all 3 columns
                const nodes = Array.from(nodeSet);

                // Draw all nodes in all 3 columns (all durations shown in each column)
                nodes.forEach(duration => {
                    // Handle grace note durations
                    const baseDuration = duration.startsWith('g') ? duration.substring(1) : duration;
                    const isGrace = duration.startsWith('g');
                    const y = durationPositions[baseDuration] || durationPositions[duration] || 200;

                    // Add dashed border style for grace notes
                    const strokeStyle = isGrace ? 'stroke="white" stroke-width="2" stroke-dasharray="5,5"' : '';

                    // Column 1: All durations shown
                    svg += `<rect x="${col1X}" y="${y - 30}" width="${columnWidth}" height="60"
                            fill="#9b59b6" opacity="0.8" rx="3" ${strokeStyle}/>`;
                    svg += `<text x="${col1X + columnWidth/2}" y="${y + 5}" text-anchor="middle"
                            style="font-size: 11px; fill: white; font-weight: bold;">${duration}</text>`;

                    // Column 2: All durations shown
                    svg += `<rect x="${col2X}" y="${y - 30}" width="${columnWidth}" height="60"
                            fill="#f39c12" opacity="0.8" rx="3" ${strokeStyle}/>`;
                    svg += `<text x="${col2X + columnWidth/2}" y="${y + 5}" text-anchor="middle"
                            style="font-size: 11px; fill: white; font-weight: bold;">${duration}</text>`;

                    // Column 3: All durations shown
                    svg += `<rect x="${col3X}" y="${y - 30}" width="${columnWidth}" height="60"
                            fill="#16a085" opacity="0.8" rx="3" ${strokeStyle}/>`;
                    svg += `<text x="${col3X + columnWidth/2}" y="${y + 5}" text-anchor="middle"
                            style="font-size: 11px; fill: white; font-weight: bold;">${duration}</text>`;
                });

                // Draw connecting bands for rhythm patterns
                patterns.forEach((pattern, index) => {
                    const [from, middle, to] = pattern.pattern;

                    // Handle grace note durations for Y positions
                    const fromBase = from.startsWith('g') ? from.substring(1) : from;
                    const middleBase = middle.startsWith('g') ? middle.substring(1) : middle;
                    const toBase = to.startsWith('g') ? to.substring(1) : to;

                    const fromY = durationPositions[fromBase] || durationPositions[from] || 200;
                    const middleY = durationPositions[middleBase] || durationPositions[middle] || 200;
                    const toY = durationPositions[toBase] || durationPositions[to] || 200;

                    // Check if pattern contains grace notes
                    const hasGraceNote = from.startsWith('g') || middle.startsWith('g') || to.startsWith('g');

                    const bandHeight = Math.min(30, Math.max(3, pattern.count * 1.5));
                    const opacity = Math.min(0.7, 0.2 + pattern.count * 0.03);
                    const color = `hsl(${(index * 360 / patterns.length) % 360}, 60%, 55%)`;

                    // Enhanced styling for grace note patterns (matching KPIC-2)
                    const strokeColor = hasGraceNote ? 'rgba(255, 140, 0, 0.5)' : color;
                    const strokeDasharray = hasGraceNote ? 'stroke-dasharray="12 3 9 4 6 5 3 6 1 7"' : '';
                    const strokeWidth = hasGraceNote ? '2' : '1';
                    const transitionId = `kric3-${from}-${middle}-${index}`;

                    // Bands from column 1 to 2 and 2 to 3
                    const path1 = `M ${col1X + columnWidth} ${fromY}
                                  C ${col1X + columnWidth + 50} ${fromY},
                                    ${col2X - 50} ${middleY},
                                    ${col2X} ${middleY}
                                  L ${col2X} ${middleY + bandHeight}
                                  C ${col2X - 50} ${middleY + bandHeight},
                                    ${col1X + columnWidth + 50} ${fromY + bandHeight},
                                    ${col1X + columnWidth} ${fromY + bandHeight}
                                  Z`;

                    const path2 = `M ${col2X + columnWidth} ${middleY}
                                  C ${col2X + columnWidth + 50} ${middleY},
                                    ${col3X - 50} ${toY},
                                    ${col3X} ${toY}
                                  L ${col3X} ${toY + bandHeight}
                                  C ${col3X - 50} ${toY + bandHeight},
                                    ${col2X + columnWidth + 50} ${middleY + bandHeight},
                                    ${col2X + columnWidth} ${middleY + bandHeight}
                                  Z`;

                    svg += `<path d="${path1}" fill="${strokeColor}" opacity="${opacity}"
                            ${hasGraceNote ? 'stroke="' + strokeColor + '" stroke-width="' + strokeWidth + '" ' + strokeDasharray : ''}
                            class="sankey-band-3col clickable-band-3col pattern-group-${index}"
                            data-pattern="${pattern.pattern.join('-')}"
                            data-pattern-array='${JSON.stringify(pattern.pattern)}'
                            data-positions="${pattern.positions.join(',')}"
                            data-positions-array='${JSON.stringify(pattern.positions)}'
                            data-has-grace="${hasGraceNote}"
                            data-type="${type}"
                            data-count="${pattern.count}"
                            data-transition-id="${transitionId}"
                            data-pattern-group="${index}"
                            style="cursor: pointer;"
                            onmouseover="event.stopPropagation(); highlightKpic3PatternGroup(${index}, '${hasGraceNote ? 'rgba(255, 140, 0, 0.8)' : color}', '${hasGraceNote ? 'rgba(255, 140, 0, 0.6)' : color}', event, 1);"
                            onmouseout="unhighlightKpic3PatternGroup(${index}, '${opacity}');"
                            onmousemove="event.stopPropagation(); highlightKpic3PatternGroup(${index}, '${hasGraceNote ? 'rgba(255, 140, 0, 0.8)' : color}', '${hasGraceNote ? 'rgba(255, 140, 0, 0.6)' : color}', event, 1);">
                            <title>${from} ‚Üí ${middle}: √ó${pattern.count}${hasGraceNote ? ' (includes grace notes)' : ''}</title>
                            </path>`;

                    svg += `<path d="${path2}" fill="${strokeColor}" opacity="${opacity}"
                            ${hasGraceNote ? 'stroke="' + strokeColor + '" stroke-width="' + strokeWidth + '" ' + strokeDasharray : ''}
                            class="sankey-band-3col clickable-band-3col pattern-group-${index}"
                            data-pattern="${pattern.pattern.join('-')}"
                            data-pattern-array='${JSON.stringify(pattern.pattern)}'
                            data-positions="${pattern.positions.join(',')}"
                            data-positions-array='${JSON.stringify(pattern.positions)}'
                            data-has-grace="${hasGraceNote}"
                            data-type="${type}"
                            data-count="${pattern.count}"
                            data-transition-id="${transitionId}-2"
                            data-pattern-group="${index}"
                            style="cursor: pointer;"
                            onmouseover="event.stopPropagation(); highlightKpic3PatternGroup(${index}, '${hasGraceNote ? 'rgba(255, 140, 0, 0.8)' : color}', '${hasGraceNote ? 'rgba(255, 140, 0, 0.6)' : color}', event, 2);"
                            onmouseout="unhighlightKpic3PatternGroup(${index}, '${opacity}');"
                            onmousemove="event.stopPropagation(); highlightKpic3PatternGroup(${index}, '${hasGraceNote ? 'rgba(255, 140, 0, 0.8)' : color}', '${hasGraceNote ? 'rgba(255, 140, 0, 0.6)' : color}', event, 2);">
                            <title>${middle} ‚Üí ${to}: √ó${pattern.count}${hasGraceNote ? ' (includes grace notes)' : ''}</title>
                            </path>`;
                });
            }

            svg += '</svg>';


            return svg;
        }

        // Highlight 3-note patterns in tablature
        function highlightThreeNotePattern(type, pattern, positions, skipSankeyClearing = false) {
            console.log(`Highlighting ${type} 3-note pattern:`, pattern, 'at positions:', positions, 'skipSankeyClearing:', skipSankeyClearing);

            // Clear previous highlighting from tablature
            document.querySelectorAll('.note-circle').forEach(circle => {
                circle.style.stroke = '';
                circle.style.strokeWidth = '';
                circle.style.filter = '';
                circle.style.opacity = '0.3';
            });

            // Only clear Sankey highlighting if not explicitly skipped (to avoid circular clearing)
            if (!skipSankeyClearing) {
                document.querySelectorAll('.sankey-band-3col, .clickable-band-3col').forEach(band => {
                    band.style.stroke = '';
                    band.style.strokeWidth = '';
                    band.style.filter = '';
                    band.classList.remove('selected-band-3col');
                });
            }

            // Highlight the pattern occurrences in tablature
            positions.forEach((startPos, occurrenceIndex) => {
                const color = `hsl(${(occurrenceIndex * 360 / positions.length) % 360}, 70%, ${type === 'pitch' ? '60' : '50'}%)`;

                for (let i = 0; i < 3; i++) { // 3 notes in the pattern
                    const noteIndex = startPos + i;
                    const noteCircle = document.querySelector(`.note-circle[data-note-index="${noteIndex}"]`);
                    if (noteCircle) {
                        noteCircle.style.stroke = color;
                        noteCircle.style.strokeWidth = '3px';
                        noteCircle.style.filter = `drop-shadow(0 0 6px ${color})`;
                        noteCircle.style.opacity = '1';
                    }
                }
            });

            // Highlight the corresponding Sankey bands (both old and new classes)
            const patternKey = pattern.join('-');
            document.querySelectorAll('.sankey-band-3col, .clickable-band-3col').forEach(band => {
                const bandPattern = band.getAttribute('data-pattern');
                if (bandPattern === patternKey) {
                    band.style.stroke = '#ff6b6b';
                    band.style.strokeWidth = '3px';
                    band.style.filter = 'drop-shadow(0 0 8px #ff6b6b)';
                    band.classList.add('selected-band-3col');
                }
            });

            // Link to KPIC-3 dropdown if it's a pitch pattern
            if (type === 'pitch') {
                triggerKPIC3Pattern(pattern, false);
            }

            // Link to KRIC-3 dropdown if it's a rhythm pattern
            if (type === 'rhythm') {
                triggerKRIC3Pattern(pattern, false);
            }
        }

        // Trigger KPIC-3 pattern selection in dropdown
        function triggerKPIC3Pattern(pattern, isMultiSelect = false) {
            console.log('triggerKPIC3Pattern called with:', pattern, 'multiSelect:', isMultiSelect);

            const kpicSlider = document.getElementById('kpicSlider');
            if (!kpicSlider) return;

            // Ensure we're at KPIC-3
            if (kpicSlider.value !== '3') {
                // Update KPIC slider to 3
                kpicSlider.value = 3;
                window.kpicThreshold = 'kpic-3';

                // Update slider display
                const display = document.getElementById('kpicSliderValue');
                if (display) {
                    display.textContent = '3';
                    const percentage = (3 / 136) * 100;
                    const sliderRect = kpicSlider.getBoundingClientRect();
                    const sliderWidth = sliderRect.width;
                    const handleWidth = 20;
                    const leftPosition = (percentage / 100) * (sliderWidth - handleWidth) + (handleWidth / 2) - 0;
                    display.style.left = `${Math.max(0, Math.min(leftPosition, sliderWidth - 30))}px`;
                }

                // Update pattern options for KPIC-3 (only if not already on KPIC-3 Sankey view)
                const contentArea = document.getElementById('content-area');
                const isKpic3SankeyOpen = contentArea && contentArea.style.display !== 'none' &&
                                         contentArea.innerHTML.includes('KPIC-3 & KRIC-3 Pattern Analysis');

                if (!isKpic3SankeyOpen) {
                    updateKpicPatternOptions();
                }
            }

            // Small delay to ensure dropdown is ready
            setTimeout(() => {
                console.log('üîß Now selecting KPIC-3 pattern in dropdown');
                selectKPIC3PatternInDropdown(pattern, isMultiSelect);
            }, 50);
        }

        // Select the pattern in KPIC-3 dropdown
        function selectKPIC3PatternInDropdown(pattern, isMultiSelect) {
            const patternSelect = document.getElementById('specificKpicPattern');
            if (!patternSelect) {
                console.warn('KPIC pattern dropdown not found');
                return;
            }

            // Clear previous selections if not multi-selecting
            if (!isMultiSelect) {
                Array.from(patternSelect.options).forEach(option => option.selected = false);
            }

            // Find and select the matching pattern
            const patternStr = pattern.join(' ‚Üí ');
            console.log('Looking for pattern in dropdown:', patternStr);

            let foundMatch = false;
            Array.from(patternSelect.options).forEach(option => {
                if (option.textContent.includes(patternStr)) {
                    option.selected = true;
                    foundMatch = true;
                    console.log('‚úÖ Selected pattern in dropdown:', option.textContent);

                    // Scroll the selected option into view
                    option.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });

            if (!foundMatch) {
                console.warn('Pattern not found in dropdown:', patternStr);
            }

            // Small delay to ensure selection is properly registered before triggering change
            setTimeout(() => {
                const event = new Event('change', { bubbles: true });
                patternSelect.dispatchEvent(event);
                console.log(`üîß Dispatched change event for KPIC-3 selection`);
            }, 100);
        }

        // Highlight entire KPIC-3 pattern group (both segments)
        function highlightKpic3PatternGroup(patternIndex, glowColor1, glowColor2, event, segment) {
            const groupElements = document.querySelectorAll(`.pattern-group-${patternIndex}`);
            groupElements.forEach(element => {
                if (!element.classList.contains('selected-band-3col')) {
                    element.style.opacity = '0.8';
                    element.style.filter = `drop-shadow(0 0 8px ${glowColor1}) drop-shadow(0 0 16px ${glowColor2})`;
                }
            });

            // Show tooltip if event is provided
            if (event && window.kpic3TransitionData) {
                // Find the transition data for this pattern
                const transitionId = `kpic3-${patternIndex}`;
                let transitionInfo = null;

                // Search for the matching transition data
                for (let [key, data] of window.kpic3TransitionData.entries()) {
                    if (key.includes(`-${patternIndex}`)) {
                        transitionInfo = data;
                        break;
                    }
                }

                if (transitionInfo) {
                    showKpic3Tooltip(event, transitionInfo, segment);
                }
            }
        }

        // Remove highlight from KPIC-3 pattern group
        function unhighlightKpic3PatternGroup(patternIndex, originalOpacity) {
            const groupElements = document.querySelectorAll(`.pattern-group-${patternIndex}`);
            groupElements.forEach(element => {
                if (!element.classList.contains('selected-band-3col')) {
                    element.style.opacity = originalOpacity;
                    element.style.filter = '';
                }
            });

            // Hide tooltip
            hideSankeyTooltip();
        }

        // Highlight entire KRIC-3 pattern group (both segments)
        function highlightKric3PatternGroup(patternIndex, glowColor1, glowColor2, event, segment) {
            const groupElements = document.querySelectorAll(`.kric3-pattern-group-${patternIndex}`);
            groupElements.forEach(element => {
                if (!element.classList.contains('selected-kric3-band')) {
                    element.style.opacity = '0.8';
                    element.style.filter = `drop-shadow(0 0 8px ${glowColor1}) drop-shadow(0 0 16px ${glowColor2})`;
                    element.style.strokeWidth = parseFloat(element.style.strokeWidth || element.getAttribute('stroke-width') || '2') + 2;
                }
            });

            // Show tooltip if event is provided
            if (event && window.kric3TransitionData) {
                // Find the transition data for this pattern
                let transitionInfo = null;

                // Search for the matching transition data by pattern index
                for (let [key, data] of window.kric3TransitionData.entries()) {
                    if (data.bandIndex === patternIndex) {
                        transitionInfo = data;
                        break;
                    }
                }

                if (transitionInfo) {
                    showKric3DetailedTooltip(event, transitionInfo, segment);
                }
            }
        }

        // Remove highlight from KRIC-3 pattern group
        function unhighlightKric3PatternGroup(patternIndex, originalOpacity) {
            const groupElements = document.querySelectorAll(`.kric3-pattern-group-${patternIndex}`);
            groupElements.forEach(element => {
                if (!element.classList.contains('selected-kric3-band')) {
                    element.style.opacity = originalOpacity;
                    element.style.filter = '';
                    element.style.strokeWidth = '';
                }
            });

            // Hide tooltip
            hideSankeyTooltip();
        }

        // Highlight KPIC-3 Sankey patterns based on dropdown selection
        function highlightKpic3SankeyPatterns(selectedPatterns) {
            // Only proceed if the KPIC-3 Sankey is currently visible
            const kpic3Container = document.getElementById('kpic3-patterns');
            if (!kpic3Container || !kpic3Container.offsetParent) {
                console.log('üéØ KPIC-3 Sankey not visible, skipping highlighting');
                return;
            }

            // Clear any existing KPIC-3 Sankey highlighting
            document.querySelectorAll('.sankey-band-3col, .clickable-band-3col').forEach(band => {
                band.classList.remove('selected-band-3col');
                band.style.stroke = '';
                band.style.strokeWidth = '';
                band.style.filter = '';
            });

            // Find and highlight matching bands in the KPIC-3 Sankey
            selectedPatterns.forEach((pattern, patternIndex) => {
                const patternKey = pattern.pattern.join('-');
                console.log('üéØ Highlighting KPIC-3 Sankey pattern:', patternKey);

                // Find all bands that match this pattern
                const matchingBands = document.querySelectorAll(`[data-pattern="${patternKey}"].clickable-band-3col`);
                console.log('üéØ Found matching KPIC-3 bands:', matchingBands.length);

                matchingBands.forEach(band => {
                    console.log('üéØ Before highlighting - band styles:', {
                        stroke: band.style.stroke,
                        strokeWidth: band.style.strokeWidth,
                        filter: band.style.filter
                    });

                    // Add visual highlighting using the same approach as KPIC-2
                    band.classList.add('selected-band-3col');

                    // Store original attributes
                    if (!band.getAttribute('data-original-stroke')) {
                        band.setAttribute('data-original-stroke', band.getAttribute('stroke') || 'none');
                    }
                    if (!band.getAttribute('data-original-width')) {
                        band.setAttribute('data-original-width', band.getAttribute('stroke-width') || '1');
                    }

                    // Apply dramatic highlighting that should definitely be visible
                    band.setAttribute('stroke', '#ff0000');
                    band.setAttribute('stroke-width', '8');
                    band.setAttribute('fill', '#ff6b6b');
                    band.setAttribute('opacity', '0.9');
                    band.style.filter = 'drop-shadow(0 0 15px #ff0000)';

                    console.log('üéØ After highlighting - band styles:', {
                        stroke: band.style.stroke,
                        strokeWidth: band.style.strokeWidth,
                        filter: band.style.filter,
                        className: band.className
                    });
                    console.log('üéØ Highlighted KPIC-3 band element:', band);
                });
            });

            // Note: Don't call highlightThreeNotePattern here to avoid circular clearing
            // The tablature highlighting is already handled by the main updateHighlighting function
        }

        // Highlight KRIC-3 Sankey patterns based on dropdown selection
        function highlightKric3SankeyPatterns(selectedPatterns) {
            // Only proceed if the KRIC-3 Sankey is currently visible
            const kric3Container = document.getElementById('kric3-patterns');
            if (!kric3Container || !kric3Container.offsetParent) {
                console.log('üéØ KRIC-3 Sankey not visible, skipping highlighting');
                return;
            }

            console.log('üéØ KRIC-3 Sankey highlighting called with', selectedPatterns.length, 'patterns');

            // Clear any existing KRIC-3 Sankey highlighting
            document.querySelectorAll('.kric3-band, .kric3-pattern-group-0, .kric3-pattern-group-1, .kric3-pattern-group-2, .kric3-pattern-group-3, .kric3-pattern-group-4, .kric3-pattern-group-5, .kric3-pattern-group-6, .kric3-pattern-group-7, .kric3-pattern-group-8, .kric3-pattern-group-9').forEach(band => {
                band.classList.remove('selected-kric3-band');
                band.style.stroke = '';
                band.style.strokeWidth = '';
                band.style.filter = '';
            });

            // Highlight bands for each selected pattern
            selectedPatterns.forEach((selectedPattern, patternIndex) => {
                console.log('üéØ Looking for KRIC-3 Sankey band matching pattern:', selectedPattern.pattern);

                // Find matching bands by comparing patterns
                document.querySelectorAll('.kric3-band').forEach(band => {
                    const bandPattern = band.getAttribute('data-pattern');
                    if (bandPattern) {
                        try {
                            const bandPatternArray = JSON.parse(bandPattern);
                            if (JSON.stringify(bandPatternArray) === JSON.stringify(selectedPattern.pattern)) {
                                // Get the pattern group for this band
                                const patternGroup = band.getAttribute('data-pattern-group');
                                if (patternGroup) {
                                    // Highlight both segments of this pattern group
                                    const groupElements = document.querySelectorAll(`.kric3-pattern-group-${patternGroup}`);
                                    console.log(`üéØ Found ${groupElements.length} elements in KRIC-3 pattern group ${patternGroup}`);

                                    groupElements.forEach(element => {
                                        console.log('üéØ Before KRIC-3 highlighting - element styles:', {
                                            stroke: element.style.stroke,
                                            strokeWidth: element.style.strokeWidth,
                                            filter: element.style.filter
                                        });

                                        element.classList.add('selected-kric3-band');

                                        // Store original attributes like KRIC-2 does
                                        if (!element.getAttribute('data-original-stroke')) {
                                            element.setAttribute('data-original-stroke', element.getAttribute('stroke') || 'none');
                                        }
                                        if (!element.getAttribute('data-original-width')) {
                                            element.setAttribute('data-original-width', element.getAttribute('stroke-width') || '1');
                                        }

                                        // Apply dramatic highlighting for KRIC-3
                                        element.setAttribute('stroke', '#FFD700');
                                        element.setAttribute('stroke-width', '8');
                                        element.setAttribute('fill', '#FFD700');
                                        element.setAttribute('opacity', '0.8');
                                        element.style.filter = 'drop-shadow(0 0 15px #FFD700)';

                                        console.log('üéØ After KRIC-3 highlighting - element styles:', {
                                            stroke: element.style.stroke,
                                            strokeWidth: element.style.strokeWidth,
                                            filter: element.style.filter,
                                            className: element.className
                                        });
                                    });
                                    console.log(`üéØ Highlighted KRIC-3 pattern group ${patternGroup} for pattern:`, selectedPattern.pattern);
                                }
                            }
                        } catch (e) {
                            console.warn('Error parsing band pattern:', e);
                        }
                    }
                });
            });
        }

        // Update KPIC-3 zoom
        function updateKpic3Zoom() {
            const xZoom = parseFloat(document.getElementById('kpic3-x-zoom')?.value || 1);
            const yZoom = parseFloat(document.getElementById('kpic3-y-zoom')?.value || 0.67);

            const kpic3Container = document.getElementById('kpic3-patterns');
            const kric3Container = document.getElementById('kric3-patterns');

            if (kpic3Container) {
                // Apply zoom like KPIC-2 - counter-scale only nodes and text, NOT bands
                const kpic3Svg = kpic3Container.querySelector('svg');
                if (kpic3Svg) {
                    // Apply zoom to the whole SVG
                    kpic3Svg.style.transform = `scale(${xZoom}, ${yZoom})`;
                    kpic3Svg.style.transformOrigin = 'top left';

                    // Keep label boxes constant size by counter-scaling them (like KPIC-2)
                    const nodes = kpic3Svg.querySelectorAll('.sankey-node-3col');
                    const texts = kpic3Svg.querySelectorAll('text');

                    nodes.forEach(node => {
                        // Get the original center position using getBBox() like KPIC-2
                        const rect = node.getBBox();
                        const centerX = rect.x + rect.width / 2;
                        const centerY = rect.y + rect.height / 2;

                        // Apply counter-scale with center positioning
                        node.style.transform = `scale(${1/xZoom}, ${1/yZoom})`;
                        node.style.transformOrigin = `${centerX}px ${centerY}px`;
                    });

                    texts.forEach(text => {
                        // Get the text position
                        const x = parseFloat(text.getAttribute('x'));
                        const y = parseFloat(text.getAttribute('y'));

                        // Apply counter-scale with text center positioning
                        text.style.transform = `scale(${1/xZoom}, ${1/yZoom})`;
                        text.style.transformOrigin = `${x}px ${y}px`;
                    });

                    // DO NOT counter-scale bands - they scale with the SVG and stay connected
                }
            }

            if (kric3Container) {
                // Simple zoom - just scale the container
                kric3Container.style.transform = `scale(${xZoom}, ${yZoom})`;
                kric3Container.style.transformOrigin = 'top left';
                // No counter-scaling - let everything scale together naturally
            }
        }

        // Regenerate KPIC-3 with different mode
        function regenerateKpic3WithMode() {
            const selectedMode = document.querySelector('input[name="kpic3Mode"]:checked')?.value || 'all';
            console.log('Regenerating KPIC-3 with mode:', selectedMode);
            generateKpic3Kric3SankeyDiagrams(selectedMode);
        }

        // Generate Sankey HTML
        function generateSankeyHTML(type, transitions, noteData, durationRanks, graceTransitions = {}, kpicMode = 'all', pitchRankingMap = null, rhythmTransitions = {}, rhythmRankingMap = null, totalTransitions = null) {
            console.log('generateSankeyHTML called for type:', type, 'mode:', kpicMode);
            const links = [];
            const nodeWidth = type === 'pitch' ? 60 : 80;
            let svg = '';

            if (type === 'pitch') {
                // For KPIC-2: Use exact tablature string order and spacing
                const stringLines = document.querySelectorAll('.string-line');
                const stringLabels = document.querySelectorAll('.string-label');

                // Get actual string positions from tablature
                const stringPositions = {};
                stringLines.forEach(line => {
                    const yPos = parseFloat(line.getAttribute('data-base-y1') || line.getAttribute('y1'));

                    // Find corresponding label
                    let closestLabel = null;
                    let minDistance = Infinity;
                    stringLabels.forEach(label => {
                        const labelY = parseFloat(label.getAttribute('data-base-y') || label.getAttribute('y'));
                        const distance = Math.abs(yPos - labelY);
                        if (distance < minDistance && distance < 20) {
                            minDistance = distance;
                            closestLabel = label;
                        }
                    });

                    if (closestLabel) {
                        const text = closestLabel.textContent;
                        const match = text.match(/String (\d+): ([A-G]#?\d)/);
                        if (match) {
                            const stringKey = `String ${match[1]}: ${match[2]}`;
                            stringPositions[stringKey] = yPos;
                        }
                    }
                });

                // Use actual tablature dimensions for proper scaling
                const minY = Math.min(...Object.values(stringPositions));
                const maxY = Math.max(...Object.values(stringPositions));
                const range = maxY - minY;

                // Match the tablature's actual scale
                // The tablature uses these string positions directly, so we should too
                const svgHeight = 900; // Fixed height for all Sankey diagrams
                const svgWidth = 600; // Standard 2-column layout

                // Process transitions
                Object.entries(transitions).forEach(([key, count]) => {
                    const parts = key.split('|||');
                    const from = parts[0];
                    const to = parts[1];
                    const transitionType = parts[2]; // Could be 'grace-grace', 'grace-main', 'main-grace', or undefined for main-main
                    links.push({ source: from, target: to, value: count, transitionType: transitionType, fullKey: key });
                });

                svg = `<svg width="${svgWidth}" height="${svgHeight}" id="${type}-sankey-svg">`;

                if (kpicMode === 'grace') {
                    // 3-column layout for grace units mode
                    const columnWidth = 60;
                    const columnSpacing = (svgWidth - 3 * columnWidth - 40) / 2; // Space between columns

                    // Column positions
                    const col1X = 20; // Grace notes (when grace comes first)
                    const col2X = col1X + columnWidth + columnSpacing; // Main notes (center)
                    const col3X = col2X + columnWidth + columnSpacing; // Grace notes (when grace comes later)

                    // Collect all unique pitches
                    const allPitches = new Set();
                    Object.keys(stringPositions).forEach(key => {
                        allPitches.add(key);
                    });

                    // Draw 3-column nodes
                    Array.from(allPitches).forEach(stringKey => {
                        const y = stringPositions[stringKey];
                        const pitchName = stringKey.split(': ')[1];

                        // Column 1: Grace notes (left) - only if this pitch appears as grace
                        const hasGraceIncoming = links.some(l => l.target.includes(pitchName) && l.transitionType === 'grace-approach');
                        if (hasGraceIncoming) {
                            svg += `<rect x="${col1X}" y="${y - 30}" width="${columnWidth}" height="60"
                                    fill="#FFD700" opacity="0.8" rx="3"
                                    class="sankey-node grace-left" data-node="${stringKey}" data-column="1"/>`;
                            svg += `<text x="${col1X + columnWidth/2}" y="${y + 7}" text-anchor="middle"
                                    style="font-size: 11px; fill: white; font-weight: bold; stroke: black; stroke-width: 0.5; paint-order: stroke fill;">${pitchName}</text>`;
                            svg += `<text x="${col1X + columnWidth/2}" y="${y + 22}" text-anchor="middle"
                                    style="font-size: 10px; fill: white; font-weight: bold; stroke: black; stroke-width: 0.3; paint-order: stroke fill;">grace</text>`;
                        }

                        // Column 2: Main notes (center) - always present
                        svg += `<rect x="${col2X}" y="${y - 30}" width="${columnWidth}" height="60"
                                fill="#3498db" opacity="0.8" rx="3"
                                class="sankey-node main-center" data-node="${stringKey}" data-column="2"/>`;
                        svg += `<text x="${col2X + columnWidth/2}" y="${y + 7}" text-anchor="middle"
                                style="font-size: 11px; fill: white; font-weight: bold; stroke: black; stroke-width: 0.5; paint-order: stroke fill;">${pitchName}</text>`;

                        // Column 3: Grace notes (right) - only if this pitch appears as grace
                        const hasGraceOutgoing = links.some(l => l.source.includes(pitchName) && l.transitionType === 'grace-departure');
                        if (hasGraceOutgoing) {
                            svg += `<rect x="${col3X}" y="${y - 30}" width="${columnWidth}" height="60"
                                    fill="#FFA500" opacity="0.8" rx="3"
                                    class="sankey-node grace-right" data-node="${stringKey}" data-column="3"/>`;
                            svg += `<text x="${col3X + columnWidth/2}" y="${y + 7}" text-anchor="middle"
                                    style="font-size: 11px; fill: white; font-weight: bold; stroke: black; stroke-width: 0.5; paint-order: stroke fill;">${pitchName}</text>`;
                            svg += `<text x="${col3X + columnWidth/2}" y="${y + 22}" text-anchor="middle"
                                    style="font-size: 10px; fill: white; font-weight: bold; stroke: black; stroke-width: 0.3; paint-order: stroke fill;">grace</text>`;
                        }
                    });
                } else {
                    // Standard 2-column layout for all and main modes
                    const nodeKeys = new Set(Object.keys(stringPositions));
                    if (kpicMode === 'all') {
                        // Don't create separate grace node labels - use the same pitch labels for both
                    }

                    // Draw all string positions as nodes (both left and right)
                    Array.from(nodeKeys).forEach(stringKey => {
                        const originalY = stringPositions[stringKey];
                        const y = originalY;
                        const pitchName = stringKey.split(': ')[1] || stringKey;

                        // Use consistent node colors (no grace distinction since same pitch)
                        const leftColor = '#3498db';
                        const rightColor = '#2ecc71';

                        // Left side (From)
                        svg += `<rect x="20" y="${y - 30}" width="${nodeWidth}" height="60"
                                fill="${leftColor}" opacity="0.8" rx="3"
                                class="sankey-node" data-node="${stringKey}" data-side="left"/>`;
                        svg += `<text x="${20 + nodeWidth/2}" y="${y + 7}" text-anchor="middle"
                                style="font-size: 20px; fill: white; font-weight: bold; stroke: black; stroke-width: 0.5; paint-order: stroke fill;">${pitchName}</text>`;

                        // Right side (To)
                        svg += `<rect x="${svgWidth - nodeWidth - 20}" y="${y - 30}" width="${nodeWidth}" height="60"
                                fill="${rightColor}" opacity="0.8" rx="3"
                                class="sankey-node" data-node="${stringKey}" data-side="right"/>`;
                        svg += `<text x="${svgWidth - nodeWidth/2 - 20}" y="${y + 7}" text-anchor="middle"
                                style="font-size: 20px; fill: white; font-weight: bold; stroke: black; stroke-width: 0.5; paint-order: stroke fill;">${pitchName}</text>`;
                    });
                }

                // This is the updated code for side-by-side bands in Sankey diagram
// Replace from line 6540 onwards in analytical_tablature.html

                if (kpicMode === 'grace') {
                    // Grace mode: 3-column layout with special handling
                    const columnWidth = 60;
                    const totalWidth = 800;
                    const columnSpacing = (totalWidth - 3 * columnWidth - 40) / 2;
                    const col1X = 20; // Grace left
                    const col2X = col1X + columnWidth + columnSpacing; // Main center
                    const col3X = col2X + columnWidth + columnSpacing; // Grace right

                    // Draw grace mode links directly without grouping
                    links.forEach((link, linkIndex) => {
                        const sourceY = stringPositions[link.source.replace(' (grace)', '')];
                        const targetY = stringPositions[link.target.replace(' (grace)', '')];

                        if (sourceY && targetY) {
                            const fromNote = link.source.split(': ')[1].replace(' (grace)', '');
                            const toNote = link.target.split(': ')[1].replace(' (grace)', '');
                            const pattern = `["${fromNote}", "${toNote}"]`;
                            const thickness = Math.min(12, Math.max(2, link.value * 1.5));

                            // Determine source and target positions based on transition type
                            let sourceX, targetX;
                            if (link.transitionType === 'grace-approach') {
                                // Main (col2) ‚Üí Grace (col1 or col3 based on pitch direction)
                                sourceX = col2X + columnWidth;
                                targetX = (fromNote.localeCompare(toNote) < 0) ? col3X : col1X;
                            } else if (link.transitionType === 'grace-departure') {
                                // Grace (col1 or col3) ‚Üí Main (col2)
                                sourceX = (fromNote.localeCompare(toNote) < 0) ? col3X + columnWidth : col1X + columnWidth;
                                targetX = col2X;
                            }

                            const midX = (sourceX + targetX) / 2;

                            // Get transition info for tooltip
                            const transitionKey = link.fullKey || `${link.source}|||${link.target}`;
                            const pitchRanking = pitchRankingMap?.get(transitionKey);
                            const rhythmInfo = getRhythmInfoForTransition(fromNote, toNote, noteData, rhythmTransitions, rhythmRankingMap);
                            const transitionId = `transition_${linkIndex}`;

                            // Store transition data
                            if (!window.sankeyTransitionData) {
                                window.sankeyTransitionData = new Map();
                            }
                            window.sankeyTransitionData.set(transitionId, {
                                fromNote,
                                toNote,
                                count: link.value,
                                totalTransitions: totalTransitions || Object.values(transitions).reduce((sum, count) => sum + count, 0),
                                transitionType: link.transitionType,
                                pitchRanking,
                                rhythmInfo,
                                groupInfo: { totalTypes: 1, allTypes: [link.transitionType], allCounts: [link.value] }
                            });

                            // Draw the transition band
                            const isApproach = link.transitionType === 'grace-approach';
                            const strokeColor = isApproach ? 'rgba(255, 140, 0, 0.5)' : 'rgba(255, 165, 0, 0.5)';
                            const dashArray = isApproach ? '12 3 9 4 6 5 3 6 1 7' : '1 7 3 6 6 5 9 4 12 3';

                            svg += `<path d="M ${sourceX} ${adjustedSourceY} C ${midX} ${adjustedSourceY}, ${midX} ${adjustedTargetY}, ${targetX} ${adjustedTargetY}"
                                    stroke="${strokeColor}"
                                    stroke-width="${thickness}" fill="none"
                                    stroke-dasharray="${dashArray}"
                                    class="sankey-link clickable-band"
                                    data-source="${link.source}"
                                    data-target="${link.target}"
                                    data-pattern='${pattern}'
                                    data-pattern-raw='${fromNote}-${toNote}'
                                    data-value="${link.value}"
                                    data-band-id="kpic-${linkIndex}"
                                    data-transition-type="${link.transitionType}"
                                    style="cursor: pointer;"
                                    onclick="handleSankeyBandClick(this, '${fromNote}-${toNote}');"
                                    onmouseover="event.stopPropagation(); this.style.stroke='${strokeColor.replace('0.5', '0.8')}'; this.style.strokeWidth='${Math.min(16, thickness + 3)}'; showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));"
                                    onmouseout="if(!this.classList.contains('selected-band')) { this.style.stroke='${strokeColor}'; this.style.strokeWidth='${thickness}'; } hideSankeyTooltip();"
                                    onmousemove="showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));" />`;

                            // Add center label
                            svg += `<text x="${midX}" y="${(adjustedSourceY + adjustedTargetY) / 2}" text-anchor="middle" pointer-events="none"
                                    class="sankey-label" data-band-id="kpic-${linkIndex}"
                                    style="font-size: 10px; fill: #FFD700; font-weight: bold;
                                           text-shadow: 1px 1px 1px rgba(0,0,0,0.8);
                                           transition: font-size 0.2s ease, filter 0.2s ease;">${link.value}</text>`;
                        }
                    });
                } else {
                    // Standard 2-column layout for 'all' and 'main' modes
                    // Group links by source-target pair to draw side-by-side
                    const linkGroups = {};
                    links.forEach(link => {
                        const baseSource = link.source.replace(' (grace)', '');
                        const baseTarget = link.target.replace(' (grace)', '');
                        const baseKey = `${baseSource}|||${baseTarget}`;
                        if (!linkGroups[baseKey]) {
                            linkGroups[baseKey] = [];
                        }
                        linkGroups[baseKey].push(link);
                    });

                    // Debug: Log groups with multiple transition types
                    Object.entries(linkGroups).forEach(([key, group]) => {
                        if (group.length > 1) {
                            const types = group.map(l => l.transitionType || 'main-main').join(', ');
                            console.log(`Pitch pair ${key.replace('|||', ' ‚Üí ')} has ${group.length} transition types: ${types}`);
                        }
                    });

                    // Draw grouped links with click handling
                    let globalLinkIndex = 0;
                    Object.values(linkGroups).forEach(group => {
                        group.forEach((link, groupIndex) => {
                        const linkIndex = globalLinkIndex++;
                        const sourceY = stringPositions[link.source] || stringPositions[link.source.replace(' (grace)', '')];
                        const targetY = stringPositions[link.target] || stringPositions[link.target.replace(' (grace)', '')];

                        if (sourceY && targetY) {
                            // Extract note names first for debug logging
                            const fromNote = link.source.split(': ')[1].replace(' (grace)', '');
                            const toNote = link.target.split(': ')[1].replace(' (grace)', '');
                            const pattern = `["${fromNote}", "${toNote}"]`;

                            // Calculate offset for side-by-side bands
                            const groupSize = group.length;
                            const offsetAmount = groupSize > 1 ? 12 : 0; // Increased offset for better visibility
                            const yOffset = groupSize > 1 ? (groupIndex - (groupSize - 1) / 2) * offsetAmount : 0;

                            // Debug log for multi-type groups
                            if (groupSize > 1 && groupIndex === 0) {
                                console.log(`Drawing ${groupSize} bands for ${fromNote} ‚Üí ${toNote} with types:`, group.map(l => l.transitionType || 'main-main'));
                            }

                            // Use actual Y positions from tablature with offset
                            const scaledSourceY = sourceY + yOffset;
                            const scaledTargetY = targetY + yOffset;
                            const thickness = Math.min(14, Math.max(2, link.value * 1.5)); // Slightly thinner for side-by-side

                            // Create curved path
                            const sourceX = 20 + nodeWidth;
                            const targetX = svgWidth - nodeWidth - 20;
                            const midX = (sourceX + targetX) / 2;

                            // Get transition ranking info
                            const transitionKey = link.fullKey || `${link.source}|||${link.target}`;
                            const pitchRanking = pitchRankingMap?.get(transitionKey);
                            const rhythmInfo = getRhythmInfoForTransition(fromNote, toNote, noteData, rhythmTransitions, rhythmRankingMap);

                            // Create unique ID for this transition for tooltip data
                            const transitionId = `transition_${linkIndex}`;

                            // Store transition info in a global map for tooltip access
                            if (!window.sankeyTransitionData) {
                                window.sankeyTransitionData = new Map();
                            }

                            // Add group information for context
                            const groupInfo = {
                                totalTypes: group.length,
                                allTypes: group.map(l => l.transitionType || 'main-main'),
                                allCounts: group.map(l => l.value)
                            };

                            window.sankeyTransitionData.set(transitionId, {
                                fromNote,
                                toNote,
                                count: link.value,
                                totalTransitions: totalTransitions || Object.values(transitions).reduce((sum, count) => sum + count, 0),
                                transitionType: link.transitionType,
                                pitchRanking,
                                rhythmInfo,
                                groupInfo
                            });

                            // Determine style based on transition type
                            if (kpicMode === 'grace') {
                                // 3-column grace mode drawing
                                const columnWidth = 60;
                                const columnSpacing = (svgWidth - 3 * columnWidth - 40) / 2;
                                const col1X = 20; // Grace left
                                const col2X = col1X + columnWidth + columnSpacing; // Main center
                                const col3X = col2X + columnWidth + columnSpacing; // Grace right

                                if (link.transitionType === 'grace-approach') {
                                    // Main (col2) ‚Üí Grace (col1 or col3)
                                    const targetX = fromNote.localeCompare(toNote) < 0 ? col3X : col1X; // Right if ascending pitch, left if descending
                                    const sourceX = col2X + columnWidth;
                                    const targetXStart = targetX;
                                    const midX = (sourceX + targetXStart) / 2;

                                    svg += `<path d="M ${sourceX} ${scaledSourceY} C ${midX} ${scaledSourceY}, ${midX} ${scaledTargetY}, ${targetXStart} ${scaledTargetY}"
                                            stroke="rgba(255, 140, 0, 0.5)"
                                            stroke-width="${thickness}" fill="none"
                                            stroke-dasharray="12 3 9 4 6 5 3 6 1 7"
                                            class="sankey-link clickable-band"
                                            data-source="${link.source}"
                                            data-target="${link.target}"
                                            data-pattern='${pattern}'
                                            data-pattern-raw='${fromNote}-${toNote}'
                                            data-value="${link.value}"
                                            data-band-id="kpic-${linkIndex}"
                                            data-transition-type="grace-approach"
                                            style="cursor: pointer;"
                                            onmouseover="event.stopPropagation(); this.style.stroke='rgba(255, 140, 0, 0.8)'; this.style.strokeWidth='${Math.min(20, thickness + 3)}'; showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));"
                                            onmouseout="if(!this.classList.contains('selected-band')) { this.style.stroke='rgba(255, 140, 0, 0.5)'; this.style.strokeWidth='${thickness}'; } hideSankeyTooltip();"
                                            onmousemove="showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));" />`;
                                } else if (link.transitionType === 'grace-departure') {
                                    // Grace (col1 or col3) ‚Üí Main (col2)
                                    const sourceX = fromNote.localeCompare(toNote) < 0 ? col3X + columnWidth : col1X + columnWidth;
                                    const targetX = col2X;
                                    const midX = (sourceX + targetX) / 2;

                                    svg += `<path d="M ${sourceX} ${scaledSourceY} C ${midX} ${scaledSourceY}, ${midX} ${scaledTargetY}, ${targetX} ${scaledTargetY}"
                                            stroke="rgba(255, 165, 0, 0.5)"
                                            stroke-width="${thickness}" fill="none"
                                            stroke-dasharray="1 7 3 6 6 5 9 4 12 3"
                                            class="sankey-link clickable-band"
                                            data-source="${link.source}"
                                            data-target="${link.target}"
                                            data-pattern='${pattern}'
                                            data-pattern-raw='${fromNote}-${toNote}'
                                            data-value="${link.value}"
                                            data-band-id="kpic-${linkIndex}"
                                            data-transition-type="grace-departure"
                                            style="cursor: pointer;"
                                            onmouseover="event.stopPropagation(); this.style.stroke='rgba(255, 165, 0, 0.8)'; this.style.strokeWidth='${Math.min(20, thickness + 3)}'; showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));"
                                            onmouseout="if(!this.classList.contains('selected-band')) { this.style.stroke='rgba(255, 165, 0, 0.5)'; this.style.strokeWidth='${thickness}'; } hideSankeyTooltip();"
                                            onmousemove="showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));" />`;
                                }
                            } else if (kpicMode === 'all') {
                                if (link.transitionType === 'main-grace') {
                                    // Main to grace - solid blue transitioning to dashed orange
                                    const splitPoint = 0.6;
                                    const splitX = sourceX + (targetX - sourceX) * splitPoint;
                                    const splitY = scaledSourceY + (scaledTargetY - scaledSourceY) * splitPoint;

                                    svg += `<g>
                                        <path d="M ${sourceX} ${scaledSourceY} C ${sourceX + (midX - sourceX) * splitPoint} ${scaledSourceY}, ${splitX - (splitX - sourceX) * 0.3} ${splitY}, ${splitX} ${splitY}"
                                            stroke="rgba(52, 152, 219, 0.4)"
                                            stroke-width="${thickness}" fill="none"
                                            pointer-events="none"/>
                                        <path d="M ${splitX} ${splitY} C ${splitX + (targetX - splitX) * 0.3} ${splitY}, ${targetX - (targetX - midX) * (1 - splitPoint)} ${scaledTargetY}, ${targetX} ${scaledTargetY}"
                                            stroke="rgba(255, 140, 0, 0.5)"
                                            stroke-width="${thickness}" fill="none"
                                            stroke-dasharray="12 3 9 4 6 5 3 6 1 7"
                                            pointer-events="none"/>
                                        <path d="M ${sourceX} ${scaledSourceY} C ${midX} ${scaledSourceY}, ${midX} ${scaledTargetY}, ${targetX} ${scaledTargetY}"
                                            stroke="transparent"
                                            stroke-width="${thickness + 10}" fill="none"
                                            class="sankey-link clickable-band"
                                            data-source="${link.source}"
                                            data-target="${link.target}"
                                            data-pattern='${pattern}'
                                            data-pattern-raw='${fromNote}-${toNote}'
                                            data-value="${link.value}"
                                            data-band-id="kpic-${linkIndex}"
                                            data-transition-type="main-grace"
                                            style="cursor: pointer;"
                                            onmouseover="event.stopPropagation(); this.parentNode.querySelectorAll('path').forEach((p, i) => { if(i < 2) { p.style.strokeWidth = '${Math.min(20, thickness + 3)}'; p.style.opacity = '0.8'; } }); showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));"
                                            onmouseout="this.parentNode.querySelectorAll('path').forEach((p, i) => { if(i < 2) { p.style.strokeWidth = '${thickness}'; p.style.opacity = '1'; } }); hideSankeyTooltip();"
                                            onmousemove="showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));">
                                    </g>`;
                                } else if (link.transitionType === 'grace-main') {
                                    // Grace to main - dashed orange transitioning to solid blue
                                    const splitPoint = 0.4;
                                    const splitX = sourceX + (targetX - sourceX) * splitPoint;
                                    const splitY = scaledSourceY + (scaledTargetY - scaledSourceY) * splitPoint;

                                    svg += `<g>
                                        <path d="M ${sourceX} ${scaledSourceY} C ${sourceX + (midX - sourceX) * splitPoint} ${scaledSourceY}, ${splitX - (splitX - sourceX) * 0.3} ${splitY}, ${splitX} ${splitY}"
                                            stroke="rgba(255, 165, 0, 0.5)"
                                            stroke-width="${thickness}" fill="none"
                                            stroke-dasharray="1 7 3 6 6 5 9 4 12 3"
                                            pointer-events="none"/>
                                        <path d="M ${splitX} ${splitY} C ${splitX + (targetX - splitX) * 0.3} ${splitY}, ${targetX - (targetX - midX) * (1 - splitPoint)} ${scaledTargetY}, ${targetX} ${scaledTargetY}"
                                            stroke="rgba(52, 152, 219, 0.4)"
                                            stroke-width="${thickness}" fill="none"
                                            pointer-events="none"/>
                                        <path d="M ${sourceX} ${scaledSourceY} C ${midX} ${scaledSourceY}, ${midX} ${scaledTargetY}, ${targetX} ${scaledTargetY}"
                                            stroke="transparent"
                                            stroke-width="${thickness + 10}" fill="none"
                                            class="sankey-link clickable-band"
                                            data-source="${link.source}"
                                            data-target="${link.target}"
                                            data-pattern='${pattern}'
                                            data-pattern-raw='${fromNote}-${toNote}'
                                            data-value="${link.value}"
                                            data-band-id="kpic-${linkIndex}"
                                            data-transition-type="grace-main"
                                            style="cursor: pointer;"
                                            onmouseover="event.stopPropagation(); this.parentNode.querySelectorAll('path').forEach((p, i) => { if(i < 2) { p.style.strokeWidth = '${Math.min(20, thickness + 3)}'; p.style.opacity = '0.8'; } }); showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));"
                                            onmouseout="this.parentNode.querySelectorAll('path').forEach((p, i) => { if(i < 2) { p.style.strokeWidth = '${thickness}'; p.style.opacity = '1'; } }); hideSankeyTooltip();"
                                            onmousemove="showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));">
                                    </g>`;
                                } else if (link.transitionType === 'grace-grace') {
                                    // Grace to grace - fully dashed gold
                                    svg += `<path d="M ${sourceX} ${scaledSourceY} C ${midX} ${scaledSourceY}, ${midX} ${scaledTargetY}, ${targetX} ${scaledTargetY}"
                                            stroke="rgba(255, 215, 0, 0.6)"
                                            stroke-width="${thickness}" fill="none"
                                            stroke-dasharray="3 3"
                                            class="sankey-link clickable-band"
                                            data-source="${link.source}"
                                            data-target="${link.target}"
                                            data-pattern='${pattern}'
                                            data-pattern-raw='${fromNote}-${toNote}'
                                            data-value="${link.value}"
                                            data-band-id="kpic-${linkIndex}"
                                            data-transition-type="grace-grace"
                                            style="cursor: pointer;"
                                            onmouseover="event.stopPropagation(); this.style.stroke='rgba(255, 215, 0, 0.9)'; this.style.strokeWidth='${Math.min(20, thickness + 3)}'; showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));"
                                            onmouseout="if(!this.classList.contains('selected-band')) { this.style.stroke='rgba(255, 215, 0, 0.6)'; this.style.strokeWidth='${thickness}'; } hideSankeyTooltip();"
                                            onmousemove="showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));" />`;
                                } else {
                                    // Main to main - fully solid blue
                                    svg += `<path d="M ${sourceX} ${scaledSourceY} C ${midX} ${scaledSourceY}, ${midX} ${scaledTargetY}, ${targetX} ${scaledTargetY}"
                                            stroke="rgba(52, 152, 219, 0.4)"
                                            stroke-width="${thickness}" fill="none"
                                            class="sankey-link clickable-band"
                                            data-source="${link.source}"
                                            data-target="${link.target}"
                                            data-pattern='${pattern}'
                                            data-pattern-raw='${fromNote}-${toNote}'
                                            data-value="${link.value}"
                                            data-band-id="kpic-${linkIndex}"
                                            style="cursor: pointer;"
                                            onmouseover="event.stopPropagation(); this.style.stroke='rgba(52, 152, 219, 0.7)'; this.style.strokeWidth='${Math.min(20, thickness + 3)}'; showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));"
                                            onmouseout="if(!this.classList.contains('selected-band')) { this.style.stroke='rgba(52, 152, 219, 0.4)'; this.style.strokeWidth='${thickness}'; } hideSankeyTooltip();"
                                            onmousemove="showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));" />`;
                                }
                            } else {
                                // For other modes, use solid bands
                                let strokeStyle = "rgba(52, 152, 219, 0.4)";
                                svg += `<path d="M ${sourceX} ${scaledSourceY} C ${midX} ${scaledSourceY}, ${midX} ${scaledTargetY}, ${targetX} ${scaledTargetY}"
                                        stroke="${strokeStyle}"
                                        stroke-width="${thickness}" fill="none"
                                        class="sankey-link clickable-band"
                                        data-source="${link.source}"
                                        data-target="${link.target}"
                                        data-pattern='${pattern}'
                                        data-pattern-raw='${fromNote}-${toNote}'
                                        data-value="${link.value}"
                                        data-band-id="kpic-${linkIndex}"
                                        style="cursor: pointer;"
                                        onmouseover="event.stopPropagation(); this.style.stroke='rgba(52, 152, 219, 0.7)'; this.style.strokeWidth='${Math.min(20, thickness + 3)}'; showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));"
                                        onmouseout="if(!this.classList.contains('selected-band')) { this.style.stroke='rgba(52, 152, 219, 0.4)'; this.style.strokeWidth='${thickness}'; } hideSankeyTooltip();"
                                        onmousemove="showSankeyTooltip(event, window.sankeyTransitionData.get('${transitionId}'));" />`;
                            }

                            // Add center label with count/total format
                            const labelColor = link.transitionType ? '#FFD700' : '#fff';
                            svg += `<text x="${midX}" y="${(scaledSourceY + scaledTargetY) / 2}" text-anchor="middle" pointer-events="none"
                                    class="sankey-label" data-band-id="kpic-${linkIndex}"
                                    style="font-size: 10px; fill: ${labelColor}; font-weight: bold;
                                           text-shadow: 1px 1px 1px rgba(0,0,0,0.8);
                                           transition: font-size 0.2s ease, filter 0.2s ease;">${link.value}</text>`;

                            // Add annotation tag with rank and percentage
                            if (pitchRankingMap && totalTransitions) {
                                const ranking = pitchRankingMap.get(fromNote + '-' + toNote);
                            }
                            }
                        });
                    });
                }

                svg += '</svg>';

            } else {
                // KRIC-2: Keep existing rhythm layout but add clickability and grace note handling
                const nodes = new Set();

                Object.entries(transitions).forEach(([key, count]) => {
                    const parts = key.split('|||');
                    const from = parts[0];
                    const to = parts[1];
                    const transitionType = parts[2]; // Could be 'grace-grace', 'grace-main', 'main-grace', or 'main-main'

                    // Strip grace prefixes for node positioning
                    const cleanFrom = from.startsWith('g') ? from.substring(1) : from;
                    const cleanTo = to.startsWith('g') ? to.substring(1) : to;

                    nodes.add(cleanFrom);
                    nodes.add(cleanTo);
                    links.push({
                        source: cleanFrom,
                        target: cleanTo,
                        originalSource: from,
                        originalTarget: to,
                        value: count,
                        transitionType: transitionType,
                        fullKey: key
                    });
                });

                // Group links by musical note equivalency (not raw duration values)
                // Group "8‚Üí1" and "8‚Üí0.5" together as "2nd‚Üí16th" variations
                const linkGroups = {};
                links.forEach(link => {
                    // Convert to musical note names for grouping
                    const sourceNote = durationToNoteName(link.originalSource).replace('grace ', '');
                    const targetNote = durationToNoteName(link.originalTarget).replace('grace ', '');
                    const groupKey = `${sourceNote}|||${targetNote}`;

                    if (!linkGroups[groupKey]) {
                        linkGroups[groupKey] = [];
                    }
                    linkGroups[groupKey].push(link);
                });

                // Debug: Log groups with multiple transition types
                Object.entries(linkGroups).forEach(([key, group]) => {
                    if (group.length > 1) {
                        const types = group.map(l => l.transitionType).join(', ');
                        console.log(`üîß KRIC group ${key.replace('|||', '‚Üí')} has ${group.length} transition types: ${types}`);
                    }
                });

                // Function to calculate proportional height based on duration
                function getDurationHeight(duration) {
                    const baseHeight = 20; // Minimum height
                    // Strip grace prefix for height calculation
                    const cleanDuration = duration.startsWith('g') ? duration.substring(1) : duration;
                    const multiplier = parseFloat(cleanDuration) || 1; // Get duration value
                    return Math.max(baseHeight, multiplier * 20); // Scale by 20 pixels per unit
                }

                const nodeArray = Array.from(nodes);

                const sourceNodes = new Set(links.map(l => l.source));
                const targetNodes = new Set(links.map(l => l.target));
                const leftNodes = Array.from(sourceNodes);
                const rightNodes = Array.from(targetNodes);

                // Sort nodes by duration rank (largest to smallest - top to bottom)
                const sortedLeftNodes = leftNodes.sort((a, b) => {
                    // Strip grace prefix for ranking lookup
                    const cleanA = a.startsWith('g') ? a.substring(1) : a;
                    const cleanB = b.startsWith('g') ? b.substring(1) : b;
                    const rankA = durationRanks[cleanA] || 0;
                    const rankB = durationRanks[cleanB] || 0;
                    return rankB - rankA; // Descending order (largest first)
                });

                const sortedRightNodes = rightNodes.sort((a, b) => {
                    // Strip grace prefix for ranking lookup
                    const cleanA = a.startsWith('g') ? a.substring(1) : a;
                    const cleanB = b.startsWith('g') ? b.substring(1) : b;
                    const rankA = durationRanks[cleanA] || 0;
                    const rankB = durationRanks[cleanB] || 0;
                    return rankB - rankA; // Descending order (largest first)
                });

                // Calculate total height needed for all nodes with their proportional heights
                const eighthNoteSpacing = 80; // Large spacing to ensure no overlap (2 √ó eighth note height)
                let totalNeededHeight = 100; // Top and bottom padding

                // Calculate for left nodes (they determine the layout)
                sortedLeftNodes.forEach((node, index) => {
                    totalNeededHeight += getDurationHeight(node);
                    if (index < sortedLeftNodes.length - 1) {
                        totalNeededHeight += eighthNoteSpacing; // Add spacing between boxes
                    }
                });

                const svgHeight = 900; // Fixed height for all Sankey diagrams
                const svgWidth = 600;

                svg = `<svg width="${svgWidth}" height="${svgHeight}" id="${type}-sankey-svg">`;

                // Draw rhythm nodes with proportional heights
                // Calculate positions and heights for left nodes
                const leftNodePositions = {};
                let currentY = 110; // Anchor at top, same as KPIC charts

                sortedLeftNodes.forEach((node, i) => {
                    const nodeHeight = getDurationHeight(node);
                    const displayText = durationToNoteName(node); // Use readable note name

                    // Center Y position for this node
                    const centerY = currentY + nodeHeight / 2;
                    leftNodePositions[node] = centerY;

                    svg += `<rect x="20" y="${currentY}" width="${nodeWidth}" height="${nodeHeight}"
                            fill="#e74c3c" opacity="0.8" rx="3"
                            class="sankey-node" data-node="${node}" data-side="left"/>`;
                    svg += `<text x="${20 + nodeWidth/2}" y="${centerY + 4}" text-anchor="middle"
                            style="font-size: 11px; fill: white; font-weight: bold;">${displayText}</text>`;

                    // Add visual separator line for debugging spacing
                    if (i < sortedLeftNodes.length - 1) {
                        const separatorY = currentY + nodeHeight + eighthNoteSpacing / 2;
                        svg += `<line x1="10" y1="${separatorY}" x2="${nodeWidth + 30}" y2="${separatorY}"
                                stroke="#ccc" stroke-width="1" stroke-dasharray="5,5" opacity="0.5"/>`;
                    }

                    currentY += nodeHeight + eighthNoteSpacing; // Move to next position with eighth note spacing
                });

                // Calculate positions and heights for right nodes
                const rightNodePositions = {};
                currentY = 110; // Reset start position - anchor at top

                sortedRightNodes.forEach((node, i) => {
                    const nodeHeight = getDurationHeight(node);
                    const displayText = durationToNoteName(node); // Use readable note name

                    // Center Y position for this node
                    const centerY = currentY + nodeHeight / 2;
                    rightNodePositions[node] = centerY;

                    svg += `<rect x="${svgWidth - nodeWidth - 20}" y="${currentY}" width="${nodeWidth}" height="${nodeHeight}"
                            fill="#f39c12" opacity="0.8" rx="3"
                            class="sankey-node" data-node="${node}" data-side="right"/>`;
                    svg += `<text x="${svgWidth - nodeWidth/2 - 20}" y="${centerY + 4}" text-anchor="middle"
                            style="font-size: 11px; fill: white; font-weight: bold;">${displayText}</text>`;

                    currentY += nodeHeight + eighthNoteSpacing; // Move to next position with eighth note spacing
                });

                // Create transition data store for KRIC tooltips
                if (!window.sankeyRhythmTransitionData) {
                    window.sankeyRhythmTransitionData = new Map();
                }

                // Create shared tooltip data for each rhythm pair group (like KPIC)
                Object.entries(linkGroups).forEach(([groupKey, group]) => {
                    const baseRhythm = group[0]; // Use first link as reference

                    // Calculate total transitions for percentage
                    const totalTransitions = Object.values(transitions).reduce((sum, count) => sum + count, 0);

                    // Create combined group information
                    const groupInfo = {
                        totalTypes: group.length,
                        allTypes: group.map(l => l.transitionType),
                        allCounts: group.map(l => l.value)
                    };

                    // Get KPIC-2 pitches for this rhythm pair
                    const pitchInfo = getPitchInfoForRhythmPattern([baseRhythm.originalSource, baseRhythm.originalTarget]);

                    // Create base transition ID using musical note names (same as groupKey)
                    const baseTransitionId = groupKey.replace('|||', '-');

                    // Find the most frequent transition in this group for primary display
                    const primaryLink = group.reduce((max, link) => link.value > max.value ? link : max);
                    const primaryRanking = rhythmRankingMap?.get(primaryLink.fullKey);

                    // Create combined tooltip data for the entire rhythm pair group
                    const sourceNoteName = durationToNoteName(baseRhythm.originalSource).replace('grace ', '');
                    const targetNoteName = durationToNoteName(baseRhythm.originalTarget).replace('grace ', '');

                    const combinedTooltipData = {
                        fromRhythm: sourceNoteName, // Use musical note name
                        toRhythm: targetNoteName,   // Use musical note name
                        count: primaryLink.value,
                        total: totalTransitions,
                        percentage: ((primaryLink.value / totalTransitions) * 100).toFixed(1),
                        rank: primaryRanking?.rank || 'N/A',
                        transitionType: primaryLink.transitionType,
                        pitchInfo: pitchInfo,
                        groupInfo: groupInfo // This contains ALL transition types and their counts
                    };

                    // Store the same combined data for all possible transition IDs in this group
                    group.forEach(link => {
                        const specificId = `${link.originalSource}-${link.originalTarget}-${link.transitionType}`;
                        window.sankeyRhythmTransitionData.set(specificId, combinedTooltipData);
                    });
                    // Also store under base ID
                    window.sankeyRhythmTransitionData.set(baseTransitionId, combinedTooltipData);
                });

                // Draw grouped links with offset positioning (like KPIC)
                let globalLinkIndex = 0;
                Object.values(linkGroups).forEach(group => {
                    group.forEach((link, groupIndex) => {
                    const linkIndex = globalLinkIndex++;
                    const sourceY = leftNodePositions[link.source];
                    const targetY = rightNodePositions[link.target];

                    if (sourceY !== undefined && targetY !== undefined) {
                        // Calculate offset for multiple bands (like KPIC)
                        const groupSize = group.length;
                        const offsetAmount = groupSize > 1 ? 12 : 0;
                        const yOffset = groupSize > 1 ? (groupIndex - (groupSize - 1) / 2) * offsetAmount : 0;

                        // Apply offset to Y positions
                        const adjustedSourceY = sourceY + yOffset;
                        const adjustedTargetY = targetY + yOffset;

                        const thickness = Math.min(20, Math.max(2, link.value * 2));

                        const sourceX = 20 + nodeWidth;
                        const targetX = svgWidth - nodeWidth - 20;
                        const midX = (sourceX + targetX) / 2;

                        // Extract just the duration names for the pattern
                        const pattern = `["${link.source}", "${link.target}"]`;
                        // Create pattern raw with actual duration values (including grace prefixes)
                        const patternRaw = `${link.originalSource}-${link.originalTarget}`;

                        // Create transition ID for tooltip lookup - use musical note names for combined tooltips
                        const sourceNoteName = durationToNoteName(link.originalSource).replace('grace ', '');
                        const targetNoteName = durationToNoteName(link.originalTarget).replace('grace ', '');
                        const transitionId = `${sourceNoteName}-${targetNoteName}`;


                        // Apply directional grace note styling
                        if (link.transitionType === 'grace-grace') {
                            // Grace to grace - fully dashed gold
                            svg += `<path d="M ${sourceX} ${adjustedSourceY} C ${midX} ${adjustedSourceY}, ${midX} ${adjustedTargetY}, ${targetX} ${adjustedTargetY}"
                                    stroke="rgba(255, 215, 0, 0.6)"
                                    stroke-width="${thickness}" fill="none"
                                    stroke-dasharray="3 3"
                                    class="sankey-link clickable-band"
                                    data-source="${link.source}"
                                    data-target="${link.target}"
                                    data-pattern='${pattern}'
                                    data-pattern-raw='${patternRaw}'
                                    data-value="${link.value}"
                                    data-band-id="kric-${linkIndex}"
                                    data-transition-type="${link.transitionType}"
                                    style="cursor: pointer;"
                                    onmouseover="event.stopPropagation(); this.style.stroke='rgba(255, 215, 0, 0.9)'; this.style.strokeWidth='${Math.min(25, thickness + 3)}'; showRhythmSankeyTooltip(event, window.sankeyRhythmTransitionData.get('${transitionId}'));"
                                    onmouseout="if(!this.classList.contains('selected-band')) { this.style.stroke='rgba(255, 215, 0, 0.6)'; this.style.strokeWidth='${thickness}'; } hideSankeyTooltip();"
                                    onmousemove="showRhythmSankeyTooltip(event, window.sankeyRhythmTransitionData.get('${transitionId}'));"
                                    title="${link.source} ‚Üí ${link.target} (${link.transitionType}): ${link.value} occurrence${link.value > 1 ? 's' : ''}"/>`;
                        } else if (link.transitionType === 'main-grace') {
                            // Main to grace - solid red transitioning to dashed orange (toward grace side)
                            const splitPoint = 0.6;
                            const splitX = sourceX + (targetX - sourceX) * splitPoint;
                            const splitY = adjustedSourceY + (adjustedTargetY - adjustedSourceY) * splitPoint;

                            svg += `<g>
                                <path d="M ${sourceX} ${sourceY} C ${sourceX + (midX - sourceX) * splitPoint} ${sourceY}, ${splitX - (splitX - sourceX) * 0.3} ${splitY}, ${splitX} ${splitY}"
                                    stroke="rgba(231, 76, 60, 0.4)"
                                    stroke-width="${thickness}" fill="none"
                                    pointer-events="none"/>
                                <path d="M ${splitX} ${splitY} C ${splitX + (targetX - splitX) * 0.3} ${splitY}, ${targetX - (targetX - midX) * (1 - splitPoint)} ${targetY}, ${targetX} ${targetY}"
                                    stroke="rgba(255, 140, 0, 0.5)"
                                    stroke-width="${thickness}" fill="none"
                                    stroke-dasharray="12 3 9 4 6 5 3 6 1 7"
                                    pointer-events="none"/>
                                <path d="M ${sourceX} ${sourceY} C ${midX} ${sourceY}, ${midX} ${targetY}, ${targetX} ${targetY}"
                                    stroke="transparent"
                                    stroke-width="${thickness + 10}" fill="none"
                                    class="sankey-link clickable-band"
                                    data-source="${link.source}"
                                    data-target="${link.target}"
                                    data-pattern='${pattern}'
                                    data-pattern-raw='${patternRaw}'
                                    data-value="${link.value}"
                                    data-band-id="kric-${linkIndex}"
                                    data-transition-type="${link.transitionType}"
                                    style="cursor: pointer;"
                                    onmouseover="event.stopPropagation(); this.parentNode.querySelectorAll('path').forEach((p, i) => { if(i < 2) { p.style.strokeWidth = '${Math.min(25, thickness + 3)}'; p.style.opacity = '0.8'; } }); showRhythmSankeyTooltip(event, window.sankeyRhythmTransitionData.get('${transitionId}'));"
                                    onmouseout="this.parentNode.querySelectorAll('path').forEach((p, i) => { if(i < 2) { p.style.strokeWidth = '${thickness}'; p.style.opacity = '1'; } }); hideSankeyTooltip();"
                                    onmousemove="showRhythmSankeyTooltip(event, window.sankeyRhythmTransitionData.get('${transitionId}'));"
                                    title="${link.source} ‚Üí ${link.target} (${link.transitionType}): ${link.value} occurrence${link.value > 1 ? 's' : ''}">
                            </g>`;
                        } else if (link.transitionType === 'grace-main') {
                            // Grace to main - dashed orange transitioning to solid red (from grace side)
                            const splitPoint = 0.4;
                            const splitX = sourceX + (targetX - sourceX) * splitPoint;
                            const splitY = adjustedSourceY + (adjustedTargetY - adjustedSourceY) * splitPoint;

                            svg += `<g>
                                <path d="M ${sourceX} ${sourceY} C ${sourceX + (midX - sourceX) * splitPoint} ${sourceY}, ${splitX - (splitX - sourceX) * 0.3} ${splitY}, ${splitX} ${splitY}"
                                    stroke="rgba(255, 165, 0, 0.5)"
                                    stroke-width="${thickness}" fill="none"
                                    stroke-dasharray="1 7 3 6 6 5 9 4 12 3"
                                    pointer-events="none"/>
                                <path d="M ${splitX} ${splitY} C ${splitX + (targetX - splitX) * 0.3} ${splitY}, ${targetX - (targetX - midX) * (1 - splitPoint)} ${targetY}, ${targetX} ${targetY}"
                                    stroke="rgba(231, 76, 60, 0.4)"
                                    stroke-width="${thickness}" fill="none"
                                    pointer-events="none"/>
                                <path d="M ${sourceX} ${sourceY} C ${midX} ${sourceY}, ${midX} ${targetY}, ${targetX} ${targetY}"
                                    stroke="transparent"
                                    stroke-width="${thickness + 10}" fill="none"
                                    class="sankey-link clickable-band"
                                    data-source="${link.source}"
                                    data-target="${link.target}"
                                    data-pattern='${pattern}'
                                    data-pattern-raw='${patternRaw}'
                                    data-value="${link.value}"
                                    data-band-id="kric-${linkIndex}"
                                    data-transition-type="${link.transitionType}"
                                    style="cursor: pointer;"
                                    onmouseover="event.stopPropagation(); this.parentNode.querySelectorAll('path').forEach((p, i) => { if(i < 2) { p.style.strokeWidth = '${Math.min(25, thickness + 3)}'; p.style.opacity = '0.8'; } }); showRhythmSankeyTooltip(event, window.sankeyRhythmTransitionData.get('${transitionId}'));"
                                    onmouseout="this.parentNode.querySelectorAll('path').forEach((p, i) => { if(i < 2) { p.style.strokeWidth = '${thickness}'; p.style.opacity = '1'; } }); hideSankeyTooltip();"
                                    onmousemove="showRhythmSankeyTooltip(event, window.sankeyRhythmTransitionData.get('${transitionId}'));"
                                    title="${link.source} ‚Üí ${link.target} (${link.transitionType}): ${link.value} occurrence${link.value > 1 ? 's' : ''}">
                            </g>`;
                        } else {
                            // Main to main - solid red
                            svg += `<path d="M ${sourceX} ${adjustedSourceY} C ${midX} ${adjustedSourceY}, ${midX} ${adjustedTargetY}, ${targetX} ${adjustedTargetY}"
                                    stroke="rgba(231, 76, 60, 0.4)"
                                    stroke-width="${thickness}" fill="none"
                                    class="sankey-link clickable-band"
                                    data-source="${link.source}"
                                    data-target="${link.target}"
                                    data-pattern='${pattern}'
                                    data-pattern-raw='${patternRaw}'
                                    data-value="${link.value}"
                                    data-band-id="kric-${linkIndex}"
                                    data-transition-type="${link.transitionType}"
                                    style="cursor: pointer;"
                                    onmouseover="event.stopPropagation(); this.style.stroke='rgba(231, 76, 60, 0.7)'; this.style.strokeWidth='${Math.min(25, thickness + 3)}'; showRhythmSankeyTooltip(event, window.sankeyRhythmTransitionData.get('${transitionId}'));"
                                    onmouseout="if(!this.classList.contains('selected-band')) { this.style.stroke='rgba(231, 76, 60, 0.4)'; this.style.strokeWidth='${thickness}'; } hideSankeyTooltip();"
                                    onmousemove="showRhythmSankeyTooltip(event, window.sankeyRhythmTransitionData.get('${transitionId}'));"
                                    title="${link.source} ‚Üí ${link.target} (${link.transitionType}): ${link.value} occurrence${link.value > 1 ? 's' : ''}"/>`;
                        }

                        // Add center label with count/total format
                        svg += `<text x="${midX}" y="${(adjustedSourceY + adjustedTargetY) / 2}" text-anchor="middle" pointer-events="none"
                                class="sankey-label" data-band-id="kric-${linkIndex}"
                                style="font-size: 10px; fill: #fff; font-weight: bold;
                                       text-shadow: 1px 1px 1px rgba(0,0,0,0.8);
                                       transition: font-size 0.2s ease, filter 0.2s ease;">${link.value}</text>`;

                    }
                    });
                });

                svg += '</svg>';
            }

            // Add interaction for clickable bands
            setTimeout(() => {
                document.querySelectorAll('.clickable-band').forEach(band => {
                    band.addEventListener('click', function(event) {
                        const pattern = JSON.parse(this.getAttribute('data-pattern'));
                        const isMultiSelect = event.ctrlKey || event.metaKey;

                        // Determine if this is a KPIC or KRIC band based on parent SVG
                        const parentSvg = this.closest('svg');
                        const isKRIC = parentSvg && parentSvg.id === 'rhythm-sankey-svg';

                        // Get the associated label
                        const bandId = this.getAttribute('data-band-id');
                        const associatedLabel = document.querySelector(`text[data-band-id="${bandId}"]`);

                        // Check selection state BEFORE any modifications
                        const wasSelected = this.classList.contains('selected-band');
                        console.log('Band clicked, wasSelected:', wasSelected, 'pattern:', pattern, 'bandId:', bandId, 'this:', this);

                        // Debug: Check all selected bands before processing
                        const allSelectedBands = document.querySelectorAll('.clickable-band.selected-band');
                        console.log('Currently selected bands before processing:', allSelectedBands.length);

                        // Visual feedback for selected bands
                        if (!isMultiSelect) {
                            // Clear all OTHER selected bands if not multi-selecting
                            document.querySelectorAll('.clickable-band.selected-band').forEach(b => {
                                if (b !== this) { // Don't clear THIS band yet
                                    b.classList.remove('selected-band');
                                    if (b.closest('svg').id === 'rhythm-sankey-svg') {
                                        // Reset KRIC band stroke color based on transition type
                                        const transitionType = b.getAttribute('data-transition-type');
                                        if (transitionType === 'grace-grace') {
                                            b.style.stroke = 'rgba(255, 215, 0, 0.6)';
                                        } else if (transitionType === 'grace-main') {
                                            b.style.stroke = 'rgba(255, 165, 0, 0.5)';
                                        } else if (transitionType === 'main-grace') {
                                            b.style.stroke = 'rgba(255, 140, 0, 0.5)';
                                        } else {
                                            b.style.stroke = 'rgba(231, 76, 60, 0.4)';
                                        }
                                    } else {
                                        b.style.stroke = 'rgba(52, 152, 219, 0.4)';
                                    }
                                    // Also reset other labels
                                    const otherBandId = b.getAttribute('data-band-id');
                                    const otherLabel = document.querySelector(`text[data-band-id="${otherBandId}"]`);
                                    if (otherLabel) {
                                        otherLabel.style.fontSize = '10px';
                                        otherLabel.style.filter = 'none';
                                    }
                                }
                            });
                        }

                        if (wasSelected) {
                            // Deselecting
                            this.classList.remove('selected-band');
                            if (isKRIC) {
                                // Reset KRIC band stroke color based on transition type
                                const transitionType = this.getAttribute('data-transition-type');
                                if (transitionType === 'grace-grace') {
                                    this.style.stroke = 'rgba(255, 215, 0, 0.6)';
                                } else if (transitionType === 'grace-main') {
                                    this.style.stroke = 'rgba(255, 165, 0, 0.5)';
                                } else if (transitionType === 'main-grace') {
                                    this.style.stroke = 'rgba(255, 140, 0, 0.5)';
                                } else {
                                    this.style.stroke = 'rgba(231, 76, 60, 0.4)';
                                }
                            } else {
                                this.style.stroke = 'rgba(52, 152, 219, 0.4)';
                            }

                            // Reset label styling
                            if (associatedLabel) {
                                associatedLabel.style.fontSize = '10px';
                                associatedLabel.style.filter = 'none';
                            }

                            // Deselect the corresponding pattern from dropdown
                            if (isKRIC) {
                                const kricSelect = document.getElementById('specificKricPattern');
                                if (kricSelect && window.kricPatterns && window.kricPatterns['kric-2']) {
                                    const patterns = window.kricPatterns['kric-2'];
                                    const matchIndex = patterns.findIndex(p => JSON.stringify(p.pattern) === JSON.stringify(pattern));
                                    if (matchIndex !== -1 && kricSelect.options[matchIndex]) {
                                        kricSelect.options[matchIndex].selected = false;
                                    }
                                }
                            } else {
                                const kpicSelect = document.getElementById('specificKpicPattern');
                                if (kpicSelect) {
                                    const analysisMode = document.querySelector('input[name="analysisMode"]:checked')?.value || 'full';
                                    const modePatterns = analysisData.kpic_patterns[analysisMode] || analysisData.kpic_patterns.full;
                                    let patterns = modePatterns['kpic-2'] || [];
                                    const matchIndex = patterns.findIndex(p => JSON.stringify(p.pattern) === JSON.stringify(pattern));
                                    if (matchIndex !== -1 && kpicSelect.options[matchIndex]) {
                                        kpicSelect.options[matchIndex].selected = false;
                                    }
                                }
                            }

                            // Check if any bands are still selected
                            const anySelected = document.querySelectorAll('.clickable-band.selected-band').length > 0;
                            console.log('Deselecting band, any others selected?', anySelected);

                            if (!anySelected) {
                                clearHighlighting();
                                // Restore default dimming
                                document.querySelectorAll('.note-circle').forEach(circle => {
                                    circle.style.opacity = '0.4';
                                });
                            } else {
                                // Refresh highlighting with remaining selections
            // Refresh pattern options for the new mode
            if (window.kpicThreshold && window.kpicThreshold !== "none") {
                updateKpicPatternOptions();
            }                                updateHighlighting();
                            }
                        } else {
                            // Selecting
                            console.log('üéØ SELECTING band - calling trigger function directly');

                            // Only clear other bands if not multi-selecting
                            if (!isMultiSelect) {
                                // Clear ALL other selected bands (not just this one)
                                document.querySelectorAll('.clickable-band.selected-band').forEach(b => {
                                    if (b !== this) {
                                        console.log('Clearing band:', b.getAttribute('data-band-id'));
                                        b.classList.remove('selected-band');
                                        if (b.closest('svg').id === 'rhythm-sankey-svg') {
                                            // Reset KRIC band stroke color based on transition type
                                            const transitionType = b.getAttribute('data-transition-type');
                                            if (transitionType === 'grace-grace') {
                                                b.style.stroke = 'rgba(255, 215, 0, 0.6)';
                                            } else if (transitionType === 'grace-main') {
                                                b.style.stroke = 'rgba(255, 165, 0, 0.5)';
                                            } else if (transitionType === 'main-grace') {
                                                b.style.stroke = 'rgba(255, 140, 0, 0.5)';
                                            } else {
                                                b.style.stroke = 'rgba(231, 76, 60, 0.4)';
                                            }
                                        } else {
                                            b.style.stroke = 'rgba(52, 152, 219, 0.4)';
                                        }
                                        // Reset other labels
                                        const otherBandId = b.getAttribute('data-band-id');
                                        const otherLabel = document.querySelector(`text[data-band-id="${otherBandId}"]`);
                                        if (otherLabel) {
                                            otherLabel.style.fontSize = '10px';
                                            otherLabel.style.filter = 'none';
                                        }
                                    }
                                });
                            }

                            // Set this band as selected
                            this.classList.add('selected-band');
                            if (isKRIC) {
                                // Set selected KRIC band stroke color based on transition type
                                const transitionType = this.getAttribute('data-transition-type');
                                if (transitionType === 'grace-grace') {
                                    this.style.stroke = 'rgba(255, 215, 0, 0.9)';
                                } else if (transitionType === 'grace-main') {
                                    this.style.stroke = 'rgba(255, 165, 0, 0.8)';
                                } else if (transitionType === 'main-grace') {
                                    this.style.stroke = 'rgba(255, 140, 0, 0.8)';
                                } else {
                                    this.style.stroke = 'rgba(231, 76, 60, 0.9)';
                                }
                            } else {
                                this.style.stroke = 'rgba(52, 152, 219, 0.9)';
                            }

                            // Enhance label styling
                            if (associatedLabel) {
                                associatedLabel.style.fontSize = '14px';
                                associatedLabel.style.filter = 'drop-shadow(0 0 6px #ffff00) drop-shadow(0 0 12px #ffff00)';
                            }

                            // Call appropriate pattern trigger function FIRST (this updates dropdown)
                            console.log('üéØ About to call pattern trigger function');
                            if (isKRIC) {
                                triggerKRICPattern(pattern, isMultiSelect);
                            } else {
                                triggerKPICPattern(pattern, isMultiSelect);
                            }
                        }
                    });
                });
            }, 100);

            return svg;
        }

        // Trigger KPIC pattern selection
        function triggerKPICPattern(pattern, isMultiSelect = false) {
            console.log('triggerKPICPattern called with:', pattern, 'multiSelect:', isMultiSelect);

            const kpicSlider = document.getElementById('kpicSlider');
            if (!kpicSlider) return;

            // Always ensure we're at KPIC-2
            if (kpicSlider.value !== '2') {
                // Update KPIC slider to 2
                kpicSlider.value = 2;
                window.kpicThreshold = 'kpic-2';

                // Update slider display
                const display = document.getElementById('kpicSliderValue');
                if (display) {
                    display.textContent = '2';
                    const percentage = (2 / 136) * 100;
                    const sliderRect = kpicSlider.getBoundingClientRect();
                    const sliderWidth = sliderRect.width;
                    const handleWidth = 20;
                    const leftPosition = (percentage / 100) * (sliderWidth - handleWidth) + (handleWidth / 2) - 0;
                    display.style.left = `${Math.max(0, Math.min(leftPosition, sliderWidth - 30))}px`;
                }
            }

            // ALWAYS update pattern options to ensure dropdown is properly populated
            // This ensures patterns are available even on subsequent clicks
            console.log('üîß Updating KPIC pattern options to ensure dropdown is ready');
            updateKpicPatternOptions();

            // Small delay to ensure DOM updates are complete
            setTimeout(() => {
                console.log('üîß Now calling selectPattern after ensuring dropdown is ready');
                selectPattern(pattern, isMultiSelect);
            }, 50);
        }

        // Trigger KRIC pattern selection
        function triggerKRICPattern(pattern, isMultiSelect = false) {
            console.log('triggerKRICPattern called with:', pattern, 'multiSelect:', isMultiSelect);

            const kricSlider = document.getElementById('kricSlider');
            if (!kricSlider) return;

            // Always ensure we're at KRIC-2
            if (kricSlider.value !== '2') {
                // Update KRIC slider to 2
                kricSlider.value = 2;
                window.kricThreshold = 'kric-2';

                // Update slider display
                const display = document.getElementById('kricSliderValue');
                if (display) {
                    display.textContent = '2';
                    const percentage = (2 / 136) * 100;
                    const sliderRect = kricSlider.getBoundingClientRect();
                    const sliderWidth = sliderRect.width;
                    const handleWidth = 20;
                    const leftPosition = (percentage / 100) * (sliderWidth - handleWidth) + (handleWidth / 2) - 0;
                    display.style.left = `${Math.max(0, Math.min(leftPosition, sliderWidth - 30))}px`;
                }
            }

            // ALWAYS update pattern options to ensure dropdown is properly populated
            updateKricPatternOptions();

            // Small delay to ensure DOM updates are complete
            setTimeout(() => {
                selectKricPattern(pattern, isMultiSelect);
            }, 50);
        }

        // Helper function to select a specific KRIC pattern
        function selectKricPattern(pattern, isMultiSelect) {
            console.log('selectKricPattern called with:', pattern);

            const patternSelect = document.getElementById('specificKricPattern');
            if (!patternSelect) {
                console.error('KRIC Pattern select element not found');
                return;
            }

            // Generate KRIC patterns from noteData if not exists
            if (!window.kricPatterns) {
                generateKricPatterns();
            }

            // Get KRIC-2 patterns
            const patterns = window.kricPatterns['kric-2'] || [];

            console.log('Available patterns in KRIC-2:', patterns.length);
            console.log('Options in dropdown:', patternSelect.options.length);

            // Find the matching pattern index
            let matchingIndex = -1;
            for (let i = 0; i < patterns.length; i++) {
                const patternStr = JSON.stringify(patterns[i].pattern);
                const searchStr = JSON.stringify(pattern);

                if (patternStr === searchStr) {
                    matchingIndex = i;
                    console.log('Match found at index:', i);
                    break;
                }
            }

            // If pattern not found, create a temporary pattern
            if (matchingIndex === -1) {
                console.log('Pattern not in KRIC-2, creating temporary pattern');

                // Search for this pattern in the actual note data
                const noteCircles = document.querySelectorAll('.note-circle');
                const positions = [];

                // Find all occurrences of this rhythm pattern
                for (let i = 0; i < noteCircles.length - 1; i++) {
                    const currentNote = noteCircles[i];
                    const nextNote = noteCircles[i + 1];

                    // Determine durations based on spacing
                    const currentCx = parseFloat(currentNote.getAttribute('data-base-x') || currentNote.getAttribute('cx'));
                    const nextCx = parseFloat(nextNote.getAttribute('data-base-x') || nextNote.getAttribute('cx'));
                    const spacing = nextCx - currentCx;

                    let currentDuration = 'quarter';
                    if (spacing > 400) currentDuration = 'whole';
                    else if (spacing > 200) currentDuration = 'half';
                    else if (spacing > 100) currentDuration = 'quarter';
                    else if (spacing > 50) currentDuration = 'eighth';
                    else currentDuration = 'sixteenth';

                    let nextDuration = 'quarter';
                    if (i < noteCircles.length - 2) {
                        const followingNote = noteCircles[i + 2];
                        const followingCx = parseFloat(followingNote.getAttribute('data-base-x') || followingNote.getAttribute('cx'));
                        const nextSpacing = followingCx - nextCx;
                        if (nextSpacing > 400) nextDuration = 'whole';
                        else if (nextSpacing > 200) nextDuration = 'half';
                        else if (nextSpacing > 100) nextDuration = 'quarter';
                        else if (nextSpacing > 50) nextDuration = 'eighth';
                        else nextDuration = 'sixteenth';
                    }

                    // Check if this matches our pattern
                    if (currentDuration === pattern[0] && nextDuration === pattern[1]) {
                        positions.push(i);
                    }
                }

                if (positions.length > 0) {
                    // Create a temporary pattern object
                    const tempPattern = {
                        pattern: pattern,
                        count: positions.length,
                        positions: positions
                    };

                    // Add it to the patterns array temporarily
                    patterns.push(tempPattern);
                    matchingIndex = patterns.length - 1;

                    // Add it to the dropdown
                    const option = document.createElement('option');
                    option.value = matchingIndex;
                    option.textContent = `${pattern.join(' ‚Üí ')} (${positions.length}√ó) [from Sankey]`;
                    patternSelect.appendChild(option);

                    console.log('Created temporary KRIC pattern:', tempPattern);
                }
            }

            console.log('Final matching index:', matchingIndex);
            console.log('Current selections:', Array.from(patternSelect.selectedOptions).map(o => o.value));

            if (matchingIndex >= 0 && matchingIndex < patternSelect.options.length) {
                // Handle multi-selection
                if (!isMultiSelect) {
                    // Clear ALL previous selections
                    Array.from(patternSelect.options).forEach(option => {
                        option.selected = false;
                    });
                    console.log('Cleared all KRIC selections');
                }

                // Find the option with the matching index value
                let targetOption = null;
                for (let i = 0; i < patternSelect.options.length; i++) {
                    if (parseInt(patternSelect.options[i].value) === matchingIndex) {
                        targetOption = patternSelect.options[i];
                        break;
                    }
                }

                if (targetOption) {
                    if (isMultiSelect) {
                        // Toggle selection in multi-select mode
                        targetOption.selected = !targetOption.selected;
                        console.log('Toggled KRIC option:', matchingIndex, 'to', targetOption.selected);
                    } else {
                        // Select only this pattern
                        targetOption.selected = true;
                        console.log('Selected KRIC option:', matchingIndex);
                    }

                    // Trigger highlighting
            // Refresh pattern options for the new mode
            if (window.kpicThreshold && window.kpicThreshold !== "none") {
                updateKpicPatternOptions();
            }                    updateHighlighting();
                } else {
                    console.error('Could not find option with value:', matchingIndex);
                }
            } else {
                console.warn('No matching KRIC pattern found for:', pattern);
            }
        }

        // Generate KRIC patterns from note data for all levels
        function generateKricPatterns() {
            console.log('Generating KRIC patterns from note data');

            // Debug: Show all duration text elements
            const allDurationTexts = document.querySelectorAll('text[style*="font-size: 10px"][text-anchor="middle"]');
            console.log(`üîç Found ${allDurationTexts.length} duration text elements:`);
            allDurationTexts.forEach((text, i) => {
                if (i < 10) {
                    const x = text.getAttribute('data-base-x') || text.getAttribute('x');
                    const y = text.getAttribute('data-base-y') || text.getAttribute('y');
                    const originalDuration = text.getAttribute('data-original-duration');
                    const currentText = text.textContent;
                    console.log(`  Text ${i}: (${x},${y}) current="${currentText}" original="${originalDuration}"`);
                }
            });

            // Get current analysis mode
            const analysisMode = document.querySelector('input[name="analysisMode"]:checked')?.value || 'full';
            const isMainOnly = analysisMode === 'main_melody';

            const noteCircles = document.querySelectorAll('.note-circle');
            const rhythmData = [];

            // Extract rhythm data from notes with grace detection and actual tablature values
            const graceNoteIndices = [3, 10, 19, 21, 49, 51, 60, 92, 94, 107, 109];

            noteCircles.forEach((circle, index) => {
                const cx = parseFloat(circle.getAttribute('data-base-x') || circle.getAttribute('cx'));
                const cy = parseFloat(circle.getAttribute('data-base-y') || circle.getAttribute('cy'));
                const isGrace = graceNoteIndices.includes(index);

                // Skip grace notes in main-only mode
                if (isMainOnly && isGrace) {
                    return;
                }

                // Get actual duration from tablature text
                const durationValue = extractDurationFromTablature(cx, cy);

                // Use actual duration values from tablature
                let duration = durationValue.toString();

                // Add grace prefix if this is a grace note (only in full mode)
                const rhythmLabel = (isGrace && !isMainOnly) ? 'g' + duration : duration;

                // Debug logging for first few notes
                if (index < 20) {
                    console.log(`Note ${index}: cx=${cx}, cy=${cy}, durationValue=${durationValue} ‚Üí ${rhythmLabel} (grace=${isGrace})`);
                }

                rhythmData.push({
                    index: index,
                    duration: rhythmLabel, // Now includes grace prefix
                    originalDuration: duration, // Keep original for reference
                    isGrace: isGrace,
                    durationValue: durationValue, // Store original value for debugging
                    cx: cx
                });
            });

            // Generate KRIC patterns for all levels (2 through max possible)
            const maxLevel = Math.min(16, rhythmData.length); // Max 16 levels or note count
            window.kricPatterns = {};



            for (let ngramSize = 2; ngramSize <= maxLevel; ngramSize++) {
                const patterns = {};

                for (let i = 0; i <= rhythmData.length - ngramSize; i++) {
                    const pattern = [];

                    // Build the n-gram pattern
                    for (let j = 0; j < ngramSize; j++) {
                        pattern.push(rhythmData[i + j].duration);
                    }

                    const key = JSON.stringify(pattern);
                    if (!patterns[key]) {
                        patterns[key] = {
                            pattern: pattern,
                            count: 0,
                            positions: []
                        };
                    }
                    patterns[key].count++;
                    patterns[key].positions.push(i);
                }

                // Convert to array and sort by count (descending)
                const patternsArray = Object.values(patterns).sort((a, b) => b.count - a.count);
                window.kricPatterns[`kric-${ngramSize}`] = patternsArray;
            }

            console.log('Generated KRIC patterns for all levels:', window.kricPatterns);
        }

        // Helper function to select a specific pattern
        function selectPattern(pattern, isMultiSelect) {
            console.log('selectPattern called with:', pattern, 'isMultiSelect:', isMultiSelect);

            const patternSelect = document.getElementById('specificKpicPattern');
            if (!patternSelect) {
                console.error('Pattern select element not found');
                return;
            }

            // Make sure we have the kpic-2 patterns
            const analysisMode = document.querySelector('input[name="analysisMode"]:checked')?.value || 'full';
            const modePatterns = analysisData.kpic_patterns[analysisMode] || analysisData.kpic_patterns.full;
            let patterns = modePatterns['kpic-2'] || [];

            console.log('Available patterns in KPIC-2:', patterns.length);
            console.log('Options in dropdown:', patternSelect.options.length);

            // Find the matching pattern index
            let matchingIndex = -1;
            for (let i = 0; i < patterns.length; i++) {
                const patternStr = JSON.stringify(patterns[i].pattern);
                const searchStr = JSON.stringify(pattern);

                if (patternStr === searchStr) {
                    matchingIndex = i;
                    console.log('Match found at index:', i);
                    break;
                }
            }

            // If pattern not found, it might be a single occurrence pattern not in KPIC-2
            // We should create a temporary pattern for visualization
            if (matchingIndex === -1) {
                console.log('Pattern not in KPIC-2, searching in raw data or creating temporary pattern');

                // Search for this pattern in the actual note data
                const noteCircles = document.querySelectorAll('.note-circle');
                const positions = [];

                // Find all occurrences of this pattern
                for (let i = 0; i < noteCircles.length - 1; i++) {
                    const currentNote = noteCircles[i];
                    const nextNote = noteCircles[i + 1];

                    // Get the note values (you might need to adjust this based on your data structure)
                    const currentPitch = currentNote.getAttribute('data-note') ||
                                        currentNote.getAttribute('data-pitch');
                    const nextPitch = nextNote.getAttribute('data-note') ||
                                      nextNote.getAttribute('data-pitch');

                    // Check if this matches our pattern
                    if (currentPitch === pattern[0] && nextPitch === pattern[1]) {
                        positions.push(i);
                    }
                }

                if (positions.length > 0) {
                    // Create a temporary pattern object
                    const tempPattern = {
                        pattern: pattern,
                        count: positions.length,
                        positions: positions
                    };

                    // Add it to the patterns array temporarily
                    patterns = [...patterns, tempPattern];
                    matchingIndex = patterns.length - 1;

                    // Add it to the dropdown
                    const option = document.createElement('option');
                    option.value = matchingIndex;
                    option.textContent = `${pattern.join(' ‚Üí ')} (${positions.length}√ó) [from Sankey]`;
                    patternSelect.appendChild(option);

                    // Also add it to the analysisData so highlighting works
                    if (!modePatterns['kpic-2']) {
                        modePatterns['kpic-2'] = [];
                    }
                    modePatterns['kpic-2'].push(tempPattern);

                    console.log('Created temporary pattern:', tempPattern);
                }
            }

            console.log('Final matching index:', matchingIndex);
            console.log('Current selections:', Array.from(patternSelect.selectedOptions).map(o => o.value));

            if (matchingIndex >= 0 && matchingIndex < patternSelect.options.length) {
                // Handle multi-selection
                if (!isMultiSelect) {
                    // Clear ALL previous selections - force clear
                    Array.from(patternSelect.options).forEach(option => {
                        option.selected = false;
                    });
                    console.log('üéØ Cleared all dropdown selections for single select');
                }

                // Find the option with the matching index value
                let targetOption = null;
                for (let i = 0; i < patternSelect.options.length; i++) {
                    if (parseInt(patternSelect.options[i].value) === matchingIndex) {
                        targetOption = patternSelect.options[i];
                        break;
                    }
                }

                if (targetOption) {
                    if (isMultiSelect) {
                        // Toggle selection in multi-select mode
                        targetOption.selected = !targetOption.selected;
                        console.log('Toggled option:', matchingIndex, 'to', targetOption.selected);
                    } else {
                        // Select only this pattern
                        targetOption.selected = true;
                        console.log('Selected option:', matchingIndex);
                    }

                    // Force the select element to update
                    patternSelect.dispatchEvent(new Event('change'));

                    // Scroll the selected option into view
                    targetOption.scrollIntoView({ block: 'nearest' });

                    // Force visual update of the dropdown
                    patternSelect.focus();
                    patternSelect.blur();
                    console.log(`üéØ Forced dropdown visual refresh, selected option text: "${targetOption.textContent}"`);
                    console.log(`üéØ Dropdown visual state:`, {
                        selectedIndex: patternSelect.selectedIndex,
                        selectedOptions: patternSelect.selectedOptions.length,
                        value: patternSelect.value,
                        multiple: patternSelect.multiple
                    });

                    // CRITICAL FIX: Always call updateHighlighting immediately and directly
                    // Don't rely on setTimeout or conditional checks
                    console.log('üî• DIRECT CALL to updateHighlighting from selectPattern');
            // Refresh pattern options for the new mode
            if (window.kpicThreshold && window.kpicThreshold !== "none") {
                updateKpicPatternOptions();
            }                    updateHighlighting();

                    console.log('Updated selections:', Array.from(patternSelect.selectedOptions).map(o => o.value));
                } else {
                    console.error('Could not find option with value:', matchingIndex);
                }
            } else {
                console.log('Pattern not found in KPIC-2 or index out of range:', pattern);
                console.log('Pattern was:', pattern);
            }
        }

        // Helper function to convert duration values to musical note names
        function durationToNoteName(duration) {
            // Strip grace prefix for conversion
            const cleanDuration = duration.startsWith('g') ? duration.substring(1) : duration;
            const isGrace = duration.startsWith('g');

            let noteName;
            switch (cleanDuration) {
                case '0.5': noteName = '16th'; break;
                case '1': noteName = '16th'; break;
                case '2': noteName = '8th'; break;
                case '3': noteName = 'dotted 8th'; break;
                case '4': noteName = '4th'; break;
                case '5': noteName = 'dotted 4th'; break;
                case '6': noteName = 'dotted 4th+'; break;
                case '7': noteName = 'dotted 2nd-'; break;
                case '8': noteName = '2nd'; break;
                default: noteName = cleanDuration; break;
            }

            return isGrace ? `grace ${noteName}` : noteName;
        }

        // Helper function to get pitch information for a rhythm pattern
        function getPitchInfoForRhythmPattern(rhythmPattern) {
            const pitchData = [];

            // Get all note elements
            const noteCircles = document.querySelectorAll('.note-circle');

            // Build rhythm sequence from tablature
            const rhythmSequence = [];
            noteCircles.forEach((circle, index) => {
                const cx = parseFloat(circle.getAttribute('data-base-x') || circle.getAttribute('cx'));
                const cy = parseFloat(circle.getAttribute('data-base-y') || circle.getAttribute('cy'));
                const isGrace = circle.getAttribute('data-is-grace') === 'true';

                // Get duration from tablature
                let durationValue = 2;
                const durationTexts = document.querySelectorAll('text[style*="font-size: 10px"]');
                durationTexts.forEach(text => {
                    const textX = parseFloat(text.getAttribute('data-base-x') || text.getAttribute('x'));
                    const textY = parseFloat(text.getAttribute('data-base-y') || text.getAttribute('y'));
                    if (Math.abs(textX - cx) < 5 && Math.abs(textY - (cy - 20)) < 30) {
                        const value = parseFloat(text.textContent);
                        if (!isNaN(value)) {
                            durationValue = value;
                        }
                    }
                });

                const duration = durationValue.toString();
                const rhythmLabel = isGrace ? 'g' + duration : duration;

                // Get pitch from string position
                const stringInfo = {
                    110: 'D4', 260: 'G4', 320: 'A4', 410: 'C5',
                    470: 'D5', 530: 'E5', 620: 'G5'
                };
                const pitch = stringInfo[Math.round(cy/10)*10] || 'Unknown';

                rhythmSequence.push({ rhythm: rhythmLabel, pitch: pitch, index: index });
            });

            // Find occurrences of the rhythm pattern and collect associated pitches
            for (let i = 0; i < rhythmSequence.length - 1; i++) {
                if (rhythmSequence[i].rhythm === rhythmPattern[0] &&
                    rhythmSequence[i + 1].rhythm === rhythmPattern[1]) {
                    pitchData.push({
                        fromPitch: rhythmSequence[i].pitch,
                        toPitch: rhythmSequence[i + 1].pitch,
                        position: i
                    });
                }
            }

            return pitchData;
        }

        // Function to create and show KRIC Sankey tooltip
        function showRhythmSankeyTooltip(event, transitionInfo) {
            // Determine which specific transition type is being hovered
            const hoveredElement = event.target;
            const hoveredTransitionType = hoveredElement.getAttribute('data-transition-type');

            // Override the transitionType in transitionInfo with the hovered one
            if (hoveredTransitionType) {
                transitionInfo = {...transitionInfo, transitionType: hoveredTransitionType};
            }
            // Remove existing tooltip
            const existingTooltip = document.querySelector('.sankey-tooltip');
            if (existingTooltip) {
                existingTooltip.remove();
            }

            // Create new tooltip
            const tooltip = document.createElement('div');
            tooltip.className = 'sankey-tooltip';

            const { fromRhythm, toRhythm, count, total, percentage, rank, transitionType, pitchInfo, groupInfo } = transitionInfo;

            let typeLabel = '';
            let texturePattern = '';
            if (transitionType === 'main-grace') {
                typeLabel = ' (Main ‚Üí Grace)';
                texturePattern = '<div class="tooltip-section"><span class="tooltip-label">Texture Pattern:</span><br><span style="font-family: monospace;">‚îÅ‚îÅ‚îÅ‚îÅ ‚îÖ‚îÖ‚îÖ‚îÖ</span> (solid to dashed)</div>';
            } else if (transitionType === 'grace-main') {
                typeLabel = ' (Grace ‚Üí Main)';
                texturePattern = '<div class="tooltip-section"><span class="tooltip-label">Texture Pattern:</span><br><span style="font-family: monospace;">‚îÖ‚îÖ‚îÖ‚îÖ ‚îÅ‚îÅ‚îÅ‚îÅ</span> (dashed to solid)</div>';
            } else if (transitionType === 'grace-grace') {
                typeLabel = ' (Grace ‚Üí Grace)';
                texturePattern = '<div class="tooltip-section"><span class="tooltip-label">Texture Pattern:</span><br><span style="font-family: monospace;">‚îÖ‚îÖ‚îÖ‚îÖ ‚îÖ‚îÖ‚îÖ‚îÖ</span> (fully dashed)</div>';
            } else {
                typeLabel = ' (Main ‚Üí Main)';
                texturePattern = '<div class="tooltip-section"><span class="tooltip-label">Texture Pattern:</span><br><span style="font-family: monospace;">‚îÅ‚îÅ‚îÅ‚îÅ ‚îÅ‚îÅ‚îÅ‚îÅ</span> (fully solid)</div>';
            }

            // Add group information if multiple types exist
            let groupSection = '';
            if (groupInfo && groupInfo.totalTypes > 1) {
                const allPatterns = groupInfo.allTypes.map(type => {
                    if (type === 'main-grace') return 'Main‚ÜíGrace (‚îÅ‚îÅ‚îÅ‚îÅ ‚îÖ‚îÖ‚îÖ‚îÖ)';
                    else if (type === 'grace-main') return 'Grace‚ÜíMain (‚îÖ‚îÖ‚îÖ‚îÖ ‚îÅ‚îÅ‚îÅ‚îÅ)';
                    else if (type === 'grace-grace') return 'Grace‚ÜíGrace (‚îÖ‚îÖ‚îÖ‚îÖ ‚îÖ‚îÖ‚îÖ‚îÖ)';
                    else return 'Main‚ÜíMain (‚îÅ‚îÅ‚îÅ‚îÅ ‚îÅ‚îÅ‚îÅ‚îÅ)';
                }).join('<br>');
                const typeBreakdown = groupInfo.allTypes.map((type, i) => {
                    const typeName = type === 'main-grace' ? 'Main‚ÜíGrace' :
                                    type === 'grace-main' ? 'Grace‚ÜíMain' :
                                    type === 'grace-grace' ? 'Grace‚ÜíGrace' : 'Main‚ÜíMain';

                    const isCurrentType = transitionType === type;
                    const style = isCurrentType ? 'font-weight: bold; color: #FFD700;' : 'color: #CCC;';
                    return `<span style="${style}">${typeName}: ${groupInfo.allCounts[i]}</span>`;
                }).join('<br>');

                groupSection = `
                    <div class="tooltip-section">
                        <span class="tooltip-label">All Types for ${durationToNoteName(fromRhythm)}‚Üí${durationToNoteName(toRhythm)}:</span><br>
                        ${typeBreakdown}
                    </div>
                    <div class="tooltip-section">
                        <span class="tooltip-label">All Texture Patterns:</span><br>
                        <span style="font-family: monospace; font-size: 11px;">${allPatterns}</span>
                    </div>`;
            }

            // Create pitch information section
            let pitchSection = '';
            if (pitchInfo && pitchInfo.length > 0) {
                const pitchList = pitchInfo.map(p =>
                    `<span class="tooltip-pitch">${p.fromPitch}‚Üí${p.toPitch}</span>`
                ).join('<br>');
                pitchSection = `
                    <div class="tooltip-section">
                        <span class="tooltip-label">KPIC-2 Pitches:</span><br>
                        ${pitchList}
                    </div>`;
            }

            tooltip.innerHTML = `
                <div class="tooltip-title">${durationToNoteName(fromRhythm)} ‚Üí ${durationToNoteName(toRhythm)}${typeLabel}</div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Occurrences:</span> <span class="tooltip-value">${count}/${total}</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Percentage:</span> <span class="tooltip-value">${percentage}%</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Rank:</span> <span class="tooltip-value">#${rank}</span>
                </div>
                ${texturePattern}
                ${groupSection}
                ${pitchSection}
            `;

            // Position tooltip to the right of mouse (avoiding cursor coverage)
            tooltip.style.left = (event.pageX + 15) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';

            document.body.appendChild(tooltip);
        }

        // Function to create and show Sankey tooltip
        function showSankeyTooltip(event, transitionInfo) {
            // Remove existing tooltip
            const existingTooltip = document.querySelector('.sankey-tooltip');
            if (existingTooltip) {
                existingTooltip.remove();
            }

            // Create new tooltip
            const tooltip = document.createElement('div');
            tooltip.className = 'sankey-tooltip';

            const { fromNote, toNote, count, transitionType, pitchRanking, rhythmInfo, groupInfo } = transitionInfo;

            let typeLabel = '';
            let texturePattern = '';
            if (transitionType === 'main-grace') {
                typeLabel = ' (Main ‚Üí Grace)';
                texturePattern = '<div class="tooltip-section"><span class="tooltip-label">Texture Pattern:</span><br><span style="font-family: monospace;">‚îÅ‚îÅ‚îÅ‚îÅ ‚îÖ‚îÖ‚îÖ‚îÖ</span> (solid to dashed)</div>';
            } else if (transitionType === 'grace-main') {
                typeLabel = ' (Grace ‚Üí Main)';
                texturePattern = '<div class="tooltip-section"><span class="tooltip-label">Texture Pattern:</span><br><span style="font-family: monospace;">‚îÖ‚îÖ‚îÖ‚îÖ ‚îÅ‚îÅ‚îÅ‚îÅ</span> (dashed to solid)</div>';
            } else if (transitionType === 'grace-grace') {
                typeLabel = ' (Grace ‚Üí Grace)';
                texturePattern = '<div class="tooltip-section"><span class="tooltip-label">Texture Pattern:</span><br><span style="font-family: monospace;">‚îÖ‚îÖ‚îÖ‚îÖ ‚îÖ‚îÖ‚îÖ‚îÖ</span> (fully dashed)</div>';
            } else {
                typeLabel = ' (Main ‚Üí Main)';
                texturePattern = '<div class="tooltip-section"><span class="tooltip-label">Texture Pattern:</span><br><span style="font-family: monospace;">‚îÅ‚îÅ‚îÅ‚îÅ ‚îÅ‚îÅ‚îÅ‚îÅ</span> (fully solid)</div>';
            }

            // Add group information if multiple types exist
            let groupSection = '';
            if (groupInfo && groupInfo.totalTypes > 1) {
                const allPatterns = groupInfo.allTypes.map(type => {
                    if (type === 'main-grace') return 'Main‚ÜíGrace (‚îÅ‚îÅ‚îÅ‚îÅ ‚îÖ‚îÖ‚îÖ‚îÖ)';
                    else if (type === 'grace-main') return 'Grace‚ÜíMain (‚îÖ‚îÖ‚îÖ‚îÖ ‚îÅ‚îÅ‚îÅ‚îÅ)';
                    else if (type === 'grace-grace') return 'Grace‚ÜíGrace (‚îÖ‚îÖ‚îÖ‚îÖ ‚îÖ‚îÖ‚îÖ‚îÖ)';
                    else return 'Main‚ÜíMain (‚îÅ‚îÅ‚îÅ‚îÅ ‚îÅ‚îÅ‚îÅ‚îÅ)';
                }).join('<br>');
                const typeBreakdown = groupInfo.allTypes.map((type, i) => {
                    const typeName = type === 'main-grace' ? 'Main‚ÜíGrace' :
                                    type === 'grace-main' ? 'Grace‚ÜíMain' :
                                    type === 'grace-grace' ? 'Grace‚ÜíGrace' : 'Main‚ÜíMain';

                    // Fix the comparison logic for main-main transitions
                    const currentTransitionNormalized = transitionType || 'main-main';
                    const typeNormalized = type || 'main-main';
                    const isCurrentType = currentTransitionNormalized === typeNormalized;

                    const style = isCurrentType ? 'font-weight: bold; color: #FFD700;' : 'color: #CCC;';
                    return `<span style="${style}">${typeName}: ${groupInfo.allCounts[i]}</span>`;
                }).join('<br>');

                groupSection = `
                    <div class="tooltip-section">
                        <span class="tooltip-label">All Types for this Pitch Pair:</span><br>
                        ${typeBreakdown}
                    </div>
                    <div class="tooltip-section">
                        <span class="tooltip-label">All Texture Patterns:</span><br>
                        <span style="font-family: monospace; font-size: 11px;">${allPatterns}</span>
                    </div>`;
            }

            let rhythmSection = '';
            if (rhythmInfo && rhythmInfo.length > 0) {
                const rhythmList = rhythmInfo.map(r => `<span class="tooltip-rhythm">${r.from}‚Üí${r.to} (√ó${r.count})</span>`).join('<br>');
                rhythmSection = `
                    <div class="tooltip-section">
                        <span class="tooltip-label">KRIC Rhythms:</span><br>
                        ${rhythmList}
                    </div>`;
            }

            tooltip.innerHTML = `
                <div class="tooltip-title">${fromNote} ‚Üí ${toNote}${typeLabel}</div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Occurrences:</span> <span class="tooltip-value">${count}</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Percentage:</span> <span class="tooltip-value">${pitchRanking?.percentage || '0.0'}%</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Rank:</span> <span class="tooltip-value">#${pitchRanking?.rank || 'N/A'}</span>
                </div>
                ${texturePattern}
                ${groupSection}
                ${rhythmSection}
            `;

            // Position tooltip to the right of mouse (avoiding cursor coverage)
            tooltip.style.left = (event.pageX + 45) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';

            document.body.appendChild(tooltip);
        }

        // Function to hide Sankey tooltip
        function hideSankeyTooltip() {
            const tooltip = document.querySelector('.sankey-tooltip');
            if (tooltip) {
                tooltip.remove();
            }
        }

        // Function to create and show KPIC-3 tooltip
        function showKpic3Tooltip(event, transitionInfo, segment) {
            // Remove existing tooltip
            hideSankeyTooltip();

            if (!transitionInfo) return;

            // Create new tooltip
            const tooltip = document.createElement('div');
            tooltip.className = 'sankey-tooltip';

            const { fullPattern, segment1, segment2, count, totalPatterns, percentage, rank, positions, hasGraceNote, type } = transitionInfo;

            // Determine which segment is being hovered
            const currentSegment = segment === 2 ? segment2 : segment1;
            const segmentLabel = segment === 2 ? ' (Segment 2/2)' : ' (Segment 1/2)';

            let typeLabel = hasGraceNote ? ' (includes grace notes)' : '';

            // Position information
            const positionList = positions.slice(0, 5).map(pos => `Note ${pos + 1}`).join(', ');
            const positionSuffix = positions.length > 5 ? `, +${positions.length - 5} more` : '';

            tooltip.innerHTML = `
                <div class="tooltip-title">${currentSegment}${segmentLabel}</div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Full Pattern:</span> <span class="tooltip-value">${fullPattern}</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Occurrences:</span> <span class="tooltip-value">${count}/${totalPatterns}</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Percentage:</span> <span class="tooltip-value">${percentage}%</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Rank:</span> <span class="tooltip-value">#${rank}</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Type:</span> <span class="tooltip-value">${type.toUpperCase()}-3${typeLabel}</span>
                </div>
                <div class="tooltip-section">
                    <span class="tooltip-label">Positions:</span> <span class="tooltip-value">${positionList}${positionSuffix}</span>
                </div>
            `;

            // Position tooltip to the right of mouse (avoiding cursor coverage)
            tooltip.style.left = (event.pageX + 15) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';

            document.body.appendChild(tooltip);
        }

        // Function to get rhythm transitions for a pitch transition
        function getRhythmInfoForTransition(fromNote, toNote, noteData, rhythmTransitions, rhythmRankingMap) {
            const rhythmInfo = [];

            // Find all rhythm patterns that occur between these pitch notes
            for (let i = 0; i < noteData.length - 1; i++) {
                const currentPitch = noteData[i].pitch;
                const nextPitch = noteData[i + 1].pitch;

                if ((currentPitch === fromNote && nextPitch === toNote) ||
                    (currentPitch.replace(' (grace)', '') === fromNote && nextPitch.replace(' (grace)', '') === toNote)) {
                    const currentDuration = noteData[i].duration;
                    const nextDuration = noteData[i + 1].duration;
                    const rhythmKey = `${currentDuration}|||${nextDuration}`;
                    const ranking = rhythmRankingMap?.get(rhythmKey);

                    const existing = rhythmInfo.find(r => r.from === currentDuration && r.to === nextDuration);
                    if (existing) {
                        existing.count++;
                    } else {
                        rhythmInfo.push({
                            from: currentDuration,
                            to: nextDuration,
                            count: 1,
                            ranking: ranking
                        });
                    }
                }
            }

            return rhythmInfo.sort((a, b) => b.count - a.count);
        }

        // Function to restore normal note visibility
        function restoreNormalNoteVisibility() {
            console.log('Restoring normal note visibility');
            document.querySelectorAll('.note-circle').forEach(circle => {
                circle.style.display = 'block';
                circle.style.opacity = '1';
                // Reset to original color
                if (circle.style.fill === 'rgb(255, 215, 0)') { // Gold in RGB
                    circle.style.fill = '#008080'; // Reset to teal
                }
            });
            document.querySelectorAll('.string-number').forEach(sn => {
                sn.style.display = 'block';
                sn.style.opacity = '1';
            });
            document.querySelectorAll('rect[fill*="resonance"]').forEach(band => {
                band.style.display = 'block';
                band.style.opacity = band.getAttribute('opacity') || '0.9';
            });
        }

        // Function to regenerate Sankey with selected mode
        function regenerateSankeyWithMode() {
            const selectedMode = document.querySelector('input[name="sankeyMode"]:checked')?.value || 'all';
            console.log('Regenerating Sankey with mode:', selectedMode);

            // Sync with analysis mode radio buttons (without triggering change event)
            const analysisModeMap = {
                'all': 'full',
                'main': 'main_melody'
            };
            const correspondingAnalysisMode = analysisModeMap[selectedMode];
            const analysisRadio = document.querySelector(`input[name="analysisMode"][value="${correspondingAnalysisMode}"]`);
            if (analysisRadio && !analysisRadio.checked) {
                console.log('üîÑ Syncing analysis mode from Sankey:', correspondingAnalysisMode);
                // Set the radio button without triggering its onchange
                window.skipSankeySync = true; // Flag to prevent circular update
                analysisRadio.checked = true;

                // Clear KRIC pattern cache to force regeneration with new mode
                window.kricPatterns = null;

                // Update the highlighting based on new mode
                updateHighlighting();
                window.skipSankeySync = false;
            }

            // Generate the Sankey diagram with the selected mode
            generateSankeyDiagrams(selectedMode);
        }

        // Update Sankey zoom
        function updateSankeyZoom() {
            const xZoom = document.getElementById('sankey-x-zoom').value;
            const yZoom = document.getElementById('sankey-y-zoom').value;

            const kpicSvg = document.getElementById('pitch-sankey-svg');
            const kricSvg = document.getElementById('rhythm-sankey-svg');

            if (kpicSvg) {
                // Apply zoom to the whole SVG
                kpicSvg.style.transform = `scale(${xZoom}, ${yZoom})`;
                kpicSvg.style.transformOrigin = 'top left';

                // Keep label boxes constant size by counter-scaling them
                const nodes = kpicSvg.querySelectorAll('.sankey-node');
                const texts = kpicSvg.querySelectorAll('text');

                nodes.forEach(node => {
                    // Get the original center position
                    const rect = node.getBBox();
                    const centerX = rect.x + rect.width / 2;
                    const centerY = rect.y + rect.height / 2;

                    // Apply counter-scale with center positioning
                    node.style.transform = `scale(${1/xZoom}, ${1/yZoom})`;
                    node.style.transformOrigin = `${centerX}px ${centerY}px`;
                });

                texts.forEach(text => {
                    // Get the text position
                    const x = parseFloat(text.getAttribute('x'));
                    const y = parseFloat(text.getAttribute('y'));

                    // Apply counter-scale with text center positioning
                    text.style.transform = `scale(${1/xZoom}, ${1/yZoom})`;
                    text.style.transformOrigin = `${x}px ${y}px`;
                });
            }

            if (kricSvg) {
                // Apply zoom to the whole SVG
                kricSvg.style.transform = `scale(${xZoom}, ${yZoom})`;
                kricSvg.style.transformOrigin = 'top left';

                // Keep label boxes constant size by counter-scaling them
                const nodes = kricSvg.querySelectorAll('.sankey-node');
                const texts = kricSvg.querySelectorAll('text');

                nodes.forEach(node => {
                    // Get the original center position
                    const rect = node.getBBox();
                    const centerX = rect.x + rect.width / 2;
                    const centerY = rect.y + rect.height / 2;

                    // Apply counter-scale with center positioning
                    node.style.transform = `scale(${1/xZoom}, ${1/yZoom})`;
                    node.style.transformOrigin = `${centerX}px ${centerY}px`;
                });

                texts.forEach(text => {
                    // Get the text position
                    const x = parseFloat(text.getAttribute('x'));
                    const y = parseFloat(text.getAttribute('y'));

                    // Apply counter-scale with text center positioning
                    text.style.transform = `scale(${1/xZoom}, ${1/yZoom})`;
                    text.style.transformOrigin = `${x}px ${y}px`;
                });
            }
        }

        // Highlight pitch pattern
        function highlightPitchPattern(pitch) {
            // Find and highlight corresponding KPIC-2 patterns
            const patterns = analysisData.kpic_patterns.full['kpic-2'] || [];
            patterns.forEach(pattern => {
                if (pattern.pattern.includes(pitch)) {
                    // Trigger highlighting of these positions
                    console.log('Highlighting pitch pattern:', pattern);
                }
            });
        }

        // Highlight rhythm pattern
        function highlightRhythmPattern(rhythm) {
            // Find and highlight corresponding KRIC-2 patterns
            const patterns = analysisData.kric_patterns?.full?.['kric-2'] || [];
            patterns.forEach(pattern => {
                if (pattern.pattern.includes(rhythm)) {
                    // Trigger highlighting of these positions
                    console.log('Highlighting rhythm pattern:', pattern);
                }
            });
        }

        // Vietnamese lyrics text-to-speech functionality
        let lyricsSynth = null;
        let lyricsUtterance = null;
        let currentVietnameseVoiceSettings = {
            type: 'male-bac',
            rate: 0.8,
            pitch: 1.0,
            volume: 1.0
        };

        function openPhoneticGuidePopup(text) {
            // Create phonetic guide HTML content
            const phonetic = convertToPhonetic(text);

            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Vietnamese Pronunciation Guide</title>
                    <style>
                        body {
                            font-family: 'Segoe UI', sans-serif;
                            padding: 20px;
                            background: #f8f9fa;
                            margin: 0;
                        }
                        .container {
                            background: white;
                            padding: 25px;
                            border-radius: 10px;
                            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                            max-width: 500px;
                            margin: 0 auto;
                        }
                        h2 {
                            color: #2c3e50;
                            margin: 0 0 20px 0;
                            text-align: center;
                        }
                        .vietnamese {
                            font-size: 20px;
                            margin-bottom: 15px;
                            color: #333;
                            padding: 10px;
                            background: #e8f4fd;
                            border-radius: 5px;
                        }
                        .phonetic {
                            font-size: 18px;
                            color: #666;
                            font-family: monospace;
                            padding: 10px;
                            background: #f0f8ff;
                            border-radius: 5px;
                            margin-bottom: 20px;
                        }
                        .close-btn {
                            background: #3498db;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 5px;
                            cursor: pointer;
                            display: block;
                            margin: 0 auto;
                            font-size: 14px;
                        }
                        .close-btn:hover {
                            background: #2980b9;
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h2>üìñ Vietnamese Pronunciation</h2>
                        <div class="vietnamese"><strong>Vietnamese:</strong><br>${text}</div>
                        <div class="phonetic"><strong>Phonetic:</strong><br>${phonetic}</div>
                        <button class="close-btn" onclick="window.close()">‚úÖ Close Window</button>
                    </div>
                </body>
                </html>
            `;

            // Open popup window with phonetic content
            const popup = window.open(
                '',
                'PhoneticGuide',
                'width=550,height=400,scrollbars=yes,resizable=yes,menubar=no,toolbar=no,location=no'
            );

            if (popup) {
                popup.document.write(htmlContent);
                popup.document.close();
                popup.focus();
            }
        }

        function openGoogleTranslatePopup(text) {
            // Create popup window for Google Translate
            const encodedText = encodeURIComponent(text);
            const url = `https://translate.google.com/?sl=vi&tl=en&text=${encodedText}&op=translate`;

            // Open smaller, easily closable popup window
            const popup = window.open(
                url,
                'GoogleTranslateVoice',
                'width=600,height=500,scrollbars=yes,resizable=yes,menubar=no,toolbar=no,location=no'
            );

            // Focus the popup
            if (popup) {
                popup.focus();
            }
        }

        function playVietnameseNaturalVoice(text, lineIndex) {
            if ('speechSynthesis' in window) {
                if (!text) {
                    alert('No text found for this line.');
                    return;
                }

                // Stop any existing speech
                stopVietnameseSpeech();

                // Create new speech instance
                lyricsSynth = window.speechSynthesis;
                lyricsUtterance = new SpeechSynthesisUtterance(text);

                // Find the best Vietnamese voice (avoid English speakers)
                const voices = lyricsSynth.getVoices();
                let selectedVoice = null;

                // First priority: Actual Vietnamese voices
                selectedVoice = voices.find(voice =>
                    voice.lang.includes('vi') || voice.name.toLowerCase().includes('viet')
                );

                // Second priority: Asian language voices (better for Vietnamese sounds)
                if (!selectedVoice) {
                    selectedVoice = voices.find(voice =>
                        voice.lang.includes('zh') || voice.lang.includes('ja') || voice.lang.includes('ko')
                    );
                }

                // Fallback: Default voice but force Vietnamese language
                if (!selectedVoice) {
                    selectedVoice = voices[0]; // Use default
                }

                // Apply voice
                if (selectedVoice) {
                    lyricsUtterance.voice = selectedVoice;
                }
                lyricsUtterance.lang = 'vi-VN'; // Force Vietnamese language

                // Set speech parameters - NATURAL pitch, no adjustments
                lyricsUtterance.rate = 0.8; // Slightly slower for Vietnamese
                lyricsUtterance.pitch = 1.0; // Natural pitch - no modification
                lyricsUtterance.volume = 1.0;

                // Event handlers for visual feedback
                const targetBtn = document.querySelector(`button[title*="Vietnamese voice for line ${lineIndex + 1}"]`);
                lyricsUtterance.onstart = function() {
                    if (targetBtn) {
                        targetBtn.style.background = '#E91E63';
                        targetBtn.innerHTML = 'üîâ';
                    }
                };

                lyricsUtterance.onend = function() {
                    if (targetBtn) {
                        targetBtn.style.background = '#FF7043';
                        targetBtn.innerHTML = 'üîä';
                    }
                };

                lyricsUtterance.onerror = function(event) {
                    console.error('Speech synthesis error:', event);
                    if (targetBtn) {
                        targetBtn.style.background = '#FF7043';
                        targetBtn.innerHTML = 'üîä';
                    }
                };

                // Start speaking
                lyricsSynth.speak(lyricsUtterance);
            } else {
                alert('Text-to-speech is not supported in this browser.');
            }
        }

        function showPhoneticReading(text, lineIndex) {
            // Create phonetic popup
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 3px solid #3498db;
                border-radius: 10px;
                padding: 20px;
                box-shadow: 0 8px 20px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 500px;
                font-family: 'Segoe UI', sans-serif;
            `;

            // Convert to phonetic (basic approximation)
            const phonetic = convertToPhonetic(text);

            popup.innerHTML = `
                <h3 style="margin: 0 0 15px 0; color: #2c3e50;">üìñ Vietnamese Pronunciation</h3>
                <div style="font-size: 18px; margin-bottom: 10px; color: #333;">
                    <strong>Vietnamese:</strong> ${text}
                </div>
                <div style="font-size: 16px; margin-bottom: 15px; color: #666; font-family: monospace;">
                    <strong>Phonetic:</strong> ${phonetic}
                </div>
                <div style="text-align: center;">
                    <button onclick="this.parentElement.parentElement.remove()"
                            style="background: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
                        ‚úÖ Got it
                    </button>
                </div>
            `;

            document.body.appendChild(popup);

            // Auto-close after 8 seconds
            setTimeout(() => {
                if (popup.parentElement) popup.remove();
            }, 8000);
        }

        function convertToPhonetic(vietnameseText) {
            // Basic Vietnamese to phonetic conversion
            const phoneticMap = {
                '√†': 'ah', '√°': 'ah', '·∫£': 'ah', '√£': 'ah', '·∫°': 'ah',
                'ƒÉ': 'a', '·∫±': 'a', '·∫Ø': 'a', '·∫≥': 'a', '·∫µ': 'a', '·∫∑': 'a',
                '√¢': 'aw', '·∫ß': 'aw', '·∫•': 'aw', '·∫©': 'aw', '·∫´': 'aw', '·∫≠': 'aw',
                '√®': 'eh', '√©': 'eh', '·∫ª': 'eh', '·∫Ω': 'eh', '·∫π': 'eh',
                '√™': 'ay', '·ªÅ': 'ay', '·∫ø': 'ay', '·ªÉ': 'ay', '·ªÖ': 'ay', '·ªá': 'ay',
                '√¨': 'ee', '√≠': 'ee', '·ªâ': 'ee', 'ƒ©': 'ee', '·ªã': 'ee',
                '√≤': 'oh', '√≥': 'oh', '·ªè': 'oh', '√µ': 'oh', '·ªç': 'oh',
                '√¥': 'aw', '·ªì': 'aw', '·ªë': 'aw', '·ªï': 'aw', '·ªó': 'aw', '·ªô': 'aw',
                '∆°': 'uh', '·ªù': 'uh', '·ªõ': 'uh', '·ªü': 'uh', '·ª°': 'uh', '·ª£': 'uh',
                '√π': 'oo', '√∫': 'oo', '·ªß': 'oo', '≈©': 'oo', '·ª•': 'oo',
                '∆∞': 'oo', '·ª´': 'oo', '·ª©': 'oo', '·ª≠': 'oo', '·ªØ': 'oo', '·ª±': 'oo',
                '·ª≥': 'ee', '√Ω': 'ee', '·ª∑': 'ee', '·ªπ': 'ee', '·ªµ': 'ee',
                'ƒë': 'd',
                'r': 'z', 'r·∫±ng': 'zahng', 'r√≠': 'zee',
                'ng': 'ng', 'nh': 'ny', 'ch': 'ch', 'th': 'th', 'ph': 'f',
                'gi': 'yee', 'qu': 'kw'
            };

            let result = vietnameseText.toLowerCase();

            // Apply phonetic mappings
            for (const [viet, phonetic] of Object.entries(phoneticMap)) {
                result = result.replaceAll(viet, phonetic);
            }

            return result;
        }

        function openGoogleTranslateForLine(text) {
            const encodedText = encodeURIComponent(text);
            const url = `https://translate.google.com/?sl=vi&tl=en&text=${encodedText}&op=translate`;
            window.open(url, '_blank');
        }

        function playSystemVoice(lineText, lineIndex, lines) {
            if ('speechSynthesis' in window) {
                // Stop any existing speech
                stopVietnameseSpeech();

                // Create new speech instance
                lyricsSynth = window.speechSynthesis;
                lyricsUtterance = new SpeechSynthesisUtterance(lineText);

                // Apply Vietnamese voice settings
                applyVietnameseVoiceSettings(lyricsUtterance);

                // Event handlers
                const readButtons = document.querySelectorAll('.lyrics-playback-buttons button[title*="Read Vietnamese"]');
                lyricsUtterance.onstart = function() {
                    readButtons.forEach(btn => {
                        if (btn.title.includes(`line ${lineIndex + 1}`)) {
                            btn.style.background = '#E91E63';
                            btn.innerHTML = 'üîä';
                        }
                    });
                };

                lyricsUtterance.onend = function() {
                    readButtons.forEach(btn => {
                        btn.style.background = '#9C27B0';
                        btn.innerHTML = 'üó£Ô∏è';
                    });
                };

                lyricsUtterance.onerror = function(event) {
                    console.error('Speech synthesis error:', event);
                    readButtons.forEach(btn => {
                        btn.style.background = '#9C27B0';
                        btn.innerHTML = 'üó£Ô∏è';
                    });
                    alert('Error playing Vietnamese: ' + event.error);
                };

                // Start speaking
                lyricsSynth.speak(lyricsUtterance);
            } else {
                alert('Text-to-speech is not supported in this browser.');
            }
        }

        function stopVietnameseSpeech() {
            if (lyricsSynth && lyricsSynth.speaking) {
                lyricsSynth.cancel();
            }
            // Reset all read buttons
            document.querySelectorAll('.lyrics-playback-buttons button[title*="Read Vietnamese"]').forEach(btn => {
                btn.style.background = '#9C27B0';
                btn.innerHTML = 'üó£Ô∏è';
            });
        }

        function applyVietnameseVoiceSettings(utterance) {
            const voices = speechSynthesis.getVoices();
            let selectedVoice = null;

            // Check if user has selected a specific voice from test page
            const savedVoice = localStorage.getItem('selectedVietnameseVoice');
            if (savedVoice) {
                try {
                    const voiceData = JSON.parse(savedVoice);
                    selectedVoice = voices.find(voice =>
                        voice.name === voiceData.name && voice.lang === voiceData.lang
                    );
                    if (selectedVoice) {
                        utterance.voice = selectedVoice;
                        utterance.lang = selectedVoice.lang;
                        utterance.rate = voiceData.rate || currentVietnameseVoiceSettings.rate;
                        utterance.pitch = 1.0;
                        utterance.volume = currentVietnameseVoiceSettings.volume;
                        return;
                    }
                } catch (e) {
                    console.warn('Error loading saved voice:', e);
                }
            }

            // Fallback to original voice selection logic
            const voiceType = currentVietnameseVoiceSettings.type;

            // Try to find specific Vietnamese voices based on selection
            if (voiceType.includes('male')) {
                selectedVoice = voices.find(voice =>
                    (voice.lang.includes('vi') || voice.name.toLowerCase().includes('viet')) &&
                    (voice.name.toLowerCase().includes('male') || voice.name.toLowerCase().includes('nam'))
                ) || voices.find(voice =>
                    voice.lang.includes('vi') || voice.name.toLowerCase().includes('viet')
                );
            } else if (voiceType.includes('female')) {
                selectedVoice = voices.find(voice =>
                    (voice.lang.includes('vi') || voice.name.toLowerCase().includes('viet')) &&
                    (voice.name.toLowerCase().includes('female') || voice.name.toLowerCase().includes('n·ªØ'))
                ) || voices.find(voice =>
                    voice.lang.includes('vi') || voice.name.toLowerCase().includes('viet')
                );
            }

            // Fallback to any Vietnamese voice or default
            if (!selectedVoice) {
                selectedVoice = voices.find(voice =>
                    voice.lang.includes('vi') || voice.name.toLowerCase().includes('viet')
                );
            }

            if (selectedVoice) {
                utterance.voice = selectedVoice;
                utterance.lang = 'vi-VN';
            } else {
                utterance.lang = 'vi-VN';
            }

            // Apply voice characteristics based on region and gender
            const settings = getVoiceCharacteristics(voiceType);
            utterance.rate = currentVietnameseVoiceSettings.rate;
            utterance.pitch = settings.pitch;
            utterance.volume = currentVietnameseVoiceSettings.volume;
        }

        function getVoiceCharacteristics(voiceType) {
            const characteristics = {
                'male-bac': { pitch: 0.8, description: 'Northern Male - Lower pitch, clear pronunciation' },
                'female-bac': { pitch: 1.2, description: 'Northern Female - Higher pitch, clear pronunciation' },
                'male-trung': { pitch: 0.9, description: 'Central Male - Medium pitch, melodic tone' },
                'female-trung': { pitch: 1.1, description: 'Central Female - Medium-high pitch, melodic tone' },
                'male-nam': { pitch: 0.85, description: 'Southern Male - Slightly lower pitch, softer tone' },
                'female-nam': { pitch: 1.15, description: 'Southern Female - Medium-high pitch, softer tone' }
            };

            return characteristics[voiceType] || { pitch: 1.0, description: 'Default voice' };
        }

        function updateVietnameseVoice() {
            const selector = document.getElementById('vietnamese-voice-selector');
            currentVietnameseVoiceSettings.type = selector.value;

            // Update pitch based on voice type
            const characteristics = getVoiceCharacteristics(selector.value);
            currentVietnameseVoiceSettings.pitch = characteristics.pitch;

            console.log('Vietnamese voice updated:', selector.value, characteristics.description);
        }

        function updateSpeechRate() {
            const slider = document.getElementById('speech-rate-slider');
            const valueDisplay = document.getElementById('speech-rate-value');

            currentVietnameseVoiceSettings.rate = parseFloat(slider.value);
            valueDisplay.textContent = slider.value + 'x';
        }

        // Initialize voices when they're loaded
        if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = function() {
                // Voices are now loaded
                console.log('Available voices:', speechSynthesis.getVoices().map(v => v.name + ' (' + v.lang + ')'));
            };
        }

        // Right-Aligned Bar Chart Functions
        let rightBarChartVisible = true;

        function toggleRightBarChart() {
            const container = document.getElementById('rightBarChartContainer');
            const button = document.getElementById('toggleRightBarChart');

            rightBarChartVisible = !rightBarChartVisible;

            if (rightBarChartVisible) {
                container.style.display = 'block';
                button.textContent = 'üìä KP/RIC-1';
                button.style.background = '#008080';
                generateRightBarChart();
            } else {
                container.style.display = 'none';
                button.textContent = 'üìä Show KP/RIC-1';
                button.style.background = '#95a5a6';
            }

            // Recalculate zoom to account for bar chart visibility
            const zoomSelect = document.getElementById('zoomLevel');
            if (zoomSelect && zoomSelect.value === 'fit-width') {
                updateZoomFromSelect();
            }
        }

        function generateRightBarChart() {
            console.log('Generating right-aligned bar chart');

            // Update position to sync with tablature Y
            updateRightBarChartPosition();

            // Get current tablature zoom settings
            const tablatureContainer = document.querySelector('.tablature-container');
            const tablatureSvg = document.getElementById('tablatureSvg');
            // Use global Y-zoom variable instead of parsing transform
            const yZoomValue = currentYZoom || 0.67;
            console.log('üìè KP/RIC-1 using Y-zoom:', yZoomValue);

            // String configuration matching CLAUDE.md
            const stringInfo = {
                5: { note: 'D4', yPos: 110 },
                7: { note: 'G4', yPos: 260 },
                8: { note: 'A4', yPos: 320 },
                9: { note: 'C5', yPos: 410 },
                10: { note: 'D5', yPos: 470 },
                11: { note: 'E5', yPos: 530 },
                12: { note: 'G5', yPos: 620 }
            };

            // Extract duration data for each string (reusing existing logic)
            const noteCircles = document.querySelectorAll('.note-circle');

            // Reset string duration data
            Object.keys(stringInfo).forEach(stringNum => {
                stringInfo[stringNum].durations = {};
            });

            // Analyze each note
            noteCircles.forEach((circle, index) => {
                const cx = parseFloat(circle.getAttribute('data-base-x') || circle.getAttribute('cx'));
                const cy = parseFloat(circle.getAttribute('data-base-y') || circle.getAttribute('cy'));
                const isGrace = circle.getAttribute('data-is-grace') === 'true';

                // Get actual duration using unified function
                const durationValue = extractDurationFromTablature(cx, cy);

                // Map duration values to bar chart categories
                let durationType;
                if (durationValue >= 8) {
                    durationType = isGrace ? 'grace-half' : 'half';
                } else if (durationValue >= 4) {
                    durationType = isGrace ? 'grace-quarter' : 'quarter';
                } else if (durationValue >= 3) {
                    durationType = isGrace ? 'grace-dotted-eighth' : 'dotted-eighth';
                } else if (durationValue >= 2) {
                    durationType = isGrace ? 'grace-eighth' : 'eighth';
                } else if (durationValue >= 1) {
                    durationType = isGrace ? 'grace-16th' : '16th';
                } else {
                    durationType = isGrace ? 'grace-32nd' : '32nd';
                }

                // Find closest string
                let closestString = null;
                let minDistance = Infinity;
                for (const [stringNum, info] of Object.entries(stringInfo)) {
                    const distance = Math.abs(cy - info.yPos);
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestString = stringNum;
                    }
                }

                // Assign note to string
                if (closestString && minDistance < 30) {
                    if (!stringInfo[closestString].durations[durationType]) {
                        stringInfo[closestString].durations[durationType] = [];
                    }
                    stringInfo[closestString].durations[durationType].push({
                        index: index,
                        cx: cx,
                        cy: cy,
                        element: circle,
                        isGrace: isGrace
                    });
                }
            });

            // Store data globally for highlighting function
            window.stringAnalysisData = stringInfo;

            // Generate HTML for right bar chart
            generateRightBarChartHTML(stringInfo, yZoomValue);
        }

        function generateRightBarChartHTML(stringInfo, yZoom) {
            const container = document.getElementById('rightBarChartContent');

            // Duration types using your optimized color system from COLOR_SYSTEM.md
            const kpicColors = ['#0066CC', '#3498DB', '#5DADE2', '#85C1E9'];  // Blue family (pitch)
            const kricColors = ['#27AE60', '#52BE80', '#76D7A4', '#A9DFBF'];  // Green family (rhythm)
            const mainNoteColor = '#008080';  // Teal for main notes
            const graceNoteColor = '#FFD700'; // Gold for grace notes

            const durationTypes = [
                { type: 'half', thickness: 48, color: kricColors[0], label: 'Half (8)' },           // Primary green
                { type: 'grace-half', thickness: 48, color: graceNoteColor, label: 'Grace Half (8)' },       // Gold
                { type: 'quarter', thickness: 32, color: kricColors[1], label: 'Quarter (4)' },     // Light green
                { type: 'grace-quarter', thickness: 32, color: graceNoteColor, label: 'Grace Quarter (4)' },   // Gold
                { type: 'dotted-eighth', thickness: 24, color: kricColors[2], label: 'Dotted Eighth (3)' },  // Mint green
                { type: 'grace-dotted-eighth', thickness: 24, color: graceNoteColor, label: 'Grace Dotted Eighth (3)' }, // Gold
                { type: 'eighth', thickness: 16, color: mainNoteColor, label: 'Eighth (2)' },      // Teal (main note color)
                { type: 'grace-eighth', thickness: 16, color: graceNoteColor, label: 'Grace Eighth (2)' },     // Gold
                { type: '16th', thickness: 8, color: kpicColors[0], label: '16th (1)' },          // Primary blue
                { type: 'grace-16th', thickness: 8, color: graceNoteColor, label: 'Grace 16th (1)' },         // Gold
                { type: '32nd', thickness: 4, color: kpicColors[1], label: '32nd (0.5)' },        // Light blue
                { type: 'grace-32nd', thickness: 4, color: graceNoteColor, label: 'Grace 32nd (0.5)' }      // Gold
            ];

            // Calculate max count for bar scaling
            let maxCount = 0;
            Object.values(stringInfo).forEach(info => {
                if (info.durations) {
                    Object.values(info.durations).forEach(durationArray => {
                        maxCount = Math.max(maxCount, durationArray.length);
                    });
                }
            });

            let html = '';

            // Generate bars for each string
            Object.entries(stringInfo).forEach(([stringNum, info]) => {
                const yPos = info.yPos * yZoom; // Apply Y-zoom
                const durations = info.durations || {};

                // String label
                html += `
                    <div style="position: absolute; left: 5px; top: ${yPos - 10}px;
                         font-weight: bold; font-size: 12px; color: #2c3e50;
                         transform: translateY(-50%);">
                        ${info.note}
                    </div>
                `;

                if (Object.keys(durations).length > 0) {
                    let currentX = 50; // Start position for bars

                    // Render bars for each duration type that exists
                    durationTypes.forEach(durInfo => {
                        if (durations[durInfo.type] && durations[durInfo.type].length > 0) {
                            const count = durations[durInfo.type].length;
                            const barWidth = Math.max(20, (count / maxCount) * 200);
                            const barHeight = durInfo.thickness * 0.75; // Increased height (150% of 0.5)

                            html += `
                                <div class="right-bar-chart-bar"
                                     data-string="${stringNum}"
                                     data-duration="${durInfo.type}"
                                     data-color="${durInfo.color}"
                                     title="${durInfo.label}: ${count} notes"
                                     style="position: absolute;
                                            left: ${currentX}px;
                                            top: ${yPos - barHeight/2}px;
                                            width: ${barWidth}px;
                                            height: ${barHeight}px;
                                            background: ${durInfo.color};
                                            cursor: pointer;
                                            border-radius: 2px;
                                            opacity: 0.8;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            font-size: 15px;
                                            font-weight: bold;
                                            color: white;
                                            text-shadow:
                                                -0.5px -0.5px 0 #000,
                                                 0.5px -0.5px 0 #000,
                                                -0.5px  0.5px 0 #000,
                                                 0.5px  0.5px 0 #000;"
                                     onmouseover="this.style.opacity='1'"
                                     onmouseout="this.style.opacity='0.8'">
                                    ${count}
                                </div>
                            `;
                            currentX += barWidth + 5;
                        }
                    });
                }
            });

            container.innerHTML = html;

            // Add event listeners for proper multi-select support
            container.querySelectorAll('.right-bar-chart-bar').forEach(bar => {
                bar.addEventListener('click', function(event) {
                    const stringNum = this.getAttribute('data-string');
                    const durationType = this.getAttribute('data-duration');
                    const barColor = this.getAttribute('data-color');
                    highlightRightStringNotes(stringNum, durationType, event, barColor);
                });
            });
        }

        function highlightRightStringNotes(stringNum, durationType, event, barColor) {
            const isMultiSelect = event && (event.ctrlKey || event.metaKey);

            if (isMultiSelect) {
                // Multi-select mode: toggle this selection
                highlightStringNotesMulti(stringNum, durationType, barColor);
            } else {
                // Single select mode: clear others and highlight this one
                highlightStringNotesSingle(stringNum, durationType, barColor);
            }
        }

        // Single-select highlighting function with color-matched glow
        function highlightStringNotesSingle(stringNum, durationType, barColor) {
            // Clear all previous selections first
            document.querySelectorAll('[onclick*="highlightRightStringNotes"]').forEach(bar => {
                bar.classList.remove('selected-bar');
                bar.style.boxShadow = bar.getAttribute('data-original-shadow') || '';
                bar.style.filter = '';
                bar.style.transform = 'scale(1)';
            });

            // Clear all note highlights
            document.querySelectorAll('.note-circle').forEach(circle => {
                circle.style.filter = '';
            });

            if (!window.stringAnalysisData || !window.stringAnalysisData[stringNum]) return;

            const notes = window.stringAnalysisData[stringNum].durations[durationType];
            if (!notes || notes.length === 0) return;

            // Highlight the clicked bar
            const targetBar = document.querySelector(`[onclick*="highlightRightStringNotes('${stringNum}', '${durationType}'"]`);
            if (targetBar) {
                if (!targetBar.getAttribute('data-original-shadow')) {
                    targetBar.setAttribute('data-original-shadow', targetBar.style.boxShadow || '');
                }
                targetBar.classList.add('selected-bar');

                // Use bar color for the glow effect
                const glowColor = barColor;
                targetBar.style.boxShadow = `0 0 20px ${glowColor}, 0 0 40px ${glowColor}`;
                targetBar.style.filter = 'brightness(1.2)';
                targetBar.style.transform = 'scale(1.05)';
            }

            // Highlight notes with color-matched glow
            notes.forEach((noteData, index) => {
                const circle = noteData.element;
                setTimeout(() => {
                    circle.style.filter = `drop-shadow(0 0 15px ${barColor}) drop-shadow(0 0 25px ${barColor}) drop-shadow(0 0 35px ${barColor})`;
                    circle.style.transition = 'filter 0.3s ease';
                }, index * 80);
            });

            // Show notification
            const stringNote = window.stringAnalysisData[stringNum].note;
            const durationLabel = durationType.replace('grace-', 'Grace ').replace(/^\w/, c => c.toUpperCase());
            showNotification(`Highlighted ${notes.length} ${durationLabel} notes on String ${stringNum} (${stringNote})`);
        }

        // Multi-select highlighting function
        function highlightStringNotesMulti(stringNum, durationType, barColor) {
            if (!window.stringAnalysisData || !window.stringAnalysisData[stringNum]) return;

            const notes = window.stringAnalysisData[stringNum].durations[durationType];
            if (!notes || notes.length === 0) return;

            // Check if this selection is already active
            const targetBar = document.querySelector(`[onclick*="highlightRightStringNotes('${stringNum}', '${durationType}'"]`);
            const isCurrentlySelected = targetBar && targetBar.classList.contains('selected-bar');

            if (isCurrentlySelected) {
                // Deselect this bar and its notes
                targetBar.classList.remove('selected-bar');
                targetBar.style.boxShadow = targetBar.getAttribute('data-original-shadow') || '';
                targetBar.style.filter = '';
                targetBar.style.transform = 'scale(1)';

                notes.forEach(noteData => {
                    noteData.element.style.filter = '';
                });
            } else {
                // Select this bar and its notes
                if (targetBar) {
                    if (!targetBar.getAttribute('data-original-shadow')) {
                        targetBar.setAttribute('data-original-shadow', targetBar.style.boxShadow || '');
                    }
                    targetBar.classList.add('selected-bar');
                    targetBar.style.boxShadow = `0 0 20px ${barColor}, 0 0 40px ${barColor}`;
                    targetBar.style.filter = 'brightness(1.2)';
                    targetBar.style.transform = 'scale(1.05)';
                }

                notes.forEach((noteData, index) => {
                    const circle = noteData.element;
                    setTimeout(() => {
                        circle.style.filter = `drop-shadow(0 0 15px ${barColor}) drop-shadow(0 0 25px ${barColor}) drop-shadow(0 0 35px ${barColor})`;
                        circle.style.transition = 'filter 0.3s ease';
                    }, index * 80);
                });
            }

            // Show notification
            const stringNote = window.stringAnalysisData[stringNum].note;
            const action = isCurrentlySelected ? 'Deselected' : 'Selected';
            const durationLabel = durationType.replace('grace-', 'Grace ').replace(/^\w/, c => c.toUpperCase());
            showNotification(`${action} ${notes.length} ${durationLabel} notes on String ${stringNum} (${stringNote})`);
        }

        // Update right bar chart when tablature zoom changes
        function updateRightBarChartZoom() {
            if (rightBarChartVisible) {
                generateRightBarChart();
            }
        }

        function updateRightBarChartPosition() {
            const container = document.getElementById('rightBarChartContainer');
            const tablatureSvg = document.getElementById('tablatureSvg');

            if (!container || !tablatureSvg) return;

            // Get the tablature SVG's current position
            const svgRect = tablatureSvg.getBoundingClientRect();

            // Keep the chart Y position synced with tablature
            container.style.top = svgRect.top + 'px';
        }

        // Initialize right bar chart on page load
        window.addEventListener('load', function() {
            if (rightBarChartVisible) {
                generateRightBarChart();
            }
        });

        // Update bar chart content and position on window resize and scroll
        window.addEventListener('resize', function() {
            if (rightBarChartVisible) {
                updateRightBarChartPosition();
                setTimeout(() => generateRightBarChart(), 100);
            }
        });

        window.addEventListener('scroll', function() {
            if (rightBarChartVisible) {
                updateRightBarChartPosition();
            }
        });

        // Analysis Modal Functions
        function openAnalysisModal() {
            document.getElementById('analysisModal').style.display = 'block';
        }

        function closeAnalysisModal() {
            document.getElementById('analysisModal').style.display = 'none';
        }

        function showAnalysisTab(tabName) {
            // Hide all tab contents
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.style.display = 'none');

            // Show selected tab
            document.getElementById(tabName + '-tab').style.display = 'block';

            // Update tab buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => {
                button.style.background = '#bdc3c7';
                button.style.color = '#34495e';
                button.classList.remove('active');
            });

            // Highlight active button
            event.target.style.background = '#3498db';
            event.target.style.color = 'white';
            event.target.classList.add('active');
        }

        function exportAnalysis() {
            // Create a comprehensive text version of the analysis
            const songTitle = document.getElementById('songTitle').textContent;
            const analysisContent = `
# Song Analysis: ${songTitle}

## Key Takeaways

### Cultural Message
A humorous Vietnamese folk song depicting marital hardships, using wit and satire to comment on social relationships and domestic life challenges.

### Musical Key Points
- Uses 7 of 16 ƒê√†n Tranh strings (D4-G5 range)
- Dominated by descending melodic patterns
- C5-A4-C5 oscillation is most characteristic
- Intermediate-advanced difficulty level

### Learning Focus
- Master the E5-D5-C5-A4-C5 descending phrase
- Practice the long melodic sequences (16+ notes)
- Work on smooth transitions between registers
- Focus on expressive melodic storytelling

## Cultural Significance

### Lyrics in Vietnamese Society
"B√† R·∫±ng B√† R√≠" uses humor and wordplay to address serious social issues about marriage and domestic relationships. The song's satirical tone allows for social commentary while entertaining, reflecting Vietnamese culture's tradition of using folk songs to discuss difficult topics through wit and metaphor. The repetitive "b√† R·∫±ng b√† R√≠" phrase creates a rhythmic storytelling device typical of Vietnamese oral tradition.

### Historical Context
This folk song represents the tradition of Vietnamese satirical music, where social criticism is delivered through humor and memorable melodies. Such songs were important outlets for expressing frustrations about social conditions, particularly regarding family and marital relationships. The melodic complexity reflects the sophisticated storytelling tradition of Vietnamese folk music.

## Technical Analysis

### String Usage Analysis
**Strings Used:** 7 out of 16 total strings
- String 5 (D4): 12 occurrences
- String 7 (G4): 24 occurrences
- String 8 (A4): 31 occurrences
- String 9 (C5): 72 occurrences
- String 10 (D5): 28 occurrences
- String 11 (E5): 19 occurrences
- String 12 (G5): 3 occurrences

### Range and Difficulty
**Melodic Range:** D4 to G5 (spanning 1.5 octaves)
**Difficulty Level:** Intermediate - requires good left-hand dexterity and rhythm control
**Key Challenges:** Dotted rhythm precision, smooth transitions between C5-A4-G4

## Pattern Analysis

### Top KPIC (Pitch) Patterns
1. C5 ‚Üí C5 (Same note repetition) - 16 times
2. A4 ‚Üí C5 (Ascending minor third) - 14 times
3. C5 ‚Üí A4 (Descending minor third) - 14 times
4. C5 ‚Üí D5 (Ascending major second) - 10 times

These patterns form the melodic backbone of the piece, with C5-A4 oscillation being particularly characteristic.

### Top KRIC (Rhythm) Patterns
1. ‚ô™. ‚Üí ‚ô™ (Dotted eighth to eighth) - 28 times
2. ‚ô™ ‚Üí ‚ô™. (Eighth to dotted eighth) - 26 times
3. ‚ô™ ‚Üí ‚ô™ (Even eighth notes) - 22 times

The heavy use of dotted eighth notes creates the characteristic "lilt" or swing feel of this traditional Vietnamese melody.

## Rhythmic Character

### Dotted Eighth Note Emphasis
The extensive use of dotted eighth notes (‚ô™.) is what gives "L√Ω Ng·ª±a √î" its distinctive rhythmic character. This creates a galloping rhythm that musically represents the horse's gait mentioned in the song's title.

**Rhythmic Impact:**
- Creates forward momentum and energy
- Mimics the natural rhythm of horse hooves
- Provides characteristic Vietnamese folk rhythm
- Adds complexity without overwhelming the melody

### Practice Recommendations
1. **Rhythm Isolation:** Practice the dotted rhythm pattern on a single string before adding pitch changes.
2. **Metronome Work:** Start at 80 BPM and gradually increase to performance tempo (120 BPM).
3. **Pattern Focus:** Master the C5-A4-C5 melodic pattern with correct dotted rhythms.
4. **Expression:** Emphasize the strong beats while keeping dotted notes light and flowing.

---
Generated by ƒê√†n Tranh Tablature Analysis System
            `;

            // Create and download the file
            const blob = new Blob([analysisContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${songTitle.replace(/\s+/g, '_')}_Analysis.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('analysisModal');
            if (event.target == modal) {
                closeAnalysisModal();
            }
        }

        // Bent Notes Highlighting System
        let bentNotesHighlighted = false;

        // Initialize bent notes to grey (OFF state) when page loads
        function initializeBentNotesToGrey() {
            const svg = document.getElementById('tablatureSvg');
            if (!svg) return;

            const allNotes = svg.querySelectorAll('.note-circle');
            allNotes.forEach(noteCircle => {
                const currentFill = noteCircle.getAttribute('fill');
                // If note is red (bent note), change it to grey initially
                if (currentFill === '#E74C3C') {
                    noteCircle.setAttribute('data-original-red-fill', '#E74C3C'); // Remember it was bent
                    noteCircle.setAttribute('fill', '#666666'); // Set to grey by default
                }
            });
        }

        function toggleBentNotesHighlight() {
            const svg = document.getElementById('tablatureSvg');
            if (!svg) return;

            const bentNoteCircles = [];
            const allNotes = svg.querySelectorAll('.note-circle');

            // Find all bent notes by checking for the data attribute we set during initialization
            allNotes.forEach(noteCircle => {
                // Find notes that were originally bent (marked during initialization)
                if (noteCircle.getAttribute('data-original-red-fill') === '#E74C3C') {
                    bentNoteCircles.push(noteCircle);
                }
            });

            const metric = document.getElementById('bentStringsMetric');

            if (!bentNotesHighlighted) {
                // Turn ON highlighting: Change grey bent notes to red
                bentNoteCircles.forEach(circle => {
                    circle.setAttribute('fill', '#E74C3C'); // Red fill (ON state)
                });
                bentNotesHighlighted = true;
                metric.style.background = '#E74C3C';
                metric.style.borderColor = '#E74C3C';
                metric.querySelector('span').style.color = 'white';
            } else {
                // Turn OFF highlighting: Change red bent notes back to grey
                bentNoteCircles.forEach(circle => {
                    circle.setAttribute('fill', '#666666'); // Grey fill (OFF state)
                });
                bentNotesHighlighted = false;
                metric.style.background = 'white';
                metric.style.borderColor = '#27ae60';
                metric.querySelector('span').style.color = '#27ae60';
            }
        }

        // Update bent strings/notes metrics on page load
        function updateBentMetrics() {
            const svg = document.getElementById('tablatureSvg');
            if (!svg) return;

            const bentStrings = new Set();
            const bentNoteIndices = new Set();
            const allNotes = svg.querySelectorAll('.note-circle');

            allNotes.forEach(noteCircle => {
                const noteIndex = noteCircle.getAttribute('data-note-index');
                const bendSymbol = svg.querySelector(`.bend-symbol[data-note-index="${noteIndex}"]`);
                if (bendSymbol) {
                    bentNoteIndices.add(noteIndex);
                    // Extract string number from the note
                    const stringText = noteCircle.nextElementSibling;
                    if (stringText && stringText.classList.contains('string-number')) {
                        bentStrings.add(stringText.textContent.trim());
                    }
                }
            });

            document.getElementById('bentStringsCount').textContent = bentStrings.size;
            document.getElementById('bentNotesCount').textContent = bentNoteIndices.size;
        }

        // Call on page load
        setTimeout(updateBentMetrics, 500);

        // Update tuning display with song-specific tuning
        const SONG_TUNING = '__SONG_TUNING__'; // Will be replaced by generator
        if (SONG_TUNING && SONG_TUNING !== '__SONG_TUNING__') {
            const tuningArray = JSON.parse(SONG_TUNING);
            document.getElementById('tuningDisplay').textContent = tuningArray.join(' - ');
        }

    </script>
    <script>
        // Initialize bent notes to grey when page loads
        window.addEventListener('load', function() {
            setTimeout(initializeBentNotesToGrey, 500);
        });
    </script>
</body>
</html>