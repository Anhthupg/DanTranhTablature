<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vietnamese Voice Test - Choose Your Preferred Voice</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        .test-phrase {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #3498db;
            margin-bottom: 30px;
            text-align: center;
        }

        .vietnamese-text {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .english-text {
            font-size: 16px;
            color: #666;
            font-style: italic;
        }

        .voice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .voice-card {
            background: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .voice-card:hover {
            border-color: #3498db;
            transform: translateY(-2px);
        }

        .voice-card.selected {
            border-color: #27ae60;
            background: #e8f5e8;
        }

        .voice-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .voice-details {
            font-size: 12px;
            color: #666;
            margin-bottom: 15px;
            min-height: 40px;
        }

        .voice-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .play-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .play-btn:hover {
            background: #2980b9;
        }

        .play-btn.playing {
            background: #e74c3c;
        }

        .select-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }

        .select-btn:hover {
            background: #219a52;
        }

        .rate-control {
            font-size: 11px;
            color: #666;
        }

        .rate-control input {
            width: 60px;
            margin: 0 5px;
        }

        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .selected-voice {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
        }

        .back-btn:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <a href="analytical_tablature.html" class="back-btn">‚Üê Back to Tablature</a>

    <div class="container">
        <h1>üó£Ô∏è Vietnamese Pronunciation Options</h1>

        <div class="instructions">
            <strong>‚ö†Ô∏è Note:</strong> Most system voices don't pronounce Vietnamese correctly. Below are the available options:
            <br><strong>üéØ Recommended:</strong> Use the "Phonetic Guide" option which shows Vietnamese pronunciation in a more readable format, or try Google Translate voice (external link).
        </div>

        <div class="test-phrase">
            <div class="vietnamese-text">B√† R·∫±ng b√† R√≠, ·ªõi r·∫±ng b√† ƒëi</div>
            <div class="english-text">"Grandmother Rang and Grandmother Ri, oh where are you going?"</div>
        </div>

        <!-- Alternative Solutions -->
        <div class="voice-grid">
            <!-- Phonetic Guide Option -->
            <div class="voice-card">
                <div class="voice-name">üìö Phonetic Reading Guide</div>
                <div class="voice-details">
                    Shows pronunciation guide when you click üó£Ô∏è buttons<br>
                    <strong>Example:</strong> "B√† R·∫±ng" ‚Üí "Ba Zahng"<br>
                    <strong>Best for:</strong> Learning pronunciation
                </div>
                <div class="voice-controls">
                    <button class="play-btn" onclick="showPhoneticDemo()">üìñ Show Example</button>
                </div>
                <button class="select-btn" onclick="selectPhoneticMode()">‚úÖ Use Phonetic Guide</button>
            </div>

            <!-- Google Translate Option -->
            <div class="voice-card">
                <div class="voice-name">üåê Google Translate (External)</div>
                <div class="voice-details">
                    Opens Google Translate with Vietnamese text<br>
                    <strong>Quality:</strong> Excellent Vietnamese pronunciation<br>
                    <strong>Note:</strong> Requires internet connection
                </div>
                <div class="voice-controls">
                    <button class="play-btn" onclick="openGoogleTranslate()">üîó Try Google Translate</button>
                </div>
                <button class="select-btn" onclick="selectGoogleTranslate()">‚úÖ Use Google Translate</button>
            </div>

            <!-- Best System Voice Option -->
            <div class="voice-card">
                <div class="voice-name">üé§ Best Available System Voice</div>
                <div class="voice-details">
                    Uses the best voice your system offers<br>
                    <strong>Quality:</strong> Variable (may not be accurate)<br>
                    <strong>Note:</strong> Works offline but pronunciation limited
                </div>
                <div class="voice-controls">
                    <button class="play-btn" onclick="testBestSystemVoice()" id="system-voice-btn">üîä Test System Voice</button>
                    <div class="rate-control">
                        Speed: <input type="range" min="0.5" max="1.5" step="0.1" value="0.7" id="system-rate" onchange="updateSystemRate()">
                        <span id="system-rate-value">0.7x</span>
                    </div>
                </div>
                <button class="select-btn" onclick="selectSystemVoice()">‚úÖ Use System Voice</button>
            </div>
        </div>

        <!-- Phonetic Demo -->
        <div id="phonetic-demo" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h3>üìñ Phonetic Reading Guide Example:</h3>
            <div style="font-family: monospace; font-size: 16px; line-height: 2;">
                <strong>Vietnamese:</strong> B√† R·∫±ng b√† R√≠, ·ªõi r·∫±ng b√† ƒëi<br>
                <strong>Phonetic:</strong> Ba Zahng ba Zee, uh-ee zahng ba dee<br>
                <strong>Tones:</strong> ‚Üò ‚Üò ‚Üò ‚Üó ‚Üó ‚Üò ‚Üò ‚Üí
            </div>
        </div>

        <div id="selected-voice" class="selected-voice" style="display: none;">
            <strong>‚úÖ Selected Voice:</strong> <span id="selected-voice-name"></span>
            <br>
            <button onclick="applySelectedVoice()" style="margin-top: 10px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">Apply to Tablature</button>
        </div>
    </div>

    <script>
        let speechSynth = window.speechSynthesis;
        let currentlyPlaying = null;
        const testPhrase = "B√† R·∫±ng b√† R√≠, ·ªõi r·∫±ng b√† ƒëi";

        function showPhoneticDemo() {
            const demo = document.getElementById('phonetic-demo');
            demo.style.display = demo.style.display === 'none' ? 'block' : 'none';
        }

        function openGoogleTranslate() {
            const encodedText = encodeURIComponent(testPhrase);
            const url = `https://translate.google.com/?sl=vi&tl=en&text=${encodedText}&op=translate`;
            window.open(url, '_blank');
        }

        function testBestSystemVoice() {
            if (currentlyPlaying) {
                speechSynth.cancel();
                document.getElementById('system-voice-btn').textContent = 'üîä Test System Voice';
                currentlyPlaying = null;
                return;
            }

            const voices = speechSynth.getVoices();
            const rate = parseFloat(document.getElementById('system-rate').value);

            // Try to find best voice
            let bestVoice = voices.find(voice => voice.lang.includes('vi')) ||
                          voices.find(voice => voice.lang.includes('en-US')) ||
                          voices.find(voice => voice.lang.includes('en')) ||
                          voices[0];

            const utterance = new SpeechSynthesisUtterance(testPhrase);
            if (bestVoice) utterance.voice = bestVoice;
            utterance.lang = 'vi-VN';
            utterance.rate = rate;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;

            const btn = document.getElementById('system-voice-btn');
            btn.textContent = 'üîä Playing...';
            currentlyPlaying = true;

            utterance.onend = function() {
                btn.textContent = 'üîä Test System Voice';
                currentlyPlaying = null;
            };

            utterance.onerror = function() {
                btn.textContent = '‚ùå Error';
                currentlyPlaying = null;
            };

            speechSynth.speak(utterance);
        }

        function updateSystemRate() {
            const slider = document.getElementById('system-rate');
            const valueDisplay = document.getElementById('system-rate-value');
            valueDisplay.textContent = slider.value + 'x';
        }

        function selectPhoneticMode() {
            localStorage.setItem('vietnameseReadingMode', 'phonetic');
            showSelection('Phonetic Reading Guide');
        }

        function selectGoogleTranslate() {
            localStorage.setItem('vietnameseReadingMode', 'google');
            showSelection('Google Translate (External)');
        }

        function selectSystemVoice() {
            const voices = speechSynth.getVoices();
            let bestVoice = voices.find(voice => voice.lang.includes('vi')) ||
                          voices.find(voice => voice.lang.includes('en-US')) ||
                          voices.find(voice => voice.lang.includes('en')) ||
                          voices[0];

            const rate = parseFloat(document.getElementById('system-rate').value);

            localStorage.setItem('vietnameseReadingMode', 'system');
            localStorage.setItem('selectedVietnameseVoice', JSON.stringify({
                name: bestVoice ? bestVoice.name : 'Default',
                lang: bestVoice ? bestVoice.lang : 'en-US',
                rate: rate
            }));

            showSelection(`System Voice: ${bestVoice ? bestVoice.name : 'Default'}`);
        }

        function showSelection(modeName) {
            document.querySelectorAll('.voice-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Find and select the appropriate card
            const cards = document.querySelectorAll('.voice-card');
            if (modeName.includes('Phonetic')) cards[0].classList.add('selected');
            else if (modeName.includes('Google')) cards[1].classList.add('selected');
            else if (modeName.includes('System')) cards[2].classList.add('selected');

            const selectedDiv = document.getElementById('selected-voice');
            const nameSpan = document.getElementById('selected-voice-name');
            nameSpan.textContent = modeName;
            selectedDiv.style.display = 'block';
        }

        function applySelectedVoice() {
            alert('‚úÖ Selection saved! You can now return to the tablature. Your chosen option will be used for Vietnamese reading.');
        }

        // Load any previously selected mode
        const previousMode = localStorage.getItem('vietnameseReadingMode');
        if (previousMode) {
            if (previousMode === 'phonetic') showSelection('Phonetic Reading Guide');
            else if (previousMode === 'google') showSelection('Google Translate (External)');
            else if (previousMode === 'system') {
                const voiceData = localStorage.getItem('selectedVietnameseVoice');
                if (voiceData) {
                    try {
                        const parsed = JSON.parse(voiceData);
                        showSelection(`System Voice: ${parsed.name}`);
                    } catch (e) {
                        showSelection('System Voice: Default');
                    }
                }
            }
        }
    </script>
</body>
</html>